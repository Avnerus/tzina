(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);var _multiline_text=require("../util/multiline_text");var _multiline_text2=_interopRequireDefault(_multiline_text);var _index=require("../lib/text2d/index");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Agam12PMAnimation=function(_THREE$Object3D){_inherits(Agam12PMAnimation,_THREE$Object3D);function Agam12PMAnimation(config,square){_classCallCheck(this,Agam12PMAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Agam12PMAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/agam12pm";_this.square=square;_this.didInit=false;_this.INTRO_TEXT=["Yaakov Agam, 89 years old.","The godfather of Kinetic art and one of the first","who asked the viewer to participate.","This fountain, “Water and Fire”, is a piece that","represents the core of his philosophy."];_this.INTRO_TEXT_HEB=[".יעקב אגם, בן 89","אבי האמנות הקינטית ומהראשונים",".ששיתפו את הצופה ביצירה עצמה",'.המזרקה, פסל "המים והאש", מהווה את יסוד תורתו'];_this.showedIntro=false;return _this}_createClass(Agam12PMAnimation,[{key:"init",value:function init(loadingManager){if(!this.didInit){this.loadingManager=loadingManager;this.setupAnim();this.text=this.generateText();this.text.hide(0);this.text.setText(this.config.language=="heb"?this.INTRO_TEXT_HEB:this.INTRO_TEXT);this.add(this.text);this.didInit=true}}},{key:"showIntroText",value:function showIntroText(){var _this2=this;this.showedIntro=true;this.text.show(1);setTimeout(function(){if(_this2.text){_this2.text.hide(1).then(function(){_this2.remove(_this2.text)})}},2e4)}},{key:"generateText",value:function generateText(){var TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#33e5ab",antialias:true,shadow:true,shadowSize:6};var text=new _multiline_text2.default(5,TEXT_DEFINITION,100);text.init();text.position.set(-9.1,5.4,-9,56);text.scale.set(.0087,.0087,.0087);return text}},{key:"setupAnim",value:function setupAnim(){var _this3=this;this.animStart=false;this.sequenceConfig=[{time:15,anim:function anim(){_this3.firstAni()}}];this.nextAnim=null;this.completeSequenceSetup();this.loadingManager.itemStart("Agam12PMAnim");var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}var agamTex=tex_loader.load(this.BASE_PATH+"/images/agamFigure.jpg");this.agamMat=new THREE.MeshLambertMaterial({map:agamTex});loader.load(this.BASE_PATH+"/models/agamFigure.json",function(geometry,material){_this3.agamGeo=geometry;_this3.agamArt=new THREE.Mesh(_this3.agamGeo,_this3.agamMat);_this3.agamArt.position.set(-.44,.32,-4.78);_this3.agamArt.scale.multiplyScalar(1.31);_this3.add(_this3.agamArt)});var agamSmallTex_1=tex_loader.load(this.BASE_PATH+"/images/agamSmall_1.jpg");var agamSmallTex_2=tex_loader.load(this.BASE_PATH+"/images/agamSmall_2.jpg");this.agamSMat1=new THREE.MeshLambertMaterial({map:agamSmallTex_1});this.agamSMat2=new THREE.MeshLambertMaterial({map:agamSmallTex_2});loader.load(this.BASE_PATH+"/models/agamSmall.json",function(geometry,material){_this3.agamGeoS=geometry;_this3.agamSmall_1=new THREE.Mesh(_this3.agamGeoS,_this3.agamSMat1);_this3.agamSmall_1.position.set(2.88,.26,-2.21);_this3.agamSmall_1.scale.multiplyScalar(.56);_this3.add(_this3.agamSmall_1);_this3.agamSmall_2=new THREE.Mesh(_this3.agamGeoS,_this3.agamSMat2);_this3.agamSmall_2.position.set(-2,.18,-1.85);_this3.agamSmall_2.scale.multiplyScalar(.5);_this3.add(_this3.agamSmall_2)});this.dummy={opacity:1};events.on("experience_end",function(){_this3.disposeAni()});this.loadingManager.itemEnd("Agam12PMAnim")}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"firstAni",value:function firstAni(){}},{key:"characterDisappear",value:function characterDisappear(){var _this4=this;TweenMax.to(this.dummy,5,{opacity:0,onUpdate:function onUpdate(){_this4.parent.fullVideo.setOpacity(_this4.dummy.opacity)},onStart:function onStart(){},onComplete:function onComplete(){_this4.parent.fullVideo.setOpacity(0)}})}},{key:"disposeAni",value:function disposeAni(){this.remove(this.text);this.remove(this.agamArt);this.remove(this.agamSmall_1);this.remove(this.agamSmall_2);this.agamMat.map.dispose();this.agamSMat1.map.dispose();this.agamSMat2.map.dispose();this.agamMat.dispose();this.agamSMat1.dispose();this.agamSMat2.dispose();this.agamGeo.dispose();this.agamGeoS.dispose();console.log("dispose Agam ani!")}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(!this.showedIntro&&time>=10){this.showIntroText()}if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}this.square.fountain.updateVideoTime(time)}},{key:"update",value:function update(dt,et){}}]);return Agam12PMAnimation}(THREE.Object3D);exports.default=Agam12PMAnimation},{"../lib/text2d/index":40,"../util/debug":58,"../util/multiline_text":64}],2:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var HaimAnimation=function(_THREE$Object3D){_inherits(HaimAnimation,_THREE$Object3D);function HaimAnimation(renderer,sky,square,config){_classCallCheck(this,HaimAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(HaimAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/haim";_this.sky=sky;_this.square=square;return _this}_createClass(HaimAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.loadingManager.itemStart("HaimAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.sequenceConfig=[{time:2,anim:function anim(){_this2.bagOn()}},{time:12,anim:function anim(){_this2.tubeDown(1)}},{time:73,anim:function anim(){_this2.tubeOut(.5)}},{time:75,anim:function anim(){_this2.skyLightDarken()}},{time:82,anim:function anim(){_this2.skyLightStorm()}},{time:246,anim:function anim(){_this2.skyLightBack()}},{time:252,anim:function anim(){_this2.characterDisappear()}}];this.nextAnim=null;this.completeSequenceSetup();this.lookupTable=[];for(var _i=0;_i<50;_i++){this.lookupTable.push(Math.random())}this.envLightChanged=false;this.ARC_SEGMENTS=20;this.liquidTex=tex_loader.load(this.BASE_PATH+"/images/liquid_trans.png");this.liquidTex.repeat.x=1;this.liquidTex.repeat.y=1;this.liquidTex.offset.x=-1.5;var liquidOutTex=tex_loader.load(this.BASE_PATH+"/images/liquid_trans.png");liquidOutTex.offset.x=-1.5;var curveData=[{0:[["-3.159","10.927","0.000"],["-3.189","11.500","0.000"],["-3.177","12.022","0.000"],["-3.136","12.631","0.000"],["-3.128","13.234","0.000"]],1:[["-3.781","8.857","0.000"],["-3.286","9.857","0.000"],["-3.160","11.100","0.000"],["-3.068","12.128","0.000"],["-3.128","13.234","0.000"]],2:[["-7.611","5.348","0.000"],["-6.050","7.141","0.000"],["-4.323","8.570","0.000"],["-3.094","10.206","0.000"],["-3.128","13.234","0.000"]],3:[["-5.944","2.942","0.000"],["-6.979","5.283","0.000"],["-4.898","7.275","0.000"],["-3.115","9.459","0.000"],["-3.128","13.234","0.000"]],4:[["-1.120","0.241","0.000"],["-2.292","1.358","0.000"],["-3.449","3.592","0.000"],["-3.163","7.837","0.000"],["-3.128","13.234","0.000"]]},{0:[["2.018","10.354","0.000"],["2.019","10.557","0.000"],["2.019","10.644","0.000"],["2.019","10.857","0.000"],["2.019","11.103","0.000"]],1:[["3.076","8.242","0.000"],["2.423","9.122","0.000"],["2.229","9.807","0.000"],["2.089","10.399","0.000"],["2.023","11.103","0.000"]],2:[["4.283","5.164","0.000"],["4.339","6.507","0.000"],["3.444","7.655","0.000"],["2.348","9.105","0.000"],["2.026","11.103","0.000"]],3:[["3.733","4.397","0.000"],["5.174","5.680","0.000"],["4.101","7.572","0.000"],["2.319","8.977","0.000"],["2.027","11.103","0.000"]],4:[["0.309","1.753","0.000"],["0.922","2.383","0.000"],["2.148","3.644","0.000"],["2.068","8.616","0.000"],["2.028","11.103","0.000"]]},{0:[["-5.225","11.075","0.000"],["-5.225","11.207","0.000"],["-5.225","11.322","0.000"],["-5.225","11.454","0.000"],["-5.229","11.617","0.000"]],1:[["-5.531","9.877","0.000"],["-5.346","10.366","0.000"],["-5.282","10.892","0.000"],["-5.207","11.245","0.000"],["-5.229","11.617","0.000"]],2:[["-6.292","7.159","0.000"],["-6.103","8.209","0.000"],["-5.783","9.283","0.000"],["-5.226","10.430","0.000"],["-5.229","11.617","0.000"]],3:[["-6.584","4.154","0.000"],["-7.290","5.244","0.000"],["-6.810","7.861","0.000"],["-5.263","9.541","0.000"],["-5.229","11.617","0.000"]],4:[["-2.564","1.722","0.000"],["-4.488","2.871","0.000"],["-5.184","6.074","0.000"],["-5.283","9.124","0.000"],["-5.229","11.617","0.000"]]},{0:[["4.340","10.498","0.000"],["4.340","10.631","0.000"],["4.340","10.763","0.000"],["4.340","10.949","0.000"],["4.340","11.109","0.000"]],1:[["4.883","9.308","0.000"],["4.646","9.712","0.000"],["4.466","10.098","0.000"],["4.394","10.526","0.000"],["4.340","11.109","0.000"]],2:[["5.913","6.951","0.000"],["5.945","7.930","0.000"],["5.383","8.794","0.000"],["4.804","9.583","0.000"],["4.340","11.109","0.000"]],3:[["5.201","3.987","0.000"],["6.796","4.851","0.000"],["7.024","6.938","0.000"],["4.738","8.295","0.000"],["4.340","11.109","0.000"]],4:[["0.395","0.520","0.000"],["2.293","1.171","0.000"],["4.523","2.861","0.000"],["4.307","8.094","0.000"],["4.340","11.109","0.000"]]}];this.tubes=[];this.liquidInTubes=[];this.tubesVec=[];this.tubesCurve=[];this.tubesGeo=[];this.tubesMat=[];for(var k=0;k<curveData.length;k++){var curve_vec={};var c_size=Object.keys(curveData[k]).length;for(var _i2=0;_i2<c_size;_i2++){curve_vec[_i2]=[];for(var j=0;j<curveData[k][_i2].length;j++){var newVector=new THREE.Vector3(Number(curveData[k][_i2][j][0]),Number(curveData[k][_i2][j][1]),Number(curveData[k][_i2][j][2]));newVector.multiply(new THREE.Vector3(.4,.8,.4));curve_vec[_i2].push(newVector)}}this.tubesVec.push(curve_vec)}this.cloudTex=tex_loader.load(this.BASE_PATH+"/images/clouds.png");this.cloudMat=new THREE.MeshBasicMaterial({color:65535,map:this.cloudTex,blending:"AdditiveBlending",side:THREE.DoubleSide,opacity:1});this.cloudGroup={"in":[],out:[]};this.bag;this.bagTexs=[],this.bagAniTexs=[];var bagFiles=[this.BASE_PATH+"/images/tubeBag.png",this.BASE_PATH+"/images/tubeBag_B.png",this.BASE_PATH+"/images/tubeBag_E.png",this.BASE_PATH+"/images/tubeBag_M.png"];var bagAniFiles=[this.BASE_PATH+"/images/lip_ani.png",this.BASE_PATH+"/images/wool_ani.png",this.BASE_PATH+"/images/eye_ani.png",this.BASE_PATH+"/images/dollar_ani.png"];for(var _i3=0;_i3<bagFiles.length;_i3++){var bagTex=tex_loader.load(bagFiles[_i3]);var bagAniTex=tex_loader.load(bagAniFiles[_i3]);this.bagTexs.push(bagTex);this.bagAniTexs.push(bagAniTex)}var curveOutData=[{0:[["-0.147","1.266","0.000"],["0.065","1.479","0.000"],["0.207","1.585","0.000"],["0.384","1.869","0.000"],["0.597","2.188","0.000"]],1:[["-0.147","1.266","0.000"],["0.233","1.658","0.000"],["0.630","2.155","0.000"],["1.191","2.917","0.000"],["1.528","3.654","0.000"]],2:[["-0.147","1.266","0.000"],["0.758","2.335","0.000"],["1.724","3.843","0.000"],["2.172","6.088","0.000"],["2.369","8.359","0.000"]],3:[["-0.147","1.266","0.000"],["1.466","2.775","0.000"],["2.347","5.554","0.000"],["2.663","9.469","0.000"],["2.790","12.589","0.000"]],4:[["-0.147","1.266","0.000"],["1.896","2.992","0.000"],["2.635","6.535","0.000"],["2.875","11.431","0.000"],["2.972","14.938","0.000"]]},{0:[["-0.633","0.149","0.000"],["-0.895","0.234","0.000"],["-1.105","0.360","0.000"],["-1.367","0.456","0.000"],["-1.597","0.578","0.000"]],1:[["-0.633","0.149","0.000"],["-1.193","0.319","0.000"],["-1.684","0.615","0.000"],["-2.361","0.931","0.000"],["-3.178","1.504","0.000"]],2:[["-0.633","0.149","0.000"],["-1.789","0.705","0.000"],["-2.732","1.524","0.000"],["-3.950","3.068","0.000"],["-4.440","5.833","0.000"]],3:[["-0.633","0.149","0.000"],["-2.132","1.118","0.000"],["-3.568","2.806","0.000"],["-4.379","6.028","0.000"],["-4.347","10.511","0.000"]],4:[["-0.633","0.149","0.000"],["-2.292","1.358","0.000"],["-3.632","3.592","0.000"],["-4.259","7.837","0.000"],["-4.254","13.234","0.000"]]},{0:[["-1.262","0.857","0.000"],["-1.400","0.882","0.000"],["-1.543","0.917","0.000"],["-1.677","0.953","0.000"],["-1.850","1.034","0.000"]],1:[["-1.486","0.904","0.000"],["-2.084","1.038","0.000"],["-2.531","1.239","0.000"],["-2.895","1.468","0.000"],["-3.302","1.702","0.000"]],2:[["-2.157","1.132","0.000"],["-3.441","1.852","0.000"],["-4.398","2.858","0.000"],["-5.202","4.046","0.000"],["-5.580","5.445","0.000"]],3:[["-2.844","1.709","0.000"],["-4.513","4.023","0.000"],["-5.346","6.622","0.000"],["-5.645","8.918","0.000"],["-5.625","11.571","0.000"]],4:[["-2.918","2.360","0.000"],["-4.913","5.778","0.000"],["-5.609","8.980","0.000"],["-5.708","12.031","0.000"],["-5.796","15.019","0.000"]]},{0:[["-0.420","0.945","0.000"],["-0.216","0.961","0.000"],["-0.019","1.000","0.000"],["0.138","1.050","0.000"],["0.281","1.118","0.000"]],1:[["-0.420","0.945","0.000"],["-0.008","0.980","0.000"],["0.349","1.109","0.000"],["0.823","1.268","0.000"],["1.226","1.537","0.000"]],2:[["-0.420","0.945","0.000"],["0.767","1.323","0.000"],["2.006","2.157","0.000"],["3.105","3.346","0.000"],["4.046","4.728","0.000"]],3:[["-0.420","0.945","0.000"],["1.857","1.863","0.000"],["3.865","4.380","0.000"],["4.745","7.761","0.000"],["5.188","10.209","0.000"]],4:[["-0.420","0.945","0.000"],["2.399","2.199","0.000"],["5.019","5.944","0.000"],["5.548","11.248","0.000"],["5.474","13.625","0.000"]]}];this.outTubes=[];this.liquidInOutTubes=[];this.outTubesVec=[];this.outTubesCurve=[];this.outTubesGeo=[];this.outTubesMat=[];for(var _k=0;_k<curveOutData.length;_k++){var _curve_vec={};var _c_size=Object.keys(curveOutData[_k]).length;for(var _i4=0;_i4<_c_size;_i4++){_curve_vec[_i4]=[];for(var _j=0;_j<curveOutData[_k][_i4].length;_j++){var _newVector=new THREE.Vector3(Number(curveOutData[_k][_i4][_j][0]),Number(curveOutData[_k][_i4][_j][1]),Number(curveOutData[_k][_i4][_j][2]));_newVector.multiply(new THREE.Vector3(.7,.8,.7));_curve_vec[_i4].push(_newVector)}}this.outTubesVec.push(_curve_vec)}loader.load(this.BASE_PATH+"/models/haim_tubeBag.json",function(geometry,material){_this2.bagGeo=geometry;_this2.bag=new THREE.Mesh(geometry,new THREE.MeshBasicMaterial({map:_this2.bagTexs[0],transparent:true}));loader.load(_this2.BASE_PATH+"/models/cloud.json",function(geometry,material){_this2.cloudGeo=geometry;_this2.cloud=new THREE.Mesh(geometry,_this2.cloudMat);_this2.cloud.scale.multiplyScalar(.01);_this2.cvMaterial=new THREE.MeshBasicMaterial({color:65535,wireframe:true,morphTargets:true,transparent:true,opacity:.1});_this2.liquidMaterial=new THREE.MeshBasicMaterial({map:_this2.liquidTex,transparent:true,opacity:.9});_this2.liquidDown=false;_this2.createCurve(new THREE.Vector3,new THREE.Vector3(0,-.5,0),0);_this2.createCurve(new THREE.Vector3,new THREE.Vector3(0,.25,0),1);_this2.cvOutMaterial=new THREE.MeshBasicMaterial({color:16776960,wireframe:true,morphTargets:true,transparent:true,opacity:.1});_this2.liquidOutMaterial=new THREE.MeshBasicMaterial({map:liquidOutTex,transparent:true,opacity:.9});_this2.liquidOut=false;_this2.createOutCurve(new THREE.Vector3,new THREE.Vector3(0,.3,0),0);_this2.createOutCurve(new THREE.Vector3,new THREE.Vector3(0,-.2,0),1);_this2.initSPEParicle(tex_loader);_this2.createGroundPuddle(tex_loader)})});this.boneTex=tex_loader.load(this.BASE_PATH+"/images/bone.jpg");this.boneTex.wrapS=this.boneTex.wrapT=THREE.RepeatWrapping;this.boneTex.repeat.set(5,5);this.boneMat=new THREE.MeshBasicMaterial({map:this.boneTex});loader.load(this.BASE_PATH+"/models/spine.json",function(geometry,material){_this2.boneGeo=geometry;_this2.spine=new THREE.Mesh(_this2.boneGeo,_this2.boneMat);_this2.add(_this2.spine)});events.on("character_idle",function(name){if(name=="Haim"&&_this2.envLightChanged){_this2.skyLightBack()}});events.on("character_playing",function(name){if(name=="Haim"&&_this2.envLightChanged){_this2.oriHemi=_this2.sky.getHemiLghtOriStatus();_this2.oriDir=_this2.sky.getDirLghtOriStatus();_this2.sky.pauseUpdateHemiLight();_this2.oriFLightIntensity=_this2.square.fountainLight.intensity;TweenMax.to(_this2.sky.dirLight,1,{intensity:0});TweenMax.to(_this2.sky.hemiLight,1,{intensity:.7});TweenMax.to(_this2.square.fountainLight,1,{intensity:0});TweenMax.to(_this2.sky.hemiLight.color,1,{r:.114,g:.192,b:.592});TweenMax.to(_this2.sky.hemiLight.groundColor,1,{r:.078,g:.373,b:.4})}});events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("HaimAnim")}},{key:"initSPEParicle",value:function initSPEParicle(tex_loader){var particleTex=tex_loader.load(this.BASE_PATH+"/images/tubeBag_ani_3.png");this.particleGroup=new SPE.Group({texture:{value:particleTex,frames:new THREE.Vector2(4,4),frameCount:16,loop:3},blending:1,depthTest:true,maxParticleCount:3e3});this.particleEmitters=[];for(var _i5=0;_i5<this.cloudGroup.out.length;_i5++){var emitter=new SPE.Emitter({maxAge:{value:10,spread:4},position:{value:this.cloudGroup.out[_i5].position,spread:new THREE.Vector3(5,0,5)},acceleration:{value:new THREE.Vector3(0,-1.2,0),spread:new THREE.Vector3(0,-1,0)},velocity:{value:new THREE.Vector3(.1,-1,.1)},opacity:{value:[.5,1,1,1,1,0]},size:{value:[.1,.4,.7,.7,.3],spread:1},particleCount:300,activeMultiplier:.1});this.particleGroup.addEmitter(emitter);this.particleEmitters.push(emitter)}this.add(this.particleGroup.mesh)}},{key:"createGroundPuddle",value:function createGroundPuddle(tex_loader){var _this3=this;this.puddles=new THREE.Object3D;this.puddleAnimators=[];this.puddleMats=[];this.puddleTexs=[];this.puddleGeos=[];var orders=[[0,1,2,3,2,4,4,4],[4,4,4,0,1,2,3,2],[2,3,2,4,4,4,0,1],[2,4,4,4,0,1,2,3]];this.puddleTex=tex_loader.load(this.BASE_PATH+"/images/puddle.png",function(){for(var _i6=0;_i6<orders.length;_i6++){var pTex=_this3.puddleTex.clone();pTex.needsUpdate=true;_this3.puddleTexs.push(pTex);var puddleAni=new _texture_animator2.default(pTex,5,1,8,40,orders[_i6]);var puddleMat=new THREE.MeshBasicMaterial({map:pTex,transparent:true,blending:THREE.AdditiveBlending,opacity:.2});_this3.puddleAnimators.push(puddleAni);_this3.puddleMats.push(puddleMat)}var puddleGeo=new THREE.PlaneGeometry(1,1);_this3.puddleGeos.push(puddleGeo);for(var _i7=0;_i7<40;_i7++){var puddle=new THREE.Mesh(puddleGeo,_this3.puddleMats[_i7%4]);puddle.position.set(Math.random()*12-6,0,Math.random()*14-7+3);puddle.rotation.x=-Math.PI/2;puddle.scale.multiplyScalar((Math.random()+1)/4);_this3.puddles.add(puddle)}_this3.add(_this3.puddles);if(_this3.config.platform=="vive"){_this3.puddles.position.y=.46;_this3.puddles.rotation.set(8.85*Math.PI/180,0,348.45*Math.PI/180)}else{_this3.puddles.position.y=-.16}})}},{key:"createCurve",value:function createCurve(pos,rot,index){var tubeNumber=this.tubesVec.length;for(var j=0;j<this.tubesVec.length;j++){var tubeObject=new THREE.Object3D;var curve_points=[];var c_size2=Object.keys(this.tubesVec[j]).length;for(var _i8=0;_i8<c_size2;_i8++){var cSpline=new THREE.CatmullRomCurve3(this.tubesVec[j][_i8]);cSpline.type="chordal";curve_points.push(cSpline)}var cvGeometry=new THREE.TubeGeometry(curve_points[curve_points.length-1],this.ARC_SEGMENTS,.05,3,false);for(var _i9=0;_i9<curve_points.length-1;_i9++){var cvGeometry2=new THREE.TubeGeometry(curve_points[_i9],this.ARC_SEGMENTS,.05,3,false);var nameee="t"+_i9;cvGeometry.morphTargets[_i9]={name:nameee,vertices:cvGeometry2.vertices}}cvGeometry.computeMorphNormals();this.tubesGeo.push(cvGeometry);var cvTube=new THREE.Mesh(cvGeometry,this.cvMaterial);cvTube.morphTargetInfluences[0]=1;tubeObject.add(cvTube);cvTube.visible=false;var liquidGeo=new THREE.TubeGeometry(curve_points[curve_points.length-1],this.ARC_SEGMENTS,.03,3,false);this.tubesGeo.push(liquidGeo);var tubeLiquid=new THREE.Mesh(liquidGeo,this.liquidMaterial);tubeObject.add(tubeLiquid);tubeLiquid.visible=false;var theBag=this.bag.clone();theBag.material=new THREE.MeshBasicMaterial({map:this.bagTexs[j%4],transparent:true});this.tubesMat.push(theBag.material);var lengthhh=liquidGeo.vertices.length-1;theBag.position.copy(liquidGeo.vertices[lengthhh]);theBag.scale.multiplyScalar(this.clamp(this.lookupTable[j+index*tubeNumber],.3,1));theBag.rotation.y=-rot.y+this.lookupTable[j+index*tubeNumber]/2;tubeObject.add(theBag);theBag.visible=false;if((j+index)%2==0){var theCloud=this.cloud.clone();lengthhh=liquidGeo.vertices.length-1;theCloud.position.copy(liquidGeo.vertices[lengthhh]);theCloud.position.y+=this.lookupTable[j];TweenMax.to(theCloud.position,4,{y:"+="+.2,repeat:-1,yoyo:true,delay:j%2,ease:Power0.easeNone});tubeObject.add(theCloud);this.cloudGroup.in.push(theCloud);theCloud.visible=false}tubeObject.position.copy(pos);tubeObject.rotation.set(rot.x,rot.y,rot.z);this.tubes.push(tubeObject);this.add(tubeObject)}}},{key:"createOutCurve",value:function createOutCurve(pos,rot,index){for(var j=0;j<this.outTubesVec.length;j++){var tubeObject=new THREE.Object3D;var curve_points=[];var c_size2=Object.keys(this.outTubesVec[j]).length;for(var _i10=0;_i10<c_size2;_i10++){var cSpline=new THREE.CatmullRomCurve3(this.outTubesVec[j][_i10]);cSpline.type="chordal";curve_points.push(cSpline)}var cvGeometry=new THREE.TubeGeometry(curve_points[curve_points.length-1],this.ARC_SEGMENTS,.05,3,false);for(var _i11=0;_i11<curve_points.length-1;_i11++){var cvGeometry2=new THREE.TubeGeometry(curve_points[_i11],this.ARC_SEGMENTS,.05,3,false);var nameee="t"+_i11;cvGeometry.morphTargets[_i11]={name:nameee,vertices:cvGeometry2.vertices}}cvGeometry.computeMorphNormals();this.outTubesGeo.push(cvGeometry);var cvTube=new THREE.Mesh(cvGeometry,this.cvOutMaterial);cvTube.morphTargetInfluences[0]=1;tubeObject.add(cvTube);cvTube.visible=false;var liquidGeo=new THREE.TubeGeometry(curve_points[curve_points.length-1],this.ARC_SEGMENTS,.03,3,false);this.outTubesGeo.push(liquidGeo);var tubeLiquid=new THREE.Mesh(liquidGeo,this.liquidOutMaterial);tubeObject.add(tubeLiquid);tubeLiquid.visible=false;if((j+index)%2==0){var theCloud=this.cloud.clone();var lengthhh=liquidGeo.vertices.length-1;theCloud.position.copy(liquidGeo.vertices[lengthhh]);theCloud.position.y+=this.lookupTable[j];TweenMax.to(theCloud.position,4,{y:"+="+.2,repeat:-1,yoyo:true,delay:j%3,ease:Power0.easeNone});tubeObject.add(theCloud);this.cloudGroup.out.push(theCloud);theCloud.visible=false}tubeObject.position.copy(pos);tubeObject.rotation.set(rot.x,rot.y,rot.z);this.outTubes.push(tubeObject);this.add(tubeObject)}}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"addSplineObject",value:function addSplineObject(position){var geometry=new THREE.BoxGeometry(.5,.5,.5);var object=new THREE.Mesh(geometry,new THREE.MeshBasicMaterial({color:Math.random()*16777215}));if(position){object.position.copy(position)}else{object.position.x=Math.random()*10-5;object.position.y=Math.random()*6;object.position.z=Math.random()*10-5}this.add(object);this.splineHelperObjects.push(object);return object}},{key:"updateSplineOutline",value:function updateSplineOutline(){var p=void 0,p2=void 0;var spline=this.splines.line;var splineMesh=spline.mesh;for(var _i12=0;_i12<this.ARC_SEGMENTS;_i12+=2){p=splineMesh.geometry.vertices[_i12];p.copy(spline.getPoint(_i12/(this.ARC_SEGMENTS-1)));p2=splineMesh.geometry.vertices[_i12+1];p2.copy(p).add(new THREE.Vector3(1,0,0))}splineMesh.geometry.verticesNeedUpdate=true}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var _i13=0;_i13<this.sequenceConfig.length;_i13++){this.sequenceConfig[_i13].performed=false}}},{key:"bagOn",value:function bagOn(){for(var _i14=0;_i14<this.tubes.length;_i14++){this.tubes[_i14].children[2].visible=true}}},{key:"tubeDown",value:function tubeDown(_duration){var _this4=this;var tmpEndArray=[0,1,0,0];var tmpEndArray2=[0,0,1,0];var tmpEndArray3=[0,0,0,1];var tmpEndArray4=[0,0,0,0];var targets=[];for(var _i15=0;_i15<this.tubes.length;_i15++){targets.push(this.tubes[_i15].children[0].morphTargetInfluences)}this.tubes[0].children[1].visible=false;this.outTubes[0].children[1].visible=false;for(var _i16=0;_i16<this.tubes.length;_i16++){this.tubes[_i16].children[0].visible=true}this.tl=new TimelineMax;this.tl.to(targets,_duration,{endArray:tmpEndArray,ease:Power0.easeNone,onStart:function onStart(){_this4.tubes[0].children[1].material.map.offset.x=-1.5}}).to(targets,_duration,{endArray:tmpEndArray2,ease:Power0.easeNone}).to(targets,_duration,{endArray:tmpEndArray3,ease:Power0.easeNone}).to(targets,_duration/1.5,{endArray:tmpEndArray4,ease:Back.easeInOut.config(2.5),onStart:function onStart(){for(var _i17=0;_i17<_this4.tubes.length;_i17++){_this4.tubes[_i17].children[1].visible=true}_this4.tubes[0].children[1].material.map.offset.x=-1.5;_this4.liquidDown=true},onComplete:function onComplete(){for(var _i18=0;_i18<_this4.tubes.length;_i18++){TweenMax.to(_this4.tubes[_i18].children[2].scale,1,{x:"-=0.25",y:"-=0.25",z:"-=0.25",ease:Power1.easeInOut,yoyo:true,repeat:-1})}}})}},{key:"tubeOut",value:function tubeOut(_duration){var _this5=this;for(var _i19=0;_i19<this.outTubes.length;_i19++){this.outTubes[_i19].children[0].visible=true}var tmpEndArray=[0,1,0,0];var tmpEndArray2=[0,0,1,0];var tmpEndArray3=[0,0,0,1];var tmpEndArray4=[0,0,0,0];var targets=[];for(var _i20=0;_i20<this.outTubes.length;_i20++){targets.push(this.outTubes[_i20].children[0].morphTargetInfluences)}this.tl=new TimelineMax;this.tl.to(targets,_duration*1.5,{endArray:tmpEndArray,ease:Back.easeInOut.config(2.5),onStart:function onStart(){}}).to(targets,_duration*2,{endArray:tmpEndArray2,ease:Power0.easeNone}).to(targets,_duration*2,{endArray:tmpEndArray3,ease:Power0.easeNone}).to(targets,_duration*2,{endArray:tmpEndArray4,ease:Power0.easeNone,onComplete:function onComplete(){for(var _i21=0;_i21<_this5.tubes.length;_i21++){TweenMax.to(_this5.tubes[_i21].children[2].scale,_duration*(_this5.clamp(_this5.tubes[_i21].children[2].scale.x,.5,1)*20),{x:.01,y:.01,z:.01,ease:Bounce.easeInOut})}for(var _i22=0;_i22<_this5.cloudGroup.out.length;_i22++){_this5.cloudGroup.out[_i22].visible=true;_this5.cloudGroup.in[_i22].visible=true;TweenMax.to(_this5.cloudGroup.out[_i22].scale,_duration*20,{x:1.5,y:1,z:1.5,ease:Power0.easeNone});TweenMax.to(_this5.cloudGroup.in[_i22].scale,_duration*20,{x:1.5,y:1,z:1.5,ease:Power0.easeNone,onComplete:function onComplete(){_this5.liquidOut=true;for(var _i23=0;_i23<_this5.outTubes.length;_i23++){_this5.outTubes[_i23].children[1].visible=true}}})}}})}},{key:"skyLightDarken",value:function skyLightDarken(){this.oriHemi=this.sky.getHemiLghtOriStatus();this.oriDir=this.sky.getDirLghtOriStatus();this.sky.pauseUpdateHemiLight();this.oriFLightIntensity=this.square.fountainLight.intensity;
TweenMax.to(this.sky.dirLight,2,{intensity:.2});TweenMax.to(this.sky.hemiLight,2,{intensity:.2});TweenMax.to(this.square.fountainLight,3,{intensity:0});this.envLightChanged=true}},{key:"skyLightStorm",value:function skyLightStorm(){TweenMax.to(this.sky.dirLight,4,{intensity:0});TweenMax.to(this.sky.hemiLight,4,{intensity:.7});TweenMax.to(this.sky.hemiLight.color,4,{r:.114,g:.192,b:.592});TweenMax.to(this.sky.hemiLight.groundColor,4,{r:.078,g:.373,b:.4})}},{key:"skyLightBack",value:function skyLightBack(){var _this6=this;TweenMax.to(this.square.fountainLight,2,{intensity:this.oriFLightIntensity});var hemiTargetIntensity=this.sky.getHemiLghtCorrectIntensity();TweenMax.to(this.sky.hemiLight,2,{intensity:hemiTargetIntensity});TweenMax.to(this.sky.dirLight,2,{intensity:this.oriDir.intensity,onComplete:function onComplete(){_this6.sky.resumeUpdateHemiLight()}});TweenMax.to(this.sky.hemiLight.color,1,{r:this.oriHemi.color.r,g:this.oriHemi.color.g,b:this.oriHemi.color.b});TweenMax.to(this.sky.hemiLight.groundColor,1,{r:this.oriHemi.groundColor.r,g:this.oriHemi.groundColor.g,b:this.oriHemi.groundColor.b})}},{key:"characterDisappear",value:function characterDisappear(){var _this7=this;var rainOriginPositions=[];for(var _i24=0;_i24<this.particleGroup.emitters.length;_i24++){this.particleGroup.emitters[_i24].activeMultiplier=1.5;var emitterPos=this.particleGroup.emitters[_i24].position.value;rainOriginPositions.push(emitterPos);this.particleGroup.emitters[_i24].position.value=new THREE.Vector3(0,emitterPos.y,0)}TweenMax.to(this.parent.fullVideo.mesh.scale,1.5,{x:1e-5,y:1e-5,z:1e-5,ease:Back.easeInOut,delay:5,onStart:function onStart(){for(i=0;i<_this7.cloudGroup.in.length;i++){_this7.detach(_this7.cloudGroup.in[i],_this7.cloudGroup.in[i].parent,_this7)}var _loop=function _loop(_i25){TweenMax.to(_this7.tubes[_i25].scale,1,{x:.01,y:.01,z:.01,ease:Back.easeInOut,onComplete:function onComplete(){_this7.tubes[_i25].visible=false}})};for(var _i25=0;_i25<_this7.tubes.length;_i25++){_loop(_i25)}for(i=0;i<_this7.cloudGroup.out.length;i++){_this7.detach(_this7.cloudGroup.out[i],_this7.cloudGroup.out[i].parent,_this7)}var _loop2=function _loop2(_i26){TweenMax.to(_this7.outTubes[_i26].scale,1,{x:.01,y:.01,z:.01,ease:Back.easeInOut,onComplete:function onComplete(){_this7.outTubes[_i26].visible=false}})};for(var _i26=0;_i26<_this7.outTubes.length;_i26++){_loop2(_i26)}TweenMax.to(_this7.spine.scale,1,{x:.01,y:.01,z:.01,ease:Back.easeInOut,onComplete:function onComplete(){_this7.spine.visible=false}})},onComplete:function onComplete(){_this7.parent.fullVideo.setOpacity(0);for(var _i27=0;_i27<_this7.particleGroup.emitters.length;_i27++){_this7.particleGroup.emitters[_i27].activeMultiplier=.1;_this7.particleGroup.emitters[_i27].position.value=rainOriginPositions[_i27]}}});this.envLightChanged=false}},{key:"disposeAni",value:function disposeAni(){var _this8=this;for(var t in this.tubes){this.remove(t)}for(var t in this.outTubes){this.remove(t)}for(var i=0;i<this.tubesGeo.length;i++){this.tubesGeo[i].dispose()}for(var i=0;i<this.outTubesGeo.length;i++){this.outTubesGeo[i].dispose()}for(var i=0;i<this.tubesMat.length;i++){this.tubesMat[i].dispose()}for(var i=0;i<this.outTubesMat.length;i++){this.outTubesMat[i].dispose()}this.bagGeo.dispose();for(var i=0;i<this.bagTexs.length;i++){this.bagTexs[i].dispose()}for(var i=0;i<this.bagAniTexs.length;i++){this.bagAniTexs[i].dispose()}this.cvMaterial.dispose();this.liquidMaterial.dispose();this.cvOutMaterial.dispose();this.liquidOutMaterial.dispose();this.liquidTex.dispose();this.cloudTex.dispose();this.cloudMat.dispose();this.cloudGeo.dispose();this.remove(this.spine);this.boneGeo.dispose();this.boneMat.dispose();this.boneTex.dispose();this.remove(this.puddles);for(var i=0;i<this.puddleGeos.length;i++){this.puddleGeos[i].dispose()}for(var i=0;i<this.puddleMats.length;i++){this.puddleMats[i].dispose()}for(var i=0;i<this.puddleTexs.length;i++){this.puddleTexs[i].dispose()}this.remove(this.particleGroup.mesh);this.particleEmitters.forEach(function(e){_this8.particleGroup.removeEmitter(e)});this.particleGroup.dispose();console.log("dispose Haim ani!")}},{key:"detach",value:function detach(child,parent,scene){parent.remove(child);scene.add(child)}},{key:"transX",value:function transX(geo,n){for(var _i28=0;_i28<geo.vertices.length;_i28++){geo.vertices[_i28].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var _i29=0;_i29<geo.vertices.length;_i29++){geo.vertices[_i29].z+=n}}},{key:"transY",value:function transY(geo,n){for(var _i30=0;_i30<geo.vertices.length;_i30++){geo.vertices[_i30].y+=n}}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){if(this.liquidDown&&!this.liquidOut){this.tubes[0].children[1].material.map.offset.x+=.01;if(this.tubes[0].children[1].material.map.offset.x>1)this.tubes[0].children[1].material.map.offset.x=-1}else if(this.liquidOut){this.tubes[0].children[1].material.map.offset.x-=.01;if(this.tubes[0].children[1].material.map.offset.x<-1)this.tubes[0].children[1].material.map.offset.x=1;this.outTubes[0].children[1].material.map.offset.x-=.01;if(this.outTubes[0].children[1].material.map.offset.x<-1)this.outTubes[0].children[1].material.map.offset.x=1;this.particleGroup.tick(dt);for(var _i31=0;_i31<this.puddleAnimators.length;_i31++){this.puddleAnimators[_i31].updateWithOrder(300*dt)}}}}]);return HaimAnimation}(THREE.Object3D);exports.default=HaimAnimation},{"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/improved_noise":61,"../util/texture_animator":65}],3:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var HannahAnimation=function(_THREE$Object3D){_inherits(HannahAnimation,_THREE$Object3D);function HannahAnimation(config){_classCallCheck(this,HannahAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(HannahAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/hannah";return _this}_createClass(HannahAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;var scope=this;this.loadingManager.itemStart("HannahAnim");this.domeMorphTargets=[];this.perlin=new _improved_noise2.default;this.sequenceConfig=[{time:1,anim:function anim(){_this2.appear()}},{time:65,anim:function anim(){_this2.beDome()}},{time:87,anim:function anim(){_this2.showLeaf()}},{time:171,anim:function anim(){_this2.beCollapse()}},{time:285,anim:function anim(){_this2.characterDisappear()}}];this.nextAnim=null;this.noiseFactor=160;var hannahRoomFiles=[this.BASE_PATH+"/models/hannah_room/hr_bookshelf.js",this.BASE_PATH+"/models/hannah_room/hr_chair.js",this.BASE_PATH+"/models/hannah_room/hr_door.js",this.BASE_PATH+"/models/hannah_room/hr_fireplace.js",this.BASE_PATH+"/models/hannah_room/hr_photo1.js",this.BASE_PATH+"/models/hannah_room/hr_photo2.js",this.BASE_PATH+"/models/hannah_room/hr_photo3.js",this.BASE_PATH+"/models/hannah_room/hr_photo4.js",this.BASE_PATH+"/models/hannah_room/hr_photo5.js",this.BASE_PATH+"/models/hannah_room/hr_room2.js",this.BASE_PATH+"/models/hannah_room/hr_shelf.js",this.BASE_PATH+"/models/hannah_room/hr_sidewall.js",this.BASE_PATH+"/models/hannah_room/hr_sofa.js",this.BASE_PATH+"/models/hannah_room/hr_sofa2.js",this.BASE_PATH+"/models/hannah_room/hr_table.js",this.BASE_PATH+"/models/hannah_room/hr_window.js"];var doodleMenTexFiles=[this.BASE_PATH+"/images/doodleMen1.png",this.BASE_PATH+"/images/doodleMen2.png",this.BASE_PATH+"/images/doodleMen3.png"];var doodleMenTex=[],doodleMen=[];this.doodleMenAnimators=[];var p_tex_loader=new THREE.TextureLoader(this.loadingManager);var twigGeo=void 0,leafGeo=void 0,twigMat=void 0,leafMat=void 0;this.hannahRoom=new THREE.Object3D;this.domeRelatedGeos=[];this.domeRelatedMats=[];this.domeRelatedTexs=[];leafMat=new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,wireframe:true});this.domeRelatedMats.push(leafMat);this.evilTex=p_tex_loader.load(this.BASE_PATH+"/images/spike3.jpg");twigMat=new THREE.MeshBasicMaterial({color:9984535,wireframe:true});this.domeRelatedMats.push(twigMat);this.evilTex.wrapS=THREE.RepeatWrapping;this.evilTex.wrapT=THREE.RepeatWrapping;this.evilTex.repeat.set(1,4);this.evilMat=new THREE.MeshLambertMaterial({map:this.evilTex});this.center=new THREE.Mesh(new THREE.SphereGeometry(.2),new THREE.MeshBasicMaterial({color:16711680}));this.center.position.set(0,-5,2);this.add(this.center);var loader=new THREE.JSONLoader(this.loadingManager);loader.load(this.BASE_PATH+"/models/spike_curvey_s.js",function(geometry,material){_this2.evilGeo=geometry});loader.load(this.BASE_PATH+"/models/leavesss_less_s.js",function(geometry,material){_this2.leafGeo=geometry;scope.domeRelatedGeos.push(_this2.leafGeo);var face=void 0,numberOfSides=void 0,vertexIndex=void 0,point=void 0,color=void 0;var faceIndices=["a","b","c","d"];for(var _i=0;_i<_this2.leafGeo.faces.length;_i++){face=_this2.leafGeo.faces[_i];numberOfSides=face instanceof THREE.Face3?3:4;for(var j=0;j<numberOfSides;j++){vertexIndex=face[faceIndices[j]];point=_this2.leafGeo.vertices[vertexIndex];color=new THREE.Color;color.setRGB((point.x+1.2)*30/((j+4)*15),.6+point.y*10/((j+4)*13),(point.x+1.3)*30/((j+4)*14));face.vertexColors[j]=color}}});loader.load(this.BASE_PATH+"/models/twig_s.js",function(geometry,material){twigGeo=geometry;scope.domeRelatedGeos.push(twigGeo)});this.loadModelDome(this.BASE_PATH+"/models/shield_s.js",this.BASE_PATH+"/models/dome_s.js",this.BASE_PATH+"/models/collapse_s.js",this.BASE_PATH+"/models/exitCover.json").then(function(dome){_this2.dome=dome;_this2.add(_this2.dome);console.log("Loaded dome, setting up 'things'",_this2.dome);var centerV=_this2.center.position.clone();var upp=new THREE.Vector3(0,-1,0);for(var _i2=0;_i2<_this2.dome.geometry.vertices.length-9;_i2+=9){var fMesh=new Thing(_this2.dome.geometry.vertices[_i2],twigGeo,_this2.leafGeo,_this2.evilGeo,twigMat,leafMat,_this2.evilMat);_this2.add(fMesh.mesh);var vA=_this2.dome.geometry.vertices[_i2].clone();var tempA=new THREE.Vector3;tempA.set(_this2.lookupTable[_i2%50]*.5,_this2.lookupTable[(_i2+1)%50]*.5,_this2.lookupTable[(_i2+2)%50]*.5);vA.add(tempA);var m1=new THREE.Matrix4;m1.lookAt(centerV,vA,upp);fMesh.mesh.quaternion.setFromRotationMatrix(m1);scope.domeMorphTargets.push(fMesh)}console.log("domeMorphTargets length: "+_this2.domeMorphTargets.length);_this2.initParticles()});this.menTexs=[];this.menMats=[];this.menGeometry=new THREE.PlaneGeometry(5,10);for(var _i3=0;_i3<doodleMenTexFiles.length;_i3++){var mTex=p_tex_loader.load(doodleMenTexFiles[_i3]);this.menTexs.push(mTex);var mAni=new _texture_animator2.default(mTex,2,1,2,60,[0,1]);this.doodleMenAnimators.push(mAni);var mMat=new THREE.MeshBasicMaterial({map:mTex,side:THREE.DoubleSide,transparent:true});this.menMats.push(mMat);var mMesh=new THREE.Mesh(this.menGeometry,mMat);mMesh.position.x=-15-_i3*6;mMesh.position.y=7.5;this.hannahRoom.add(mMesh);doodleMen.push(mMesh)}this.roomGeos=[];this.roomMats=[];for(var _i4=0;_i4<hannahRoomFiles.length;_i4++){loader.load(hannahRoomFiles[_i4],function(geometry){scope.roomGeos.push(geometry);var colorValue=Math.random()*255|0;var colorString="rgb("+colorValue+","+colorValue+","+colorValue+")";var mat=new THREE.MeshLambertMaterial({color:colorString});scope.roomMats.push(mat);var meshhh=new THREE.Mesh(geometry,mat);scope.hannahRoom.add(meshhh)})}this.hannahRoom.scale.multiplyScalar(.015);this.hannahRoom.position.set(.5,2,.8);this.add(this.hannahRoom);this.loadingManager.itemEnd("HannahAnim");this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}events.on("experience_end",function(){_this2.disposeAni()});this.completeSequenceSetup()}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"initParticles",value:function initParticles(){var p_tex_loader=new THREE.TextureLoader(this.loadingManager);var particleTex=p_tex_loader.load(this.BASE_PATH+"/images/dandelion_particle.jpg");this.particleGroup=new SPE.Group({texture:{value:particleTex},depthTest:false,maxParticleCount:1e3});this.particleEmitters=[];for(var i=0;i<this.domeMorphTargets.length-2;i+=2){var emitter=new SPE.Emitter({type:SPE.distributions.SPHERE,maxAge:{value:10,spread:2},position:{value:this.domeMorphTargets[i].mesh.position,radius:.2},acceleration:{value:new THREE.Vector3(0,-.5,0)},velocity:{value:new THREE.Vector3(.3,-.3,.3)},rotation:{angle:.5},angle:{value:[0,.5,-.5],spread:[0,-.5,.5]},opacity:{value:[0,1,1,1,0]},size:{value:[.05,.1,.2,.2,.1]},particleCount:15,drag:.6,activeMultiplier:.3});this.particleGroup.addEmitter(emitter);this.particleEmitters.push(emitter)}this.add(this.particleGroup.mesh)}},{key:"updateVertices",value:function updateVertices(){var morphTargets=this.dome.geometry.morphTargets;var morphInfluences=this.dome.morphTargetInfluences;var upp=new THREE.Vector3(0,-1,0);for(var i=0;i<this.shieldGeo.vertices.length-9;i+=9){var centerV=this.center.position.clone();var vA=new THREE.Vector3;var tempA=new THREE.Vector3;for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];var target=morphTargets[t].vertices[i];vA.addScaledVector(tempA.subVectors(target,this.shieldGeo.vertices[i]),influence)}vA.add(this.shieldGeo.vertices[i]);tempA.set(this.lookupTable[i%50]*.5,this.lookupTable[(i+1)%50]*.5,this.lookupTable[(i+2)%50]*.5);vA.add(tempA);this.domeMorphTargets[i/9].mesh.position.copy(vA);if(i/9%2==0){if(i/18!=20)this.particleGroup.emitters[i/18].position.value=this.particleGroup.emitters[i/18].position.value.copy(vA)}var m1=new THREE.Matrix4;m1.lookAt(centerV,vA,upp);this.domeMorphTargets[i/9].mesh.quaternion.setFromRotationMatrix(m1)}}},{key:"appear",value:function appear(){for(var i=0;i<this.domeMorphTargets.length;i++){this.domeMorphTargets[i].mesh.children[2].visible=true;TweenMax.to(this.domeMorphTargets[i].mesh.children[2].scale,4,{x:1.5,y:1.5,z:1.5,ease:Power4.easeIn})}}},{key:"beDome",value:function beDome(){var _this3=this;var tmpEndArray=[1,0,0];TweenMax.to(this.dome.morphTargetInfluences,4,{endArray:tmpEndArray,ease:Power2.easeInOut,onUpdate:function onUpdate(){_this3.updateVertices()}});this.noiseFactor=140}},{key:"showLeaf",value:function showLeaf(){var _this4=this;var _loop=function _loop(i){_this4.domeMorphTargets[i].mesh.children[1].visible=true;TweenMax.to(_this4.domeMorphTargets[i].mesh.children[1].scale,2,{x:1.5,y:1.5,z:1.5,ease:Power2.easeOut});TweenMax.to(_this4.domeMorphTargets[i].mesh.children[2].scale,4,{x:.01,y:.01,z:.01,ease:Power4.easeIn,onComplete:function onComplete(){_this4.remove(_this4.domeMorphTargets[i].mesh.children[2]);_this4.evilGeo.dispose();_this4.evilMat.dispose();_this4.evilTex.dispose()}})};for(var i=0;i<this.domeMorphTargets.length;i++){_loop(i)}}},{key:"beCollapse",value:function beCollapse(){var _this5=this;var tmpEndArray=[0,1,0];TweenMax.to(this.dome.morphTargetInfluences,4,{endArray:tmpEndArray,ease:Power2.easeInOut,onUpdate:function onUpdate(){_this5.updateVertices()}});var face=void 0,numberOfSides=void 0,vertexIndex=void 0,point=void 0,color=void 0;var faceIndices=["a","b","c","d"];for(var i=0;i<this.leafGeo.faces.length;i++){face=this.leafGeo.faces[i];numberOfSides=face instanceof THREE.Face3?3:4;for(var j=0;j<numberOfSides;j++){vertexIndex=face[faceIndices[j]];point=this.leafGeo.vertices[vertexIndex];var faceVertexColor=face.vertexColors[j];TweenMax.to(faceVertexColor,4,{r:(point.x*2+.5)*4/5,g:Math.random()/4+.1,b:.08,onUpdate:function onUpdate(){for(var _i5=0;_i5<_this5.domeMorphTargets.length;_i5++){_this5.domeMorphTargets[_i5].mesh.children[1].geometry.colorsNeedUpdate=true}}})}}for(var _i6=0;_i6<this.particleGroup.emitters.length;_i6++){this.particleGroup.emitters[_i6].activeMultiplier=1;this.particleGroup.emitters[_i6].acceleration.value=new THREE.Vector3(0,.5,0)}}},{key:"characterDisappear",value:function characterDisappear(){var _this6=this;TweenMax.to(this.domeMorphTargets[0].mesh.children[1].material,1,{wireframeLinewidth:3});var tmpEndArray=[0,0,.99];TweenMax.to(this.dome.morphTargetInfluences,2,{endArray:tmpEndArray,ease:Power2.easeInOut,onUpdate:function onUpdate(){_this6.updateVertices()}});TweenMax.to(this.parent.fullVideo.mesh.scale,1,{x:1e-5,y:1e-5,z:1e-5,ease:Power3.easeIn,delay:1,onStart:function onStart(){TweenMax.to(_this6.parent.fullVideo.mesh.rotation,1.5,{y:Math.PI*2,ease:Power3.easeIn})},onComplete:function onComplete(){_this6.parent.fullVideo.setOpacity(0);_this6.noiseFactor=140;tmpEndArray=[0,1,0];TweenMax.to(_this6.dome.morphTargetInfluences,4,{endArray:tmpEndArray,ease:Power2.easeInOut,onUpdate:function onUpdate(){_this6.updateVertices()}});TweenMax.to(_this6.domeMorphTargets[0].mesh.children[1].material,1,{wireframeLinewidth:1})}})}},{key:"disposeAni",value:function disposeAni(){var _this7=this;this.remove(this.hannahRoom);this.remove(this.center);for(var i=0;i<this.domeMorphTargets.length;i++){this.remove(this.domeMorphTargets[i].mesh)}this.remove(this.dome);this.menGeometry.dispose();for(var i=0;i<this.menMats.length;i++){this.menMats[i].dispose()}for(var i=0;i<this.menTexs.length;i++){this.menTexs[i].dispose()}for(var i=0;i<this.domeRelatedGeos.length;i++){this.domeRelatedGeos[i].dispose()}for(var i=0;i<this.domeRelatedMats.length;i++){this.domeRelatedMats[i].dispose()}for(var i=0;i<this.domeRelatedTexs.length;i++){this.domeRelatedTexs[i].dispose()}for(var i=0;i<this.roomGeos.length;i++){this.roomGeos[i].dispose()}for(var i=0;i<this.roomMats.length;i++){this.roomMats[i].dispose()}this.remove(this.particleGroup.mesh);this.particleEmitters.forEach(function(e){_this7.particleGroup.removeEmitter(e)});this.particleGroup.dispose();console.log("dispose Hannah ani!")}},{key:"loadModelDome",value:function loadModelDome(modelS,modelD,modelC,modelE){var _this8=this;var promise=new Promise(function(resolve,reject){var loader=new THREE.JSONLoader(_this8.loadingManager);var domeMat=new THREE.MeshBasicMaterial({morphTargets:true,color:11158664,wireframe:true,visible:false});var followMat=new THREE.MeshBasicMaterial({color:16776960});var followMesh=new THREE.Mesh(new THREE.SphereGeometry(10),followMat);loader.load(modelS,function(geometry,material){_this8.shieldGeo=geometry;loader.load(modelD,function(geometryD,materialD){var domeGeo=geometryD;loader.load(modelC,function(geometryC,materialC){var collapseGeo=geometryC;loader.load(modelE,function(geometryE,materialE){var exitCoverGeo=geometryE;_this8.shieldGeo.morphTargets[0]={name:"t1",vertices:domeGeo.vertices};_this8.shieldGeo.morphTargets[1]={name:"t2",vertices:collapseGeo.vertices};_this8.shieldGeo.morphTargets[2]={name:"t3",vertices:exitCoverGeo.vertices};_this8.shieldGeo.computeMorphNormals();var dome=new THREE.Mesh(_this8.shieldGeo,domeMat);dome.name="dome";resolve(dome)})})})})});return promise}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("Hannah - do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"update",value:function update(dt,et){if(this.particleGroup){this.particleGroup.tick(dt)}for(var i=0;i<this.shieldGeo.vertices.length-9;i+=9){var h=this.perlin.noise(et*.1,i,1)/this.noiseFactor;this.domeMorphTargets[i/9].mesh.position.addScalar(h);if(i/9%2==0){if(i/18!=20){this.particleGroup.emitters[i/18].position.value=this.particleGroup.emitters[i/18].position.value.copy(this.domeMorphTargets[i/9].mesh.position)}}}if(this.doodleMenAnimators.length>0){for(var _i7=0;_i7<this.doodleMenAnimators.length;_i7++){this.doodleMenAnimators[_i7].updateWithOrder(300*dt)}}}}]);return HannahAnimation}(THREE.Object3D);exports.default=HannahAnimation;function Thing(pos,geoTwig,geoLeaf,geoEvil,twigMat,leafMat,evilMat){this.position=pos.clone();this.mesh=new THREE.Object3D;this.twig=new THREE.Mesh(geoTwig,twigMat);this.leaf=new THREE.Mesh(geoLeaf,leafMat);this.evil=new THREE.Mesh(geoEvil,evilMat);this.mesh.add(this.twig);this.mesh.add(this.leaf);this.mesh.add(this.evil);this.mesh.position.copy(this.position);this.mesh.children[1].scale.set(.01,.01,.01);this.mesh.children[0].scale.set(.01,.01,.01);this.mesh.children[2].scale.set(.01,.01,.01);this.mesh.children[1].visible=false;this.mesh.children[0].visible=false;this.mesh.children[2].visible=false}function map_range(value,low1,high1,low2,high2){return low2+(high2-low2)*(value-low1)/(high1-low1)}},{"../util/EndArrayPlugin":55,"../util/debug":58,"../util/improved_noise":61,"../util/texture_animator":65}],4:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("../util/fbo");var _fbo2=_interopRequireDefault(_fbo);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _sun_loader=require("../sun_loader");var _sun_loader2=_interopRequireDefault(_sun_loader);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var IntroAnimation=function(_THREE$Object3D){_inherits(IntroAnimation,_THREE$Object3D);function IntroAnimation(scene,renderer,square,timeController,config){_classCallCheck(this,IntroAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(IntroAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/intro";_this.render_fs="#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n  //gl_FragColor = vec4( vec3( 1., .5, .5 ), .85 );\n  gl_FragColor = vec4( 1., 1., 1., 1. );\n}\n";_this.render_vs="#define GLSLIFY 1\n//float texture containing the positions of each particle\nuniform sampler2D positions;\nattribute vec2 reference;\nvarying vec2 vUv;\n//size\nuniform float pointSize;\n\nvoid main() {\n    vUv = uv;\n\n\n    //the mesh is a nomrliazed square so the uvs = the xy positions of the vertices\n    vec3 pos = texture2D( positions, reference).xyz;\n\n    //pos now contains the position of a point in space that can be transformed\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( pos, 1.0 );\n\n    gl_PointSize = pointSize;\n\n}\n";_this.simulation_fs="#define GLSLIFY 1\nhighp float random_2_0(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_4_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_4_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_4_2(vec4 x) {\n     return mod289_4_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_4_3(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_4_4(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D_4_5 = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_4_6 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_4_6;\n  vec3 i1 = min( g_4_6.xyz, l.zxy );\n  vec3 i2 = max( g_4_6.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D_4_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_4_1(i);\n  vec4 p = permute_4_2( permute_4_2( permute_4_2(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D_4_5.wyz - D_4_5.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1_4_7 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0_4_8 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1_4_7.xy,h.z);\n  vec3 p3 = vec3(a1_4_7.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt_4_3(vec4(dot(p0_4_8,p0_4_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0_4_8 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0_4_8,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n\n\n\nvec3 snoiseVec3_3_9( vec3 x ){\n\n  float s  = snoise_4_4(vec3( x ));\n  float s1 = snoise_4_4(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise_4_4(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\n\nvec3 curlNoise_3_10( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3_3_9( p - dx );\n  vec3 p_x1 = snoiseVec3_3_9( p + dx );\n  vec3 p_y0 = snoiseVec3_3_9( p - dy );\n  vec3 p_y1 = snoiseVec3_3_9( p + dy );\n  vec3 p_z0 = snoiseVec3_3_9( p - dz );\n  vec3 p_z1 = snoiseVec3_3_9( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\n\n\nmat4 rotationMatrix_1_11(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\n\nuniform sampler2D positions;\nuniform float deltaTime;\nuniform float maxDepth;\nuniform float amplitude;\nuniform float frequency;\nuniform float gravity;\nuniform float mouseRotation;\nuniform float squareRadius;\nuniform float squareCenterX;\nuniform float squareCenterY;\nuniform float squareCenterZ;\nuniform float bounceFactor;\nvec3 acce = vec3(0.0,0.0,0.0);\nvec3 velocity = vec3(0.0,0.0,0.0);\nvec3 wind = vec3(1.0,0.0,0.0);\nvec3 force = vec3(0.0, 0.0, 0.0);\nvec3 squareCenter;\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 pos = texture2D( positions, vUv ).rgb;\n\n    // if hitting square\n    squareCenter = vec3(squareCenterX, squareCenterY, squareCenterZ);\n    float disToSq = distance(pos, squareCenter);\n    if ( disToSq < squareRadius ) {\n        force = normalize(pos - squareCenter);\n        force *= bounceFactor;\n    }\n\n    // decreasing the force gradually\n    if ( distance(force, vec3(0.0))>0.1 ){\n        force /= 2.0;\n    } else {\n        force *= 0.0;\n    }\n    acce += force;\n\n    // wind from mouse\n    wind *= (mouseRotation / disToSq * 20.0);\n    // decreasing the wind gradually\n    if ( distance(wind, vec3(0.0))>0.1 ){\n        wind /= 2.0;\n    } else {\n        wind *= 0.0;\n    }\n    acce += wind;\n    \n    // gravity\n    // acce.y -= ( random(pos.xz) * gravity );\n    acce.y -= ( random_2_0(pos.xz) * gravity * deltaTime );\n\n    velocity = velocity + acce;\n    pos = pos + velocity;\n\n    acce *= 0.0;\n    wind = vec3(1.0,0.0,0.0);\n\n    // if hitting ground, reset\n    if (pos.y < -300.0) {  //\n       pos.y += 550.0;     // top: ~250\n       pos.x = -30.0 + random_2_0(pos.xz) * 60.0;\n       pos.z = -20.0 + random_2_0(pos.xz) * 50.0;\n\n       //acce *= 0.0;\n       velocity *= 0.0;\n    }\n\n    gl_FragColor = vec4( pos, 1.0 );\n}\n";
_this.simulation_vs="#define GLSLIFY 1\nvarying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, 1.0 - uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";_this.width=256;_this.height=256;_this.scene=scene;_this.renderer=renderer;_this.maxDepth=50;_this.square=square;_this.timeController=timeController;return _this}_createClass(IntroAnimation,[{key:"initParticles",value:function initParticles(ref,geo){var fboGeo=geo;if(ref!=null){fboGeo.applyMatrix((new THREE.Matrix4).makeScale(ref.scale.x,ref.scale.y,ref.scale.z));fboGeo.applyMatrix((new THREE.Matrix4).makeRotationFromEuler(ref.rotation));fboGeo.applyMatrix((new THREE.Matrix4).makeTranslation(ref.position.x,ref.position.y,ref.position.z))}var data=new Float32Array(this.width*this.height*3);var points=THREE.GeometryUtils.randomPointsInNoFaceGeometry(fboGeo,this.width*this.height);for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.isStarted=false;this.loadingManager.itemStart("IntroAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);var plyLoader=new THREE.PLYLoader(this.loadingManager);this.animStart=false;this.sequenceConfig=[{time:5,anim:function anim(){_this2.something()}}];this.nextAnim=null;this.completeSequenceSetup();this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}plyLoader.load(this.BASE_PATH+"/models/onetreecolorless.ply",function(geometry){_this2.treeGeo=geometry;_this2.treeMaterial=new THREE.PointsMaterial({color:16777215,size:1});var treeTransformer=[[new THREE.Vector3(10,10,2),new THREE.Vector3(0,300,-50),new THREE.Vector3(Math.PI*9/8,0,Math.PI/2)]];_this2.trees=new THREE.Object3D;for(var _i=0;_i<treeTransformer.length;_i++){var tree=new THREE.Points(geometry.clone(),_this2.treeMaterial);tree.scale.set(treeTransformer[_i][0].x,treeTransformer[_i][0].y,treeTransformer[_i][0].z);tree.position.set(treeTransformer[_i][1].x,treeTransformer[_i][1].y,treeTransformer[_i][1].z);tree.rotation.set(treeTransformer[_i][2].x,treeTransformer[_i][2].y,treeTransformer[_i][2].z);_this2.trees.add(tree)}_this2.trees.scale.multiplyScalar(4);_this2.trees.position.set(-50,-130,345);_this2.add(_this2.trees);_this2.snowGeo=geometry.clone();_this2.refObj=new THREE.Object3D;_this2.refObj.scale.set(15,15,5);_this2.refObj.position.set(0,250,80);_this2.refObj.rotation.set(Math.PI*9/8,0,Math.PI/2)});this.blueprint=tex_loader.load(this.BASE_PATH+"/images/blueprint_edit.jpg");this.blueprint.wrapS=THREE.RepeatWrapping;this.blueprint.wrapT=THREE.RepeatWrapping;this.blueprintMat=new THREE.MeshPhongMaterial({map:this.blueprint,color:3229534,shininess:10,shading:THREE.FlatShading});loader.load(this.BASE_PATH+"/models/terrain5.json",function(geometry,material){_this2.terrain=new THREE.Mesh(geometry,_this2.blueprintMat);_this2.terrain.scale.multiplyScalar(4);_this2.terrain.position.set(-40,-500,20);_this2.add(_this2.terrain)});this.cloudAmount=20;this.cloudRadius=[180,120,300];this.cloudScale=[9,8,15];this.cloudColors=[new THREE.Color(15202043),new THREE.Color(13369344),new THREE.Color(4926073)];this.floorHeight=0;this.treeRadius=3;this.cloudTex=tex_loader.load(this.BASE_PATH+"/images/cloud3.png");this.cloudTex.wrapS=THREE.RepeatWrapping;this.cloudTex.wrapT=THREE.RepeatWrapping;this.cloudTex.repeat.set(5,3);var cloudFiles=[this.BASE_PATH+"/models/cloud1_3.json",this.BASE_PATH+"/models/cloud2_3.json"];this.cloudGeos=[];this.cloudGroup=[];this.cloudMaterial=new THREE.MeshBasicMaterial({color:this.cloudColors[0],map:this.cloudTex,transparent:true,opacity:.2});this.loadClouds(cloudFiles).then(function(){for(var _i2=0;_i2<3;_i2++){var cloudRing=new THREE.Object3D;cloudRing.position.y=(_i2+1)*-100;var tl=new TimelineMax({repeat:-1});tl.to(cloudRing.rotation,250+_i2*50,{y:Math.PI*2,ease:Power0.easeNone});cloudRing.tweenline=tl;_this2.add(cloudRing);_this2.cloudGroup.push(cloudRing)}for(var _i3=0;_i3<_this2.cloudAmount;_i3++){var cloudd=new THREE.Mesh(_this2.cloudGeos[_i3%2],_this2.cloudMaterial);cloudd.position.set(Math.sin(Math.PI*2/_this2.cloudAmount*_i3)*_this2.cloudRadius[_i3%3]*(1+_this2.lookupTable[_i3]/2),_this2.lookupTable[_i3],Math.cos(Math.PI*2/_this2.cloudAmount*_i3)*_this2.cloudRadius[_i3%3]*(1+_this2.lookupTable[_i3+1]/2));cloudd.rotation.set(0,Math.PI*2/_this2.cloudAmount*_i3+Math.PI,0,"YXZ");cloudd.scale.multiplyScalar(_this2.cloudScale[_i3%3]*(1+_this2.lookupTable[_i3]/2));_this2.cloudGroup[_i3%3].add(cloudd)}});this.completeSequenceSetup();this.loadingManager.itemEnd("IntroAnim")}},{key:"loadClouds",value:function loadClouds(cloudFiles){var _this3=this;var loaders=[];for(var i=0;i<cloudFiles.length;i++){loaders.push(this.loadFile(this.loadingManager,cloudFiles[i]))}var promise=new Promise(function(resolve,reject){Promise.all(loaders).then(function(results){for(var _i4=0;_i4<results.length;_i4++){_this3.cloudGeos.push(results[_i4])}resolve()})});return promise}},{key:"loadFile",value:function loadFile(loadingManager,path){return new Promise(function(resolve,reject){var loader=new THREE.JSONLoader(loadingManager);loader.load(path,function(geo){resolve(geo)})})}},{key:"initFBOParticle",value:function initFBOParticle(){var squareMesh=this.square.getSphereMesh();console.log(squareMesh.geometry.boundingSphere);this.sRadius=squareMesh.geometry.boundingSphere.radius;this.sCenter=squareMesh.geometry.boundingSphere.center;console.log("Square radius ",this.sRadius,"Center: ",this.sCenter);this.simulationShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:this.positionsForFBO},deltaTime:{type:"f",value:0},maxDepth:{type:"f",value:this.maxDepth},maxDistance:{type:"f",value:50},amplitude:{type:"f",value:0},frequency:{type:"f",value:1},gravity:{type:"f",value:7},mouseRotation:{type:"f",value:0},squareRadius:{type:"f",value:this.sRadius*.04},squareCenterX:{type:"f",value:this.sCenter.x},squareCenterY:{type:"f",value:this.sCenter.y},squareCenterZ:{type:"f",value:this.sCenter.z-70},bounceFactor:{type:"f",value:2}},vertexShader:this.simulation_vs,fragmentShader:this.simulation_fs});this.renderShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:null},pointSize:{type:"f",value:1}},vertexShader:this.render_vs,fragmentShader:this.render_fs,transparent:false});var particleGeometry=new THREE.Geometry;particleGeometry.vertices.push(new THREE.Vector3);this.fbo=new _fbo2.default;this.fbo.init(this.width,this.height,this.renderer,this.simulationShader,this.renderShader,particleGeometry);this.fbo.particles.frustumCulled=false;this.add(this.fbo.particles);this.timerAnim=null}},{key:"disposeAni",value:function disposeAni(){console.log("Intro animation - disposing");this.remove(this.trees);this.remove(this.terrain);this.blueprint.dispose();this.blueprintMat.dispose();this.treeGeo.dispose();this.treeMaterial.dispose();for(var i=0;i<this.cloudGroup.length;i++){this.cloudGroup[i].tweenline.kill();this.remove(this.cloudGroup[i])}this.cloudTex.dispose();this.cloudMaterial.dispose();for(var i=0;i<this.cloudGeos.length;i++){this.cloudGeos[i].dispose()}this.disposeSnowParticle()}},{key:"createSnowParticle",value:function createSnowParticle(){this.positionsForFBO=this.initParticles(this.refObj,this.snowGeo);this.test=new _sun_loader2.default(this.renderer);this.test.init();this.test.position.set(0,60,0);this.initFBOParticle()}},{key:"disposeSnowParticle",value:function disposeSnowParticle(){this.remove(this.fbo.particles);this.fbo.particles.geometry.dispose();if(this.test){this.remove(this.test)}}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"start",value:function start(){this.isStarted=true;this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){if(this.isStarted){this.simulationShader.uniforms.deltaTime.value=dt;this.fbo.update();this.test.update(dt,et)}}}]);return IntroAnimation}(THREE.Object3D);exports.default=IntroAnimation},{"../sun_loader":49,"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/fbo":59,"../util/improved_noise":61,"../util/texture_animator":65}],5:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ItzhakAnimation=function(_THREE$Object3D){_inherits(ItzhakAnimation,_THREE$Object3D);function ItzhakAnimation(config){_classCallCheck(this,ItzhakAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(ItzhakAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/itzhak";return _this}_createClass(ItzhakAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.animStart=false;this.sequenceConfig=[{time:1,anim:function anim(){_this2.growClouds(3)}},{time:29,anim:function anim(){_this2.dropClouds(5,false)}},{time:62,anim:function anim(){_this2.dropClouds(8,false)}},{time:102,anim:function anim(){_this2.dropClouds(3,false)}},{time:120,anim:function anim(){_this2.dropClouds(12,false)}},{time:143,anim:function anim(){_this2.dropClouds(16,false)}},{time:166,anim:function anim(){_this2.dropClouds(20,true)}},{time:179,anim:function anim(){_this2.characterDisappear()}}];this.nextAnim=null;this.completeSequenceSetup();this.loadingManager.itemStart("ItzhakAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.cloudAmount=10;this.cloudRadius=[3,4,5];this.cloudScale=[.15,.3,.45];this.cloudColors=[new THREE.Color(15202043),new THREE.Color(13369344),new THREE.Color(4926073)];this.floorHeight=-2.5;this.treeRadius=3;this.cloudIndex=[];for(var _i=0;_i<this.cloudAmount;_i++){this.cloudIndex.push(_i)}this.cloudTex=tex_loader.load(this.BASE_PATH+"/images/cloud3.png");this.cloudTex.wrapS=THREE.RepeatWrapping;this.cloudTex.wrapT=THREE.RepeatWrapping;this.cloudTex.repeat.set(5,3);this.itzhakLoadingManager=new THREE.LoadingManager;this.itzhakLoadingManager.onLoad=function(){for(var j=0;j<_this2.cloudGeos.length;j++){_this2.cloudGeos[j].morphTargets.push({name:"h1",vertices:_this2.heartGeos[j].vertices});_this2.cloudGeos[j].computeMorphNormals()}_this2.createClouds()};var cloudFiles=[this.BASE_PATH+"/models/cloud1_3.json",this.BASE_PATH+"/models/cloud2_3.json"];var heartFiles=[this.BASE_PATH+"/models/heart1.json",this.BASE_PATH+"/models/heart2.json"];this.cloudGeos=[];this.heartGeos=[];this.cloudGroup=[];this.cloudOuterGroup=[];this.cloudVirtualGroup={};this.cloudMats=[];this.loadClouds(cloudFiles,heartFiles);this.treeTex=tex_loader.load(this.BASE_PATH+"/images/house.jpg");this.treeMat=new THREE.MeshBasicMaterial({map:this.treeTex});this.treeGroup=new THREE.Object3D;loader.load(this.BASE_PATH+"/models/singleTree.json",function(geometry){_this2.treeGeo=geometry;var tree=new THREE.Mesh(geometry,_this2.treeMat);for(var _i2=0;_i2<16;_i2++){var t=tree.clone();t.position.set(Math.sin(Math.PI*2/32*(_i2+8))*(_this2.treeRadius-.5)+_this2.lookupTable[_i2],0,Math.cos(Math.PI*2/32*(_i2+8))*(_this2.treeRadius-.5)+_this2.lookupTable[_i2]);t.scale.y=.9+_this2.lookupTable[_i2]/2;t.rotation.y=_this2.lookupTable[_i2]*2;_this2.treeGroup.add(t)}for(var _i3=0;_i3<20;_i3++){var _t=tree.clone();_t.position.set(Math.sin(Math.PI*2/40*(_i3+10))*_this2.treeRadius+_this2.lookupTable[_i3],0,Math.cos(Math.PI*2/40*(_i3+10))*_this2.treeRadius+_this2.lookupTable[_i3]);_t.scale.y=.4+_this2.lookupTable[_i3]/2;_t.rotation.y=_this2.lookupTable[_i3]*2;_this2.treeGroup.add(_t)}_this2.treeGroup.position.z=1;_this2.add(_this2.treeGroup)});this.dummy={timeScaleValue:0};this.rockGroup=new THREE.Object3D;this.add(this.rockGroup);this.rockTex=tex_loader.load(this.BASE_PATH+"/images/rock.jpg");this.rockMat=new THREE.MeshLambertMaterial({map:this.rockTex});this.loadRock(this.BASE_PATH+"/models/rock1.json",this.BASE_PATH+"/models/rock2.json",loader);events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("ItzhakAnim")}},{key:"loadRock",value:function loadRock(r_f_1,r_f_2,loader){var _this3=this;var rockss=[];this.rockGeo,this.rockGeo2;loader.load(r_f_1,function(geometry){_this3.rockGeo=geometry;var rock1=new THREE.Mesh(geometry,_this3.rockMat);rockss.push(rock1);loader.load(r_f_2,function(geometry2){_this3.rockGeo2=geometry2;var rock2=new THREE.Mesh(geometry2,_this3.rockMat);rockss.push(rock2);for(var i=0;i<6;i++){for(var j=0;j<9;j++){var r=rockss[i*j%2].clone();r.position.set(Math.sin(Math.PI*2/12*(i+3))*1+_this3.lookupTable[i+j],j*.3,Math.cos(Math.PI*2/12*(i+3))*1+_this3.lookupTable[i+j]);r.scale.multiplyScalar(.3+_this3.lookupTable[i+j]/2);r.rotation.y=_this3.lookupTable[i+j];_this3.rockGroup.add(r)}}})})}},{key:"loadClouds",value:function loadClouds(cloudFiles,heartFiles){var _this4=this;var cloudLoader=new THREE.JSONLoader(this.itzhakLoadingManager);var _loop=function _loop(i){cloudLoader.load(cloudFiles[i],function(geometry){geometry.name="cloudGeo"+i;_this4.cloudGeos.push(geometry)});cloudLoader.load(heartFiles[i],function(geometry2){geometry2.name="heartGeo"+i;_this4.heartGeos.push(geometry2)})};for(var i=0;i<cloudFiles.length;i++){_loop(i)}}},{key:"createClouds",value:function createClouds(){this.cloudMaterial=new THREE.MeshBasicMaterial({color:this.cloudColors[0],map:this.cloudTex,transparent:true,opacity:.5,morphTargets:true,morphNormals:true});this.outerCloudMaterial=new THREE.MeshBasicMaterial({color:this.cloudColors[0],map:this.cloudTex,transparent:true,opacity:1});for(var i=0;i<3;i++){var cloudRing=new THREE.Object3D;cloudRing.position.y=5-i*2;var tl=new TimelineMax({repeat:-1});tl.to(cloudRing.rotation,150+i*20,{y:Math.PI*2,ease:Power0.easeNone});cloudRing.tweenline=tl;this.add(cloudRing);this.cloudGroup.push(cloudRing);var cloudOuterRing=new THREE.Object3D;cloudOuterRing.position.y=8-i*4;var tl_2=new TimelineMax({repeat:-1});tl_2.to(cloudOuterRing.rotation,150+i*20,{y:Math.PI*2,ease:Power0.easeNone});cloudOuterRing.tweenline=tl_2;this.add(cloudOuterRing);this.cloudOuterGroup.push(cloudOuterRing)}for(var _i4=0;_i4<this.cloudAmount;_i4++){var cloudObject={};var _cloudMat=this.cloudMaterial.clone();this.cloudMats.push(_cloudMat);var cloudd=new THREE.Mesh(this.cloudGeos[_i4%2],_cloudMat);cloudd.position.set(Math.sin(Math.PI*2/this.cloudAmount*_i4)*this.cloudRadius[_i4%3],this.lookupTable[_i4],Math.cos(Math.PI*2/this.cloudAmount*_i4)*this.cloudRadius[_i4%3]);cloudd.rotation.set(0,Math.PI*2/this.cloudAmount*_i4+Math.PI,0,"YXZ");cloudd.scale.multiplyScalar(this.cloudScale[_i4%3]*(1+this.lookupTable[_i4]/2));cloudd.material.opacity=0;this.cloudGroup[_i4%3].add(cloudd);cloudObject.object=cloudd;this.cloudVirtualGroup[_i4]=cloudObject;var cloudd_out=new THREE.Mesh(this.cloudGeos[_i4%2],this.outerCloudMaterial);cloudd_out.position.set(Math.sin(Math.PI*2/this.cloudAmount*_i4)*this.cloudRadius[_i4%3]*3,this.lookupTable[_i4]*3,Math.cos(Math.PI*2/this.cloudAmount*_i4)*this.cloudRadius[_i4%3]*3);cloudd_out.rotation.set(0,Math.PI*2/this.cloudAmount*_i4+Math.PI,0,"YXZ");cloudd_out.scale.multiplyScalar(this.cloudScale[_i4%3]*(2+this.lookupTable[_i4]/2));cloudd_out.material.opacity=0;this.cloudOuterGroup[_i4%3].add(cloudd_out)}}},{key:"characterDisappear",value:function characterDisappear(){var _this5=this;TweenMax.to(this.dummy,6,{timeScaleValue:80,ease:Power3.easeIn,onStart:function onStart(){for(var i=0;i<_this5.cloudGroup.length;i++){TweenMax.to(_this5.cloudGroup[i].scale,2,{x:"+="+i*.03,z:"+="+i*.03});TweenMax.to(_this5.cloudGroup[i].position,2,{y:"-="+(3-i)})}},onUpdate:function onUpdate(){for(var i=0;i<_this5.cloudGroup.length;i++){_this5.cloudGroup[i].tweenline.timeScale(_this5.dummy.timeScaleValue*(3-i)*2.5)}}});var _loop2=function _loop2(i){TweenMax.to(_this5.cloudGroup[i].scale,1,{x:.01,y:.01,z:.01,delay:5,ease:Back.easeIn.config(4),onStart:function onStart(){TweenMax.to(_this5.cloudGroup[i].position,2,{y:0,ease:Back.easeInOut})},onComplete:function onComplete(){_this5.cloudGroup[i].visible=false}})};for(var i=0;i<this.cloudGroup.length;i++){_loop2(i)}var _loop3=function _loop3(_i5){var theCloud=_this5.cloudVirtualGroup[_i5].object;if(theCloud.theParent!=null)_this5.attach(theCloud,_this5,theCloud.theParent);TweenMax.to(theCloud.rotation,3,{x:0});TweenMax.to(theCloud.material.color,2,{r:_this5.cloudColors[1].r,g:_this5.cloudColors[1].g,b:_this5.cloudColors[1].b,onStart:function onStart(){var toY=theCloud.position.y+-8*_this5.lookupTable[_i5];TweenMax.to(theCloud.position,5,{y:theCloud.oriHeight})}});TweenMax.to(theCloud.scale,5,{x:"+=.8",y:"+=1.1",z:"+=.8",delay:_this5.lookupTable[_i5]*3})};for(var _i5=0;_i5<this.cloudAmount;_i5++){_loop3(_i5)}TweenMax.to(this.parent.fullVideo.mesh.scale,1,{x:1e-5,y:1e-5,z:1e-5,ease:Back.easeInOut,delay:5.5,onComplete:function onComplete(){_this5.parent.fullVideo.setOpacity(0)}})}},{key:"disposeAni",value:function disposeAni(){for(var i=0;i<this.cloudGroup.length;i++){this.remove(this.cloudGroup[i])}for(var i=0;i<this.cloudOuterGroup.length;i++){this.remove(this.cloudOuterGroup[i])}for(var i=0;i<this.cloudGeos.length;i++){this.cloudGeos[i].dispose()}this.cloudMaterial.dispose();this.outerCloudMaterial.dispose();for(var i=0;i<this.cloudMats.length;i++){this.cloudMats[i].dispose()}this.cloudTex.dispose();this.remove(this.treeGroup);this.treeGeo.dispose();this.treeMat.dispose();this.treeTex.dispose();this.remove(this.rockGroup);this.rockGeo.dispose();this.rockGeo2.dispose();this.rockMat.dispose();this.rockTex.dispose();for(var i=0;i<this.heartGeos.length;i++){this.heartGeos[i].dispose()}console.log("dispose Itzhak ani!")}},{key:"growClouds",value:function growClouds(diff){for(var i=0;i<this.cloudAmount;i++){TweenMax.to(this.cloudVirtualGroup[i].object.material,2,{opacity:.5,delay:this.lookupTable[i]*diff})}TweenMax.to(this.outerCloudMaterial,2,{opacity:1})}},{key:"dropCloud",value:function dropCloud(c_index,theCloud,theParent,noRise){var _this6=this;TweenMax.to(theCloud.material.color,2,{r:this.cloudColors[1].r,g:this.cloudColors[1].g,b:this.cloudColors[1].b,onStart:function onStart(){TweenMax.to(theCloud.material,2,{opacity:1})}});TweenMax.to(theCloud.morphTargetInfluences,2,{endArray:[1],onComplete:function onComplete(){setTimeout(function(){_this6.detach(theCloud,theParent,_this6)},3500);TweenMax.to(theCloud.position,2,{y:_this6.floorHeight,ease:Bounce.easeOut,delay:4+c_index*.05,onStart:function onStart(){TweenMax.to(theCloud.rotation,1,{x:Math.PI/2,delay:.5})},onCompleteParams:[theCloud.position.y+theParent.position.y],onComplete:function onComplete(oriHeight){TweenMax.to(theCloud.material.color,.5,{r:_this6.cloudColors[2].r,g:_this6.cloudColors[2].g,b:_this6.cloudColors[2].b});if(!noRise){TweenMax.to(theCloud.position,4,{y:oriHeight,delay:5,onStart:function onStart(){TweenMax.to(theCloud.morphTargetInfluences,2,{endArray:[0],ease:RoughEase.ease.config({template:Power0.easeNone,strength:1,points:20,taper:"none",randomize:true,clamp:false})});TweenMax.to(theCloud.material.color,2,{r:_this6.cloudColors[0].r,g:_this6.cloudColors[0].g,b:_this6.cloudColors[0].b});TweenMax.to(theCloud.rotation,1,{x:0});TweenMax.to(theCloud.material,2,{opacity:.5})},onComplete:function onComplete(){_this6.attach(theCloud,_this6,theParent)}})}else{theCloud.oriHeight=oriHeight;theCloud.theParent=theParent}}})}})}},{key:"dropSingleCloud",value:function dropSingleCloud(c_index){var whichCloud=c_index%3;var childIndex=Math.floor(c_index/3);var theParent=this.cloudGroup[whichCloud];var theCloud=this.cloudGroup[whichCloud].children[childIndex];this.dropCloud(c_index,theCloud,theParent)}},{key:"dropMultiCloud",value:function dropMultiCloud(c_index,noRise){var theCloud=this.cloudVirtualGroup[c_index].object;var theParent=theCloud.parent;this.dropCloud(c_index,theCloud,theParent,noRise)}},{key:"dropClouds",value:function dropClouds(amount,noRise){var counter=0;this.shuffle(this.cloudIndex);for(var i=0;i<amount;i++){this.dropMultiCloud(this.cloudIndex[i],noRise)}}},{key:"shuffle",value:function shuffle(a){for(var i=a.length;i;i--){var j=Math.floor(Math.random()*i);var _ref=[a[j],a[i-1]];a[i-1]=_ref[0];a[j]=_ref[1]}}},{key:"detach",value:function detach(child,parent,scene){child.applyMatrix(parent.matrix);parent.remove(child);scene.add(child)}},{key:"attach",value:function attach(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrix);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"doFirstAni",value:function doFirstAni(){console.log("do first animation.")}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){}}]);return ItzhakAnimation}(THREE.Object3D);exports.default=ItzhakAnimation},{"../util/debug":58,"../util/improved_noise":61}],6:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ItzikAnimation=function(_THREE$Object3D){_inherits(ItzikAnimation,_THREE$Object3D);function ItzikAnimation(config){_classCallCheck(this,ItzikAnimation);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(ItzikAnimation).call(this));_this2.config=config;_this2.BASE_PATH=_this2.config.assetsHost+"assets/animations/itzik";return _this2}_createClass(ItzikAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this3=this;var scope=this;this.animStart=false;this.sequenceConfig=[{time:50,anim:function anim(){_this3.benchOutFirst()}},{time:60,anim:function anim(){_this3.benchMove(1)}},{time:68,anim:function anim(){_this3.benchMove(2)}},{time:75,anim:function anim(){_this3.benchMove(3)}},{time:80,anim:function anim(){_this3.benchMove(4)}},{time:85,anim:function anim(){_this3.benchMove(5)}},{time:93,anim:function anim(){_this3.benchRotateNoScale_On()}},{time:190,anim:function anim(){_this3.benchRotateNoScale_Off()}},{time:197,anim:function anim(){_this3.characterDisappear()}}];this.nextAnim=null;this.completeSequenceSetup();this.perlin=new _improved_noise2.default;this.loadingManager.itemStart("ItzikAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.benchGroup=new THREE.Object3D;this.benchCount=6;this.b_offset=5;this.b_radius=11.55;this.b_open_index=0;this.clouds=[];this.items=[];this.itemIsMoving=[];for(var _i=0;_i<this.benchCount;_i++){this.itemIsMoving.push(false)}this.cloudFiles=[this.BASE_PATH+"/models/clouds/cloud_0.json",this.BASE_PATH+"/models/clouds/cloud_1.json",this.BASE_PATH+"/models/clouds/cloud_2.json",this.BASE_PATH+"/models/clouds/cloud_3.json",this.BASE_PATH+"/models/clouds/cloud_4.json",this.BASE_PATH+"/models/clouds/cloud_5.json",this.BASE_PATH+"/models/clouds/cloud_6.json",this.BASE_PATH+"/models/clouds/cloud_7.json",this.BASE_PATH+"/models/clouds/cloud_8.json",this.BASE_PATH+"/models/clouds/cloud_9.json"];this.itemFiles=[this.BASE_PATH+"/models/items/1_baguette.json",this.BASE_PATH+"/models/items/2_coke.json",this.BASE_PATH+"/models/items/3_newspaper.json",this.BASE_PATH+"/models/items/4_soccer.json",this.BASE_PATH+"/models/items/5_cigarettes.json",this.BASE_PATH+"/models/items/6_bags.json",this.BASE_PATH+"/models/items/7_bucket.json",this.BASE_PATH+"/models/items/8_soccerFlat.json",this.BASE_PATH+"/models/items/9_dollhouse.json",this.BASE_PATH+"/models/items/9_dollhouse.json"];this.lightColor=[16663078,16676902,16690726,16704550,16774042,10682356,8909055,8901887,616180,343446];this.benchTexFiles=[this.BASE_PATH+"/images/benches/1_carpet.jpg",this.BASE_PATH+"/images/benches/2_metal.jpg",this.BASE_PATH+"/images/benches/3_marble.jpg",this.BASE_PATH+"/images/benches/4_rock.jpg",this.BASE_PATH+"/images/benches/5_photo.jpg",this.BASE_PATH+"/images/benches/9_tiles.jpg",this.BASE_PATH+"/images/benches/7_sand.jpg",this.BASE_PATH+"/images/benches/8_rust.jpg",this.BASE_PATH+"/images/benches/6_wood.jpg",this.BASE_PATH+"/images/benches/10_metal.jpg"];this.benchTexNRMFiles=[this.BASE_PATH+"/images/benches/NRM/1_carpet_NRM.png",this.BASE_PATH+"/images/benches/NRM/2_metal_NRM.png",this.BASE_PATH+"/images/benches/NRM/3_marble_NRM.png",this.BASE_PATH+"/images/benches/NRM/4_rock_NRM.png",this.BASE_PATH+"/images/benches/NRM/5_photo_NRM.png",this.BASE_PATH+"/images/benches/NRM/9_tiles_NRM.png",this.BASE_PATH+"/images/benches/NRM/7_sand_NRM.png",this.BASE_PATH+"/images/benches/NRM/8_rust_NRM.png",this.BASE_PATH+"/images/benches/NRM/6_wood_NRM.png",this.BASE_PATH+"/images/benches/NRM/10_metal_NRM.png"];this.benchTextures=[];this.benchTexturesNRM=[];this.benchMats=[];this.disposeRelatedGeos=[];for(var _i2=0;_i2<this.benchCount;_i2++){var bt=tex_loader.load(this.benchTexFiles[_i2]);this.benchTextures.push(bt);var btNRM=tex_loader.load(this.benchTexNRMFiles[_i2]);this.benchTexturesNRM.push(btNRM);var bm=new THREE.MeshStandardMaterial({map:bt,normalMap:btNRM,roughness:1,metalness:0});this.benchMats.push(bm)}this.cloudTex=tex_loader.load(this.BASE_PATH+"/images/clouds.jpg");this.cloudMat=new THREE.MeshLambertMaterial({map:this.cloudTex});this.itemsTex=tex_loader.load(this.BASE_PATH+"/images/items.jpg");this.itemsMat=new THREE.MeshLambertMaterial({map:this.itemsTex});this.itemsTex2=tex_loader.load(this.BASE_PATH+"/images/items2.png");this.itemsMat2=new THREE.MeshLambertMaterial({map:this.itemsTex2,transparent:true});this.smokeTex=tex_loader.load(this.BASE_PATH+"/images/smoke2.png");this.smokeMat=new THREE.SpriteMaterial({map:this.smokeTex,color:343446,transparent:true,opacity:0});this.fog=new THREE.Object3D;var _loop=function _loop(_i3){loader.load(_this3.cloudFiles[_i3],function(geometry,material){scope.disposeRelatedGeos.push(geometry);var tmpCloud=new THREE.Mesh(geometry,_this3.cloudMat);var pointLight=new THREE.PointLight(_this3.lightColor[_i3],1,2);pointLight.position.z=10;tmpCloud.add(pointLight);pointLight.visible=false;tmpCloud.scale.multiplyScalar(.5);
tmpCloud.position.y=15;TweenMax.to(tmpCloud.position,1,{y:15.1,repeat:-1,yoyo:true,ease:Power1.easeInOut});_this3.clouds[_i3]=tmpCloud;if(_i3==_this3.benchCount-1){_this3.loadModelItems(_this3.itemFiles,_this3.itemsMat,_this3.itemsMat2,loader)}})};for(var _i3=0;_i3<this.benchCount;_i3++){_loop(_i3)}this.dummy={opacity:1};events.on("experience_end",function(){_this3.disposeAni()});this.loadingManager.itemEnd("ItzikAnim")}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"benchOutFirst",value:function benchOutFirst(){TweenMax.to(this.benchGroup.children[0].scale,1.5,{x:1,y:1,z:1,ease:Back.easeInOut})}},{key:"benchMove",value:function benchMove(_seq){for(var i=0;i<=_seq;i++){var mathStuff=Math.PI*2/this.benchCount*(_seq-i+this.b_offset-2);TweenMax.to(this.benchGroup.children[i].position,2,{x:Math.sin(mathStuff)*this.b_radius,z:Math.cos(mathStuff)*this.b_radius,ease:Power3.easeInOut});TweenMax.to(this.benchGroup.children[i].rotation,2,{y:mathStuff+Math.PI,ease:Power3.easeInOut,onComplete:this.benchOut,onCompleteParams:[this,i]})}this.itemIsMoving[_seq]=true;if(_seq==3){TweenMax.to(this.benchGroup.children[3].children[1].rotation,2,{z:1,repeat:-1,yoyo:true,ease:Power3.easeInOut})}}},{key:"benchOut",value:function benchOut(_this,_index){TweenMax.to(_this.benchGroup.children[_index].scale,1.5,{x:1,y:1,z:1,ease:Back.easeInOut})}},{key:"characterDisappear",value:function characterDisappear(){var _this4=this;TweenMax.to(this.smokeMat,1,{opacity:1});TweenMax.to(this.fog.position,4,{x:0,delay:.9,ease:Power1.easeInOut});if(this.parent.fullVideo){TweenMax.to(this.dummy,3,{opacity:0,delay:10,onUpdate:function onUpdate(){_this4.parent.fullVideo.setOpacity(_this4.dummy.opacity)},onStart:function onStart(){TweenMax.to(_this4.smokeMat,4,{opacity:0})},onComplete:function onComplete(){_this4.parent.fullVideo.setOpacity(0);var mathStuff=Math.PI*2/_this4.benchCount;_this4.benchGroupRotateOn(_this4,mathStuff);for(var i=0;i<_this4.benchGroup.children.length;i++){_this4.benchGroup.children[i].children[0].visible=false}}})}}},{key:"disposeAni",value:function disposeAni(){this.remove(this.benchGroup);for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}for(var i=0;i<this.benchMats.length;i++){this.benchMats[i].dispose()}for(var i=0;i<this.benchTextures.length;i++){this.benchTextures[i].dispose()}for(var i=0;i<this.benchTexturesNRM.length;i++){this.benchTexturesNRM[i].dispose()}this.cloudMat.dispose();this.itemsMat.dispose();this.itemsMat2.dispose();this.smokeMat.dispose();this.cloudTex.dispose();this.itemsTex.dispose();this.itemsTex2.dispose();this.smokeTex.dispose();console.log("dispose Itzik ani!")}},{key:"benchRotateNoScale_On",value:function benchRotateNoScale_On(){var angle=Math.PI*2/this.benchCount;this.benchTimeline=new TimelineMax({repeat:-1});this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2");this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2");this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2");this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2");this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2");this.benchTimeline.to(this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut},"+=2")}},{key:"benchRotateNoScale_Off",value:function benchRotateNoScale_Off(){if(this.benchTimeline==null)return;this.benchTimeline.pause()}},{key:"benchGroupRotateOn",value:function benchGroupRotateOn(_this,angle){var closeIndex=(_this.b_open_index+(_this.benchCount-3))%_this.benchCount;var openIndex=(_this.b_open_index+(_this.benchCount-2))%_this.benchCount;TweenMax.to(_this.benchGroup.children[closeIndex].scale,1,{x:1,y:1,z:1,ease:Power1.easeInOut});TweenMax.to(_this.benchGroup.children[openIndex].scale,.5,{x:.01,y:.01,z:.01,ease:Power1.easeInOut});_this.b_open_index++;TweenMax.to(_this.benchGroup.rotation,2,{y:"+="+angle,ease:Power3.easeInOut,delay:2,onComplete:_this.benchGroupRotateOn,onCompleteParams:[_this,angle]})}},{key:"loadModelItems",value:function loadModelItems(urls,mat,mat2,loader){var _this5=this;var _loop2=function _loop2(i){loader.load(urls[i],function(geometry,material){_this5.disposeRelatedGeos.push(geometry);if(i==3){geometry.applyMatrix((new THREE.Matrix4).makeTranslation(-2,-1.5,0));var tmpItem=new THREE.Mesh(geometry,mat);tmpItem.position.set(-2.5,1.5,0);_this5.items[i]=tmpItem}else if(i==4||i==6){var _tmpItem=new THREE.Mesh(geometry,mat2);_tmpItem.position.x=-5;_this5.items[i]=_tmpItem}else if(i==5){for(var j=0;j<50;j++){var sprite=new THREE.Sprite(_this5.smokeMat);sprite.scale.multiplyScalar(3);sprite.position.set(-7*Math.random()+3.5,-10*Math.random()+10,4+Math.random()*2);_this5.fog.add(sprite)}_this5.fog.position.x=7;_this5.items[i]=_this5.fog;_this5.loadModelBench(_this5.BASE_PATH+"/models/bench.json",loader)}else{var _tmpItem2=new THREE.Mesh(geometry,mat);_this5.items[i]=_tmpItem2}})};for(var i=0;i<urls.length;i++){_loop2(i)}}},{key:"loadModelBench",value:function loadModelBench(url,loader){var _this6=this;loader.load(url,function(geometry,material){for(var i=0;i<_this6.clouds.length;i++){var _geo=geometry.clone();_this6.disposeRelatedGeos.push(_geo);var tmp_bench=new THREE.Mesh(_geo,_this6.benchMats[i]);tmp_bench.position.set(Math.sin(Math.PI*2/10*_this6.b_offset)*_this6.b_radius,0,Math.cos(Math.PI*2/10*_this6.b_offset)*_this6.b_radius);tmp_bench.rotation.y=Math.PI*2/10*_this6.b_offset+Math.PI;tmp_bench.scale.multiplyScalar(.005);tmp_bench.add(_this6.clouds[i]);tmp_bench.add(_this6.items[i]);_this6.benchGroup.add(tmp_bench)}_this6.benchGroup.position.set(0,-4,15);_this6.add(_this6.benchGroup)})}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){if(this.itemIsMoving[this.benchCount-1]){for(var i=0;i<this.fog.children.length;i++){var h=this.perlin.noise(et*.1,i,1)/50;this.fog.children[i].position.addScalar(h)}}}}]);return ItzikAnimation}(THREE.Object3D);exports.default=ItzikAnimation},{"../util/debug":58,"../util/improved_noise":61}],7:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Lupo12PMAnimation=function(_THREE$Object3D){_inherits(Lupo12PMAnimation,_THREE$Object3D);function Lupo12PMAnimation(config){_classCallCheck(this,Lupo12PMAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Lupo12PMAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/lupo12pm";_this.initialized=false;_this.theDogs=null;_this.beDetached=false;return _this}_createClass(Lupo12PMAnimation,[{key:"init",value:function init(loadingManager){console.log("Init Lupo12PM Animation");this.initialized=true;this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.loadingManager.itemStart("Lupo12PMAnim");this.perlin=new _improved_noise2.default;this.showDummyDogs=false;this.sequenceConfig={Lupo12PM:[{time:0,anim:function anim(){_this2.setupForDay()}},{time:16,anim:function anim(){_this2.showSculptures()}},{time:24,anim:function anim(){_this2.flickerSculptureTextures()}},{time:26,anim:function anim(){_this2.growSingleCactus(0)}},{time:32,anim:function anim(){_this2.growSingleCactus(1,16711680)}},{time:42,anim:function anim(){_this2.growSingleCactus(2,16711680)}},{time:47,anim:function anim(){_this2.growSingleCactus(3,16711680)}},{time:74,anim:function anim(){_this2.growSingleCactus(4)}},{time:85,anim:function anim(){_this2.growSingleCactus(5)}},{time:88,anim:function anim(){_this2.growSingleCactus(6)}},{time:109,anim:function anim(){_this2.growSingleCactus(7)}},{time:114,anim:function anim(){_this2.growSingleCactus(8)}},{time:120,anim:function anim(){_this2.growSingleCactus(9)}},{time:135,anim:function anim(){_this2.connectToDogs()}},{time:209,anim:function anim(){_this2.characterDisappearDay()}}],Lupo5PM:[{time:0,anim:function anim(){_this2.setupForNight()}},{time:1,anim:function anim(){_this2.connectToDogs()}},{time:7,anim:function anim(){_this2.scaleDogs(1)}},{time:16,anim:function anim(){_this2.showSculptures()}},{time:24,anim:function anim(){_this2.flickerSculptureTextures()}},{time:27,anim:function anim(){_this2.scaleDogs(2)}},{time:28,anim:function anim(){_this2.shiftSculptures()}},{time:35,anim:function anim(){_this2.growSingleCactusFloor(0)}},{time:40,anim:function anim(){_this2.growSingleCactusFloor(1)}},{time:47,anim:function anim(){_this2.growSingleCactusFloor(2)}},{time:50,anim:function anim(){_this2.growSingleCactusFloor(3)}},{time:55,anim:function anim(){_this2.growSingleCactusFloor(4)}},{time:60,anim:function anim(){_this2.growSingleFlower(0)}},{time:65,anim:function anim(){_this2.growSingleFlower(1)}},{time:77,anim:function anim(){_this2.growSingleFlower(2)}},{time:85,anim:function anim(){_this2.growSingleFlower(3)}},{time:100,anim:function anim(){_this2.growSingleFlower(4)}},{time:120,anim:function anim(){_this2.closeFlower()}},{time:135,anim:function anim(){_this2.characterDisappearDay()}}]};this.nextAnim=null;this.tweenAnimCollectors=[];var p_tex_loader=new THREE.TextureLoader(this.loadingManager);this.baseMat=new THREE.MeshLambertMaterial({color:10437626,wireframe:true});this.bottomMat=new THREE.MeshLambertMaterial({color:4455071});this.topMat=new THREE.MeshLambertMaterial({color:16424771});var modelLoader=new THREE.JSONLoader(this.loadingManager);this.dogsTobePosition={desktop:{1:[19.83,22.33,1.04],2:[20.06,22.93,1.72]},vive:{1:[-10.2,22.54,-1.33],2:[-10.69,23.21,-1.68]}};var sculptureModelFiles=[[this.BASE_PATH+"/models/sculptures/deer.js",new THREE.Vector3(2.59,-.36,4.47),new THREE.Vector3(2,.5,2)],[this.BASE_PATH+"/models/sculptures/dog.js",new THREE.Vector3(-3.62,-.3,4.83),new THREE.Vector3(-2,.5,1.5)],[this.BASE_PATH+"/models/sculptures/macho.js",new THREE.Vector3(-3.8,.7,0),new THREE.Vector3(-3.8,2,1.3)],[this.BASE_PATH+"/models/sculptures/painter.js",new THREE.Vector3(4.76,1.36,2.65),new THREE.Vector3(5,2,-1)],[this.BASE_PATH+"/models/sculptures/pig.js",new THREE.Vector3(4.61,-.21,4.66),new THREE.Vector3(3.5,.5,1)],[this.BASE_PATH+"/models/sculptures/right_arm.js",new THREE.Vector3(3.71,1.39,-.03),new THREE.Vector3(2.7,2.5,-1)],[this.BASE_PATH+"/models/sculptures/short_legs.js",new THREE.Vector3(1.73,.95,-.18),new THREE.Vector3(-2.5,2,1.8)],[this.BASE_PATH+"/models/sculptures/two_heads.js",new THREE.Vector3(-1,2.55,-.44),new THREE.Vector3(0,2,-1.4)]];var sculptureTextureFiles=[this.BASE_PATH+"/images/sculptures/lupo_deer.jpg",this.BASE_PATH+"/images/sculptures/lupo_dog.jpg",this.BASE_PATH+"/images/sculptures/lupo_macho.jpg",this.BASE_PATH+"/images/sculptures/lupo_painter.jpg",this.BASE_PATH+"/images/sculptures/lupo_pig.jpg",this.BASE_PATH+"/images/sculptures/lupo_rightArm.jpg",this.BASE_PATH+"/images/sculptures/lupo_shortLegs.jpg",this.BASE_PATH+"/images/sculptures/lupo_twoHeads.jpg"];var sculptureTextMADFiles=[this.BASE_PATH+"/images/sculptures/lupo_deer_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_dog_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_macho_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_painter_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_pig_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_rightArm_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_shortLegs_MAD.jpg",this.BASE_PATH+"/images/sculptures/lupo_twoHeads_MAD.jpg"];var sculptureModels=[];this.sculptureMaterials=[];this.sculptureTextures={};this.sculptureMADMaterials=[];this.sculptureMADTextures={};this.disposeRelatedGeos=[];this.disposeRelatedMats=[];this.disposeRelatedTexs=[];this.loadSculptureTextures(sculptureTextureFiles,sculptureTextMADFiles).then(function(){console.log("Loaded lupo art materials");_this2.loadSculptureModels(sculptureModelFiles).then(function(lupoArt){_this2.lupoArt=lupoArt;_this2.lupoArt.position.set(.7,-1.2,1);_this2.add(_this2.lupoArt);for(var _i=0;_i<_this2.lupoArt.children[0].children.length;_i++){_this2.lupoArt.children[0].children[_i].visible=false}for(var _i2=0;_i2<_this2.lupoArt.children[1].children.length;_i2++){_this2.lupoArt.children[1].children[_i2].visible=false}})});this.cactusPosOffsetData=[[0,0],[.398,1.655],[.636,2.088],[-.338,1.894],[-.63,2.875],[-.609,3.692],[-.251,3.527],[-.586,-.023],[-.883,1.099],[-1.275,.934],[-1.657,1.475],[.406,.024],[.938,.877]];this.cactusPosOffsetData2=[[0,0],[.157,1.724],[.645,2.238],[-.62,1.799],[-.419,2.056],[-1.191,2.406],[-.139,2.723],[.419,.008],[.733,1.068],[.937,1.113],[-1.004,2.568]];this.cactusAniLabel=["1","2","3","4"];this.sculptureCactusPosData=[[[0,0],[.089,-.09],[-.996,.581],[.532,.304],[-.15,-.763],[2.002,-.321],[-.269,.555],[0,0],[.343,-.11],[.277,1.411],[-.219,-.741]],[[0,0],[.538,1.252],[.49,1.204],[.196,.247],[-.344,-.609],[.173,.257],[.833,-1.218],[-.262,1.972],[-2.138,.913],[-.609,-.048],[.406,.253]],[[0,-.22],[0,.489],[0,.489],[.483,.094],[.681,-.997],[.015,-.638],[1.293,-1.735],[-1.048,-.066],[-1.361,.679],[-1.39,.548],[1.984,-1.816]]];this.sculptureCactusRotData=[[-4.787,-6.672,36.729,-33.581,73.202,-74.897,0,0,-17.879,36.574,61.713],[0,0,0,0,73.02,0,0,0,0,0,0],[0,0,0,-39.005,-107.443,0,0,53.294,0,130.647,0]];this.cactusAniSequences=[[[0,7,11],[3,9,12],[1,4,8],[2,5,6,10]],[[0,7],[1,3,9],[2,4,5],[6,8,10]],[[0,7,9],[1,3],[4,5,6],[2,8,10]],[[0,4],[7,8],[1,3,9],[2,5,6,10]],[[0,7],[3,4,9],[1,5,10],[2,6,8]]];this.cactusPot=new THREE.Object3D;this.cactusPot2=new THREE.Object3D;this.sculptCactus_1=new THREE.Object3D;this.sculptCactus_2=new THREE.Object3D;this.sculptCactus_3=new THREE.Object3D;this.cactusFiles=[];this.cactusFiles2=[];this.cactusPotList={};this.cactusPotList2={};this.cactusOffsetPos=[];this.cactusOffsetPos2=[];this.cactusGroup=new THREE.Object3D;this.cactusGroupFloor=new THREE.Object3D;this.cactusTimelines=[];this.cactusFloorTimelines=[];this.cactusLoadingManager=new THREE.LoadingManager;this.cactusLoadingManager.onLoad=function(){var c_length_2=Object.keys(_this2.cactusPotList2).length;_this2.createSculptCactus(_this2.sculptCactus_1,c_length_2,0);_this2.createSculptCactus(_this2.sculptCactus_2,c_length_2,1);_this2.createSculptCactus(_this2.sculptCactus_3,c_length_2,2);var allCactus=[_this2.cactusPot,_this2.cactusPot2,_this2.sculptCactus_1,_this2.sculptCactus_2,_this2.sculptCactus_3];for(var _i3=0;_i3<10;_i3++){var newIndex=_i3%5;var new_c=allCactus[newIndex].clone(true);var new_mat=_this2.cactusMat.clone();_this2.disposeRelatedMats.push(new_mat);for(var j=0;j<new_c.children.length;j++){new_c.children[j].material=new_mat}new_c.scale.multiplyScalar(.4-.1*_this2.lookupTable[_i3]);new_c.position.set(1-6*Math.random(),1.2,5-2*Math.random());new_c.rotation.y=Math.PI/2-_this2.lookupTable[_i3]*Math.PI;_this2.cactusGroup.add(new_c)}_this2.add(_this2.cactusGroup);for(var _i4=0;_i4<5;_i4++){var _newIndex=_i4%3+2;var _new_c=allCactus[_newIndex].clone(true);var _new_mat=_this2.cactusMat.clone();_this2.disposeRelatedMats.push(_new_mat);_new_c.material=_new_mat;_new_c.scale.multiplyScalar(1.8-.5*_this2.lookupTable[_i4]);_new_c.position.set(Math.sin(Math.PI*2/20*(_i4-1))*10+_this2.lookupTable[_i4],0,Math.cos(Math.PI*2/20*(_i4-1))*10+_this2.lookupTable[_i4+1]);_new_c.rotation.y=Math.PI/2-_this2.lookupTable[_i4]*Math.PI;_this2.cactusGroupFloor.add(_new_c)}_this2.cactusGroupFloor.position.set(4.05,0,-7.82);_this2.add(_this2.cactusGroupFloor);_this2.createCactusAnimation();_this2.createFlower()};for(var _i5=1;_i5<=13;_i5++){var fileName=this.BASE_PATH+"/models/cactus/c_"+_i5+".json";this.cactusFiles.push(fileName)}for(var _i6=1;_i6<=11;_i6++){var _fileName=this.BASE_PATH+"/models/cactus2/c_"+_i6+".json";this.cactusFiles2.push(_fileName)}for(var _i7=0;_i7<this.cactusPosOffsetData.length;_i7++){var cP=new THREE.Vector3(this.cactusPosOffsetData[_i7][0],this.cactusPosOffsetData[_i7][1],0);this.cactusOffsetPos.push(cP)}for(var _i8=0;_i8<this.cactusPosOffsetData2.length;_i8++){var _cP=new THREE.Vector3(this.cactusPosOffsetData2[_i8][0],this.cactusPosOffsetData2[_i8][1],0);this.cactusOffsetPos2.push(_cP)}this.cactusTexLight=p_tex_loader.load(this.BASE_PATH+"/images/cactus_white.jpg");this.cactusTex=p_tex_loader.load(this.BASE_PATH+"/images/cactusTex.jpg");this.cactusMat=new THREE.MeshLambertMaterial({map:this.cactusTexLight,color:2082089,side:THREE.DoubleSide});this.sculptCactusMat=new THREE.MeshLambertMaterial({map:this.cactusTex,color:13421772,side:THREE.DoubleSide});this.loadCactus1(this.cactusMat);this.loadCactus2(this.cactusMat);this.flowerGroup=[];this.flower=new THREE.Object3D;this.petalTexture=p_tex_loader.load(this.BASE_PATH+"/images/white_petal.jpg");this.petalMat=new THREE.MeshPhongMaterial({map:this.petalTexture,specular:16711680});this.flowerTimeline=[];this.flowerAniSetting=[{seq:[[40,1,3,5],[55,1.2,3],[130,.1,3]],label:[["open","+=0"],["close","+=2"],["close2","+=0"]]}];this.flowerColor=[16473223,16572514,16631725];this.ARC_SEGMENTS=50;var curveData=[[["-5.155","0.704","-8.407"],["-4.902","0.714","-7.581"],["-4.962","0.585","-6.448"],["-5.020","0.153","-5.518"],["-5.273","-0.079","-3.953"],["-4.806","0.097","-3.037"],["-4.842","0.423","-3.965"],["-4.777","1.017","-2.540"],["-4.411","0.935","-1.508"],["-4.508","0.535","-0.987"],["-4.298","-0.010","0.014"],["-3.798","0.031","0.836"],["-3.261","0.247","1.269"],["-2.612","-0.004","1.630"],["-1.904","0.034","1.864"],["-1.152","1.099","1.447"],["-0.815","1.518","1.188"],["-0.378","1.742","0.515"],["-0.107","1.769","0.054"],["-0.099","1.773","-0.017"]],[["-6.769","0.435","-8.334"],["-6.828","0.093","-7.397"],["-6.512","-0.097","-6.163"],["-6.441","0.410","-5.244"],["-6.809","0.884","-4.415"],["-6.190","1.047","-2.984"],["-6.245","-0.094","-2.333"],["-5.856","0.236","-1.390"],["-5.762","0.822","-1.046"],["-5.413","0.685","-0.192"],["-5.423","0.010","0.524"],["-4.732","0.035","1.074"],["-3.765","0.275","1.519"],["-2.483","0.655","1.585"],["-1.492","1.020","1.334"],["-0.801","1.435","0.879"],["-0.127","1.935","0.047"],["-0.128","1.939","-0.027"]]];this.ropes=[];this.ropesVec=[];for(var _i9=0;_i9<curveData.length;_i9++){var curve_vec=[];for(var j=0;j<curveData[_i9].length;j++){var newVector=new THREE.Vector3(Number(curveData[_i9][j][0]),Number(curveData[_i9][j][1]),Number(curveData[_i9][j][2]));newVector.multiplyScalar(1.7);curve_vec.push(newVector)}this.ropesVec.push(curve_vec)}this.ropeMaterial=new THREE.MeshBasicMaterial({color:11730944,wireframe:true});this.liquidMats=[];this.liquidTexs=[];this.nightRopeTransformation={vive:[[[-2.18,-.57,5.71],[0,100*Math.PI/180,0]],[[-1.92,-.25,7.15],[0,88*Math.PI/180,0]]],desktop:[[[-2.66,.38,5.11],[0,339*Math.PI/180,343*Math.PI/180]],[[-1.7,-.07,5.5],[0,346*Math.PI/180,0]]]};this.dayRopeTransformation=[1.4,-.7,4.1];for(var _i10=0;_i10<2;_i10++){var liquidTex=p_tex_loader.load(this.BASE_PATH+"/images/liquid_trans.png");this.liquidTexs.push(liquidTex);liquidTex.repeat.x=1;liquidTex.repeat.y=1;liquidTex.offset.x=-1.5;this.liquidMats.push(new THREE.MeshBasicMaterial({map:liquidTex,transparent:true}));this.createRope(_i10)}this.liquidOut=false;if(this.showDummyDogs){this.dog1=new THREE.Mesh(new THREE.BoxGeometry(1.5,4,1.5),new THREE.MeshBasicMaterial({color:13369344,wireframe:true}));this.dog1.position.set(2,2,6);this.add(this.dog1);this.dog2=new THREE.Mesh(new THREE.BoxGeometry(1.5,4,1.5),new THREE.MeshBasicMaterial({color:13369344,wireframe:true}));this.dog2.position.set(-2,2,6);this.add(this.dog2)}this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.dummy={roughValue:0};events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("Lupo12PMAnim")}},{key:"setupForDay",value:function setupForDay(){}},{key:"setupForNight",value:function setupForNight(){this.lupoArt.position.set(26.52,-2,-11.21);this.lupoArt.scale.multiplyScalar(1.2);var newTranData=null;if(this.parent.config.platform=="desktop"){newTranData=this.nightRopeTransformation["desktop"]}else{newTranData=this.nightRopeTransformation["vive"]}for(var i=0;i<this.ropes.length;i++){this.ropes[i].position.fromArray(newTranData[i][0]);this.ropes[i].rotation.fromArray(newTranData[i][1])}}},{key:"assignChController",value:function assignChController(controller){this.characterController=controller}},{key:"createFlower",value:function createFlower(){var _this3=this;var modelLoader=new THREE.JSONLoader(this.LoadingManager);modelLoader.load(this.BASE_PATH+"/models/petal.json",function(geometry){_this3.petalGeo=geometry;for(var i=0;i<8;i++){var petal=new THREE.Object3D;var p=new THREE.Mesh(_this3.petalGeo,_this3.petalMat);p.rotation.x=-15*Math.PI/180;petal.add(p);petal.rotation.y=Math.PI*2/8*i;petal.scale.multiplyScalar(.3);_this3.flower.add(petal)}var f_offset=new THREE.Vector3(1.2,1,1,2);for(var _i11=0;_i11<_this3.cactusGroupFloor.children.length;_i11++){var flowerrr=_this3.flower.clone();var new_mat=_this3.petalMat.clone();_this3.disposeRelatedMats.push(new_mat);new_mat.color.set(_this3.flowerColor[_i11%3]);for(var j=0;j<flowerrr.children.length;j++){flowerrr.children[j].children[0].material=new_mat;flowerrr.children[j].children[0].scale.multiplyScalar(.01)}var f_pos=_this3.cactusGroupFloor.children[_i11].children[3].position.clone();flowerrr.position.copy(f_pos);flowerrr.rotation.x=70*Math.PI/180;flowerrr.scale.multiplyScalar(.8);_this3.cactusGroupFloor.children[_i11].add(flowerrr);_this3.flowerGroup.push(flowerrr)}_this3.createFlowerAnimation()})}},{key:"createRope",value:function createRope(_index){var cSpline=new THREE.CatmullRomCurve3(this.ropesVec[_index]);cSpline.type="chordal";var ropeGeometry=new THREE.TubeGeometry(cSpline,this.ARC_SEGMENTS,.1,5,false);this.disposeRelatedGeos.push(ropeGeometry);var ropee=new THREE.Mesh(ropeGeometry,this.ropeMaterial);var liquidGeo=new THREE.TubeGeometry(cSpline,this.ARC_SEGMENTS,.07,5,false);this.disposeRelatedGeos.push(liquidGeo);var liquid=new THREE.Mesh(liquidGeo,this.liquidMats[_index]);liquid.material.map.offset.x=-1-_index*.4;ropee.add(liquid);this.add(ropee);ropee.position.set(2.49,-.7,4.1);this.ropes.push(ropee)}},{key:"createSculptCactus",value:function createSculptCactus(s_c,length,index){for(var i=0;i<length;i++){var cc=this.cactusPotList2[i].clone();cc.material=this.sculptCactusMat;cc.position.x+=this.sculptureCactusPosData[index][i][0];cc.position.y+=this.sculptureCactusPosData[index][i][1];cc.rotation.z=this.sculptureCactusRotData[index][i]*Math.PI/180;cc.scale.multiplyScalar(.1);s_c.add(cc);cc.visible=false}}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"growFlower",value:function growFlower(){for(var i=0;i<this.flowerTimeline.length;i++){this.flowerTimeline[i].play("open")}}},{key:"growSingleFlower",value:function growSingleFlower(index){this.flowerTimeline[index].play("open")}},{key:"closeFlower",value:function closeFlower(){for(var i=0;i<this.flowerTimeline.length;i++){this.flowerTimeline[i].play()}}},{key:"growBenchCactus",value:function growBenchCactus(){for(var i=0;i<this.cactusTimelines.length;i++){if(this.cactusTimelines[i].totalProgress!=1)this.cactusTimelines[i].play()}}},{key:"growCactusFloor",value:function growCactusFloor(){for(var i=0;i<this.cactusFloorTimelines.length;i++){if(this.cactusFloorTimelines[i].totalProgress!=1)this.cactusFloorTimelines[i].play()}}},{key:"growSingleCactus",value:function growSingleCactus(index,color){this.cactusTimelines[index].play();if(color!=null){this.cactusGroup.children[index].children[0].material.color.set(color)}}},{key:"growSingleCactusFloor",value:function growSingleCactusFloor(index){this.cactusFloorTimelines[index].play()}},{key:"showSculptures",value:function showSculptures(){var _this4=this;var _loop=function _loop(i){var targetPos=_this4.lupoArt.children[0].children[i].targetPosition;var delayT=i*_this4.lookupTable[i];var t_scale=TweenMax.to(_this4.lupoArt.children[0].children[i].scale,3,{y:1,delay:delayT,ease:RoughEase.ease.config({template:Power0.easeNone,strength:.2,points:100,taper:"out",randomize:true,clamp:false})});var t_pos=TweenMax.to(_this4.lupoArt.children[0].children[i].position,3,{x:targetPos.x,y:targetPos.y,z:targetPos.z,delay:delayT,onStart:function onStart(){_this4.lupoArt.children[0].children[i].visible=true;_this4.lupoArt.children[1].children[i].visible=true}});_this4.tweenAnimCollectors.push(t_scale);_this4.tweenAnimCollectors.push(t_pos)};for(var i=0;i<this.lupoArt.children[0].children.length;i++){_loop(i)}}},{key:"flickerSculptureTextures",value:function flickerSculptureTextures(){var _this5=this;var t_flicker=TweenMax.fromTo(this.dummy,2,{roughValue:0},{roughValue:5,ease:RoughEase.ease.config({template:Power0.easeNone,strength:5,points:50,taper:"both",randomize:true,clamp:false}),onUpdate:function onUpdate(){_this5.shiftTextures()},onComplete:function onComplete(){_this5.doneShiftTextures()}});this.tweenAnimCollectors.push(t_flicker)}},{key:"shiftTextures",value:function shiftTextures(){var target=this.lupoArt.children[0].children;for(var i=0;i<target.length;i++){if(this.dummy.roughValue>2)target[i].material.map=this.sculptureMADTextures[target[i].material.map.texIndex];else target[i].material.map=this.sculptureTextures[target[i].material.map.texIndex]}}},{key:"doneShiftTextures",value:function doneShiftTextures(){var target=this.lupoArt.children[0].children;for(var i=0;i<target.length;i++){target[i].material.map=this.sculptureTextures[target[i].material.map.texIndex]}}},{key:"rotateSculptures",value:function rotateSculptures(){this.lupoArt.rotation.x=0;this.tl=new TimelineMax({repeatDelay:3,repeat:-1});this.tl.to(this.lupoArt.rotation,2,{x:Math.PI}).to(this.lupoArt.rotation,2,{x:Math.PI*2},"+=2");this.tweenAnimCollectors.push(this.tl)}},{key:"shiftSculptures",value:function shiftSculptures(){var tw=TweenMax.to(this.lupoArt.rotation,2,{x:"+="+Math.PI});this.tweenAnimCollectors.push(tw)}},{key:"connectToDogs",value:function connectToDogs(){this.liquidOut=true}},{key:"scaleDogs",value:function scaleDogs(times){var dogPos=new THREE.Vector3;if(this.parent.config.platform=="desktop"){dogPos.fromArray(this.dogsTobePosition["desktop"][times])}else{dogPos.fromArray(this.dogsTobePosition["vive"][times])}var dogSize=times+1;TweenMax.to(this.theDogs.position,6,{x:dogPos.x,y:dogPos.y,z:dogPos.z});TweenMax.to(this.theDogs.scale,6,{x:dogSize,y:dogSize,z:dogSize})}},{key:"characterDisappearDay",value:function characterDisappearDay(){var _this6=this;this.flickerSculptureTextures();TweenMax.to(this.lupoArt.rotation,3,{x:"+="+Math.PI,delay:1,ease:Back.easeInOut.config(1.4)});TweenMax.to(this.fullVideo.mesh.rotation,2,{x:"+="+Math.PI,delay:2,onStart:function onStart(){TweenMax.to(_this6.ropes[0].position,3,{y:"-="+2.5});TweenMax.to(_this6.ropes[1].position,3,{y:"-="+2.5})},onComplete:function onComplete(){_this6.fullVideo.setOpacity(0)}})}},{key:"characterDisappearNight",value:function characterDisappearNight(){var _this7=this;this.flickerSculptureTextures();TweenMax.to(this.lupoArt.rotation,3,{x:"+="+Math.PI,delay:1,ease:Back.easeInOut.config(1.4)});TweenMax.to(this.fullVideo.mesh.rotation,2,{x:"+="+Math.PI,delay:2,onComplete:function onComplete(){_this7.fullVideo.setOpacity(0)}})}},{key:"disposeAni",value:function disposeAni(){this.remove(this.lupoArt);this.baseMat.dispose();this.bottomMat.dispose();this.topMat.dispose();for(var i=0;i<this.sculptureMaterials.length;i++){this.sculptureMaterials[i].dispose()}for(var i=0;i<this.sculptureMaterials.length;i++){this.sculptureMaterials[i].dispose()}for(var i=0;i<this.liquidMats.length;i++){this.liquidMats[i].dispose()}this.remove(this.cactusGroup);this.remove(this.cactusGroupFloor);this.cactusMat.dispose();this.sculptCactusMat.dispose();this.cactusTexLight.dispose();this.cactusTex.dispose();this.petalGeo.dispose();this.petalMat.dispose();this.petalTexture.dispose();for(var i=0;i<this.ropes.length;i++){this.remove(this.ropes[i])}for(var i=0;i<this.liquidMats.length;i++){this.liquidMats[i].dispose()}this.ropeMaterial.dispose();for(var i=0;i<this.liquidTexs.length;i++){this.liquidTexs[i].dispose()}for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}for(var i=0;i<this.disposeRelatedMats.length;i++){this.disposeRelatedMats[i].dispose()}for(var i=0;i<this.disposeRelatedTexs.length;i++){this.disposeRelatedTexs[i].dispose()}console.log("dispose Lupo ani!")}},{key:"loadCactus1",value:function loadCactus1(mat){var _this8=this;var cactusLoader=new THREE.JSONLoader(this.cactusLoadingManager);var _loop2=function _loop2(i){cactusLoader.load(_this8.cactusFiles[i],function(geometry){var cc=new THREE.Mesh(geometry,mat);cc.position.copy(_this8.cactusOffsetPos[i]);cc.scale.multiplyScalar(.1);_this8.cactusPot.add(cc);_this8.cactusPotList[i]=cc;cc.visible=false})};for(var i=0;i<this.cactusFiles.length;i++){_loop2(i)}}},{key:"loadCactus2",value:function loadCactus2(mat){var _this9=this;var cactusLoader=new THREE.JSONLoader(this.cactusLoadingManager);var _loop3=function _loop3(i){cactusLoader.load(_this9.cactusFiles2[i],function(geometry){var cc=new THREE.Mesh(geometry,mat);cc.position.copy(_this9.cactusOffsetPos2[i]);cc.scale.multiplyScalar(.1);_this9.cactusPot2.add(cc);_this9.cactusPotList2[i]=cc;cc.visible=false})};for(var i=0;i<this.cactusFiles2.length;i++){_loop3(i)}}},{key:"createFlowerAnimation",value:function createFlowerAnimation(){for(var k=0;k<this.flowerGroup.length;k++){var tl=new TimelineMax;for(var j=0;j<this.flowerAniSetting[0].seq.length;j++){tl.add(this.flowerAniSetting[0].label[j][0],this.flowerAniSetting[0].label[j][1]);
var toTween=[];for(var i=0;i<this.flowerGroup[k].children.length;i++){var tw=this.createPetalAni(this.flowerGroup[k].children[i].children[0],this.flowerAniSetting[0].seq[j]);toTween.push(tw)}tl.add(toTween,this.flowerAniSetting[0].label[j][0])}tl.pause();tl.addPause(this.flowerAniSetting[0].label[1][0]);this.flowerTimeline.push(tl)}}},{key:"createPetalAni",value:function createPetalAni(petal,sequence){return TweenMax.to(petal.rotation,sequence[2],{x:sequence[0]*Math.PI/180,ease:Power1.easeInOut,onStart:function onStart(){TweenMax.to(petal.scale,sequence[2],{x:sequence[1],y:sequence[1],z:sequence[1],ease:Power1.easeInOut})}})}},{key:"createCactusAnimation",value:function createCactusAnimation(){for(var i=0;i<this.cactusGroup.children.length;i++){var tl=new TimelineMax({delay:i*.3});var timeGap=0;var theAniSequence=this.cactusAniSequences[i%5];for(var k=0;k<theAniSequence.length;k++){var toTween=[];for(var j=0;j<theAniSequence[k].length;j++){var tw=this.createCactusAni(this.cactusGroup.children[i],theAniSequence[k][j]);toTween.push(tw)}tl.add(toTween,timeGap);timeGap+=.2}tl.pause();this.cactusTimelines.push(tl)}for(var _i12=0;_i12<this.cactusGroupFloor.children.length;_i12++){var _tl=new TimelineMax({delay:_i12*.5});var _timeGap=0;var _theAniSequence=this.cactusAniSequences[_i12%3+2];for(var _k=0;_k<_theAniSequence.length;_k++){var _toTween=[];for(var _j=0;_j<_theAniSequence[_k].length;_j++){var _tw=this.createCactusAni(this.cactusGroupFloor.children[_i12],_theAniSequence[_k][_j]);_toTween.push(_tw)}_tl.add(_toTween,_timeGap);_timeGap+=.2}_tl.pause();this.cactusFloorTimelines.push(_tl)}}},{key:"createCactusAni",value:function createCactusAni(cactusP,index){return TweenMax.to(cactusP.children[index].scale,.5,{x:1,y:1,z:1,ease:Back.easeOut.config(1.7),onStart:function onStart(){cactusP.children[index].visible=true}})}},{key:"loadSculptureTextures",value:function loadSculptureTextures(textureFiles,textureMADFiles){var _this10=this;var promise=new Promise(function(resolve,reject){var tex_loader=new THREE.TextureLoader(_this10.loadingManager);for(var i=0;i<textureFiles.length;i++){var _tex=tex_loader.load(textureFiles[i]);_tex.texIndex=i;_tex.name="sculptureTex_"+i;_this10.sculptureTextures[i]=_tex;_this10.disposeRelatedTexs.push(_tex);var _mat=new THREE.MeshPhongMaterial({map:_tex,shininess:100});_this10.sculptureMaterials.push(_mat)}for(var _i13=0;_i13<textureMADFiles.length;_i13++){var _tex2=tex_loader.load(textureMADFiles[_i13]);_tex2.texIndex=_i13;_tex2.name="sculptureMadTex_"+_i13;_this10.sculptureMADTextures[_i13]=_tex2;_this10.disposeRelatedTexs.push(_tex2);var _mat2=new THREE.MeshPhongMaterial({map:_tex2,shininess:100});_this10.sculptureMADMaterials.push(_mat2)}resolve()});return promise}},{key:"loadSculptureModels",value:function loadSculptureModels(modelFiles){var _this11=this;var promise=new Promise(function(resolve,reject){var lupoArt=new THREE.Object3D;var lupoArtTop=new THREE.Object3D;var lupoArtBottom=new THREE.Object3D;var loader=new THREE.JSONLoader(_this11.loadingManager);var _loop4=function _loop4(){var modelF=modelFiles[i][0];var modelPos=modelFiles[i][2];var modelTargetPos=modelFiles[i][1];var matF=_this11.sculptureMaterials[i];matF.texIndex=0;var matMADF=_this11.sculptureMADMaterials[i];_this11.artNum=0;loader.load(modelF,function(geometry){_this11.disposeRelatedGeos.push(geometry);var meshhh=new THREE.Mesh(geometry,matF);meshhh.scale.y=.01;meshhh.position.copy(modelPos);meshhh.targetPosition=modelTargetPos;meshhh.originalPosition=modelPos;lupoArtTop.add(meshhh);var meshh=new THREE.Mesh(geometry,matMADF);meshh.position.copy(modelTargetPos);lupoArtBottom.add(meshh);_this11.artNum++})};for(var i=0;i<modelFiles.length;i++){_loop4()}lupoArt.add(lupoArtTop);lupoArtBottom.rotation.x=Math.PI;lupoArt.add(lupoArtBottom);resolve(lupoArt)});return promise}},{key:"loadModelSculptures",value:function loadModelSculptures(model,modelT,modelB){var _this12=this;var promise=new Promise(function(resolve,reject){var loader=new THREE.JSONLoader(_this12.loadingManager);loader.load(model,function(geometry,material){_this12.disposeRelatedGeos.push(geometry);var lupoArt=new THREE.Object3D;var s_base=new THREE.Mesh(geometry,_this12.baseMat);lupoArt.add(s_base);loader.load(modelT,function(geometryT,materialT){_this12.disposeRelatedGeos.push(geometryT);var s_top=new THREE.Mesh(geometryT,_this12.topMat);lupoArt.add(s_top);loader.load(modelB,function(geometryB,materialB){_this12.disposeRelatedGeos.push(geometryB);var s_bottom=new THREE.Mesh(geometryB,_this12.bottomMat);lupoArt.add(s_bottom);resolve(lupoArt)})})})});return promise}},{key:"start",value:function start(time){this.reset();this.currentSequence=this.sequenceConfig[time].slice(0);this.nextAnim=this.currentSequence.shift();if(this.theDogs==null){this.theDogs=this.characterController.characters["LupoDogs5PM"]}}},{key:"reset",value:function reset(){for(var i=0;i<this.tweenAnimCollectors.length;i++){this.tweenAnimCollectors[i].kill()}this.tweenAnimCollectors=[];this.lupoArt.rotation.x=0;for(var _i14=0;_i14<this.lupoArt.children[0].children.length;_i14++){var origPos=this.lupoArt.children[0].children[_i14].originalPosition;this.lupoArt.children[0].children[_i14].scale.y=.01;this.lupoArt.children[0].children[_i14].position.copy(origPos);this.lupoArt.children[0].children[_i14].visible=false}for(var _i15=0;_i15<this.lupoArt.children[1].children.length;_i15++){this.lupoArt.children[1].children[_i15].visible=false}this.lupoArt.position.set(.7,-1.2,1);this.lupoArt.scale.set(1,1,1);this.lupoArt.rotation.z=0;this.fullVideo=this.parent.fullVideo;for(var _i16=0;_i16<this.ropes.length;_i16++){this.ropes[_i16].position.fromArray(this.dayRopeTransformation);this.ropes[_i16].rotation.set(0,0,0)}for(var _i17=0;_i17<this.cactusTimelines.length;_i17++){this.cactusTimelines[_i17].pause(0)}for(var _i18=0;_i18<this.cactusFloorTimelines.length;_i18++){this.cactusFloorTimelines[_i18].pause(0)}for(var _i19=0;_i19<this.flowerTimeline.length;_i19++){this.flowerTimeline[_i19].pause(0)}for(var _i20=0;_i20<this.cactusGroup.children.length;_i20++){for(var j=0;j<this.cactusGroup.children[_i20].length;j++){this.cactusGroup.children[_i20].children[j].scale.set(.01,.01,.01);this.cactusGroup.children[_i20].children[j].visible=false}}for(var _i21=0;_i21<this.cactusGroupFloor.children.length;_i21++){for(var _j2=0;_j2<this.cactusGroupFloor.children[_i21].length;_j2++){this.cactusGroupFloor.children[_i21].children[_j2].scale.set(.01,.01,.01);this.cactusGroupFloor.children[_i21].children[_j2].visible=false}}for(var _i22=0;_i22<this.flowerGroup.length;_i22++){for(var _j3=0;_j3<this.flowerGroup[_i22].children.length;_j3++){this.flowerGroup[_i22].children[_j3].children[0].scale.set(.01,.01,.01)}}this.fullVideo.mesh.rotation.x=0;this.liquidOut=false;for(var _i23=0;_i23<this.ropes.length;_i23++){this.ropes[_i23].children[0].material.map.offset.x=-1.5}}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){if(this.liquidOut){for(var i=0;i<this.ropes.length;i++){this.ropes[i].children[0].material.map.offset.x+=.001;if(this.ropes[i].children[0].material.map.offset.x>1)this.ropes[i].children[0].material.map.offset.x=-.6}}}}]);return Lupo12PMAnimation}(THREE.Object3D);exports.default=Lupo12PMAnimation},{"../util/debug":58,"../util/improved_noise":61,"../util/texture_animator":65}],8:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MeirAnimation=function(_THREE$Object3D){_inherits(MeirAnimation,_THREE$Object3D);function MeirAnimation(sky,square,config){_classCallCheck(this,MeirAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MeirAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/mark";_this.sky=sky;_this.square=square;return _this}_createClass(MeirAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.animStart=false;this.sequenceConfig=[{time:2,anim:function anim(){_this2.skyLightBright()}},{time:5,anim:function anim(){_this2.pinkNeonOn()}},{time:10,anim:function anim(){_this2.blueNeonOn()}},{time:11,anim:function anim(){_this2.skyLightBright2()}},{time:32,anim:function anim(){_this2.neonRotate()}},{time:40,anim:function anim(){_this2.neonFlickering(.2,3)}},{time:45,anim:function anim(){_this2.neonRotateBack()}},{time:55,anim:function anim(){_this2.neonRotate()}},{time:94,anim:function anim(){_this2.neonRotateBack()}},{time:99,anim:function anim(){_this2.neonRotate()}},{time:105,anim:function anim(){_this2.neonRotateBack()}},{time:110,anim:function anim(){_this2.neonRotate()}},{time:115,anim:function anim(){_this2.neonRotateBack()}},{time:120,anim:function anim(){_this2.neonRotate()}},{time:198,anim:function anim(){_this2.neonFlickering(.15,6)}},{time:200,anim:function anim(){_this2.neonRotateBack()}},{time:207,anim:function anim(){_this2.neonFlickering(.15,6)}},{time:209,anim:function anim(){_this2.neonRotate()}},{time:211,anim:function anim(){_this2.skyLightBack()}},{time:218,anim:function anim(){_this2.characterDisappear()}}];this.nextAnim=null;this.completeSequenceSetup();this.loadingManager.itemStart("MarkAnim");this.envLightChanged=false;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.disposeRelatedGeos=[];this.disposeRelatedMats=[];this.neon1_light=new THREE.PointLight(16711765,0,3);this.neon1_light.position.set(.2,1,1);this.neon2_light=new THREE.PointLight(60159,0,3);this.neon2_light.position.set(-.2,1,-1);var neonFiles=[];for(var _i=1;_i<=9;_i++){var fileName=this.BASE_PATH+"/models/neon/"+_i+".json";neonFiles.push(fileName)}var neonFiles2=[];for(var _i2=1;_i2<=8;_i2++){var _fileName=this.BASE_PATH+"/models/neon2/"+_i2+".json";neonFiles2.push(_fileName)}this.neon1=new THREE.Object3D;this.neon2=new THREE.Object3D;var _loop=function _loop(_i3){loader.load(neonFiles[_i3],function(geometry,material){_this2.disposeRelatedGeos.push(geometry);var neonMat=new THREE.MeshPhongMaterial({color:12860265,emissive:16711765,emissiveIntensity:.1});_this2.disposeRelatedMats.push(neonMat);var neon=new THREE.Mesh(geometry,neonMat);if(_i3==0){neon.add(_this2.neon1_light)}var tween=_this2.createNeonAnim(neon,_i3);neon.tween=tween;_this2.neon1.add(neon)});_this2.add(_this2.neon1)};for(var _i3=0;_i3<neonFiles.length;_i3++){_loop(_i3)}this.neon1.position.set(2,0,-.11);this.neon1.rotation.set(0,142*Math.PI/180,0);var _loop2=function _loop2(_i4){loader.load(neonFiles2[_i4],function(geometry,material){_this2.disposeRelatedGeos.push(geometry);var neonMat=new THREE.MeshPhongMaterial({color:4569786,emissive:65535,emissiveIntensity:.1});_this2.disposeRelatedMats.push(neonMat);var neon=new THREE.Mesh(geometry,neonMat);if(_i4==0){neon.add(_this2.neon2_light)}var tween=_this2.createNeonAnim(neon,_i4);neon.tween=tween;_this2.neon2.add(neon)});_this2.add(_this2.neon2)};for(var _i4=0;_i4<neonFiles2.length;_i4++){_loop2(_i4)}this.neon2.position.set(1.71,0,.54);this.neon2.rotation.set(0,142*Math.PI/180,0);this.dummy={opacity:1};events.on("character_idle",function(name){if(name=="Mark"&&_this2.envLightChanged){_this2.skyLightBack()}});events.on("character_playing",function(name){if(name=="Mark"&&_this2.envLightChanged){_this2.oriHemi=_this2.sky.getHemiLghtOriStatus();_this2.oriDir=_this2.sky.getDirLghtOriStatus();_this2.sky.pauseUpdateHemiLight();_this2.oriFLightIntensity=_this2.square.fountainLight.intensity;TweenMax.to(_this2.sky.dirLight,1,{intensity:1});TweenMax.to(_this2.sky.hemiLight,1,{intensity:1});TweenMax.to(_this2.square.fountainLight,1,{intensity:2});TweenMax.to(_this2.sky.hemiLight.color,1,{r:.325,g:.412,b:.867});TweenMax.to(_this2.sky.hemiLight.groundColor,1,{r:.882,g:.392,b:.592})}});events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("MarkAnim")}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"skyLightBright",value:function skyLightBright(){this.oriHemi=this.sky.getHemiLghtOriStatus();this.oriDir=this.sky.getDirLghtOriStatus();this.sky.pauseUpdateHemiLight();this.oriFLightIntensity=this.square.fountainLight.intensity;TweenMax.to(this.sky.dirLight,3,{intensity:1});TweenMax.to(this.sky.hemiLight,3,{intensity:1});TweenMax.to(this.square.fountainLight,3,{intensity:2});this.envLightChanged=true}},{key:"skyLightBright2",value:function skyLightBright2(){TweenMax.to(this.sky.hemiLight.color,2,{r:.325,g:.412,b:.867});TweenMax.to(this.sky.hemiLight.groundColor,2,{r:.882,g:.392,b:.592});this.envLightChanged=true}},{key:"skyLightBack",value:function skyLightBack(){var _this3=this;TweenMax.to(this.square.fountainLight,2,{intensity:this.oriFLightIntensity});var hemiTargetIntensity=this.sky.getHemiLghtCorrectIntensity();TweenMax.to(this.sky.hemiLight,2,{intensity:hemiTargetIntensity});TweenMax.to(this.sky.dirLight,2,{intensity:this.oriDir.intensity,onComplete:function onComplete(){_this3.sky.resumeUpdateHemiLight()}});TweenMax.to(this.sky.hemiLight.color,1,{r:this.oriHemi.color.r,g:this.oriHemi.color.g,b:this.oriHemi.color.b});TweenMax.to(this.sky.hemiLight.groundColor,1,{r:this.oriHemi.groundColor.r,g:this.oriHemi.groundColor.g,b:this.oriHemi.groundColor.b})}},{key:"pinkNeonOn",value:function pinkNeonOn(){this.neon1_light.intensity=1}},{key:"blueNeonOn",value:function blueNeonOn(){this.neon2_light.intensity=1}},{key:"neonRotate",value:function neonRotate(){TweenMax.to([this.neon1.rotation,this.neon2.rotation],2,{y:0,ease:Back.easeInOut});TweenMax.to([this.neon1.position,this.neon2.position],2,{x:1.26,y:0,z:0,ease:Back.easeInOut})}},{key:"neonRotateBack",value:function neonRotateBack(){TweenMax.to(this.neon1.rotation,2,{y:142*Math.PI/180,ease:Back.easeInOut});TweenMax.to(this.neon1.position,2,{x:2,y:-0,z:-.11,ease:Back.easeInOut});TweenMax.to(this.neon2.rotation,2,{y:142*Math.PI/180,ease:Back.easeInOut});TweenMax.to(this.neon2.position,2,{x:1.71,y:-0,z:.54,ease:Back.easeInOut})}},{key:"neonFlickering",value:function neonFlickering(_speed,_times){var _this4=this;var repeatTimes=1+(_times-1)*2;var _loop3=function _loop3(i){_this4.neon1.children[i].tween.pause();if(i==0){TweenMax.fromTo(_this4.neon1.children[i].material,_speed,{emissiveIntensity:1},{emissiveIntensity:0,ease:Power0.easeNone,repeat:repeatTimes,yoyo:true,onComplete:function onComplete(){_this4.neon1.children[i].tween.resume()},onUpdate:function onUpdate(){_this4.neon1_light.intensity=_this4.neon1.children[i].material.emissiveIntensity}})}else{TweenMax.fromTo(_this4.neon1.children[i].material,_speed,{emissiveIntensity:0},{emissiveIntensity:1,ease:Power0.easeNone,repeat:repeatTimes,yoyo:true,onComplete:function onComplete(){_this4.neon1.children[i].tween.resume()}})}};for(var i=0;i<this.neon1.children.length;i++){_loop3(i)}var _loop4=function _loop4(_i5){_this4.neon2.children[_i5].tween.pause();if(_i5==0){TweenMax.fromTo(_this4.neon2.children[_i5].material,_speed,{emissiveIntensity:1},{emissiveIntensity:0,ease:Power0.easeNone,repeat:repeatTimes,yoyo:true,onComplete:function onComplete(){_this4.neon2.children[_i5].tween.resume()},onUpdate:function onUpdate(){_this4.neon2_light.intensity=_this4.neon2.children[_i5].material.emissiveIntensity}})}else{TweenMax.fromTo(_this4.neon2.children[_i5].material,_speed,{emissiveIntensity:0},{emissiveIntensity:1,ease:Power0.easeNone,repeat:repeatTimes,yoyo:true,onComplete:function onComplete(){_this4.neon2.children[_i5].tween.resume()}})}};for(var _i5=0;_i5<this.neon2.children.length;_i5++){_loop4(_i5)}}},{key:"characterDisappear",value:function characterDisappear(){var _this5=this;this.neonFlickering(.05,40);TweenMax.to(this.dummy,4,{opacity:0,ease:SteppedEase.config(3),onUpdate:function onUpdate(){_this5.parent.fullVideo.setOpacity(_this5.dummy.opacity)},onComplete:function onComplete(){_this5.parent.fullVideo.setOpacity(0)}});this.envLightChanged=false}},{key:"disposeAni",value:function disposeAni(){this.remove(this.neon1);this.remove(this.neon2);for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}for(var i=0;i<this.disposeRelatedMats.length;i++){this.disposeRelatedMats[i].dispose()}console.log("dispose Mark ani!")}},{key:"createNeonAnim",value:function createNeonAnim(object,index){var tweenM=TweenMax.to(object.material,2,{emissiveIntensity:1,delay:index*1.5%3,repeat:-1,repeatDelay:2+index%3,ease:RoughEase.ease.config({template:Power0.easeNone,strength:2,points:20,taper:"none",randomize:true,clamp:false})});return tweenM}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){}}]);return MeirAnimation}(THREE.Object3D);exports.default=MeirAnimation},{"../util/debug":58}],9:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("../util/fbo");var _fbo2=_interopRequireDefault(_fbo);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var MeirAnimation=function(_THREE$Object3D){_inherits(MeirAnimation,_THREE$Object3D);function MeirAnimation(config){_classCallCheck(this,MeirAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MeirAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/meir";return _this}_createClass(MeirAnimation,[{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.animStart=false;this.sequenceConfig=[{time:20,anim:function anim(){_this2.birdsOut()}},{time:102,anim:function anim(){_this2.characterDisappear()}}];this.nextAnim=null;this.completeSequenceSetup();this.loadingManager.itemStart("MeirAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.birds=[];this.backBirds=new THREE.Object3D;this.disposeRelatedGeos=[];this.birdsAniSetting=[{seq:[6,6,0,5,5],timeGap:[2,1,1.5,4,1],label:["swing_1","swing_2","jumpTurn","swing_3","swing_4"],seqNum:5},{seq:[5,5,2,6,6],timeGap:[2,1,1.5,4,1],label:["swing_1","swing_2","jumpTurn","swing_3","swing_4"],seqNum:5},{seq:[0,4,3],timeGap:[3,0,1],label:["eat","flap","jumpTurn"],seqNum:3},{seq:[8,0,0,10,9],timeGap:[3,0,1,1,5],label:["peakout","eat","eat","turn","peakback"],seqNum:5},{seq:[8,10,4,9],timeGap:[3,1,1,3],label:["peakout","turn","flap","peakback"],seqNum:4}];this.birdAniConfig=[4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,0,0,2,1];this.birdAniTimelines=[];this.backbirdAniTimelines=[];var birdPosNum=[[.86,2.88,3.3],[.64,3.32,3.3],[.46,2.83,3.3],[1.35,3.52,3.3],[1.2,2.57,3.3],[1.02,3.1,3.3],[.4,3.36,3.3],[.9,3.4,3.3],[.45,3.03,3.3],[.68,2.46,3.3],[.03,3.71,3.3],[1.38,3.47,3.3],[1.33,3.23,3.3],[.73,3.16,3.3],[1.19,3.67,3.3],[-.07,4.07,4.3],[-.54,3.82,4.02],[.9,4.8,4.8],[1.73,3.73,4.27]];this.birdsPos=[];for(var _i=0;_i<birdPosNum.length;_i++){var birdP=new THREE.Vector3(birdPosNum[_i][0],birdPosNum[_i][1],birdPosNum[_i][2]);this.birdsPos.push(birdP)}var birdDownPosNum=[[.86,0,2.8],[2.8,0,1.5],[.3,0,2.3],[3,0,2.3],[2,0,2.3],[-3,0,2],[-.4,0,2],[2.5,0,2],[.45,0,1],[-2.68,0,2],[.03,0,2],[-2.3,0,2],[3,0,2],[.73,0,2.5],[2.5,0,2],[-1.07,0,2.3],[-1.54,0,2.02],[.9,0,2.8],[2.73,0,2.27]];this.birdsDownPos=[];for(var _i2=0;_i2<birdDownPosNum.length;_i2++){var _birdP=new THREE.Vector3(birdDownPosNum[_i2][0],birdDownPosNum[_i2][1],birdDownPosNum[_i2][2]);this.birdsDownPos.push(_birdP)}this.birdTex=tex_loader.load(this.BASE_PATH+"/images/bird.jpg");this.loadModelBird(this.BASE_PATH+"/models/bird/bird_body.json",this.BASE_PATH+"/models/bird/bird_wingR.json",this.BASE_PATH+"/models/bird/bird_wingL.json",loader);this.dummy={opacity:1};events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("MeirAnim")}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"doFirstAni",value:function doFirstAni(){console.log("do first animation.")}},{key:"birdsOut",value:function birdsOut(){for(var i=0;i<15;i++){this.birdAniTimelines[i].resume()}}},{key:"characterDisappear",value:function characterDisappear(){var _this3=this;for(var i=0;i<this.birdAniTimelines.length;i++){this.birdAniTimelines[i].kill()}for(var _i3=0;_i3<this.backbirdAniTimelines.length;_i3++){this.backbirdAniTimelines[_i3].kill()}for(var _i4=0;_i4<this.birds.length;_i4++){this.birdFlapDown(this.birds[_i4],_i4)}for(var _i5=0;_i5<this.backBirds.children.length;_i5++){this.backBirdFlapDown(this.backBirds.children[_i5],_i5)}TweenMax.to(this.dummy,2.5,{opacity:0,delay:1,onUpdate:function onUpdate(){_this3.parent.fullVideo.setOpacity(_this3.dummy.opacity)},onStart:function onStart(){},onComplete:function onComplete(){_this3.parent.fullVideo.setOpacity(0);_this3.createBirdAnimations(true);_this3.createBackBirdAnimations(true)}})}},{key:"disposeAni",value:function disposeAni(){for(var i=0;i<this.birds.length;i++){this.remove(this.birds[i])}this.remove(this.backBirds);this.birdMat.dispose();this.birdTex.dispose();for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}console.log("dispose Meir ani!")}},{key:"loadModelBird",value:function loadModelBird(_body,_wingR,_wingL,loader){var _this4=this;this.birdMat=new THREE.MeshBasicMaterial({color:10866883,map:this.birdTex});loader.load(_body,function(geometry,material){_this4.disposeRelatedGeos.push(geometry);_this4.bird=new THREE.Mesh(geometry,_this4.birdMat);loader.load(_wingR,function(geometry,material){_this4.disposeRelatedGeos.push(geometry);var wingR=new THREE.Mesh(geometry,_this4.birdMat);wingR.position.x=-.6;_this4.bird.add(wingR);loader.load(_wingL,function(geometry,material){_this4.disposeRelatedGeos.push(geometry);var wingL=new THREE.Mesh(geometry,_this4.birdMat);wingL.position.x=.6;_this4.bird.add(wingL);for(var i=0;i<_this4.birdsPos.length;i++){var bd=_this4.bird.clone();bd.scale.multiplyScalar(.2);bd.position.copy(_this4.birdsPos[i]);_this4.birds.push(bd);_this4.add(bd)}for(var _i6=3;_i6<6;_i6++){var mathStuff=Math.PI*2/9*_i6;for(var j=0;j<9;j++){var _bd=_this4.bird.clone();_bd.scale.multiplyScalar(.4);var tempA=new THREE.Vector3;if(j>6)tempA.set(Math.sin(mathStuff)*(1-j/18),j/2,Math.cos(mathStuff)*(1-j/18));else if(j<2)tempA.set(Math.sin(mathStuff)*(1+(3-j)/4),j/2,Math.cos(mathStuff)*(1+(3-j)/4));else tempA.set(Math.sin(mathStuff)*1,j/2,Math.cos(mathStuff)*1);tempA.set(tempA.x+_this4.lookupTable[_i6*j%45]*.3,tempA.y+_this4.lookupTable[_i6*j%46]*.3,tempA.z+_this4.lookupTable[_i6*j%47]*.3);_bd.position.copy(tempA);_bd.rotation.y=mathStuff-Math.PI*2;_this4.backBirds.add(_bd)}}_this4.add(_this4.backBirds);_this4.backBirds.position.set(.1,-.36,3.33);_this4.backBirds.rotation.y=10*Math.PI/180;_this4.createBirdAnimations(false);_this4.createBackBirdAnimations(false)})})})}},{key:"createBirdAnimations",value:function createBirdAnimations(again){for(var i=0;i<this.birds.length;i++){var tl=new TimelineMax({repeat:-1,repeatDelay:2,delay:i%5});var index=this.birdAniConfig[i];var birdAniSetting=this.birdsAniSetting[index];if(again){birdAniSetting=this.birdsAniSetting[i%3]}for(var j=0;j<birdAniSetting.seqNum;j++){var tweenLabelTime="+="+birdAniSetting.timeGap[j];tl.add(birdAniSetting.label[j],tweenLabelTime);var tweenToBeAdded=this.selectBirdAnimation(this.birds[i],birdAniSetting.seq[j]);tl.add(tweenToBeAdded,birdAniSetting.label[j])}if(!again){if(i<15)tl.pause();this.birdAniTimelines.push(tl)}else{this.birdAniTimelines[i]=tl}}}},{key:"createBackBirdAnimations",value:function createBackBirdAnimations(again){var b_b_length=this.backBirds.children.length;for(var i=0;i<this.backBirds.children.length;i++){var tl=new TimelineMax({repeat:-1,repeatDelay:1+i/b_b_length,delay:i%5+i/b_b_length});var index=this.birdAniConfig[i];var birdAniSetting=this.birdsAniSetting[i%3];for(var j=0;j<birdAniSetting.seqNum;j++){var tweenLabelTime="+="+birdAniSetting.timeGap[j];tl.add(birdAniSetting.label[j],tweenLabelTime);var tweenToBeAdded=this.selectBirdAnimation(this.backBirds.children[i],birdAniSetting.seq[j]);tl.add(tweenToBeAdded,birdAniSetting.label[j])}if(!again){this.backbirdAniTimelines.push(tl)}else{this.backbirdAniTimelines[i]=tl}}}},{key:"selectBirdAnimation",value:function selectBirdAnimation(bird,aniIndex){switch(aniIndex){case 0:return this.birdEat(bird,1);break;case 1:return this.birdJump(bird);break;case 2:return this.birdJumpTurnV1(bird);break;case 3:return this.birdJumpTurnV2(bird);break;case 4:return this.birdFlap(bird);break;case 5:return this.birdSwingRight(bird,true);break;case 6:return this.birdSwingRight(bird,false);break;case 7:return this.birdPeek(bird);break;case 8:return this.birdPeekOut(bird,true);break;case 9:return this.birdPeekOut(bird,false);break;case 10:return this.birdTurn(bird);break}}},{key:"createBirdAnimation",value:function createBirdAnimation(){for(var i=0;i<this.birds.length;i++){var tl=new TimelineMax({repeat:-1,repeatDelay:2,delay:i%3});if(i%2==0){tl.add("eat_1");tl.add(this.birdEat(this.birds[i],1),"eat_1");tl.add("eat_2","+=2");tl.add(this.birdEat(this.birds[i],3),"eat_2");tl.add("jump","+=1");tl.add(this.birdJump(this.birds[i]),"jump")}else{tl.add("eat_3");tl.add(this.birdEat(this.birds[i],3),"eat_3");tl.add("flap");tl.add(this.birdFlap(this.birds[i]),"flap");tl.add("jumpTurn","+=1");tl.add(this.birdJumpTurnV2(this.birds[i]),"jumpTurn")}}}},{key:"birdSwingRight",value:function birdSwingRight(_bird,_right){var direction=1;if(!_right)direction=-1;return TweenMax.to(_bird.rotation,.2,{z:10*Math.PI/180*direction,onStart:function onStart(){var mov=direction*.1;TweenMax.to(_bird.position,.8,{x:"-="+mov})},onComplete:function onComplete(){TweenMax.to(_bird.rotation,.4,{z:-10*Math.PI/180*direction,onComplete:function onComplete(){TweenMax.to(_bird.rotation,.2,{z:0})}})}})}},{key:"birdEat",value:function birdEat(_bird,_repeat){return TweenMax.to(_bird.rotation,.15,{x:20*Math.PI/180,repeat:_repeat,yoyo:true})}},{key:"birdPeek",value:function birdPeek(_bird){var t1=TweenMax.to(_bird.rotation,.5,{x:10*Math.PI/180,repeat:1,repeatDelay:3,yoyo:true});var t2=TweenMax.to(_bird.position,1,{z:"+=.9",repeat:1,repeatDelay:3,yoyo:true});return[t1,t2]}},{key:"birdPeekOut",value:function birdPeekOut(_bird,_out){var direction=void 0,mov=void 0;if(_out){direction=1;mov=1.1}else{direction=0;mov=-1.1}var t1=TweenMax.to(_bird.rotation,.5,{x:10*Math.PI/180*direction});var t2=TweenMax.to(_bird.position,1,{z:"+="+mov});return[t1,t2]}},{key:"birdFlap",value:function birdFlap(_bird){var rotY=40*Math.PI/180;var t1=TweenMax.to(_bird.children[0].rotation,.15,{x:10*Math.PI/180,y:"+="+rotY,repeat:3,yoyo:true});var t2=TweenMax.to(_bird.children[1].rotation,.15,{x:10*Math.PI/180,y:"-="+rotY,repeat:3,yoyo:true});var t3=TweenMax.to(_bird.position,.2,{y:"+=0.1",repeat:1,yoyo:true,delay:.1});return[t1,t2,t3]}},{key:"birdFlapDown",value:function birdFlapDown(_bird,index){var _this5=this;var rotY=40*Math.PI/180;
TweenMax.to(_bird.children[0].rotation,.15,{x:10*Math.PI/180,y:"+="+rotY,repeat:7,yoyo:true,delay:index*.1});TweenMax.to(_bird.children[1].rotation,.15,{x:10*Math.PI/180,y:"-="+rotY,repeat:7,yoyo:true,delay:index*.1});TweenMax.to(_bird.position,.2,{y:"+=0.1",delay:index*.1+1,onComplete:function onComplete(){TweenMax.to(_bird.position,2,{x:_this5.birdsDownPos[index].x,y:_this5.birdsDownPos[index].y,z:_this5.birdsDownPos[index].z})}})}},{key:"backBirdFlapDown",value:function backBirdFlapDown(_bird,index){var _this6=this;var rotY=40*Math.PI/180;TweenMax.to(_bird.children[0].rotation,.15,{x:10*Math.PI/180,y:"+="+rotY,repeat:7,yoyo:true,delay:index*.1%1.5});TweenMax.to(_bird.children[1].rotation,.15,{x:10*Math.PI/180,y:"-="+rotY,repeat:7,yoyo:true,delay:index*.1%1.5});TweenMax.to(_bird.position,.2,{y:"+=0.1",delay:(index*.1+1)%1.5,onComplete:function onComplete(){var xPos=_this6.birdsDownPos[index%14].x+_this6.lookupTable[index%48]*3-_this6.backBirds.position.x;var yPos=_this6.birdsDownPos[index%14].y-_this6.backBirds.position.y;var zPos=_this6.birdsDownPos[index%14].z+_this6.lookupTable[index%49]*2-_this6.backBirds.position.z-2;TweenMax.to(_bird.position,2,{x:xPos,y:yPos,z:zPos});TweenMax.to(_bird.rotation,2,{y:0})}})}},{key:"birdJump",value:function birdJump(_bird){return TweenMax.to(_bird.position,.15,{y:"+=0.05",repeat:3,yoyo:true})}},{key:"birdTurn",value:function birdTurn(_bird){var rotY=10*Math.PI/180;return TweenMax.to(_bird.rotation,.2,{y:"+="+rotY,repeat:1,yoyo:true,repeatDelay:1,onComplete:function onComplete(){TweenMax.to(_bird.rotation,.2,{y:"-="+rotY,repeat:1,yoyo:true,repeatDelay:.5})}})}},{key:"birdJumpTurnV1",value:function birdJumpTurnV1(_bird){var oriRotY=_bird.rotation.y;var rotY=20*Math.PI/180;var t1=TweenMax.to(_bird.position,.15,{y:"+=0.05",repeat:1,yoyo:true,onComplete:function onComplete(){TweenMax.to(_bird.position,.15,{y:"+=0.05",repeat:1,yoyo:true,delay:1});TweenMax.to(_bird.rotation,.2,{y:oriRotY,delay:1.1})}});var t2=TweenMax.to(_bird.rotation,.2,{y:"+="+rotY,delay:.1});return[t1,t2]}},{key:"birdJumpTurnV2",value:function birdJumpTurnV2(_bird){var oriRotY=_bird.rotation.y;var rotY=10*Math.PI/180;var rotY2=30*Math.PI/180;var t1=TweenMax.to(_bird.position,.2,{y:"+=0.02",repeat:1,yoyo:true,repeatDelay:2,onComplete:function onComplete(){TweenMax.to(_bird.position,.2,{y:"+=0.04",repeat:1,yoyo:true,repeatDelay:2,onComplete:function onComplete(){TweenMax.to(_bird.position,.15,{y:"+=0.02",repeat:1,yoyo:true});TweenMax.to(_bird.rotation,.15,{y:oriRotY})}});TweenMax.to(_bird.rotation,.2,{y:"-="+rotY})}});var t2=TweenMax.to(_bird.rotation,.2,{y:"+="+rotY2});return[t1,t2]}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"start",value:function start(){this.parent.updateMatrixWorld();this.parent.fullVideo.mesh.updateMatrixWorld();this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){}}]);return MeirAnimation}(THREE.Object3D);exports.default=MeirAnimation},{"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/fbo":59,"../util/improved_noise":61,"../util/texture_animator":65}],10:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("../util/fbo");var _fbo2=_interopRequireDefault(_fbo);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var MiriamAnimation=function(_THREE$Object3D){_inherits(MiriamAnimation,_THREE$Object3D);function MiriamAnimation(renderer,config){_classCallCheck(this,MiriamAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MiriamAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/miriam";_this.render_fs="#define GLSLIFY 1\nvarying vec3 vColor;\n\nvoid main() {\n  //gl_FragColor = vec4( vec3( 1., .5, .5 ), .85 );\n  //gl_FragColor = vec4( vColor, .85 );\n  gl_FragColor = vec4( 1., 1., 1., .85 );\n}\n";_this.render_vs="#define GLSLIFY 1\n//float texture containing the positions of each particle\nuniform sampler2D positions;\nattribute vec2 reference;\nvarying vec3 vColor;\n\n//size\nuniform float pointSize;\n\nvoid main() {\n\n    //the mesh is a nomrliazed square so the uvs = the xy positions of the vertices\n    vec3 pos = texture2D( positions, reference).xyz;\n\n    gl_Position = projectionMatrix *  modelViewMatrix * vec4( pos, 1.0 );\n\n    gl_PointSize = pointSize;\n\n}\n";_this.simulation_fs="#define GLSLIFY 1\nhighp float random_2_0(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_4_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_4_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_4_2(vec4 x) {\n     return mod289_4_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_4_3(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_4_4(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D_4_5 = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_4_6 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_4_6;\n  vec3 i1 = min( g_4_6.xyz, l.zxy );\n  vec3 i2 = max( g_4_6.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D_4_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_4_1(i);\n  vec4 p = permute_4_2( permute_4_2( permute_4_2(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D_4_5.wyz - D_4_5.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1_4_7 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0_4_8 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1_4_7.xy,h.z);\n  vec3 p3 = vec3(a1_4_7.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt_4_3(vec4(dot(p0_4_8,p0_4_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0_4_8 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0_4_8,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n\n\n\nvec3 snoiseVec3_3_9( vec3 x ){\n\n  float s  = snoise_4_4(vec3( x ));\n  float s1 = snoise_4_4(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise_4_4(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\n\nvec3 curlNoise_3_10( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3_3_9( p - dx );\n  vec3 p_x1 = snoiseVec3_3_9( p + dx );\n  vec3 p_y0 = snoiseVec3_3_9( p - dy );\n  vec3 p_y1 = snoiseVec3_3_9( p + dy );\n  vec3 p_z0 = snoiseVec3_3_9( p - dz );\n  vec3 p_z1 = snoiseVec3_3_9( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\n\n\nmat4 rotationMatrix_1_11(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\n\nuniform sampler2D positions;\nuniform sampler2D morphPositions;\nuniform float timer;\nuniform float maxDepth;\nuniform float amplitude;\nuniform float frequency;\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 pos = texture2D( positions, vUv ).rgb;\n    vec3 morphPos = texture2D( morphPositions, vUv ).rgb;\n\n    if( timer<0.47 ){\n        pos = pos + (morphPos-pos) * timer;\n    }\n    \n    vec3 velocity = curlNoise_3_10( pos * frequency ) * amplitude;\n    pos = pos + velocity;\n    \n    gl_FragColor = vec4( pos, 1.0 );\n}\n";_this.simulation_vs="#define GLSLIFY 1\nvarying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, 1.0 - uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";_this.width=256;_this.height=256;_this.renderer=renderer;_this.maxDepth=50;return _this}_createClass(MiriamAnimation,[{key:"initParticles",value:function initParticles(geo){this.manFigure.matrixWorldNeedsUpdate=true;var fboGeo=geo.clone();this.disposeRelatedGeos.push(fboGeo);var data=new Float32Array(this.width*this.height*3);var points=THREE.GeometryUtils.indexedPointsInGeometry(fboGeo,this.width*this.height,this.indexArray);for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"initParticlesFirstEver",value:function initParticlesFirstEver(geo){this.manFigure.matrixWorldNeedsUpdate=true;var fboGeo=geo.clone();this.disposeRelatedGeos.push(fboGeo);fboGeo.applyMatrix((new THREE.Matrix4).makeScale(.1,.1,.1));var data=new Float32Array(this.width*this.height*3);var results=THREE.GeometryUtils.randomPointsAndIndexInGeometry(fboGeo,this.width*this.height);var points=results[0];this.indexArray=results[1];for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.loadingManager.itemStart("MiriamAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.disposeRelatedGeos=[];this.animStart=true;this.sequenceConfig=[{time:2,anim:function anim(){_this2.manOn()}},{time:5,anim:function anim(){_this2.fboOn()}},{time:10,anim:function anim(){_this2.manAppear(10)}},{time:40,anim:function anim(){_this2.manHold(8)}},{time:65,anim:function anim(){_this2.manLean(8)}},{time:105,anim:function anim(){_this2.manCircle(8)}},{time:115,anim:function anim(){_this2.manSwirl(8)}},{time:125,anim:function anim(){_this2.manSwirl2(8)}},{time:135,anim:function anim(){_this2.manSwirl3(8)}},{time:145,anim:function anim(){_this2.manSwirlNonstop()}},{time:220,anim:function anim(){_this2.manSwirlSpeedup(46)}}];this.GFClockTex=tex_loader.load(this.BASE_PATH+"/images/clockUV4.jpg");this.GFClockMat=new THREE.MeshLambertMaterial({map:this.GFClockTex});this.loadModelClock(this.BASE_PATH+"/models/clock_surface.js",this.BASE_PATH+"/models/clock_gear.js",this.BASE_PATH+"/models/clock_pointerA.js",this.BASE_PATH+"/models/clock_pointerB.js",this.GFClockMat);var men_figures2={1:[["-1.275","13.468","-0.008"],["-0.597","13.021","0.000"],["-0.736","12.368","0.000"],["-2.449","12.096","0.000"],["-3.088","10.404","0.000"],["-3.719","7.390","-0.126"],["-3.975","3.350","-0.126"],["-2.830","3.793","-0.126"],["-2.897","7.008","-0.126"],["-2.120","9.909","0.000"],["-1.914","10.638","0.000"],["-1.519","9.997","0.000"],["-1.867","6.765","0.000"],["-2.219","1.546","0.000"],["-2.375","0.810","0.000"],["-2.440","-0.069","0.000"],["-1.440","-0.069","0.000"],["-1.066","0.715","0.000"],["-1.019","1.537","0.000"],["-0.808","2.924","0.000"],["-0.418","6.490","0.000"],["0.324","6.219","0.000"],["0.233","2.685","0.000"],["0.309","1.428","0.000"],["0.311","0.624","0.000"],["0.560","-0.069","0.000"],["1.560","-0.069","0.000"],["1.801","0.854","0.000"],["1.762","1.476","0.000"],["1.768","6.424","0.000"],["1.348","9.893","-0.043"],["1.889","10.713","0.027"],["2.078","9.739","0.023"],["2.668","7.202","-0.091"],["2.535","3.913","-0.108"],["3.543","3.636","-0.108"],["3.688","7.404","-0.108"],["3.033","10.307","0.000"],["2.409","12.095","0.000"],["0.699","12.389","0.000"],["0.492","13.042","0.000"],["1.244","13.495","0.000"],["1.495","14.295","0.000"],["1.381","15.069","0.000"],["0.764","15.646","0.000"],["0.048","15.867","0.000"],["-0.718","15.695","0.041"],["-1.170","15.157","0.041"]],2:[["-1.029","13.441","1.233"],["-0.573","13.148","1.053"],["-0.771","12.510","0.789"],["-2.449","12.186","0.531"],["-3.381","10.497","0.025"],["-3.781","6.732","2.982"],["-0.731","3.824","6.626"],["-0.665","3.454","6.073"],["-3.008","5.456","2.829"],["-2.182","9.928","-0.025"],["-1.914","10.697","0.080"],["-1.784","10.027","-0.022"],["-1.867","6.222","-0.366"],["-2.219","1.546","-0.124"],["-2.375","0.810","-0.124"],["-2.440","-0.069","0.004"],["-1.440","-0.069","0.004"],["-1.066","0.715","-0.124"],["-1.019","1.537","-0.124"],["-0.808","2.924","-0.152"],["-0.420","6.410","-0.264"],["0.331","6.133","-0.261"],["0.233","2.685","-0.152"],["0.309","1.428","-0.124"],["0.311","0.624","-0.124"],["0.560","-0.069","0.004"],["1.560","-0.069","0.004"],["1.801","0.854","-0.124"],["1.762","1.476","-0.124"],["1.768","5.881","-0.366"],["1.565","9.927","-0.077"],["1.889","10.774","0.127"],["2.298","9.683","-0.052"],["2.739","5.531","2.714"],["0.485","3.523","6.075"],["0.560","3.859","6.588"],["3.757","6.668","3.056"],["3.325","10.235","0.004"],["2.409","12.182","0.522"],["1.004","12.550","0.795"],["0.704","13.171","1.061"],["1.070","13.488","1.235"],["1.553","14.172","1.901"],["1.439","14.689","2.550"],["0.822","15.041","3.050"],["0.106","15.181","3.222"],["-0.808","14.956","2.917"],["-1.284","14.530","2.273"]],3:[["1.229","12.162","2.879"],["1.392","11.560","2.520"],["0.825","11.355","2.001"],["-1.350","12.537","2.634"],["-3.122","10.409","0.277"],["-3.898","7.217","2.537"],["-0.731","3.824","6.622"],["-0.665","3.454","6.069"],["-3.148","6.250","2.001"],["-1.816","9.482","0.234"],["-0.708","10.219","0.796"],["-1.080","9.320","0.192"],["-2.431","6.286","0.062"],["-2.340","1.573","-0.235"],["-2.424","0.814","-0.127"],["-2.440","-0.069","0.000"],["-1.440","-0.069","0.000"],["-1.066","0.715","-0.128"],["-1.019","1.537","-0.128"],["-0.808","2.924","-0.156"],["-0.763","6.410","-0.268"],["-0.012","6.133","-0.265"],["0.233","2.685","-0.156"],["0.309","1.428","-0.128"],["0.311","0.624","-0.128"],["0.560","-0.069","0.000"],["1.560","-0.069","0.000"],["1.801","0.854","-0.128"],["1.762","1.973","-0.128"],["1.768","5.881","-0.004"],["2.199","8.617","0.729"],["2.687","7.856","1.199"],["3.296","6.316","2.159"],["2.308","4.830","3.732"],["0.485","3.523","6.071"],["0.560","3.859","6.584"],["3.508","6.175","3.541"],["3.590","8.520","1.658"],["3.241","9.385","1.829"],["2.448","10.353","1.916"],["2.219","10.586","2.537"],["2.624","10.445","2.822"],["3.214","10.306","3.702"],["3.312","10.534","4.502"],["3.017","11.091","5.100"],["2.609","11.682","5.313"],["2.035","12.274","5.051"],["1.668","12.554","4.488"]],4:[["1.386","13.002","1.584"],["1.423","13.212","-0.134"],["0.217","12.537","-0.511"],["-1.667","11.780","-0.604"],["-3.176","10.981","-0.601"],["-4.194","9.301","0.598"],["-4.692","7.968","1.621"],["-4.663","6.546","2.549"],["-3.918","6.351","1.852"],["-3.275","6.524","0.980"],["-2.442","6.798","-0.165"],["-1.833","6.680","-1.015"],["-1.886","4.721","-1.362"],["-1.816","2.699","-1.268"],["-1.407","1.493","-1.040"],["-1.064","0.907","-0.882"],["-0.550","0.593","-0.719"],["-0.093","0.958","-0.613"],["0.153","1.847","-0.564"],["0.297","2.756","-0.633"],["0.509","3.337","-0.697"],["0.827","3.625","-0.702"],["1.101","2.975","-0.594"],["1.250","1.971","-0.528"],["1.397","1.232","-0.409"],["1.650","0.849","-0.107"],["2.095","0.932","0.302"],["2.691","1.657","0.622"],["3.031","3.341","0.688"],["3.136","4.971","1.343"],["3.095","5.103","2.158"],["3.127","4.124","2.696"],["3.028","2.660","2.963"],["1.376","1.942","3.830"],["0.123","1.834","4.437"],["-2.660","1.921","5.809"],["-1.289","3.151","5.976"],["3.301","4.925","4.479"],["4.374","6.323","3.380"],["4.143","7.252","2.876"],["3.767","8.254","2.483"],["3.321","9.205","2.386"],["3.105","9.985","2.984"],["3.558","9.851","4.949"],["3.946","9.517","7.782"],["2.436","11.266","5.564"],["1.812","11.975","4.178"],["1.570","12.249","3.543"]],5:[["4.731","11.922","1.742"],["3.352","12.260","0.637"],["1.585","12.488","-0.072"],["-0.180","12.361","-0.330"],["-1.746","12.012","-0.161"],["-3.101","11.438","0.380"],["-4.110","10.678","1.202"],["-4.715","9.951","2.197"],["-5.041","9.181","3.218"],["-5.221","8.338","4.075"],["-5.234","7.468","4.587"],["-5.116","6.650","4.677"],["-4.917","5.987","4.397"],["-4.665","5.596","3.883"],["-4.366","5.570","3.267"],["-4.044","5.933","2.609"],["-3.764","6.616","1.910"],["-3.521","7.473","1.161"],["-3.165","8.332","0.388"],["-2.567","9.115","-0.346"],["-1.773","9.654","-0.967"],["-0.823","9.838","-1.430"],["0.242","9.766","-1.710"],["1.362","9.563","-1.783"],["2.430","9.244","-1.602"],["3.323","8.862","-1.114"],["3.919","8.419","-0.292"],["4.105","7.865","0.832"],["4.001","7.169","2.148"],["3.712","6.327","3.464"],["2.971","5.308","4.356"],["1.738","4.304","5.025"],["0.317","3.444","5.793"],["-0.945","2.972","6.437"],["-1.786","2.737","6.843"],["-2.154","2.708","7.187"],["-1.991","2.860","7.498"],["-1.349","3.143","7.781"],["-0.380","3.554","8.020"],["0.711","4.119","8.126"],["1.752","4.796","8.102"],["2.732","5.445","7.974"],["3.590","6.166","7.746"],["4.334","6.965","7.337"],["4.947","7.879","6.725"],["5.337","8.947","5.912"],["5.636","10.116","4.911"],["5.075","11.271","3.158"]],6:[["3.516","11.720","6.238"],["3.957","12.425","4.862"],["4.146","12.871","3.215"],["3.789","12.946","1.697"],["3.119","12.593","0.539"],["2.546","11.850","-0.215"],["2.170","10.829","-0.718"],["1.953","9.687","-1.128"],["1.555","8.591","-1.392"],["0.793","7.672","-1.438"],["-0.222","6.968","-1.246"],["-1.166","6.423","-0.878"],["-1.748","5.947","-0.530"],["-1.822","5.493","-0.350"],["-1.357","5.081","-0.396"],["-0.350","4.783","-0.645"],["1.083","4.701","-0.984"],["2.498","4.930","-1.056"],["3.614","5.498","-0.747"],["4.322","6.317","-0.120"],["4.680","7.196","0.716"],["4.890","7.943","1.673"],["5.023","8.454","2.820"],["5.010","8.705","4.158"],["4.785","8.684","5.431"],["4.351","8.368","6.526"],["3.696","7.760","7.370"],["2.835","6.930","7.886"],["1.750","5.994","7.991"],["0.053","5.078","7.667"],["-1.684","4.295","6.835"],["-2.565","3.725","5.489"],["-3.181","3.392","4.213"],["-3.773","3.260","3.216"],["-4.224","3.267","2.490"],["-4.581","3.358","2.155"],["-4.894","3.504","2.255"],["-5.132","3.693","2.745"],["-5.196","3.924","3.552"],["-4.994","4.209","4.567"],["-4.586","4.570","5.648"],["-4.149","5.029","6.648"],["-3.506","5.601","7.483"],["-2.504","6.297","8.071"],["-1.234","7.122","8.397"],["0.092","8.083","8.442"],["1.245","9.164","8.197"],["2.415","10.320","7.895"]],7:[["0.073","9.635","9.552"],["1.662","9.999","9.517"],["3.265","10.361","9.051"],["4.449","10.550","8.072"],["5.117","10.627","6.851"],["5.349","10.570","5.720"],["5.322","10.441","4.716"],["5.215","10.131","3.830"],["4.929","9.689","2.921"],["4.382","9.076","1.977"],["3.608","8.310","1.088"],["2.763","7.682","0.342"],["2.089","7.253","-0.135"],["1.752","6.790","-0.290"],["1.820","6.170","-0.117"],["2.300","5.395","0.425"],["3.086","4.548","1.342"],["3.739","3.904","2.500"],["4.066","3.386","3.747"],["4.056","3.015","4.930"],["3.757","2.918","5.967"],["3.255","3.031","6.894"],["2.481","3.209","7.756"],["1.398","3.575","8.492"],["0.205","4.043","8.923"],["-1.011","4.522","8.985"],["-2.187","5.011","8.636"],["-3.227","5.324","7.880"],["-4.029","5.460","6.709"],["-4.543","5.440","5.022"],["-4.905","4.944","3.213"],["-4.238","4.789","1.700"],["-3.132","4.969","0.408"],["-1.790","5.239","-0.533"],["-0.623","5.694","-0.915"],["-0.119","6.128","-1.105"],["-0.135","6.544","-1.208"],["-0.673","6.939","-1.220"],["-1.828","7.335","-1.072"],["-3.289","7.755","-0.544"],["-4.249","8.101","0.489"],["-5.001","8.463","1.534"],["-5.522","8.783","2.669"],["-5.622","9.029","3.936"],["-5.289","9.336","5.248"],["-4.390","9.437","6.587"],["-3.280","9.550","7.707"],["-2.236","9.410","8.929"]]};var men_figures_vec={},men_figures_points=[];var m_f_size=Object.keys(men_figures2).length;for(var i=1;i<=m_f_size;i++){men_figures_vec[i]=[];for(var j=0;j<men_figures2[i].length;j++){var newVector=new THREE.Vector3(Number(men_figures2[i][j][0]),Number(men_figures2[i][j][1]),Number(men_figures2[i][j][2]));newVector.multiplyScalar(.3);men_figures_vec[i].push(newVector)}}this.manMaterial=new THREE.MeshLambertMaterial({color:16711680,morphTargets:true,transparent:true,opacity:1});var m_f_size2=Object.keys(men_figures_vec).length;for(var _i=1;_i<=m_f_size2;_i++){var manSpline=new THREE.CatmullRomCurve3(men_figures_vec[_i]);manSpline.type="catmullrom";manSpline.closed=true;men_figures_points.push(manSpline)}var curveColors=[];this.manGeometries=[];var manGeometry=new THREE.TubeGeometry(men_figures_points[0],100,.05,2,true);this.manGeometries.push(manGeometry);for(var _i2=1;_i2<men_figures_points.length;_i2++){var manGeometry2=new THREE.TubeGeometry(men_figures_points[_i2],100,.05,2,true);var nameee="t"+(_i2-1);manGeometry.morphTargets[_i2-1]={name:nameee,vertices:manGeometry2.vertices};this.manGeometries.push(manGeometry2)}manGeometry.computeMorphNormals();this.manFigure=new THREE.Mesh(manGeometry,this.manMaterial);this.manFigure.position.set(1,0,-2);this.add(this.manFigure);this.manFigure.scale.multiplyScalar(.01);this.manFigure.visible=false;this.dummy={timeScaleValue:0};this.completeSequenceSetup();var positions=this.initParticlesFirstEver(this.manGeometries[0]);var morphPositions=this.initParticles(this.manGeometries[1]);this.rttIn=positions;this.simulationShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:positions},timer:{type:"f",value:0},maxDepth:{type:"f",value:this.maxDepth},morphPositions:{type:"t",value:morphPositions},maxDistance:{type:"f",value:50},amplitude:{type:"f",value:.001},frequency:{type:"f",value:.8}},vertexShader:this.simulation_vs,fragmentShader:this.simulation_fs});this.renderShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:null},pointSize:{type:"f",value:1}},vertexShader:this.render_vs,fragmentShader:this.render_fs,transparent:true,blending:THREE.AdditiveBlending});var particleGeometry=new THREE.Geometry;particleGeometry.vertices.push(new THREE.Vector3);this.fbo=new _fbo2.default;this.fbo.init(this.width,this.height,this.renderer,this.simulationShader,this.renderShader,particleGeometry);this.fbo.particles.frustumCulled=false;this.add(this.fbo.particles);this.fbo.particles.position.set(1,0,-2);this.timerAnim=null;this.fbo.update();this.fbo.particles.visible=false;events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("MiriamAnim")}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"manOn",value:function manOn(){this.manFigure.visible=true}},{key:"fboOn",value:function fboOn(){this.fbo.particles.visible=true}},{key:"manAppear",value:function manAppear(_duration){TweenMax.fromTo(this.manFigure.scale,_duration,{x:.01,y:.01,z:.01},{x:1,y:1,z:1,ease:Power1.easeOut})}},{key:"manHold",value:function manHold(_duration){var tmpEndArray=[1,0,0,0,0,0];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray,ease:Power1.easeInOut})}},{key:"manLean",value:function manLean(_duration){var tmpEndArray=[0,1,0,0,0,0];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray,ease:Power1.easeInOut})}},{key:"manCircle",value:function manCircle(_duration){var tmpEndArray=[0,0,1,0,0,0];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray,ease:Power1.easeInOut})}},{key:"manSwirl",value:function manSwirl(_duration){var tmpEndArray=[0,0,0,1,0,0];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray})}},{key:"manSwirl2",value:function manSwirl2(_duration){var tmpEndArray=[0,0,0,0,1,0];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray})}},{key:"manSwirl3",value:function manSwirl3(_duration){var tmpEndArray=[0,0,0,0,0,1];TweenMax.to(this.manFigure.morphTargetInfluences,_duration,{endArray:tmpEndArray})}},{key:"manSwirlNonstop",value:function manSwirlNonstop(){var _this3=this;this.tl=new TimelineMax({repeat:-1});this.tl.to(this.manFigure.morphTargetInfluences,4,{endArray:[0,0,0,1,0,0],onStart:function onStart(){_this3.updateMorphForFBO(_this3.manGeometries[4],_this3.dummy.timeScaleValue*2)}}).to(this.manFigure.morphTargetInfluences,4,{endArray:[0,0,0,0,1,0],onStart:function onStart(){_this3.updateMorphForFBO(_this3.manGeometries[5],_this3.dummy.timeScaleValue*2)}}).to(this.manFigure.morphTargetInfluences,4,{endArray:[0,0,0,0,0,1],onStart:function onStart(){_this3.updateMorphForFBO(_this3.manGeometries[6],_this3.dummy.timeScaleValue*2)}})}},{key:"manSwirlSpeedup",value:function manSwirlSpeedup(_duration){var _this4=this;TweenMax.to(this.manFigure.material,5,{opacity:0,onComplete:function onComplete(){_this4.manFigure.visible=false}});TweenMax.to(this.dummy,_duration,{timeScaleValue:30,ease:Power2.easeIn,onStart:function onStart(){TweenMax.to(_this4.manFigure.scale,5,{x:1.2,y:1.2,z:1.2,ease:Power2.easeInOut});TweenMax.to(_this4.fbo.particles.scale,_duration,{x:2,y:2,z:2,ease:Expo.easeIn});_this4.speedUpStart=true},onComplete:function onComplete(){console.log("fastest!");_this4.tl.kill();_this4.speedUpStart=false;TweenMax.to(_this4.parent.fullVideo.mesh.scale,1,{x:1e-5,y:1e-5,z:1e-5,ease:Back.easeInOut,onComplete:function onComplete(){_this4.parent.fullVideo.setOpacity(0)}})}})}},{key:"loadModelClock",value:function loadModelClock(model,modelB,modelC,modelD,meshMat){var _this5=this;var loader=new THREE.JSONLoader(this.loadingManager);var cloMat=meshMat;var myClock=new THREE.Object3D;this.myCP1=new THREE.Object3D;this.myCP2=new THREE.Object3D;this.grandFatherClock=new THREE.Object3D;this.pointer1Time=0;this.pointer2Time=0;loader.load(model,function(geometry,material){geometry.center();_this5.disposeRelatedGeos.push(geometry);var cFace=new THREE.Mesh(geometry,cloMat);cFace.scale.set(1,1,1.7);cFace.position.set(0,0,3.1);myClock.add(cFace)});loader.load(modelB,function(geometryB,material){geometryB.center();_this5.transY(geometryB,27);_this5.disposeRelatedGeos.push(geometryB);_this5.cGear=new THREE.Mesh(geometryB,cloMat);var myGear=new THREE.Object3D;myGear.add(_this5.cGear);myGear.rotation.z=-Math.PI/5;myClock.add(myGear)});loader.load(modelC,function(geometryC,material){geometryC.center();_this5.disposeRelatedGeos.push(geometryC);var cP1=new THREE.Mesh(geometryC,cloMat);cP1.position.set(-2.2,0,6);cP1.scale.set(1,1,2.5);_this5.myCP1.add(cP1);myClock.add(_this5.myCP1)});loader.load(modelD,function(geometryD,material){geometryD.center();_this5.disposeRelatedGeos.push(geometryD);var cP2=new THREE.Mesh(geometryD,cloMat);cP2.position.set(0,12,3);cP2.scale.set(1,1,2.5);_this5.myCP2.add(cP2);myClock.add(_this5.myCP2);myClock.position.y=-80;_this5.grandFatherClock.add(myClock);for(var i=0;i<6;i++){var geoTemp=new THREE.CylinderGeometry(.5,.5,90);_this5.disposeRelatedGeos.push(geoTemp);var bar=new THREE.Mesh(geoTemp,cloMat);bar.position.y=-15;bar.position.x=i*3-8;_this5.grandFatherClock.add(bar)
}_this5.grandFatherClock.scale.multiplyScalar(.01);_this5.grandFatherClock.position.set(1,3,-1.5);_this5.add(_this5.grandFatherClock)})}},{key:"disposeAni",value:function disposeAni(){this.remove(this.grandFatherClock);this.GFClockMat.dispose();this.GFClockTex.dispose();this.remove(this.manFigure);for(var i=0;i<this.manGeometries.length;i++){this.manGeometries[i].dispose()}this.manMaterial.dispose();this.remove(this.fbo.particles);this.fbo.particles.geometry.dispose();for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}console.log("dispose Miriam ani!")}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"updateMorphForFBO",value:function updateMorphForFBO(geo,speedUp){var morphPositions=this.initParticles(geo);var timerSpeed=8/((speedUp+12.5)/12.5);if(this.timerAnim!=null)this.timerAnim.kill();this.simulationShader.uniforms.morphPositions.value=morphPositions;if(!this.speedUpStart){this.timerAnim=TweenMax.fromTo(this.simulationShader.uniforms.timer,timerSpeed,{value:0},{value:.5,ease:Expo.easeIn})}else{this.timerAnim=TweenMax.fromTo(this.simulationShader.uniforms.timer,timerSpeed,{value:0},{value:.5})}}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("Miriam - do anim sequence ",this.nextAnim);this.nextAnim.anim();var index=this.sequenceConfig.indexOf(this.nextAnim);if(index>1&&index-2<this.manGeometries.length){this.updateMorphForFBO(this.manGeometries[index-2],0)}if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"update",value:function update(dt,et){if(this.speedUpStart)this.tl.timeScale(this.dummy.timeScaleValue);this.grandFatherClock.rotation.z=Math.sin(et*1e3/1e3)*(Math.PI/10);this.cGear.rotation.y+=.008;if(this.pointer1Time+1.2<et){this.myCP1.rotation.z+=.1;this.pointer1Time=et}if(this.pointer2Time+2<et){this.myCP2.rotation.z-=.1;this.pointer2Time=et}this.fbo.update()}}]);return MiriamAnimation}(THREE.Object3D);exports.default=MiriamAnimation},{"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/fbo":59,"../util/improved_noise":61,"../util/texture_animator":65}],11:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("../util/fbo");var _fbo2=_interopRequireDefault(_fbo);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var RamiAnimation=function(_THREE$Object3D){_inherits(RamiAnimation,_THREE$Object3D);function RamiAnimation(renderer,config){_classCallCheck(this,RamiAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(RamiAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/rami";_this.render_fs="#define GLSLIFY 1\nvarying vec3 vColor;\n\nvoid main() {\n  //gl_FragColor = vec4( vec3( 1., .5, .5 ), .85 );\n  //gl_FragColor = vec4( vColor, .85 );\n  gl_FragColor = vec4( 1., 1., 1., .85 );\n}\n";_this.render_vs="#define GLSLIFY 1\n//float texture containing the positions of each particle\nuniform sampler2D positions;\nattribute vec2 reference;\nvarying vec3 vColor;\n\n//size\nuniform float pointSize;\n\nvoid main() {\n\n    //the mesh is a nomrliazed square so the uvs = the xy positions of the vertices\n    vec3 pos = texture2D( positions, reference).xyz;\n\n    gl_Position = projectionMatrix *  modelViewMatrix * vec4( pos, 1.0 );\n\n    gl_PointSize = pointSize;\n\n}\n";_this.simulation_fs="#define GLSLIFY 1\nhighp float random_2_0(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_4_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_4_1(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_4_2(vec4 x) {\n     return mod289_4_1(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt_4_3(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_4_4(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D_4_5 = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_4_6 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_4_6;\n  vec3 i1 = min( g_4_6.xyz, l.zxy );\n  vec3 i2 = max( g_4_6.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D_4_5.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_4_1(i);\n  vec4 p = permute_4_2( permute_4_2( permute_4_2(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D_4_5.wyz - D_4_5.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1_4_7 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0_4_8 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1_4_7.xy,h.z);\n  vec3 p3 = vec3(a1_4_7.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt_4_3(vec4(dot(p0_4_8,p0_4_8), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0_4_8 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0_4_8,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n\n\n\nvec3 snoiseVec3_3_9( vec3 x ){\n\n  float s  = snoise_4_4(vec3( x ));\n  float s1 = snoise_4_4(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = snoise_4_4(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n\n}\n\n\nvec3 curlNoise_3_10( vec3 p ){\n  \n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3_3_9( p - dx );\n  vec3 p_x1 = snoiseVec3_3_9( p + dx );\n  vec3 p_y0 = snoiseVec3_3_9( p - dy );\n  vec3 p_y1 = snoiseVec3_3_9( p + dy );\n  vec3 p_z0 = snoiseVec3_3_9( p - dz );\n  vec3 p_z1 = snoiseVec3_3_9( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n\n}\n\n\n\nmat4 rotationMatrix_1_11(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                0.0,                                0.0,                                0.0,                                1.0);\n}\n\n\nuniform sampler2D positions;\nuniform sampler2D morphPositions;\nuniform float timer;\nuniform float maxDepth;\nuniform float amplitude;\nuniform float frequency;\nvarying vec2 vUv;\n\nvoid main() {\n    vec3 pos = texture2D( positions, vUv ).rgb;\n    vec3 morphPos = texture2D( morphPositions, vUv ).rgb;\n\n    if( timer<0.3 ){\n        pos = pos + (morphPos-pos) * timer;\n    }\n    \n    vec3 velocity = curlNoise_3_10( pos * frequency ) * amplitude;\n    pos = pos + velocity;\n    \n    gl_FragColor = vec4( pos, 1.0 );\n}\n";_this.simulation_vs="#define GLSLIFY 1\nvarying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, 1.0 - uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";_this.width=256;_this.height=256;_this.renderer=renderer;_this.maxDepth=50;return _this}_createClass(RamiAnimation,[{key:"initParticles",value:function initParticles(geo){this.peacock.matrixWorldNeedsUpdate=true;var fboGeo=geo.clone();fboGeo.applyMatrix((new THREE.Matrix4).makeScale(this.fboRefObj.scale.x,this.fboRefObj.scale.y,this.fboRefObj.scale.z));fboGeo.applyMatrix((new THREE.Matrix4).makeTranslation(this.fboRefObj.position.x,this.fboRefObj.position.y,this.fboRefObj.position.z));var data=new Float32Array(this.width*this.height*3);var points=THREE.GeometryUtils.indexedPointsInGeometry(fboGeo,this.width*this.height,this.indexArray);for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"initParticlesFirstEver",value:function initParticlesFirstEver(geo){this.peacock.matrixWorldNeedsUpdate=true;var fboGeo=geo.clone();fboGeo.applyMatrix((new THREE.Matrix4).makeScale(.1,.1,.1));fboGeo.applyMatrix((new THREE.Matrix4).makeTranslation(this.fboRefObj.position.x,this.fboRefObj.position.y,this.fboRefObj.position.z));var data=new Float32Array(this.width*this.height*3);var results=THREE.GeometryUtils.randomPointsAndIndexInGeometry(fboGeo,this.width*this.height);var points=results[0];this.indexArray=results[1];for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"init",value:function init(loadingManager){this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.animStart=false;this.sequenceConfig=[{time:2,anim:function anim(){_this2.peacockUp(6)}},{time:8,anim:function anim(){_this2.peacockTail(5)}},{time:23,anim:function anim(){_this2.peacockBack(5)}},{time:75,anim:function anim(){_this2.peacockOpen(5)}},{time:96,anim:function anim(){_this2.peacockBun(5)}},{time:137,anim:function anim(){_this2.peacockOpen(5)}},{time:170,anim:function anim(){_this2.peacockSwallow(5)}}];this.nextAnim=null;this.loadingManager.itemStart("RamiAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.disposeRelatedGeos=[];this.disposeRelatedTexs=[];var peacockTex=tex_loader.load(this.BASE_PATH+"/images/peacockB.jpg");peacockTex.wrapS=THREE.RepeatWrapping;peacockTex.wrapT=THREE.RepeatWrapping;peacockTex.repeat.set(1,2);this.disposeRelatedTexs.push(peacockTex);this.peacockMaterial=new THREE.MeshBasicMaterial({map:peacockTex,side:THREE.DoubleSide,wireframe:true,wireframeWidth:2,morphTargets:true,morphNormals:true});var peacockFiles=[];for(var _i=0;_i<5;_i++){var file=this.BASE_PATH+"/models/peafowl/p_"+_i+".json";peacockFiles.push(file)}this.peacockGeos={};this.tweenTransition=null;this.ramiLoadingManager=new THREE.LoadingManager;this.ramiLoadingManager.onLoad=function(){var peacockGeo=_this2.peacockGeos[4];for(var _i2=0;_i2<4;_i2++){peacockGeo.morphTargets.push({name:"p"+_i2,vertices:_this2.peacockGeos[_i2].vertices})}peacockGeo.computeMorphNormals();_this2.peacock=new THREE.Mesh(peacockGeo,_this2.peacockMaterial);_this2.peacock.position.set(.9,-5,-5);_this2.peacock.scale.multiplyScalar(.01);_this2.add(_this2.peacock);_this2.peacock.morphTargetInfluences[0]=1;_this2.fboRefObj=new THREE.Object3D;_this2.fboRefObj.scale.multiplyScalar(3);_this2.fboRefObj.position.set(.9,-5,-5);_this2.initFBOParticles()};this.loadPeacocks(peacockFiles);this.initSPEParticles();events.on("experience_end",function(){_this2.disposeAni()});this.loadingManager.itemEnd("RamiAnim")}},{key:"initFBOParticles",value:function initFBOParticles(){var positions=this.initParticlesFirstEver(this.peacockGeos[4]);var morphPositions=this.initParticles(this.peacockGeos[0]);this.rttIn=positions;this.simulationShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:positions},timer:{type:"f",value:0},maxDepth:{type:"f",value:this.maxDepth},morphPositions:{type:"t",value:morphPositions},maxDistance:{type:"f",value:50},amplitude:{type:"f",value:.001},frequency:{type:"f",value:.8}},vertexShader:this.simulation_vs,fragmentShader:this.simulation_fs});this.renderShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:null},pointSize:{type:"f",value:2}},vertexShader:this.render_vs,fragmentShader:this.render_fs,transparent:true,blending:THREE.AdditiveBlending});var particleGeometry=new THREE.Geometry;particleGeometry.vertices.push(new THREE.Vector3);this.fbo=new _fbo2.default;this.fbo.init(this.width,this.height,this.renderer,this.simulationShader,this.renderShader,particleGeometry);this.fbo.particles.frustumCulled=false;this.add(this.fbo.particles);this.fbo.particles.visible=false;console.log(this.simulationShader.uniforms.timer);this.timerAnim=null;this.fbo.update()}},{key:"loadPeacocks",value:function loadPeacocks(files){var _this3=this;var pLoader=new THREE.JSONLoader(this.ramiLoadingManager);var _loop=function _loop(i){pLoader.load(files[i],function(geometry){_this3.peacockGeos[i]=geometry;_this3.disposeRelatedGeos.push(geometry)})};for(var i=0;i<files.length;i++){_loop(i)}}},{key:"initSPEParticles",value:function initSPEParticles(){var p_tex_loader=new THREE.TextureLoader(this.loadingManager);var particleTex=p_tex_loader.load(this.BASE_PATH+"/images/feather_particle.jpg");this.particleEmitters=[];this.particleGroup=new SPE.Group({texture:{value:particleTex},maxParticleCount:1e3});var emitter=new SPE.Emitter({type:SPE.distributions.SPHERE,maxAge:{value:10,spread:2},position:{value:new THREE.Vector3(0,0,-4),radius:1},acceleration:{value:new THREE.Vector3(0,-.5,0)},velocity:{value:new THREE.Vector3(.3,-.3,.3)},rotation:{angle:.5},angle:{value:[0,.5,-.5],spread:[0,-1.5,1.5]},opacity:{value:[0,1,1,1,0]},size:{value:[.05,.15,.15,.15,.1]},particleCount:10,drag:.6,activeMultiplier:1});this.particleGroup.addEmitter(emitter);this.particleEmitters.push(emitter);this.add(this.particleGroup.mesh)}},{key:"doFirstAni",value:function doFirstAni(){console.log("do first animation.")}},{key:"peacockUp",value:function peacockUp(_duration){TweenMax.to(this.peacock.scale,_duration,{x:3,y:3,z:3,ease:Power1.easeInOut})}},{key:"peacockTail",value:function peacockTail(_duration){this.createTransition(_duration,[.8,0,0,0]);this.fbo.particles.visible=true;this.updateMorphForFBO(this.peacockGeos[0],_duration)}},{key:"peacockBack",value:function peacockBack(_duration){this.createMorph(_duration,[0,1,0,0]);this.createTransition(_duration,[.3,.8,0,0],2);this.updateMorphForFBO(this.peacockGeos[1],_duration)}},{key:"peacockOpen",value:function peacockOpen(_duration){this.createMorph(_duration,[0,0,1,0]);this.createTransition(_duration,[0,.2,.8,0]);this.updateMorphForFBO(this.peacockGeos[2],_duration)}},{key:"peacockBun",value:function peacockBun(_duration){this.createMorph(_duration,[0,0,0,1]);this.createTransition(_duration,[0,0,.2,.8]);this.updateMorphForFBO(this.peacockGeos[3],_duration)}},{key:"peacockSwallow",value:function peacockSwallow(_duration){this.createMorph(_duration,[0,0,0,0]);this.createTransition(_duration,[0,0,0,.2]);this.updateMorphForFBO(this.peacockGeos[4],_duration)}},{key:"createMorph",value:function createMorph(_duration,_array){TweenMax.to(this.peacock.morphTargetInfluences,_duration,{endArray:_array,ease:Power2.easeInOut})}},{key:"createTransition",value:function createTransition(_duration,toArray,extraTime){if(extraTime){TweenMax.to(this.peacock.morphTargetInfluences,_duration/2,{endArray:toArray,ease:Power1.easeNone,delay:_duration,repeat:3+2*extraTime,yoyo:true})}else{TweenMax.to(this.peacock.morphTargetInfluences,_duration/2,{endArray:toArray,ease:Power1.easeNone,delay:_duration,repeat:3,yoyo:true})}}},{key:"characterDisappear",value:function characterDisappear(){var _this4=this;TweenMax.to(this.parent.fullVideo.mesh.scale,1,{x:1e-5,y:1e-5,z:1e-5,ease:Back.easeInOut,onComplete:function onComplete(){_this4.parent.fullVideo.setOpacity(0)}})}},{key:"disposeAni",value:function disposeAni(){var _this5=this;this.remove(this.peacock);this.peacockMaterial.dispose();this.remove(this.fbo.particles);this.fbo.particles.geometry.dispose();this.remove(this.particleGroup.mesh);this.particleEmitters.forEach(function(e){_this5.particleGroup.removeEmitter(e)});this.particleGroup.dispose();for(var i=0;i<this.disposeRelatedGeos.length;i++){this.disposeRelatedGeos[i].dispose()}for(var i=0;i<this.disposeRelatedTexs.length;i++){this.disposeRelatedTexs[i].dispose()}console.log("dispose Rami ani!")}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"start",value:function start(){this.currentSequence=this.sequenceConfig.slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"updateMorphForFBO",value:function updateMorphForFBO(geo,_duration){var morphPositions=this.initParticles(geo);this.simulationShader.uniforms.morphPositions.value=morphPositions;TweenMax.fromTo(this.simulationShader.uniforms.timer,_duration,{value:0},{value:.3,ease:Power3.easeIn})}},{key:"updateMorphTransitionForFBO",value:function updateMorphTransitionForFBO(toGeo,_duration){var morphPositions=this.initParticles(toGeo);TweenMax.fromTo(this.simulationShader.uniforms.timer,_duration/4,{value:.3},{value:0,ease:Power0.easeNone,delay:_duration,repeat:3,yoyo:true})}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){if(this.particleGroup){this.particleGroup.tick(dt)}this.fbo.update()}}]);return RamiAnimation}(THREE.Object3D);exports.default=RamiAnimation},{"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/fbo":59,"../util/improved_noise":61,"../util/texture_animator":65}],12:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _improved_noise=require("../util/improved_noise");var _improved_noise2=_interopRequireDefault(_improved_noise);var _texture_animator=require("../util/texture_animator");var _texture_animator2=_interopRequireDefault(_texture_animator);var _GeometryUtils=require("../util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("../util/fbo");var _fbo2=_interopRequireDefault(_fbo);var _EndArrayPlugin=require("../util/EndArrayPlugin");var _EndArrayPlugin2=_interopRequireDefault(_EndArrayPlugin);var _debug=require("../util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}TweenPlugin.activate([_EndArrayPlugin2.default]);var ShirinAnimation=function(_THREE$Object3D){_inherits(ShirinAnimation,_THREE$Object3D);function ShirinAnimation(config){_classCallCheck(this,ShirinAnimation);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(ShirinAnimation).call(this));_this.config=config;_this.BASE_PATH=_this.config.assetsHost+"assets/animations/shirin";_this.initialized=false;return _this}_createClass(ShirinAnimation,[{key:"init",value:function init(loadingManager){this.callbackAfterLoaded=true;this.initialized=true;this.loadingManager=loadingManager;this.setupAnim()}},{key:"setupAnim",value:function setupAnim(){var _this2=this;this.animStart=false;this.sequenceConfig={Shirin7AM:[{time:5,anim:function anim(){_this2.crackCocoon(0)}},{time:8,anim:function anim(){_this2.stopFragment(0)}}],Shirin9AM:[{time:5,anim:function anim(){_this2.crackCocoon(4)}},{time:8,anim:function anim(){_this2.stopFragment(4)}}],Shirin12PM:[{time:5,anim:function anim(){_this2.crackCocoon(3)}},{time:8,anim:function anim(){_this2.stopFragment(3)}}],Shirin5PM:[{time:5,anim:function anim(){_this2.crackCocoon(1)}},{time:8,anim:function anim(){_this2.stopFragment(1)}}],Shirin7PM:[{time:1,anim:function anim(){_this2.crackCocoon(2)}},{time:3,anim:function anim(){_this2.showShirin()}},{time:77,anim:function anim(){_this2.closeCocoon(2)}},{time:80,anim:function anim(){_this2.stopFragment(2)}}]};this.nextAnim=null;this.tweenAnimCollectors=[];this.completeSequenceSetup();this.loadingManager.itemStart("ShirinAnim");this.perlin=new _improved_noise2.default;var tex_loader=new THREE.TextureLoader(this.loadingManager);var loader=new THREE.JSONLoader(this.loadingManager);this.lookupTable=[];for(var i=0;i<50;i++){this.lookupTable.push(Math.random())}this.benchHeight=-5;this.branchWebPos=new THREE.Vector3(0,18,-2);this.candyHeight=15;this.candyGroupPos=new THREE.Vector3(-12,0,0);this.cocoonGroupPos=new THREE.Vector3(0,25,0);this.cobwebGroupPos=new THREE.Vector3(14,10,0);this.smallShirinPos=new THREE.Vector3(.05,-.24,.64);var webTexture=tex_loader.load(this.BASE_PATH+"/images/web2.jpg");this.webMat=new THREE.MeshBasicMaterial({map:webTexture,transparent:true,opacity:.5,blending:THREE.AdditiveBlending});loader.load(this.BASE_PATH+"/models/branchWeb.json",function(geometry){_this2.branchWeb=new THREE.Mesh(geometry,_this2.webMat);_this2.branchWeb.scale.multiplyScalar(3);_this2.branchWeb.position.copy(_this2.branchWebPos);_this2.add(_this2.branchWeb)});this.candyGroup=new THREE.Object3D;this.candyTimeline=[];var candyTexture=tex_loader.load(this.BASE_PATH+"/images/candy_texture.jpeg");this.candyMats=[new THREE.MeshPhongMaterial({map:candyTexture,shininess:30}),new THREE.MeshPhongMaterial({map:candyTexture,shininess:30,color:65280}),new THREE.MeshPhongMaterial({map:candyTexture,shininess:30,color:65535})];loader.load(this.BASE_PATH+"/models/candy.json",function(geometry){var candyGeo=geometry;for(var _i=0;_i<20;_i++){var candyy=new THREE.Mesh(candyGeo,_this2.candyMats[_i%3]);candyy.scale.multiplyScalar(.01);candyy.position.set(Math.sin(Math.PI*2/10*_i)*3,10-10*_this2.lookupTable[_i]+_this2.candyHeight,Math.cos(Math.PI*2/10*_i)*3);candyy.rotation.set(_this2.lookupTable[_i],_this2.lookupTable[_i+1],_this2.lookupTable[_i+2]);_this2.candyGroup.add(candyy)}_this2.candyGroup.position.copy(_this2.candyGroupPos);_this2.add(_this2.candyGroup);_this2.createCandyAnimation()});var moonTexture=tex_loader.load(this.BASE_PATH+"/images/moon.jpg");var moonNRMTexture=tex_loader.load(this.BASE_PATH+"/images/moonNormal.jpg");var moonMat=new THREE.MeshPhongMaterial({map:moonTexture,normalMap:moonNRMTexture,emissive:1118481});this.moon=new THREE.Mesh(new THREE.SphereGeometry(10,32,32),moonMat);this.moon.rotation.set(Math.PI/2,Math.PI/2,Math.PI/2);this.moon.position.set(900,480,345);this.moon.scale.set(3.3,3.3,3.3);this.add(this.moon);var cocoonTexFiles=[this.BASE_PATH+"/images/seamless_circle.png",this.BASE_PATH+"/images/seamless_color_noise.jpg",this.BASE_PATH+"/images/seamless_curvy.jpg",this.BASE_PATH+"/images/seamless_graphic.jpg",this.BASE_PATH+"/images/seamless_pencil.jpg"];var cocoonTextures=[];var grassTex=tex_loader.load(this.BASE_PATH+"/images/grasslight-thin.jpg");this.cocoonMaterials=[];for(var _i2=0;_i2<cocoonTexFiles.length;_i2++){cocoonTextures[_i2]=tex_loader.load(cocoonTexFiles[_i2]);this.cocoonMaterials[_i2]=new THREE.MeshPhongMaterial({map:cocoonTextures[_i2],specular:275469,shininess:77,specularMap:grassTex,side:THREE.DoubleSide,morphTargets:true,morphNormals:true})}var cocoonFiles=[],cocoonCrackFiles=[],caterpillarFiles=[];this.cocoonGeos={};this.cocoonCrackGeos={};this.caterpillarGeos={};this.cocoonGroup=new THREE.Object3D;this.cocoonAnimation=[];this.caterpillarGroup=[];this.cobwebGeos=[];this.cobwebGroup=new THREE.Object3D;this.cobwebPos=[];for(var _i3=1;_i3<=5;_i3++){var f_1=this.BASE_PATH+"/models/cocoon/cocoon_"+_i3+".json";var f_2=this.BASE_PATH+"/models/cocoon/cocoon_"+_i3+"_O.json";var f_3=this.BASE_PATH+"/models/cocoon/ca_"+_i3+".json";cocoonFiles.push(f_1);cocoonCrackFiles.push(f_2);caterpillarFiles.push(f_3)}this.shirinLoadingManager=new THREE.LoadingManager;this.shirinLoadingManager.onLoad=function(){var cocoonLength=Object.keys(_this2.cocoonGeos).length;for(var _i4=0;_i4<cocoonLength;_i4++){var cocoonGeo=_this2.cocoonGeos[_i4].clone();cocoonGeo.morphTargets.push({name:"c1",vertices:_this2.cocoonCrackGeos[_i4].vertices});cocoonGeo.computeMorphNormals();var cocooonnn=new THREE.Mesh(cocoonGeo,_this2.cocoonMaterials[_i4]);cocooonnn.position.x=(_i4-2)*2.5;_this2.cocoonGroup.add(cocooonnn)}_this2.cocoonGroup.scale.multiplyScalar(5);_this2.cocoonGroup.position.copy(_this2.cocoonGroupPos);_this2.add(_this2.cocoonGroup);for(var i=0;i<_this2.cocoonGroup.children.length;i++){if(i==2){_this2.cocoonGroup.children[i].rotation.x=233*Math.PI/180;_this2.cocoonGroup.children[i].rotation.y=14*Math.PI/180;_this2.cocoonGroup.children[i].position.set(.02,-9.48,-1.82);_this2.cocoonGroup.children[i].scale.set(1.55,1.55,1.55)}else{_this2.cocoonGroup.children[i].visible=false}}_this2.initSPEParticles(tex_loader);var caterMat=new THREE.MeshPhongMaterial({color:94222,specular:5571074,shininess:50,morphTargets:true,morphNormals:true});var stringGeo=new THREE.BoxGeometry(.07,50,.07);_this2.transY(stringGeo,23);var stringMat=new THREE.MeshPhongMaterial({color:5571074});for(var _i5=0;_i5<10;_i5++){var caterGeo=_this2.cocoonGeos[_i5%5].clone();caterGeo.morphTargets.push({name:"c1",vertices:_this2.caterpillarGeos[_i5%5].vertices});caterGeo.computeMorphNormals();var caterpillaaa=new THREE.Mesh(caterGeo,caterMat.clone());caterpillaaa.scale.multiplyScalar(.01);caterpillaaa.position.set(Math.sin(Math.PI*2/10*_i5)*5,10-10*Math.random()+50,Math.cos(Math.PI*2/10*_i5)*5);caterpillaaa.rotation.y=_this2.lookupTable[_i5];var string=new THREE.Mesh(stringGeo,stringMat);caterpillaaa.add(string);_this2.add(caterpillaaa);_this2.caterpillarGroup.push(caterpillaaa);var cobwebb=new THREE.Mesh(_this2.cobwebGeos[_i5%5],_this2.webMat);cobwebb.scale.multiplyScalar(.01);_this2.cobwebPos.push(new THREE.Vector3(Math.sin(Math.PI*2/10*_i5)*7,10-10*Math.random(),Math.cos(Math.PI*2/10*_i5)*7));cobwebb.rotation.y=_this2.lookupTable[_i5];_this2.cobwebGroup.add(cobwebb)}_this2.cobwebGroup.position.copy(_this2.cobwebGroupPos);_this2.add(_this2.cobwebGroup);_this2.cobwebsScale=[new THREE.Vector3(.5,3,7),new THREE.Vector3(6,3,.5),new THREE.Vector3(1.2,3,7),new THREE.Vector3(5.4,2.6,.5),new THREE.Vector3(3.7,2.7,1)]};this.loadcocoon(cocoonFiles,cocoonCrackFiles,caterpillarFiles);
this.loadingManager.itemEnd("ShirinAnim")}},{key:"initSPEParticles",value:function initSPEParticles(_tex_loader){this.particleGroup=new SPE.Group({texture:{value:_tex_loader.load(this.BASE_PATH+"/images/fragments.png"),frames:new THREE.Vector2(3,3),frameCount:9,loop:5},maxParticleCount:2e3});for(var i=0;i<this.cocoonGroup.children.length;i++){var particlePosition=this.cocoonGroup.children[i].position.clone();particlePosition.multiplyScalar(5);particlePosition.y=this.cocoonGroup.position.y-6;var emitter=new SPE.Emitter({type:SPE.distributions.BOX,maxAge:{value:7,spread:2},position:{value:particlePosition,spread:new THREE.Vector3(4,0,3)},acceleration:{value:new THREE.Vector3(0,-2,0),spread:new THREE.Vector3(.1,1,.1)},opacity:{value:[0,1,1,1,0]},size:{value:[.02,.3,.3,.3,.2],spread:.5},particleCount:120});emitter.activeMultiplier=.5;emitter.disable();this.particleGroup.addEmitter(emitter)}this.add(this.particleGroup.mesh)}},{key:"loadcocoon",value:function loadcocoon(files,files2,files3){var _this3=this;var cocoonLoader=new THREE.JSONLoader(this.shirinLoadingManager);var _loop=function _loop(i){cocoonLoader.load(files[i],function(geometry){_this3.cocoonGeos[i]=geometry;_this3.cobwebGeos[i]=geometry.clone()})};for(var i=0;i<files.length;i++){_loop(i)}var _loop2=function _loop2(_i6){cocoonLoader.load(files2[_i6],function(geometry){_this3.cocoonCrackGeos[_i6]=geometry})};for(var _i6=0;_i6<files2.length;_i6++){_loop2(_i6)}var _loop3=function _loop3(_i7){cocoonLoader.load(files3[_i7],function(geometry){_this3.caterpillarGeos[_i7]=geometry})};for(var _i7=0;_i7<files3.length;_i7++){_loop3(_i7)}}},{key:"clamp",value:function clamp(num,min,max){return Math.min(Math.max(num,min),max)}},{key:"completeSequenceSetup",value:function completeSequenceSetup(){for(var i=0;i<this.sequenceConfig.length;i++){this.sequenceConfig[i].performed=false}}},{key:"pauseVideo",value:function pauseVideo(){var _this4=this;this.parent.fullVideo.mesh.position.y+=2;this.parent.fullVideo.wire.position.y+=2;setTimeout(function(){_this4.crackCocoon(0);_this4.parent.fullVideo.mesh.position.y-=2;_this4.parent.fullVideo.wire.position.y-=2},5e3);setTimeout(function(){_this4.stopFragment(0)},8e3)}},{key:"closeCocoon",value:function closeCocoon(index){var _this5=this;this.particleGroup.emitters[index].activeMultiplier=1;var newEPos=this.particleGroup.emitters[2].position.value;newEPos.y-=9;newEPos.z+=18;this.particleGroup.emitters[2].position.value=newEPos;setTimeout(function(_index){_this5.resetFragment(_index);var newEPos2=_this5.particleGroup.emitters[2].position.value;newEPos2.y+=9;newEPos2.z-=18;_this5.particleGroup.emitters[2].position.value=newEPos2},3e3,index);var crackTween=TweenMax.to(this.cocoonGroup.children[index].morphTargetInfluences,3,{delay:1,endArray:[0],ease:RoughEase.ease.config({template:Power0.easeNone,strength:1,points:20,taper:"none",randomize:true,clamp:false})});this.tweenAnimCollectors.push(crackTween);TweenMax.to(this.parent.fullVideo.mesh.position,2,{x:this.smallShirinPos.x,y:this.smallShirinPos.y,z:this.smallShirinPos.z,delay:2.5});TweenMax.to(this.parent.fullVideo.wire.position,2,{x:this.smallShirinPos.x,y:this.smallShirinPos.y,z:this.smallShirinPos.z,delay:2.5});TweenMax.to(this.parent.fullVideo.mesh.scale,2,{x:this.oriShirinScale*.01,y:this.oriShirinScale*.01,z:this.oriShirinScale*.01,delay:2.5});TweenMax.to(this.parent.fullVideo.wire.scale,2,{x:this.oriShirinScale*.01,y:this.oriShirinScale*.01,z:this.oriShirinScale*.01,delay:2.5})}},{key:"crackCocoon",value:function crackCocoon(index){this.dropFragment(index);var crackTween=TweenMax.to(this.cocoonGroup.children[index].morphTargetInfluences,2,{delay:1,endArray:[1],ease:RoughEase.ease.config({template:Power0.easeNone,strength:1,points:20,taper:"none",randomize:true,clamp:false})});this.tweenAnimCollectors.push(crackTween);switch(index){case 0:break;case 1:this.dropCandy(true);break;case 2:this.dropCaterpillars();break;case 3:this.dropCobwebs();break;case 3:break}}},{key:"dropFragment",value:function dropFragment(f_i){var _this6=this;this.particleGroup.emitters[f_i].enable();this.particleGroup.emitters[f_i].activeMultiplier=2;setTimeout(function(index){_this6.resetFragment(index);var newEPos=_this6.particleGroup.emitters[2].position.value;newEPos.y+=9;newEPos.z-=18;_this6.particleGroup.emitters[2].position.value=newEPos},3e3,f_i)}},{key:"stopFragment",value:function stopFragment(f_i){this.particleGroup.emitters[f_i].disable()}},{key:"resetFragment",value:function resetFragment(index){this.particleGroup.emitters[index].activeMultiplier=.5}},{key:"dropCaterpillars",value:function dropCaterpillars(){var _this7=this;var _loop4=function _loop4(i){var c_t_pos=TweenMax.to(_this7.caterpillarGroup[i].position,4,{y:"-=50",ease:Bounce.easeOut,delay:_this7.lookupTable[i]*2,onStart:function onStart(){var c_t_scale=TweenMax.to(_this7.caterpillarGroup[i].scale,.2,{x:.5,y:.5,z:.5});_this7.tweenAnimCollectors.push(c_t_scale)},onComplete:function onComplete(){var c_t_morph=TweenMax.to(_this7.caterpillarGroup[i].morphTargetInfluences,.5,{endArray:[1],yoyo:true,repeat:-1});_this7.tweenAnimCollectors.push(c_t_morph)}});_this7.tweenAnimCollectors.push(c_t_pos)};for(var i=0;i<this.caterpillarGroup.length;i++){_loop4(i)}}},{key:"dropCobwebs",value:function dropCobwebs(){var _this8=this;var _loop5=function _loop5(i){var cw_posTween=TweenMax.to(_this8.cobwebGroup.children[i].position,3,{x:_this8.cobwebPos[i].x,y:_this8.cobwebPos[i].y,z:_this8.cobwebPos[i].z,ease:Power1.easeInOut,delay:_this8.lookupTable[i]*2,onStart:function onStart(){var cw_scaleTween=TweenMax.to(_this8.cobwebGroup.children[i].scale,.2,{x:_this8.cobwebsScale[i%5].x,y:_this8.cobwebsScale[i%5].y,z:_this8.cobwebsScale[i%5].z});_this8.tweenAnimCollectors.push(cw_scaleTween)},onComplete:function onComplete(){var cw_rotTween=void 0;if(i%2==0){cw_rotTween=TweenMax.to(_this8.cobwebGroup.children[i].rotation,4,{x:"+=0.3",y:"+=1",ease:Power1.easeInOut,yoyo:true,repeat:-1})}else{cw_rotTween=TweenMax.to(_this8.cobwebGroup.children[i].rotation,4,{z:"-=0.3",y:"-=1",ease:Power1.easeInOut,yoyo:true,repeat:-1})}_this8.tweenAnimCollectors.push(cw_rotTween)}});_this8.tweenAnimCollectors.push(cw_posTween)};for(var i=0;i<this.cobwebGroup.children.length;i++){_loop5(i)}}},{key:"createCandyAnimation",value:function createCandyAnimation(){var _this9=this;var _loop6=function _loop6(i){var tl=new TimelineMax({delay:_this9.lookupTable[i]*2});var origianlPos=_this9.candyGroup.children[i].position;tl.add(TweenMax.to(_this9.candyGroup.children[i].position,1.5,{y:_this9.benchHeight,ease:Expo.easeIn,onStart:function onStart(){TweenMax.to(_this9.candyGroup.children[i].scale,.2,{x:1,y:1,z:1})}}));tl.add(TweenMax.to(_this9.candyGroup.children[i].position,.2,{y:"+=3",ease:Power1.easeOut}));tl.add(TweenMax.to(_this9.candyGroup.children[i].position,1,{y:"-=20",ease:Power1.easeIn}));tl.add(TweenMax.to(_this9.candyGroup.children[i].scale,.1,{x:.01,y:.01,z:.01}));tl.add(TweenMax.to(_this9.candyGroup.children[i].position,.1,{x:origianlPos.x,y:origianlPos.y,z:origianlPos.z}));tl.pause();_this9.candyTimeline.push(tl)};for(var i=0;i<this.candyGroup.children.length;i++){_loop6(i)}}},{key:"dropCandy",value:function dropCandy(firstTime){for(var i=0;i<this.candyTimeline.length;i++){if(firstTime)this.candyTimeline[i].play();else this.candyTimeline[i].restart(true)}}},{key:"dropShirin",value:function dropShirin(){var _this10=this;TweenMax.to(this.parent.fullVideo.mesh.position,1.5,{ease:Bounce.easeOut,y:"-=2"});TweenMax.to(this.parent.fullVideo.wire.position,1.5,{ease:Bounce.easeOut,y:"-=2"});TweenMax.to(this.parent.fullVideo.mesh.scale,2,{x:this.oriShirinScale,y:this.oriShirinScale,z:this.oriShirinScale});TweenMax.to(this.parent.fullVideo.wire.scale,2,{x:this.oriShirinScale,y:this.oriShirinScale,z:this.oriShirinScale,onComplete:function onComplete(){_this10.parent.fullVideo.play()}})}},{key:"showShirin",value:function showShirin(){var _this11=this;TweenMax.to(this.parent.fullVideo.mesh.position,3,{x:this.oriShirinPos.x,y:this.oriShirinPos.y,z:this.oriShirinPos.z});TweenMax.to(this.parent.fullVideo.wire.position,3,{x:this.oriShirinPos.x,y:this.oriShirinPos.y,z:this.oriShirinPos.z});TweenMax.to(this.parent.fullVideo.mesh.scale,3,{x:this.oriShirinScale,y:this.oriShirinScale,z:this.oriShirinScale});TweenMax.to(this.parent.fullVideo.wire.scale,3,{x:this.oriShirinScale,y:this.oriShirinScale,z:this.oriShirinScale,onComplete:function onComplete(){_this11.parent.fullVideo.play()}})}},{key:"transX",value:function transX(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].x+=n}}},{key:"transZ",value:function transZ(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].z+=n}}},{key:"transY",value:function transY(geo,n){for(var i=0;i<geo.vertices.length;i++){geo.vertices[i].y+=n}}},{key:"afterLoaded",value:function afterLoaded(){}},{key:"start",value:function start(time){this.reset(time);console.log("Shirin animation starting with ",time);this.currentSequence=this.sequenceConfig[time].slice(0);this.nextAnim=this.currentSequence.shift()}},{key:"reset",value:function reset(time){for(var _i8=0;_i8<this.tweenAnimCollectors.length;_i8++){this.tweenAnimCollectors[_i8].kill()}this.tweenAnimCollectors=[];for(var _i9=0;_i9<this.cocoonGroup.children.length;_i9++){this.cocoonGroup.children[_i9].morphTargetInfluences[0]=0}if(time=="Shirin7PM"){var newEPos=this.particleGroup.emitters[2].position.value;newEPos.y-=37;newEPos.z+=18;this.particleGroup.emitters[2].position.value=newEPos;this.particleGroup.emitters[2].acceleration.value=new THREE.Vector3(0,.7,0);this.particleGroup.emitters[2].acceleration.spread=new THREE.Vector3(.8,1,.8);this.oriShirinScale=this.parent.fullVideo.mesh.scale.x;this.parent.fullVideo.setScale(this.oriShirinScale*.01);this.parent.fullVideo.pause();this.oriShirinPos=this.parent.fullVideo.mesh.position.clone();this.parent.fullVideo.mesh.position.copy(this.smallShirinPos);this.parent.fullVideo.wire.position.copy(this.smallShirinPos)}else{for(var i=0;i<this.cocoonGroup.children.length;i++){this.cocoonGroup.children[i].visible=true}}}},{key:"updateVideoTime",value:function updateVideoTime(time){if(this.nextAnim&&time>=this.nextAnim.time){console.log("do anim sequence ",this.nextAnim);this.nextAnim.anim();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null}}}},{key:"update",value:function update(dt,et){this.particleGroup.tick(dt)}}]);return ShirinAnimation}(THREE.Object3D);exports.default=ShirinAnimation},{"../util/EndArrayPlugin":55,"../util/GeometryUtils":56,"../util/debug":58,"../util/fbo":59,"../util/improved_noise":61,"../util/texture_animator":65}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ref;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}exports.default=[{name:"ep.1: awakeness",hour:7,timeLimitMinutes:10,totalTime:330,titlePosition:[-1.05,.4,.09],insideTitlePosition:[10.22,-1.06,-4.44],insideTitlePositionLineTwo:[-5.57,-3.65,-2.18],sunLoaderRotation:[144,46,0],characters:["Meir","Rami"],extraAssets:[{name:"junkie",position:[2.24,23.9,10.32],rotation:[182,335,0],scale:.365},{name:"pocketCam",position:[-5.4,21.2,10],rotation:[0,81,0],scale:.29},{name:"cart",position:[-6.2,22.7,28.02],rotation:[193,31,0],scale:.411},{name:"dadOnBike",position:[11.22,21.2,11.22],rotation:[0,251,0],scale:.45}],effects:[{name:""}]},{name:"ep.2: home",hour:9,timeLimitMinutes:13,totalTime:540,titlePosition:[-.75,.55,.125],insideTitlePosition:[2.33,-3.65,.37],insideTitlePositionLineTwo:[-4.44,-1.96,.07],sunLoaderRotation:[75,14,0],characters:["Miriam","Itzik","FatmanSleep"],introfile:["Miryam","Itzik"],extraAssets:[(_ref={fileName:"Jacob",position:[0,0,0]},_defineProperty(_ref,"fileName","Jacobcloths"),_defineProperty(_ref,"position",[0,0,0]),_ref),{name:"oldmansit",position:[-12.93,23.2,3.79],rotation:[178,129,0],scale:.371},{name:"sweetLady",position:[-7.03,21.5,4.66],rotation:[0,15,0],scale:.31},{name:"grandpa",position:[9.42,21.2,12.11],rotation:[360,93,0],scale:.54},{name:"grandma",position:[8.52,21.2,9.42],rotation:[0,360,0],scale:.233},{name:"firstcouple",position:[-10.62,21.2,.16],rotation:[0,201,0],scale:.35},{name:"AnlenGrandma",position:[-1.35,21.2,17],rotation:[0,77,0],scale:.19}],effects:[{name:""}]},{name:"ep. 3 : emptiness",hour:12,timeLimitMinutes:8,totalTime:590,titlePosition:[.01,.97,-.03],insideTitlePosition:[.07,-1.96,-1.06],insideTitlePositionLineTwo:[-8.95,4.81,-6.69],sunLoaderRotation:[95,172,0],characters:["Mark","LupoDogs12PM","Lupo12PM","Sasha","FatmanShower"],introfile:["Mark","Lupo1"],extraAssets:[{name:"100_",position:[20.83,21.2,1.06],rotation:[0,294,0],scale:.233},{name:"dude",position:[-15.56,21.3,2.86],rotation:[0,102,0],scale:.323},{name:"twoNiceJewishMen",position:[13.64,23.65,11.85],rotation:[184,47,342],scale:.43},{name:"kadafi",position:[-7.93,24.25,6.45],rotation:[177,144,0],scale:.372},{name:"BlackGuy",position:[12.03,21.37,3.806],rotation:[0,225,0],scale:.43}],effects:[{name:"lensflare"}]},{name:"Ep.4: disappointments",hour:17,titlePosition:[.67,.57,.109],totalTime:500,insideTitlePosition:[0,5.5,0],insideTitlePositionLineTwo:[0,-4,0],sunLoaderRotation:[230,50,0],timeLimitMinutes:12,characters:["Hannah","Haim"],introfile:["Hanna","Lupo2"],extraAssets:[{name:"bridegroom",position:[1.22,21.15,8.1],rotation:[0,278,0],scale:.348},{name:"yukalele",position:[15.44,21.2,13.64],rotation:[0,144,0],scale:.322},{name:"bikeHottie",position:[-9.72,21.2,15.72],rotation:[0,19,0],scale:.44},{name:"mom",position:[6.17,21.2,7.81],rotation:[0,80,0],scale:.542},{name:"coolPair",position:[-11.94,21.4,5.42],rotation:[0,0,0],scale:.404}],effects:[{name:""}]},{name:"ep.5: loneliness",hour:19,timeLimitMinutes:12,totalTime:610,titlePosition:[.75,.37,.094],insideTitlePosition:[0,5.5,0],insideTitlePositionLineTwo:[0,-4,0],sunLoaderRotation:[0,148,0],characters:["Lupo5PM","LupoDogs5PM","Itzhak"],extraAssets:[{name:"manOnBench",position:[13.1,21.3,-6],rotation:[0,186,0],scale:.3},{name:"blueLady",position:[-5.73,21.5,12.29],rotation:[0,170,0],scale:.304},{name:"Gyno",position:[-8.88,24.07,5.42],rotation:[186,138,18],scale:.374},{name:"cat",position:[8,22.15,5],rotation:[353,152,0],scale:.439},{name:"DAN",position:[13.1,23.8,9.51],rotation:[174,25,0],scale:.33}],effects:[{name:"buildinglights"}]},{name:"ep.6: night",hour:0,timeLimitMinutes:4,totalTime:0,titlePosition:[0,-30,0],insideTitlePosition:[0,-1,0],characters:["Shirin7PM"],extraAssets:[{fileName:"lightstreets",position:[0,0,0]}]}]},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"פרק 1. התעוררות",hour:7},{name:"פרק 2. בית",hour:9},{name:"פרק 3. ריקנות",hour:12},{name:"פרק 4. אכזבות",hour:17},{name:"פרק 5. בדידות",hour:19},{name:"פרק 6. לילה",hour:0}]},{}],15:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _video_rgbd=require("./util/video_rgbd");var _video_rgbd2=_interopRequireDefault(_video_rgbd);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Character=function(_THREE$Object3D){_inherits(Character,_THREE$Object3D);function Character(config,props,collisionManager,soundManager,scene){_classCallCheck(this,Character);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Character).call(this));_this.collisionManager=collisionManager;_this.soundManager=soundManager;_this.config=config;_this.inControl=false;_this.debug=true;_this.inShow=false;_this.scene=scene;if(config.assetsHost){props.basePath=config.assetsHost+props.basePath}console.log("Character base path",props.basePath);if(!props.fullOnly){_this.idleVideo=new _video_rgbd2.default({mindepth:props.mindepth,maxdepth:props.maxdepth,fileName:props.basePath+"_idle.webm",uvdy:props.uvdy_idle?props.uvdy_idle:props.uvdy,uvdx:props.uvdx_idle?props.uvdx_idle:props.uvdx,scale:props.scale,width:props.width,height:props.height,volume:props.event?1:0,fps:props.event?25:15})}if(!props.idleOnly){_this.fullVideo=new _video_rgbd2.default({mindepth:props.mindepth,maxdepth:props.maxdepth,fileName:props.basePath+"_full.webm",uvdy:props.uvdy,uvdx:props.uvdx,scale:props.scale,volume:props.volume,width:props.width,height:props.height,fps:25})}console.log(props.name+" character constructed!");_this.props=props;_this.playingFull=false;_this.isPaused=false;_this.done=false;_this.active=false;_this.onHold=false;_this.playedIntro=false;_this.subtitlesReady=false;_this.fullReady=false;_this.audioReady=false;_this.ambientReady=false;_this.nextAdjustment=null;_this.lastAdjustment=null;_this.adjustments=null;_this.colliding=false;_this.audio=null;_this.ambientAudio=null;return _this}_createClass(Character,[{key:"init",value:function init(loadingManager){var _this2=this;this.position.fromArray(this.props.position);this.rotation.set(this.props.rotation[0]*Math.PI/180,this.props.rotation[1]*Math.PI/180,this.props.rotation[2]*Math.PI/180);if(this.animation){if(!this.animation.initialized){this.animation.init(loadingManager);this.animation.initialized=true}if(!this.props.fullOnly){this.animation.visible=false}else{console.log(this.props.name,"Showing animation");this.animation.visible=true}}else{this.animation=null}events.on("chapter_sound_playing",function(isIt){if(isIt&&_this2.props.name!="FatmanShower"&&_this2.props.name!="FatmanSleep"){_this2.hold(false)}else{_this2.unhold()}});events.on("character_playing",function(name){if(_this2.idleException(name)){return}if(_this2.props.name!=name&&_this2.props.name!="FatmanShower"&&_this2.props.name!="FatmanSleep"){_this2.hold(true)}});events.on("character_idle",function(name){if(_this2.idleException(name)){return}if(_this2.props.name!=name){_this2.unhold()}});events.on("control_threshold",function(){_this2.inControl=true;setTimeout(function(){if(_this2.onHold&&_this2.active&&!_this2.inShow){if(!_this2.props.fullOnly){_this2.idleVideo.setOpacity(1);_this2.idleVideo.play()}_this2.onHold=false}},500)});events.on("show_start",function(){_this2.inShow=true});events.on("show_end",function(){_this2.inShow=false});if(this.props.event){events.on("square_rotating",function(){_this2.updateAudioPosition()})}}},{key:"idleException",value:function idleException(name){if(name=="Lupo5PM"&&this.props.name=="LupoDogs5PM"||name=="Lupo12PM"&&this.props.name=="LupoDogs12PM"||name=="Agam12PM"&&this.props.name=="FatmanSleep"){return true}else{return false}}},{key:"hold",value:function hold(freeze){if(this.active&&!this.done&&!this.ending){this.onHold=true;console.log(this.props.name,"is pausing");if(!this.props.fullOnly){if(freeze){this.idleVideo.pause()}this.idleVideo.setOpacity(.5)}}}},{key:"unhold",value:function unhold(){if(this.active&&this.onHold&&!this.done&&!this.ending){this.onHold=false;console.log(name," is idle.",this.props.name,"is playing");if(!this.props.fullOnly){this.idleVideo.setOpacity(1);this.idleVideo.play()}}}},{key:"play",value:function play(){var _this3=this;if((!this.done||this.ending)&&!this.props.fullOnly){console.log(this.props.name+" Play idle video");this.idleVideo.load();this.idleVideo.setVisible(true);if(this.inControl){this.idleVideo.play()}else{this.idleVideo.play();setTimeout(function(){console.log(_this3.props.name+" Character video idle pausing because in intro");_this3.onHold=true;_this3.idleVideo.pause();_this3.idleVideo.setOpacity(.5)},7e3)}if(this.ending){(function(){var fade={opacity:0};_this3.idleVideo.setOpacity(fade.opacity);TweenMax.to(fade,1,{opacity:1,onComplete:function onComplete(){_this3.idleVideo.pause()},onUpdate:function onUpdate(){_this3.idleVideo.setOpacity(fade.opacity)}})})()}if(this.props.event){if(this.animation){this.animation.visible=true}this.loadAudio().then(function(){_this3.soundManager.panorama.append(_this3.audio);_this3.audio.play()});setTimeout(function(){events.emit("character_playing",_this3.props.name)},5e3);this.idleVideo.video.loop=false;this.idleVideo.video.addEventListener("ended",function(){console.log(_this3.props.name,"Character video ended");_this3.idleVideo.pause();_this3.idleVideo.unload();_this3.soundManager.panorama.detach(_this3.audio);_this3.audio.stop();_this3.audio.unload();_this3.remove(_this3.idleVideo.mesh);if(_this3.idleVideo.wire){_this3.remove(_this3.idleVideo.wire)}if(_this3.animation){_this3.remove(_this3.animation)}_this3.done=true;events.emit("character_idle",_this3.props.name);events.emit("character_ended",_this3.props.name)});this.idleVideo.video.addEventListener("timeupdate",function(){if(_this3.animation){_this3.animation.updateVideoTime(_this3.idleVideo.video.currentTime)}},false)}}}},{key:"load",value:function load(ending){var _this4=this;console.log("Character "+this.props.name+": Load");this.ending=ending;var withWire=this.ending?false:true;if(!this.done||ending){if(this.props.adjustments){this.adjustments=this.props.adjustments.slice(0);this.nextAdjustment=this.adjustments.shift()}if(!this.props.fullOnly){this.idleVideo.init(withWire);this.idleVideo.video.loop=true;this.add(this.idleVideo.mesh);if(this.idleVideo.wire){this.add(this.idleVideo.wire)}if(this.ending){this.idleVideo.multiplyScale(this.props.endingScaleMul)}}if(!this.props.idleOnly&&!this.ending){this.fullVideo.init();this.fullVideo.mesh.visible=false;this.fullVideo.wire.visible=false;console.log(this.props.name,"Adding video mesh ",this.fullVideo.video);this.add(this.fullVideo.mesh);this.add(this.fullVideo.wire);this.fullVideo.video.addEventListener("timeupdate",function(){if(_this4.playingFull){if(_this4.animation){_this4.animation.updateVideoTime(_this4.fullVideo.video.currentTime)}if(_this4.nextAdjustment&&_this4.fullVideo.video.currentTime>=_this4.nextAdjustment.sec){_this4.adjust()}events.emit("character_progress",{name:_this4.props.name,time:_this4.fullVideo.video.currentTime})}},false);this.fullVideo.video.addEventListener("ended",function(){console.log("Character video ended");_this4.endFull()},false);this.fullVideo.video.loop=false}if(this.animation){this.add(this.animation);if(this.animation.callbackAfterLoaded)this.animation.afterLoaded();this.animation.scale.set(this.props.animationScale,this.props.animationScale,this.props.animationScale);this.animation.position.fromArray(this.props.animationPosition);this.animation.rotation.set(this.props.animationRotation[0]*Math.PI/180,this.props.animationRotation[1]*Math.PI/180,this.props.animationRotation[2]*Math.PI/180);if(!this.props.fullOnly){this.animation.visible=false}}}if(ending){this.position.fromArray(this.props.endingPosition);this.rotation.set(this.props.endingRotation[0]*Math.PI/180,this.props.endingRotation[1]*Math.PI/180,this.props.endingRotation[2]*Math.PI/180)}this.active=true;this.onHold=false;1}},{key:"unload",value:function unload(){console.log("Character "+this.props.name+" Unload");if(!this.done){if(this.fullVideo){this.fullVideo.unload()}if(this.idleVideo){this.idleVideo.unload()}if(this.subtitlesVideo){this.subtitlesVideo.src=""}if(this.audio){this.soundManager.panorama.detach(this.audio);this.audio.stop();this.audio.unload()}if(this.ambientAudio&&this.props.hasAmbience){this.ambientAudio.stop();this.ambientAudio.unload()}if(this.animation){if(this.animation.envLightChanged){this.animation.skyLightBack()}}}this.active=false;this.isPaused=false;this.playingFull=false;this.subtitlesReady=false;this.audioReady=false;this.ambientReady=false;this.fullReady=false;this.nextAdjustment=null;this.lastAdjustment=null;this.adjustments=null;this.colliding=false;if(this.props.adjustments){this.attach(this.animation,this.scene,this)}}},{key:"update",value:function update(dt,et){if(!this.done||this.ending){if(!this.playingFull&&!this.props.fullOnly){this.idleVideo.update(dt)}else if(this.playingFull){this.fullVideo.update(dt);if(this.timeSinceCollision>2){console.log("Time since collision ",this.timeSinceCollision,"Ending sequence");this.pauseFull()}}}if(this.animation&&this.animation.visible){this.animation.update(dt,et)}this.timeSinceCollision+=dt}},{key:"endFull",value:function endFull(){console.log(this.props.name,"Video end full");this.fullVideo.pause();this.fullVideo.unload();this.soundManager.panorama.detach(this.audio);this.audio.stop();this.audio.unload();if(this.props.hasAmbience){this.ambientAudio.stop();this.ambientAudio.unload()}if(!this.props.fullOnly){this.idleVideo.pause();this.idleVideo.unload();this.remove(this.idleVideo.mesh);if(this.idleVideo.wire){this.add(this.idleVideo.wire)}}this.remove(this.fullVideo.mesh);if(this.fullVideo.wire){this.remove(this.fullVideo.wire)}if(this.props.event){this.remove(this.animation)}this.playingFull=false;if(this.props.subtitles){this.subtitlesVideo.src=""}this.isPaused=false;this.done=true;events.emit("character_idle",this.props.name);events.emit("character_ended",this.props.name)}},{key:"pauseFull",value:function pauseFull(){console.log(this.props.name,"Video pause full");if(!this.props.fullOnly){if(this.animation){this.animation.visible=false}this.idleVideo.setVisible(true);this.idleVideo.play()}this.fullVideo.pause();if(this.audio){this.audio.pause()}if(this.ambientAudio&&this.props.hasAmbience){this.ambientAudio.pause()}this.fullVideo.setVisible(false);this.playingFull=false;if(this.props.subtitles){this.subtitlesVideo.pause();this.subtitlesVideo.style.display="none"}this.isPaused=true;events.emit("character_idle",this.props.name);if(this.lastAdjustment){console.log("Character was adjusted - reverting");this.position.fromArray(this.props.position)}}},{key:"adjust",value:function adjust(){this.fullVideo.setDepth(this.nextAdjustment.mindepth,this.nextAdjustment.maxdepth);console.log(this.props.name+" Adjustment!!",this.nextAdjustment.sec);if(this.nextAdjustment.scale){this.fullVideo.setScale(this.nextAdjustment.scale)}if(this.nextAdjustment.position){if(this.nextAdjustment.sec!=0&&this.animation&&!this.animation.beDetached){this.detach(this.animation,this,this.scene);console.log("detach animation!");this.animation.beDetached=true}this.position.fromArray(this.nextAdjustment.position)}else if(this.lastAdjustment.position){this.nextAdjustment.position=this.lastAdjustment.position.slice(0)}this.lastAdjustment=this.nextAdjustment;if(this.adjustments.length>0){this.nextAdjustment=this.adjustments.shift()}else{this.nextAdjustment=null}console.log(this.props.name+" last adjustment ",this.lastAdjustment)}},{key:"detach",value:function detach(child,parent,scene){if(child&&parent&&scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child)}}},{key:"attach",value:function attach(child,scene,parent){if(child&&parent&&scene){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}}},{key:"onCollision",value:function onCollision(){var _this5=this;this.timeSinceCollision=0;if(this.active&&!this.colliding){this.colliding=true;setTimeout(function(){_this5.colliding=false;if(_this5.active&&_this5.inControl&&!_this5.playingFull&&!_this5.onHold&&!_this5.done){_this5.playingFull=true;console.log(_this5.props.name+" - Loading full video ");if(_this5.animation&&!_this5.props.fullOnly){_this5.animation.visible=false}if(!_this5.isPaused){if(_this5.props.subtitles){_this5.subtitlesVideo=document.getElementById("subtitles");_this5.subtitlesVideo.addEventListener("canplay",function(){if(!_this5.subtitlesReady){console.log(_this5.props.name+" - Subtitles Ready");_this5.subtitlesReady=true;_this5.checkReady()}},false);_this5.subtitlesVideo.src=_this5.props.basePath+"_subtitles.webm";_this5.subtitlesVideo.load()}_this5.fullVideo.video.addEventListener("canplay",function(){if(!_this5.fullReady){console.log(_this5.props.name+" - Full video ready");_this5.fullReady=true;_this5.checkReady()}},false);_this5.fullVideo.load();_this5.loadAudio().then(function(audio){_this5.audioReady=true;_this5.checkReady()});if(_this5.props.hasAmbience){_this5.loadCharacterAmbience().then(function(audio){_this5.ambientReady=true;_this5.checkReady()})}}else{console.log(_this5.props.name+" Resume");if(_this5.props.subtitles){_this5.subtitlesVideo.style.display="block";_this5.subtitlesVideo.play()}_this5.playFull()}}},Math.floor(Math.random()*100))}}},{key:"loadAudio",value:function loadAudio(){var _this6=this;console.log("The current character sound is "+this.props.name);return new Promise(function(resolve,reject){console.log("Loading character audio",_this6.props.basePath+"_"+_this6.config.language+".ogg");_this6.soundManager.createPositionalSoundSampler(_this6.props.basePath+"_"+_this6.config.language+".ogg",function(sampler){console.log("Loaded character audio ",sampler);_this6.audio=sampler;_this6.audio.controlVolume(2);_this6.updateAudioPosition();resolve(sampler)})})}},{key:"loadCharacterAmbience",value:function loadCharacterAmbience(){var _this7=this;return new Promise(function(resolve,reject){var relPath=_this7.config.assetsHost+"assets/sound/character_ambience/"+_this7.props.name+".ogg";console.log("Loading characters ambience ",relPath);_this7.soundManager.createStaticSoundSampler(relPath,function(sampler){console.log("Loaded characters ambience ",sampler);_this7.ambientAudio=sampler;resolve(sampler)})})}},{key:"updateAudioPosition",value:function updateAudioPosition(){if(this.audio){this.updateMatrixWorld();var worldPos=(new THREE.Vector3).setFromMatrixPosition(this.matrixWorld);this.audio.position.set(worldPos.x,worldPos.y,worldPos.z)}}},{key:"checkReady",value:function checkReady(){console.log(this.props.name,"Checking ready");if(this.fullReady&&this.audioReady&&this.active&&!this.onHold&&(this.ambientReady||!this.props.hasAmbience)&&(this.subtitlesReady||!this.props.subtitles)){if(this.animation){this.animation.start(this.props.name)}console.log("Check ready adjustment",this.nextAdjustment);if(this.nextAdjustment&&this.nextAdjustment.sec==0){this.adjust()}this.playFull();if(this.debug){events.emit("add_gui",{folder:this.props.name},this,"pauseFullDebug");events.emit("add_gui",{folder:this.props.name},this,"playFullDebug")}}}},{key:"pauseFullDebug",value:function pauseFullDebug(){this.fullVideo.pause()}},{key:"playFullDebug",value:function playFullDebug(){this.fullVideo.play()}},{key:"playFull",value:function playFull(){var _this8=this;
if(this.fullVideo.mesh){this.playingFull=true;if(this.idleVideo){this.idleVideo.pause();if(this.idleVideo.mesh){this.idleVideo.setVisible(false)}}this.fullVideo.setVisible(true);if(this.lastAdjustment&&this.lastAdjustment.position){this.position.fromArray(this.lastAdjustment.position)}if(this.config.skipCharacters){_debug2.default.fastForward(this.fullVideo.video)}this.fullVideo.play();if(this.audio){this.soundManager.panorama.append(this.audio);this.audio.play()}if(this.ambientAudio&&this.props.name!=this.ambienceExceptions){this.ambientAudio.play()}if(this.subtitlesReady){this.subtitlesVideo.style.display="block";this.subtitlesVideo.play()}if(this.animation){setTimeout(function(){_this8.animation.visible=true},1e3)}events.emit("character_playing",this.props.name)}else{console.log("Cannot play video!",this.props.name)}}}]);return Character}(THREE.Object3D);exports.default=Character},{"./util/debug":58,"./util/video_rgbd":67}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _chapters=require("./chapters");var _chapters2=_interopRequireDefault(_chapters);var _characters=require("./characters");var _characters2=_interopRequireDefault(_characters);var _characters3=require("./web/characters");var _characters4=_interopRequireDefault(_characters3);var _character=require("./character");var _character2=_interopRequireDefault(_character);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _misc=require("./util/misc");var _misc2=_interopRequireDefault(_misc);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CharacterController=function(){function CharacterController(config,animations,square,collisionManager,soundManager,scene){_classCallCheck(this,CharacterController);this.config=config;this.collisionManager=collisionManager;this.soundManager=soundManager;this.characters={};this.square=square;this.activeCharacters=[];this.animations=animations;this.addedColliders=false;this.inControl=false;this.debug=true;this.scene=scene}_createClass(CharacterController,[{key:"init",value:function init(loadingManager){var _this=this;console.log("Initializing Character controller");if(!this.config.noCharacters){_characters2.default.forEach(function(characterProps){if(_this.config.platform=="desktop"){var updateCharacter=_lodash2.default.find(_characters4.default,{name:characterProps.name});if(updateCharacter){_misc2.default.overwriteProps(characterProps,updateCharacter)}}var character=new _character2.default(_this.config,characterProps,_this.collisionManager,_this.soundManager,_this.scene);character.animation=_this.animations[characterProps.animation];character.init(loadingManager);_this.characters[characterProps.name]=character})}events.on("instructions_end",function(){console.log("Character controller now in control");_this.inControl=true;_this.addColiders()});events.on("hour_updated",function(hour){_this.loadHour(hour)});events.on("angle_updated",function(hour){console.log("Character controller Angle updated",hour,_this.activeCharacters,_this.inControl);if(_this.inControl){{_this.addColiders()}}})}},{key:"addColiders",value:function addColiders(){var _this2=this;this.activeCharacters.forEach(function(character){character.updateAudioPosition();if(character.idleOnly){character.addedColliders=true}else if(!character.done&&!character.addedColliders){console.log("Adding colliders: "+character.props.name);_this2.collisionManager.addCharacter(character);character.addedColliders=true}})}},{key:"loadHour",value:function loadHour(hour){var _this3=this;console.log("Character controller loading hour ",hour);var clone=this.activeCharacters.slice(0);this.activeCharacters=[];for(var i=0;i<clone.length;i++){var character=clone[i];if(!character.done&&!(character.props.name=="Agam9AM"&&hour==9)&&!(character.props.name=="Agam12PM"&&hour==19)){console.log("Removing character ",character.props.name," when loading hour ",hour);this.square.clockwork.remove(character);character.unload()}else{console.log("Character "+character.props.name+" is still active");this.activeCharacters.push(character)}if(character.addedColliders){console.log("Removing colliders: "+character.props.name);this.collisionManager.removeCharacter(character);character.addedColliders=false}}console.log("Loading characters for ",hour);var chapter=_lodash2.default.find(_chapters2.default,{hour:hour});chapter.characters.forEach(function(characterName){_this3.addCharacter(characterName)})}},{key:"addCharacter",value:function addCharacter(characterName){var ending=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(this.characters[characterName]&&(ending||!this.characters[characterName].done)){console.log("Adding character "+characterName);var character=this.characters[characterName];this.activeCharacters.push(character);this.square.clockwork.add(character);if(this.debug){_debug2.default.positionObject(character,character.props.name,false,-50,50,character.props.rotation)}character.load(ending);character.play()}}},{key:"removeCharacter",value:function removeCharacter(characterName){var character=this.characters[characterName];if(character){this.square.clockwork.remove(character);character.unload()}}},{key:"update",value:function update(dt,et){for(var i=0;i<this.activeCharacters.length;i++){this.activeCharacters[i].update(dt,et)}}}]);return CharacterController}();exports.default=CharacterController},{"./chapters":13,"./character":15,"./characters":17,"./util/debug":58,"./util/misc":63,"./web/characters":70,lodash:96}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"Hannah",basePath:"assets/characters/hanna",mindepth:2138.454101562,maxdepth:3047.334472656,position:[-4.85,22.04,-11.6],rotation:[355,0,3],animation:"Hannah",uvdy:.5,uvdy_idle:.48974609375,uvdx:.016,width:1024,height:2048,scale:.003*.753*.937,animationScale:.4,animationPosition:[0,-.3,-.85],animationRotation:[15,0,2],space:.22,spaceOffset:[-.2,0,.29],subtitles:null,gazeSpace:[-.27,-.21,-.6],gazeOffset:[0,0,.16],endingPosition:[4.46,22.11,-13.77],endingRotation:[360,190,3],endingScaleMul:1,hasAmbience:true},{name:"Miriam",basePath:"assets/characters/miriam",mindepth:2200,maxdepth:3119.456298828,position:[-2.5,21.99,12.2],rotation:[10,210,12],animation:"Miriam",uvdy_idle:.47900390625,uvdy:.496,uvdx:-.002,width:768,height:2048,scale:.003*.5748,animationScale:.478,animationPosition:[-.43,-.52,.51],animationRotation:[6,0,-6],space:.03,spaceOffset:[.06,0,0],subtitles:null,adjustments:[{sec:0,mindepth:2200,maxdepth:3119.456298828,position:[-2.3,22.05,12.6],scale:.003*.5748*1.106}],gazeoffset:[-.18,.34,-.14],gazespace:[-.52,-.3,-.29],endingPosition:[-2,22.04,-16.9],endingRotation:[0,178,0],endingScaleMul:1.1,hasAmbience:true},{name:"Itzik",basePath:"assets/characters/itzik",mindepth:0,maxdepth:3494.158935547,position:[-6,21.92,9.7],rotation:[10,216,5],animation:"Itzik",uvdy:.478,uvdx:0,width:512,height:2048,scale:.0027*.5308,animationScale:.246,animationPosition:[.25,.42,-1.38],animationRotation:[7.9,7.7,1],space:.33,spaceOffset:[.39,0,.28],subtitles:false,adjustments:[{sec:0,mindepth:0,maxdepth:3494.158935547,position:[-6.1,22.03,9.9],scale:.0027*.4686}],gazeoffset:[-.1,.28,-.04],gazespace:[-.39,-.04,-.21],endingPosition:[9.41,21.8,-10.54],endingRotation:[4,190,5],endingScaleMul:1.2,hasAmbience:true},{name:"Haim",basePath:"assets/characters/haim",mindepth:1029.795776367,maxdepth:1600,position:[-15.3,19.8,-10.4],rotation:[313,70,46],animation:"Haim",uvdy:.507,uvdx:0,width:2048,height:2048,scale:.003*1.243*1.455*1.048*1.024,animationScale:.4,animationPosition:[1.27,-.53,6.92],animationRotation:[0,-50,0],subtitles:false,space:-1.85,spaceOffset:[.32,0,.71],gazeSpace:[-2.15,1.9,-.95],gazeOffset:[1.63,1.76,3.62],endingPosition:[6.24,19.83,11.35],endingRotation:[196,29,188],endingScaleMul:1.2,hasAmbience:true},{name:"Rami",basePath:"assets/characters/rami",mindepth:2225.287353516,maxdepth:3252.206298828,position:[.8,22.14,12.5],rotation:[356,109,10],animation:"Rami",uvdy:.48,uvdy_idle:.477,uvdx:0,width:1024,height:2048,scale:.003*.661*1.088,animationScale:.25,animationPosition:[-.43,.25,.14],animationRotation:[-4,-23,-9],space:-.06,spaceOffset:[-.08,0,.38],subtitles:false,gazeSpace:[-.55,0,0],gazeOffset:[0,-.11,.58],endingPosition:[16.7,22.04,-5.9],endingRotation:[356,180,10],endingScaleMul:1,hasAmbience:true},{name:"Meir",basePath:"assets/characters/meir",mindepth:1482.958618164,maxdepth:2514.773681641,position:[-.43,22.39,7.43],rotation:[7,0,0],animation:"Meir",uvdy:.4931640625,uvdy_idle:.483398438,uvdx:0,width:1024,height:2048,scale:.00242802,animationScale:.228,animationPosition:[-.3,-.1,-.03],animationRotation:[0,14,0],subtitles:null,space:.3,spaceOffset:[-.31,0,-.28],gazeSpace:[-.59,-.13,-.37],gazeOffset:[.19,-.06,-.52],endingPosition:[-1.69,22.04,-7.3],endingRotation:[190.1,20,194],endingScaleMul:1,hasAmbience:true},{name:"Sasha",basePath:"assets/characters/sasha",mindepth:2131.298583984375,maxdepth:3802.192626953125,position:[-37.78,19.74,13.54],rotation:[8,131,343],animation:null,uvdy:.571527778,uvdx:0,width:1024,height:2048,scale:.003*.5,subtitles:null,idleOnly:true,hasAmbience:false},{name:"Agam12PM",basePath:"assets/characters/agam12pm",mindepth:1656.909729004,maxdepth:2789.562011719,position:[-2.11,22.08,7.338],rotation:[0,325,5.8],animation:"Agam12PM",uvdy:.496,uvdx:0,scale:.003*.69*1.07,width:1024,height:2048,animationScale:.245,animationPosition:[-.22,.07,.526],animationRotation:[0,17,-6],subtitles:null,idleOnly:true,event:true,hasAmbience:false},{name:"LupoDogs12PM",basePath:"assets/characters/lupo-dogs",mindepth:1500.681884765625,maxdepth:3376.0517578125,position:[-7.5,21.94,7.15],rotation:[20,241,17.7],animation:null,uvdy:.4794921875,uvdx:0,width:1024,height:1024,scale:.003*.406,subtitles:null,idleOnly:true,hasAmbience:false},{name:"LupoDogs5PM",basePath:"assets/characters/lupo-dogs",mindepth:1500.681884765625,maxdepth:3376.0517578125,position:[-10.36,21.94,-3.78],rotation:[12,150,352],animation:null,uvdy:.4794921875,uvdx:0,width:1024,height:1024,scale:.003*.406,subtitles:null,idleOnly:true,hasAmbience:false},{name:"Mark",basePath:"assets/characters/mark",mindepth:1499.999877929688,maxdepth:4564.32861328125,adjustments:[{sec:0,mindepth:1499.999877929688,maxdepth:4564.32861328125,position:[-12.5,21.94,3.1],scale:.003*.458437*1.34174*.865*1.246},{sec:92,mindepth:2689.701416015625,maxdepth:4381.86181640625},{sec:117,mindepth:1499.999877929688,maxdepth:4564.32861328125}],position:[-14.2,21.86,3.2],rotation:[16,81,340],animation:"Mark",uvdy:.458984375,uvdy_idle:.419,uvdx:0,width:1024,height:2048,scale:.003*.458437*1.8,animationScale:.326,animationPosition:[-.39,.08,-1.86],animationRotation:[0,275,0],space:.29,spaceOffset:[.4,0,1],subtitles:null,gazeOffset:[-.23,.01,0],gazeSpace:[-.28,0,-.64],endingPosition:[-12.2,21.7,-2.9],endingRotation:[12,150,340],endingScaleMul:1.3,hasAmbience:true},{name:"FatmanSleep",basePath:"assets/characters/fatman-sleep",mindepth:1370.90380859375,maxdepth:3802.21240234375,position:[-15.55,22.05,2.869],rotation:[0,40,0],animation:null,uvdy:.35986328125,uvdx:0,width:2048,height:2048,scale:.003*1.0952,subtitles:null,idleOnly:true,hasAmbience:false},,{name:"Lupo9AM",basePath:"assets/characters/lupo9am",mindepth:2160,maxdepth:6120.20654296875,position:[-27,21.16,-37.04],rotation:[350,300,7.3],animation:null,uvdy:.42138671875,uvdx:0,width:2048,height:2048,scale:.003*.25,subtitles:null,idleOnly:true,hasAmbience:false},{name:"Lupo12PM",basePath:"assets/characters/lupo12pm",mindepth:1770.462036132813,maxdepth:3428.071533203125,adjustments:[{sec:107,mindepth:1523.277099609375,maxdepth:3428.071533203125},{sec:134,mindepth:1770.462036132813,maxdepth:3428.071533203125},{sec:141,mindepth:2015.678588867188,maxdepth:3681.246826171875,position:[-10.4,22.13,5.6],scale:.003*.52198}],position:[-10.4,22.13,6.2],rotation:[2,216,0],animation:"Lupo12PM",uvdy:.505,uvdx:.005,width:1024,height:2048,scale:.003*.7411,animationScale:.25,animationPosition:[-.19,-.52,-.96],animationRotation:[0,0,0],subtitles:null,space:.2,spaceOffset:[.02,0,-.06],gazeOffset:[.19,.13,.22],gazeSpace:[.02,-.2,-.65],hasAmbience:true},{name:"Lupo5PM",basePath:"assets/characters/lupo5pm",mindepth:1582.586059570313,maxdepth:4480.7158203125,adjustments:[{sec:100,mindepth:1770.462036132813,maxdepth:3428.071533203125,position:[-12.97,22.12,-5.77],scale:.003*.75*1.028*1.09},{sec:120,mindepth:1523.277099609375,maxdepth:3428.071533203125,position:[-12.97,22,-5.77],scale:.003*.75*1.028*1.132}],position:[-12.2,22.1,-5.91],rotation:[40,100,310],animation:"Lupo12PM",uvdy:.49951171875,uvdx:0,width:1024,height:2048,scale:.003*.75*1.028,animationScale:.3,animationPosition:[1.13,-.53,-2.27],animationRotation:[6,-25,9],subtitles:null,space:.8,spaceOffset:[5,0,1.13],endingPosition:[12.4,22.3,-2.7],endingRotation:[12,190,352],endingScaleMul:1.1,hasAmbience:true},{name:"Itzhak",basePath:"assets/characters/itzhak",mindepth:1762.584594726563,maxdepth:3120,position:[2.1,22,-12.1],rotation:[340,255,340],animation:"Itzhak",uvdy_idle:.498,uvdy:.484,uvdx:-.044,uvdx_idle:.049,width:512,height:2048,scale:.003*.45*1.014,animationScale:.24,animationPosition:[-.03,.09,.27],animationRotation:[5,-3,0],space:-.6,spaceOffset:[.24,0,-.06],subtitles:false,gazeSpace:[0,0,-.1],gazeOffset:[-.07,.15,.06],endingPosition:[-12.91,22.04,6.4],endingRotation:[356,146,12],endingScaleMul:1.2,hasAmbience:true},{name:"Shirin7PM",basePath:"assets/characters/shirin7pm",mindepth:1214.999755859,maxdepth:3681.950439453,position:[16.98,27.2,-46.32],rotation:[0,270,0],animation:"Shirin",uvdy:.47509765625,uvdx:0,width:1024,height:2048,scale:.003*.5327*1.244*.9,animationScale:.08,animationPosition:[0,1,.8],animationRotation:[0,0,0],space:100,spaceOffset:[0,0,0],subtitles:null,fullOnly:true,hasAmbience:false},{name:"Waterman",basePath:"assets/characters/waterman",mindepth:183.75,maxdepth:6681.800292969,position:[7.87,22.36,-3.26],rotation:[0,220,0],animation:null,uvdy:.498046875,uvdx:0,width:1024,height:2048,scale:.003*.96,subtitles:null,fullOnly:true,space:20,hasAmbience:false},{name:"FatmanShower",basePath:"assets/characters/fatman-shower",mindepth:2534.99951171875,maxdepth:5070.96044921875,position:[-5.74,22.7,2.85],rotation:[192,231,197],animation:null,uvdy:.49169921875,uvdx:0,width:1024,height:2048,scale:.003*.64725*1.308,subtitles:null,idleOnly:true,hasAmbience:false},{name:"Agam7PM",basePath:"assets/characters/agam7pm",mindepth:1656.909729004,maxdepth:2789.562011719,position:[-1.75,22.049,-7.4],rotation:[0,190,2.3],animation:"Agam12PM",uvdy:.496,uvdx:0,scale:.003*.8,width:1024,height:2048,animationScale:.265,animationPosition:[-.24,.11,.76],animationRotation:[0,-4,-3.5],subtitles:null,idleOnly:true,event:true,hasAmbience:false}]},{}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _video=require("./util/video360");var _video2=_interopRequireDefault(_video);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CLOUDS_SEQUENCE_PATH="assets/clouds/sequence.webm";var CLOUDS_STATIC_PATH="assets/clouds/static.png";var States={STATIC:"static",TRANSITON:"transition"};var Clouds=function(){function Clouds(loadingManager){_classCallCheck(this,Clouds);console.log("Clouds constructed!");this.loadingManager=loadingManager;this.currentState=States.STATIC}_createClass(Clouds,[{key:"init",value:function init(targetShader){console.log("Clounds init");this.cloudsVideo=new _video2.default(CLOUDS_SEQUENCE_PATH,targetShader.uniforms.cloudsMap);this.cloudsVideo.init();this.staticTexture=new THREE.TextureLoader(this.loadingManager).load(CLOUDS_STATIC_PATH);targetShader.uniforms.cloudsMap.value=this.staticTexture;this.targetShader=targetShader}},{key:"update",value:function update(dt){if(this.currentState===States.TRANSITON){this.cloudsVideo.update(dt)}}},{key:"startTransition",value:function startTransition(){this.currentState=States.TRANSITON;this.cloudsVideo.play()}},{key:"stopTransition",value:function stopTransition(){this.currentState=States.STATIC;this.cloudsVideo.pause();this.cloudsVideo.video.currentTime=0;this.targetShader.uniforms.cloudsMap.value=this.staticTexture}}]);return Clouds}();exports.default=Clouds},{"./util/video360":66}],19:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Coin=function(_THREE$Object3D){_inherits(Coin,_THREE$Object3D);function Coin(character_controller){_classCallCheck(this,Coin);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Coin).call(this));_this.character_controller=character_controller;_this.BASE_PATH="assets/animations/coin/";return _this}_createClass(Coin,[{key:"init",value:function init(loadingManager){var _this2=this;this.coins={};this.coinsOffset={Meir:[.5,-.95,1.35],Rami:[-.3,-.9,0],Mark:[.27,-.63,-.77],Hannah:[.14,-.84,.79],Itzik:[-.85,-.84,.57],Lupo12PM:[.56,-.78,1.17],Lupo5PM:[0,-.77,0],Haim:[.93,-.56,8.06],Itzhak:[.04,-.74,1.3],Miriam:[.09,-.85,.55]};this.activeCoins=[];this.beLookedCount=0;this.toCheck=false;this.coinTimestamp=-1;this.currentOnCharacter=null;this.isShining=false;this.tweenAnimCollectors=[];this.coinsDeleted=false;var tex_loader=new THREE.TextureLoader(loadingManager);var NRM_map=tex_loader.load(this.BASE_PATH+"images/coin_NRM.png");this.coinMat=new THREE.MeshPhongMaterial({color:15451164,normalMap:NRM_map,specular:1117698,shininess:30});this.loadCoin(this.BASE_PATH+"/models/coin.json").then(function(coinModel){_this2.coinModel=coinModel;for(var key in _this2.character_controller.characters){if(_this2.character_controller.characters.hasOwnProperty(key)){if(key in _this2.coinsOffset){var coinn=_this2.coinModel.clone();coinn.position.fromArray(_this2.coinsOffset[key]);coinn.visible=false;_this2.character_controller.characters[key].add(coinn);_this2.coins[key]={};_this2.coins[key].coin=coinn;_this2.coins[key].beLooked=false}}}});events.on("character_playing",function(name){if(name in _this2.coinsOffset){_this2.reset();if(_this2.beLookedCount==1){_this2.currentOnCharacter=name;_this2.beLookedCount++;_this2.coins[_this2.currentOnCharacter].beLooked=true;_this2.toCheck=false;console.log("skip the 2nd coin for "+name)}else if(_this2.beLookedCount<3){_this2.coins[name].coin.visible=true;_this2.toCheck=true;_this2.currentOnCharacter=name;console.log("show coin for "+name)}}})}},{key:"loadCoin",value:function loadCoin(modelFile){var _this3=this;var promise=new Promise(function(resolve,reject){var loader=new THREE.JSONLoader(_this3.loadingManager);var coinModel=void 0;loader.load(modelFile,function(geometry){_this3.coinGeo=geometry;coinModel=new THREE.Mesh(_this3.coinGeo,_this3.coinMat);coinModel.scale.multiplyScalar(.04);resolve(coinModel)})});return promise}},{key:"loadHour",value:function loadHour(hour){for(var key in this.coins){this.coins[key].coin.visible=false}}},{key:"reset",value:function reset(){if(this.currentOnCharacter!=null){this.coins[this.currentOnCharacter].coin.visible=false;this.currentOnCharacter=null}this.coinTimestamp=-1;this.coinMat.shininess=30;this.isShining=false;if(this.tweenAnimCollectors.length>0){for(var i=0;i<this.tweenAnimCollectors.length;i++){this.tweenAnimCollectors[i].kill()}this.tweenAnimCollectors=[]}if(this.beLookedCount==3){this.toCheck=false;if(!this.coinsDeleted)this.disposeCoins()}}},{key:"disposeCoins",value:function disposeCoins(){console.log("delete all the coins!");for(var key in this.coinsOffset){this.character_controller.characters[key].remove(this.coins[key].coin)}this.coinMat.normalMap.dispose();this.coinMat.dispose();this.coinGeo.dispose();this.coinsDeleted=true}},{key:"update",value:function update(camera,dt,et){if(this.coinTimestamp==-1){this.coinTimestamp=et}if(!this.isShining&&et-this.coinTimestamp>13){this.coinMat.shininess=80;var coinAni=TweenMax.fromTo(this.coins[this.currentOnCharacter].coin.rotation,.8,{z:-.3},{z:.3,repeat:-1,yoyo:true,ease:Power0.easeNone});this.tweenAnimCollectors.push(coinAni);var coinAni2=TweenMax.fromTo(this.coins[this.currentOnCharacter].coin.rotation,.8,{x:-.3},{x:.3,repeat:-1,yoyo:true,delay:.5,ease:Power0.easeNone});this.tweenAnimCollectors.push(coinAni2);this.isShining=true}if(camera.position.y<.6){for(var i=0;i<this.tweenAnimCollectors.length;i++){this.tweenAnimCollectors[i].kill()}this.coins[this.currentOnCharacter].coin.rotation.set(0,0,0);this.beLookedCount++;this.coins[this.currentOnCharacter].beLooked=true;this.toCheck=false}}}]);return Coin}(THREE.Object3D);exports.default=Coin},{"./util/debug":58}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _boxIntersect=require("box-intersect");var _boxIntersect2=_interopRequireDefault(_boxIntersect);var _GeometryUtils=require("./util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PLAYER_SIZE={x:1,y:5,z:1};var COLLIDERS={stairs:["Object_1111","Object_1110"],ramps:["Object_1077"]};var CollisionManager=function(){function CollisionManager(camera,scene){_classCallCheck(this,CollisionManager);console.log("Collision Manager constructed!");this.characterObstacles=[];this.playerBox=[[0,0,0,0,0,0]];this.characterObstacleInfo=[];this.squareObstacles=[];this.squareEventObstacles=[];this.squareDebug=[];this.squareMeshes=[];this.squareEventMeshes=[];this.climbingStairs=false;this.climbingRamp=false;this.scene=scene;this.player=camera;this.meshColliders=[];this.gazeObjects=[];this.raycaster=new THREE.Raycaster;this.debugCollisions=false;this.debugGaze=false;this.debugCharacters=false;this.lastGaze=null}_createClass(CollisionManager,[{key:"init",value:function init(){}},{key:"refreshSquareColliders",value:function refreshSquareColliders(colliders){console.log("Refresh square colliders ",colliders);if(this.debugCollisions){while(this.squareDebug.length>0){var object=this.squareDebug.pop();this.scene.remove(object)}}this.squareObstacles.splice(0);this.squareEventObstacles.splice(0);this.squareMeshes.splice(0);this.squareEventMeshes.splice(0);for(var i=0;i<colliders.length;i++){this.addBoundingBox(colliders[i])}}},{key:"update",value:function update(dt){var _this=this;this.playerBox[0]=[this.player.position.x-PLAYER_SIZE.x/2,this.player.position.y-PLAYER_SIZE.y/2,this.player.position.z-PLAYER_SIZE.z/2,this.player.position.x+PLAYER_SIZE.x/2,this.player.position.y+PLAYER_SIZE.y/2,this.player.position.z+PLAYER_SIZE.z/2];(0,_boxIntersect2.default)(this.playerBox,this.characterObstacles,function(i,j){if(_this.characterObstacleInfo[j].onCollision){_this.characterObstacleInfo[j].onCollision()}});(0,_boxIntersect2.default)(this.playerBox,this.squareEventObstacles,function(i,j){var distance=_this.player.position.distanceTo((new THREE.Vector3).setFromMatrixPosition(_this.squareEventMeshes[j].matrixWorld));_this.squareEventMeshes[j].onCollision(distance)});this.gaze()}},{key:"setPlayer",value:function setPlayer(player){this.player=player}},{key:"testMovement",value:function testMovement(source,destination){var _this2=this;return new Promise(function(resolve,reject){_this2.meshColliders.splice(0);(0,_boxIntersect2.default)(_this2.playerBox,_this2.squareObstacles,function(i,j){_this2.meshColliders.push(_this2.squareMeshes[j])});if(_this2.meshColliders.length>0){var legs=(new THREE.Vector3).copy(source);legs.y=0;var directionVector=(new THREE.Vector3).copy(destination);directionVector.sub(source).normalize();var ray=new THREE.Raycaster(legs,directionVector);var collisionResults=ray.intersectObjects(_this2.meshColliders);collisionResults.forEach(function(result){if(result.distance<.1){resolve(false)}});resolve(true)}else{resolve(true)}})}},{key:"addCharacter",value:function addCharacter(character){character.updateMatrixWorld(true);if(character.props.space){console.log("COLLISION MANAGER - Adding character ",character.props.name);var space=character.props.space;var bbox=new THREE.BoundingBoxHelper(character,65280);bbox.update();var offset=new THREE.Vector3;if(character.props.spaceOffset){offset.fromArray(character.props.spaceOffset)}var newBox=THREE.GeometryUtils.enlargeBox(bbox.box,space,offset);if(this.debugCharacters){_debug2.default.adjustBBox(bbox,character.props.name+" - bbox",character.props.space,offset);this.scene.add(bbox)}console.log("Adding collision box for "+character.props.name,newBox);this.characterObstacles.push([newBox.min.x,newBox.min.y,newBox.min.z,newBox.max.x,newBox.max.y,newBox.max.z]);this.characterObstacleInfo.push(character)}if(character.idleVideo&&character.idleVideo.mesh){var gazeSpace=new THREE.Vector3;var gazeOffset=new THREE.Vector3;if(character.props.gazeSpace){gazeSpace.fromArray(character.props.gazeSpace)}if(character.props.gazeOffset){gazeOffset.fromArray(character.props.gazeOffset)}if(!character.gazeBox){character.gazeBox=new THREE.BoundingBoxHelper(character.idleVideo.mesh,16776960)}character.gazeBox.update();var _newBox=THREE.GeometryUtils.enlargeBox(character.gazeBox.box,gazeSpace,gazeOffset);_newBox.getSize(character.gazeBox.scale);_newBox.getCenter(character.gazeBox.position);if(this.debugGaze){_debug2.default.adjustBBox(character.gazeBox,character.props.name+" - Gaze",gazeSpace,gazeOffset)}else{character.gazeBox.material.visible=false}this.gazeObjects.push(character.gazeBox);this.scene.add(character.gazeBox)}}},{key:"gaze",value:function gaze(){var camVector=new THREE.Vector3(0,0,-1).applyQuaternion(this.player.quaternion);this.raycaster.set(this.player.position,camVector);var collisionResults=this.raycaster.intersectObjects(this.gazeObjects);if(collisionResults.length>0&&collisionResults[0].object.onGaze){collisionResults[0].object.onGaze(this.player.position,camVector,collisionResults[0].object.position);this.lastGaze=collisionResults[0].object}else if(this.lastGaze){this.lastGaze.onGazeStop();this.lastGaze=null}}},{key:"addGazeCollider",value:function addGazeCollider(bbox){console.log("addGazeCollider");this.scene.add(bbox);if(!this.debugGaze){bbox.material.visible=false;console.log("Sun gaze box",bbox)}this.gazeObjects.push(bbox)}},{key:"removeCharacter",value:function removeCharacter(character){if(character.props.space){var obstacleIndex=this.characterObstacleInfo.indexOf(character);if(obstacleIndex!=-1){console.log("COLLISION MANAGER - Removing character ",character.props.name,"Obstacle index: ",obstacleIndex);this.characterObstacles.splice(obstacleIndex,1);this.characterObstacleInfo.splice(obstacleIndex,1)}else{console.log("COLLISION MANAGER - no obstacle object for ",character.props.name)}}if(character.gazeBox){var gazeIndex=this.gazeObjects.indexOf(character.gazeBox);if(gazeIndex!=-1){console.log("COLLISION MANAGER - Removing character ",character.props.name,"Gaze index: ",gazeIndex);this.gazeObjects.splice(gazeIndex,1)}else{console.log("COLLISION MANAGER - no gaze object for ",character.props.name)}}}},{key:"addBoundingBox",value:function addBoundingBox(obj){var bbox=new THREE.BoundingBoxHelper(obj,65280);bbox.update();if(this.debugCollisions){this.scene.add(bbox);this.squareDebug.push(bbox)}var mesh=void 0;if(obj.type=="Mesh"){mesh=obj}else{mesh=obj.children[0]}if(obj.name!="f_11_SubMesh 0"){mesh.material.visible=false}if(obj.onCollision){this.squareEventMeshes.push(mesh);this.squareEventObstacles.push([bbox.box.min.x,bbox.box.min.y,bbox.box.min.z,bbox.box.max.x,bbox.box.max.y,bbox.box.max.z])}this.squareMeshes.push(mesh);this.squareObstacles.push([bbox.box.min.x,bbox.box.min.y,bbox.box.min.z,bbox.box.max.x,bbox.box.max.y,bbox.box.max.z])}},{key:"addBoundingBoxes",value:function addBoundingBoxes(obj,scene){}},{key:"isClimbingStairs",value:function isClimbingStairs(){return this.climbingStairs}}]);return CollisionManager}();exports.default=CollisionManager},{"./util/GeometryUtils":56,"./util/debug":58,"box-intersect":75}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={controls:"locked",basalHeight:10,fps:60,enableFlying:false,skipIntro:false,skipCharacters:false,speedIntro:false,startTime:19,movementSpeed:.3,daySpeed:.001,noSquare:false,fullscreen:false,noAnimations:false,noExtras:false,noTrees:false,noCharacters:false,production:true,assetsHost:"",platform:"vive",skipLanding:false,skipInstructions:false,language:"eng"}
},{}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={credits:[{Role:"Created by",Name:"Shirin Anlen"},{Role:"Lead Developer",Name:"Avner Peled"},{Role:"Design Director",Name:"Ziv Schneider"},{Role:"Technical Director",Name:"Or Fleisher"},{Role:"Creative Coder Animation",Name:"Laura Juo-hsin Chen"},{Role:"Script Editor",Name:"Udi Ben-Arie"}]}},{}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={credits:[{Role:"מאת היוצרת",Name:"שירין אנלן"},{Role:"מפתח ראשי",Name:"אבנר פלד"},{Role:"מעצבת ראשית",Name:"זיו שניידר"},{Role:"מנהל טכני",Name:"אור פליישר"},{Role:"קידוד יצירתי",Name:"לאורה יו-סין צ׳ן"},{Role:"עורך תסריט",Name:"אודי בן-אריה"}]}},{}],24:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _video=require("./util/video360");var _video2=_interopRequireDefault(_video);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EndCredits=function(_THREE$Object3D){_inherits(EndCredits,_THREE$Object3D);function EndCredits(config){_classCallCheck(this,EndCredits);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(EndCredits).call(this));console.log("End Credits constructed!");_this.playing=false;_this.config=config;return _this}_createClass(EndCredits,[{key:"init",value:function init(){try{console.log("Credits init");this.creditsVideo=new _video2.default("assets/end/credits_"+this.config.language+".webm");this.creditsVideo.init();var titlePlaneGeo=new THREE.PlaneGeometry(2048,1024);var material=new THREE.MeshBasicMaterial({map:this.creditsVideo.texture,side:THREE.DoubleSide,transparent:true});this.creditsPlane=new THREE.Mesh(titlePlaneGeo,material);this.add(this.creditsPlane)}catch(e){console.error("Exception",e)}}},{key:"update",value:function update(dt){if(this.creditsVideo){this.creditsVideo.update(dt)}}},{key:"play",value:function play(){this.playing=true;this.creditsVideo.play()}}]);return EndCredits}(THREE.Object3D);exports.default=EndCredits},{"./util/debug":58,"./util/video360":66}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _end_credits=require("./end_credits");var _end_credits2=_interopRequireDefault(_end_credits);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _multiline_text=require("./util/multiline_text");var _multiline_text2=_interopRequireDefault(_multiline_text);var _index=require("./lib/text2d/index");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ending=function(){function Ending(config,camera,timeController,characterController,scene,vrControls,square,introAni,soundManager){_classCallCheck(this,Ending);this.config=config;this.timeController=timeController;this.characterController=characterController;this.camera=camera;this.scene=scene;this.vrControls=vrControls;this.square=square;this.introAni=introAni;this.soundManager=soundManager;this.endingSound;this.debug=false;this.endCredits=new _end_credits2.default(this.config);this.faded=false;this.SQUARE_POSITON=[-29.17,-15.28,7.77];this.CHARACTER_ORDER=["Rami","Meir","Itzik","Miriam","Lupo5PM","Mark","Hannah","Haim","Itzhak"];this.nextCharacter=null;this.CHARACTER_TEXTS={Meir:["Meir tried to form a Facebook group against the ruin","He was very worried for what it willl do to the area.","He continues to feed the lost pigeons."],Rami:["Rami doesn’t care too much about the removal","of the square. He says life is always","in motion, and one shouldn’t fear that."],Miriam:["Miriam passed away around April-May 2015.","We shot a reenactment of a conversation with her."],Itzik:["Itzik hopes that the demolition will keep the","junkies away. He will likely keep sitting"," on the benches in the area."],Mark:["Mark found an apartment at south Tel Aviv and doesn’t sleep","on the benches anymore. He still use drugs and still visit.","He was in deep grief about the demolition."],Lupo5PM:["Lupo is bored from the area and is happy with any change","that might energizes the place. He wished that Agam’s","fountain would have been destroyed as well."],Hannah:["Hanna get upset every time","she is reminded over the demolishion,","since she often forgets about it."],Itzhak:["Yitzhak says that for the lack of a better option,","he will keep coming to the square."],Haim:["Haim wished that the square would be torn down","after his death. That did not happen.","Haim is alive and still begs at the same spot."]};this.CHARACTER_TEXTS_HEB={Meir:[".מאיר ניסה להקים קבוצת פייסבוק נגד הריסת הכיכר",".הוא נסער מאוד מהשינוי ופוחד ממה שיקרה לאזור",".ממשיך להגיע ולהאכיל את היונים האבודות"],Rami:[",רמי אדיש להורדת הכיכר. מרגיש שהחיים הם",".חלק מתנועה ואין מה לפחד ממה שהם מזמנים"],Miriam:[".מרים נפטרה באזור אפריל-מאי 2015",".לצורך הצילומים בוצע שחזור של שיחה עמה"],Itzik:["איציק מקווה שהורדת הכיכר תרחיק את","הנרקומנים מהאזור. הוא ככל הנראה ימשיך",".להגיע ולשבת על הספסלים"],Mark:["מארק מצא דירה בדרום תל אביב, הוא יותר לא ישן על","ספסלי הכיכר. עדיין משתמש בסמים",".ועדיין מגיע לבקר. הוא כאב מאוד את ההריסה"],Lupo5PM:["לופו משעומם ביותר מהאזור ושמח על כל שינוי","שמביא עמו אנרגיה חדשה. הוא קיווה שהפסל",".של אגם יהרס גם יחד עם הכיכר"],Hannah:["חנה מצטערת על הרס הכיכר",",בכל פעם מחדש",".מאחר והיא נוטה לשכוח שזה קרה"],Itzhak:[",יצחק מעיד כי ימשיך להגיע לשבת בכיכר",".בלית ברירה"],Haim:["חיים יחל לכך שיהרסו את הכיכר","רק לאחר מותו ,זה לא קרה. חיים עדיין חי",".ועדיין יושב באותו מקום מקבץ נדבות"]}}_createClass(Ending,[{key:"generateText",value:function generateText(){var TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#ffffff",antialias:true};var text=new _multiline_text2.default(5,TEXT_DEFINITION,100);text.position.set(-45.22,9,11.3);text.rotation.set(327*Math.PI/180,105*Math.PI/180,31*Math.PI/180);text.scale.set(.0136,.0136,.0136);if(this.debug){_debug2.default.positionObject(text,"Ending character text")}text.init();text.hide(0);return text}},{key:"init",value:function init(loadingManager){var _this=this;var fadePlaneGeo=new THREE.PlaneGeometry(20,20);var fadePlaneMaterial=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,transparent:true,opacity:0});this.fadePlane=new THREE.Mesh(fadePlaneGeo,fadePlaneMaterial);this.fadePlane.position.set(0,0,-.1001);this.loadEndingSound().then(function(){console.log("Ending sound loaded")});var miriamGeo=new THREE.PlaneGeometry(512,1024);new THREE.TextureLoader(loadingManager).load("assets/end/miriam.png",function(texture){var material=new THREE.MeshBasicMaterial({map:texture,side:THREE.DoubleSide,transparent:true});_this.miriamPlane=new THREE.Mesh(miriamGeo,material);if(_this.config.platform=="vive"){_this.miriamPlane.position.set(-3.93,13.4,8.61)}else{_this.miriamPlane.position.set(-10.84,13.4,8.24)}_this.miriamPlane.rotation.set(0,112*Math.PI/180,0);_this.miriamPlane.scale.set(.00169,.00169,.00169)});events.on("vr_start",function(){console.log("Into VR Start!");_this.fadePlane.position.set(0,0,-.050001)});this.spotLight=new THREE.SpotLight(16777215);this.spotLight.intensity=2;this.spotLight.castShadow=false;this.spotLight.angle=.1;this.spotLight.distance=0;this.spotLight.decay=1;this.spotLight.penumbra=.8;if(this.config.platform=="vive"){this.spotLight.position.set(-6,2.4,4.14)}else{this.spotLight.position.set(-51.73,20.44,29.46)}this.text=this.generateText();if(this.debug){var _i=0;events.emit("add_gui",{folder:"Spotlight "+_i,listen:true},this.spotLight,"castShadow");events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.01},this.spotLight.position,"x",-100,100);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.01},this.spotLight.position,"y",-100,100);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.01},this.spotLight.position,"z",-100,100);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true},this.spotLight,"intensity",0,2);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.1},this.spotLight,"angle",0,Math.PI/2);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true},this.spotLight,"distance",0,100);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.1},this.spotLight,"decay",1,2);events.emit("add_gui",{folder:"Spotlight "+_i,listen:true,step:.1},this.spotLight,"penumbra",0,1);_debug2.default.colorPicker("Spotlight "+_i,this.spotLight,"color")}}},{key:"start",value:function start(){var _this2=this;console.log("Ending is starting!");events.emit("experience_end");if(this.config.language=="heb"){this.CHARACTER_TEXTS=this.CHARACTER_TEXTS_HEB}this.floodLight=new THREE.PointLight(16777215,.6,13);this.floodLight.position.set(-15.3,2.36,2.36);if(this.debug){events.emit("add_gui",{folder:"floodLight "+i,listen:true,step:.1},this.floodLight,"decay",1,2);events.emit("add_gui",{folder:"floodLight "+i,listen:true,step:.01},this.floodLight.position,"x",-100,100);events.emit("add_gui",{folder:"floodLight "+i,listen:true,step:.01},this.floodLight.position,"y",-100,100);events.emit("add_gui",{folder:"floodLight "+i,listen:true,step:.01},this.floodLight.position,"z",-100,100);events.emit("add_gui",{folder:"floodLight "+i,listen:true},this.floodLight,"intensity",0,2);events.emit("add_gui",{folder:"floodLight "+i,listen:true},this.floodLight,"distance",0,100)}this.scene.add(this.floodLight);this.fadeOut().then(function(){TweenMax.killAll();_this2.timeController.jumpToTime(0);_this2.square.suns.visible=false;_this2.square.pool.enableWaves=false;_this2.square.fountainLight.intensity=.2;if(_this2.config.platform=="vive"){_this2.square.clockRotation=17*15*Math.PI/180}_this2.square.position.fromArray(_this2.SQUARE_POSITON);if(_this2.config.platform=="desktop"){_this2.camera.position.set(-1.2,1.6,-3.1);_this2.square.mesh.rotation.y=2.7;_this2.square.setEndingColliders()}_this2.introAni.createSnowParticle();_this2.introAni.simulationShader.uniforms.squareRadius.value=0;_this2.introAni.fbo.particles.position.x=-38;setTimeout(function(){_this2.fadeIn().then(function(){setTimeout(function(){_this2.characterController.addColiders()},4e3)})},3e3)});events.on("character_playing",function(name){setTimeout(function(){_this2.showCharacters()},5e3)});events.on("character_ended",function(name){_this2.showTexts()});if(this.debug){_debug2.default.positionObject(this.endCredits,"End credits")}}},{key:"showCharacters",value:function showCharacters(){this.showingCharacters=this.CHARACTER_ORDER.slice(0);this.showNextCharacter()}},{key:"showNextCharacter",value:function showNextCharacter(){var _this3=this;var nextCharacter=this.showingCharacters.shift();console.log("Ending - showing ",nextCharacter);this.characterController.addCharacter(nextCharacter,true);if(this.showingCharacters.length>0){setTimeout(function(){_this3.showNextCharacter()},4e3)}}},{key:"showTexts",value:function showTexts(){if(!this.endingSound.isPlaying){this.endingSound.play()}this.showingTexts=this.CHARACTER_ORDER.slice(0);this.showNextText();this.scene.add(this.spotLight);this.scene.add(this.text);this.text.show(1)}},{key:"showNextText",value:function showNextText(){var _this4=this;var nextText=this.showingTexts.shift();var targetCharacter=this.characterController.characters[nextText];this.text.setText(this.CHARACTER_TEXTS[nextText]);console.log("Ending - showing text",nextText,this.text);this.spotLight.target=targetCharacter;targetCharacter.idleVideo.play();if(nextText=="Miriam"){console.log("Ending - Miriam plane");this.square.add(this.miriamPlane)}setTimeout(function(){if(nextText=="Miriam"){_this4.square.remove(_this4.miriamPlane)}targetCharacter.idleVideo.pause();if(_this4.showingTexts.length>0){_this4.showNextText()}else{_this4.text.hide(1);setTimeout(function(){_this4.showCredits()},3e3)}},1e4)}},{key:"showCredits",value:function showCredits(){var _this5=this;this.fadeOut().then(function(){_this5.introAni.disposeAni();_this5.camera.add(_this5.endCredits);_this5.endCredits.rotation.y=0;_this5.endCredits.init();if(_this5.config.platform=="vive"){_this5.endCredits.position.set(-.02,-.08,-60);_this5.endCredits.scale.set(.053,.053,.053);_this5.square.position.set(0,-15,-150)}else{_this5.endCredits.position.set(-.02,-.08,-50);_this5.endCredits.scale.set(.04,.04,.04);_this5.camera.position.set(0,15,150)}_this5.fadeIn().then(function(){TweenMax.to(_this5.endingSound,1,{volume:.1,onComlete:function onComlete(){console.log("Faded sound to 0.4 for video dialog")},onUpdate:function onUpdate(){_this5.endingSound.controlVolume(_this5.endingSound.volume)}});_this5.endCredits.play()})})}},{key:"fadeIn",value:function fadeIn(){var _this6=this;return new Promise(function(resolve,reject){TweenMax.to(_this6.fadePlane.material,2,{opacity:0,onComplete:function onComplete(){_this6.camera.remove(_this6.fadePlane);resolve()}})})}},{key:"fadeOut",value:function fadeOut(){var _this7=this;return new Promise(function(resolve,reject){_this7.camera.add(_this7.fadePlane);TweenMax.to(_this7.fadePlane.material,2,{opacity:1,onComplete:function onComplete(){resolve()}})})}},{key:"update",value:function update(dt){this.endCredits.update(dt)}},{key:"loadEndingSound",value:function loadEndingSound(){var _this8=this;return new Promise(function(resolve,reject){_this8.soundManager.createStaticSoundSampler("assets/sound/new_end.ogg",function(sampler){_this8.endingSound=sampler;_this8.endingSound.volume=.5;_this8.endingSound.controlVolume(_this8.endingSound.volume);resolve(sampler)})})}}]);return Ending}();exports.default=Ending},{"./end_credits":24,"./lib/text2d/index":40,"./util/debug":58,"./util/multiline_text":64}],26:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _extras_def=require("./extras_def");var _extras_def2=_interopRequireDefault(_extras_def);var _chapters=require("./chapters");var _chapters2=_interopRequireDefault(_chapters);var _chapters3=require("./web/chapters");var _chapters4=_interopRequireDefault(_chapters3);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _misc=require("./util/misc");var _misc2=_interopRequireDefault(_misc);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var EXTRAS_PATH="assets/extras";var HEART_PATH="ass";var Extras=function(_THREE$Object3D){_inherits(Extras,_THREE$Object3D);function Extras(config,camera,renderer){_classCallCheck(this,Extras);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Extras).call(this));_this.currentExtras=[];_this.cameras=[camera];_this.renderer=renderer;_this.config=config;_this.debug=false;_this.inControl=false;return _this}_createClass(Extras,[{key:"init",value:function init(loadingManager){var _this2=this;this.store={};events.on("hour_updated",function(hour){setTimeout(function(){_this2.loadHour(hour)},1e3)});events.on("control_threshold",function(passed){if(passed){for(var i=0;i<_this2.currentExtras.length;i++){_this2.currentExtras[i].mesh.material.size=_this2.currentExtras[i].mesh.material.rightSize}}});events.on("vr_start",function(cameras){_this2.cameras=cameras});return new Promise(function(resolve,reject){console.log("Loading extras",_extras_def2.default);_this2.loadHeart(loadingManager).then(function(heartResult){var typePromises=_extras_def2.default.types.map(function(type){return _this2.loadType(type)});return Promise.all(typePromises)}).then(function(results){console.log("Finished loading extras",_this2.store);resolve()})})}},{key:"loadHeart",value:function loadHeart(loadingManager){var _this3=this;return new Promise(function(resolve,reject){new THREE.JSONLoader(loadingManager).load("assets/animations/itzhak/models/heart1.json",function(geometry,material){_this3.heartGeo=geometry;_this3.heartMat=new THREE.MeshBasicMaterial({color:16711680,opacity:.3,transparent:true});resolve()})})}},{key:"loadType",value:function loadType(props){var _this4=this;return new Promise(function(resolve,reject){console.log("Loading extra type ",props);Potree.POCLoader.load(EXTRAS_PATH+"/"+props.fileName,function(geometry){props.geometry=geometry;_this4.store[props.name]=props;resolve()})})}},{key:"loadHour",value:function loadHour(hour){var _this5=this;console.log("Loading extras for hour ",hour);this.currentExtras.forEach(function(extra){_this5.remove(extra.handle);if(_this5.debug){}});this.currentExtras.splice(0);var chapter=_lodash2.default.find(_chapters2.default,{hour:hour});chapter.extraAssets.forEach(function(asset){if(_this5.store[asset.name]){(function(){console.log("Loading extra asset ",asset);var type=_this5.store[asset.name];if(_this5.config.platform=="desktop"){var chapterWeb=_lodash2.default.find(_chapters4.default,{hour:hour});var assetWeb=_lodash2.default.find(chapterWeb.extraAssets,{name:asset.name});if(assetWeb){_misc2.default.overwriteProps(asset,assetWeb)}}var extra=new THREE.Object3D;var mesh=new Potree.PointCloudOctree(type.geometry);mesh.material.rightSize=type.pointSize?type.pointSize:.1;mesh.material.size=mesh.material.rightSize*.01;mesh.material.lights=false;mesh.position.set(0,0,0);extra.position.fromArray(asset.position);if(asset.rotation){extra.rotation.set(asset.rotation[0]*Math.PI/180,asset.rotation[1]*Math.PI/180,asset.rotation[2]*Math.PI/180)}if(asset.scale){extra.scale.multiplyScalar(asset.scale)}var hearts=[];if(type.hearts){(function(){var counter=1;type.hearts.forEach(function(heartDef){var heart=new THREE.Mesh(_this5.heartGeo,_this5.heartMat);heart.position.fromArray(heartDef.position);if(heartDef.rotation){heart.rotation.set(heartDef.rotation[0]*Math.PI/180,heartDef.rotation[1]*Math.PI/180,heartDef.rotation[2]*Math.PI/180)}if(heartDef.scale){heart.scale.multiplyScalar(heartDef.scale);if(_this5.config.platform=="vive"){heart.scale.multiplyScalar(2)}}if(_this5.debug){_debug2.default.positionObject(heart,asset.name+"'s heart "+counter,false,-50,50,heartDef.rotation)}extra.add(heart);hearts.push(heart)})})()}extra.add(mesh);_this5.add(extra);_this5.currentExtras.push({name:asset.name,mesh:mesh,handle:extra,hearts:hearts});if(_this5.debug){_debug2.default.positionObject(extra,asset.name,false,-40,40,asset.rotation)}})()}})}},{key:"update",value:function update(dt,et){for(var i=0;i<this.currentExtras.length;i++){for(var j=0;j<this.cameras.length;j++){this.currentExtras[i].mesh.update(this.cameras[j],this.renderer)}}}},{key:"hideExtras",value:function hideExtras(){this.currentExtras.forEach(function(extra){extra.mesh.children[0].material.opacity=0;extra.hearts.forEach(function(heart){heart.visible=false})})}},{key:"showExtras",value:function showExtras(){this.currentExtras.forEach(function(extra){TweenMax.to(extra.mesh.children[0].material,1,{opacity:1,onComplete:function onComplete(){extra.hearts.forEach(function(heart){heart.visible=true})}})})}}]);return Extras}(THREE.Object3D);exports.default=Extras},{"./chapters":13,"./extras_def":27,"./util/debug":58,"./util/misc":63,"./web/chapters":69,lodash:96}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={types:[{name:"junkie",fileName:"junkie/cloud.js",pointSize:.013,hearts:[{position:[1.2,1.6,.5],rotation:[0,235,182],scale:.05}]},{name:"pocketCam",fileName:"pocketCam/cloud.js",pointSize:.01,hearts:[{position:[2.58,4.83,1.46],rotation:[0,0,0],scale:.05}]},{name:"dadOnBike",fileName:"dadOnBike/cloud.js",pointSize:.01,hearts:[{position:[1.68,4.5,1.68],rotation:[0,0,0],scale:.05},{position:[1.35,3.8,2.35],rotation:[0,0,0],scale:.02}]},{name:"grandpa",fileName:"grandpa/cloud.js",pointSize:.01,hearts:[{position:[.8,4.5,1],rotation:[0,0,0],scale:.05}]},{name:"grandma",fileName:"grandma/cloud.js",pointSize:.01,hearts:[{position:[1.46,8.2,2.35],rotation:[0,89,0],scale:.05},{position:[.78,4.5,1.8],rotation:[0,89,0],scale:.05}]},{name:"AnlenGrandma",fileName:"AnlenGrandma/cloud.js",pointSize:.01,hearts:[{position:[1.41,9.35,1.39],rotation:[0,111,0],scale:.1}]},{name:"sweetLady",fileName:"sweetLady/cloud.js",pointSize:.01,hearts:[{position:[1.7,3.82,1.4],rotation:[0,129,0],scale:.05}]},{name:"oldmansit",fileName:"oldmansit/cloud.js",pointSize:.01,hearts:[{position:[2.13,2,.56],rotation:[0,0,174],scale:.05}]},{name:"firstcouple",fileName:"firstcouple/cloud.js",pointSize:.01,hearts:[{position:[.85,5.5,1.46],rotation:[0,0,0],scale:.05},{position:[3.7,5.8,1.46],rotation:[0,0,0],scale:.05}]},{name:"kadafi",fileName:"kadafi/cloud.js",pointSize:.014,hearts:[{position:[1.68,2.14,1],rotation:[0,0,182],scale:.05},{position:[3.9,2.5,2.2],rotation:[0,146,178],scale:.05}]},{name:"100_",fileName:"100_/cloud.js",pointSize:.012,hearts:[{position:[2.8,7.8,3],rotation:[0,0,0],scale:.05}]},{name:"twoNiceJewishMen",fileName:"twoNiceJewishMen/cloud.js",pointSize:.011,hearts:[{position:[2.35,1.9,.78],rotation:[0,105,174],scale:.05},{position:[1.68,1.7,3.25],rotation:[0,105,174],scale:.05}]},{name:"dude",fileName:"dude/cloud.js",pointSize:.011,hearts:[{position:[1.68,5.17,1],rotation:[0,0,0],scale:.05}]},{name:"BlackGuy",fileName:"BlackGuy/cloud.js",pointSize:.012,hearts:[{position:[2.13,3,.45],rotation:[0,0,0],scale:.04}]},{name:"bridegroom",fileName:"bridegroom/cloud.js",pointSize:.015,hearts:[{position:[1.4,6.2,.5],rotation:[0,41,0],scale:.05},{position:[1.6,5.9,1.3],rotation:[0,41,0],scale:.05},{position:[20.73,5.03,2.59],rotation:[0,121,0],scale:.05},{position:[19.36,5.61,5.22],rotation:[0,101,0],scale:.05}]},{name:"bikeHottie",fileName:"bikeHottie/cloud.js",pointSize:.01,hearts:[{position:[.68,3,2.8],rotation:[0,0,0],scale:.04}]},{name:"yukalele",fileName:"yukalele/cloud.js",pointSize:.013,hearts:[{position:[.56,6.18,1.23],rotation:[0,105,0],scale:.05}]},{name:"cat",fileName:"cat/cloud.js",pointSize:.013,hearts:[{position:[.9,.35,1.23],rotation:[0,0,0],scale:.02}]},{name:"mom",fileName:"mom/cloud.js",pointSize:.011,hearts:[{position:[.56,3.2,3.7],rotation:[0,0,0],scale:.05},{position:[.78,1.8,1.46],rotation:[0,0,0],scale:.03}]},{name:"cart",fileName:"cart/cloud.js",pointSize:.011,hearts:[{position:[2.13,2.47,1.68],rotation:[0,146,182],scale:.04},{position:[2.8,2.14,2.13],rotation:[0,146,182],scale:.05}]},{name:"coolPair",fileName:"coolPair/cloud.js",pointSize:.01,hearts:[{position:[1.23,3.2,.56],rotation:[0,57,0],scale:.05},{position:[.56,3.2,3.7],rotation:[0,57,0],scale:.05}]},{name:"blueLady",fileName:"blueLady/cloud.js",pointSize:.013,hearts:[{position:[3.4,3.8,3.8],rotation:[0,73,0],scale:.05}]},{name:"manOnBench",fileName:"manOnBench/cloud.js",pointSize:.013,hearts:[{position:[.8,3.8,3.7],rotation:[0,0,0],scale:.05}]},{name:"DAN",fileName:"DAN/cloud.js",pointSize:.011,hearts:[{position:[1.46,2.14,1.46],rotation:[0,69,182],scale:.05}]},{name:"Gyno",fileName:"Gyno/cloud.js",pointSize:.012,hearts:[{position:[.8,1.46,.56],rotation:[0,0,146],scale:.05}]}]}},{}],28:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAX_FLOOD_HEIGHT=13;var Flood=function(_THREE$Object3D){_inherits(Flood,_THREE$Object3D);function Flood(config){_classCallCheck(this,Flood);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Flood).call(this));console.log("Flood constructed!");_this.config=config;_this.waveSource=new THREE.Vector3(0,-30,0);_this.waveFrequencey=.07;_this.waveHeight=.5;_this.waveLength=.3;_this.END_SCALE=.447;_this.START_SCALE=.005;_this.END_HEIGHT=12.45;_this.START_HEIGHT=11.65;_this.UPDATE_INTERVAL=1/25;return _this}_createClass(Flood,[{key:"init",value:function init(loadingManager){var geometry=new THREE.CircleGeometry(100,16);var tessellateModifier=new THREE.TessellateModifier(.1);var tessellationDepth=7;for(var i=0;i<tessellationDepth;i++){tessellateModifier.modify(geometry)}var texture=new THREE.TextureLoader(loadingManager).load("assets/flood/emotions.jpg");texture.wrapS=texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(10,10);var material=new THREE.MeshLambertMaterial({opacity:.8,map:texture,shading:THREE.FlatShading,transparent:true,wireframe:false});this.mesh=new THREE.Mesh(geometry,material);this.mesh.renderOrder=1;this.mesh.scale.set(this.START_SCALE,this.START_SCALE,this.START_SCALE);this.mesh.position.set(-.7,this.START_HEIGHT,0);this.mesh.rotation.x=-Math.PI/2;this.add(this.mesh);this.timer=0}},{key:"updateFlood",value:function updateFlood(percentage){if(percentage>=.3&&percentage<=.7){var scale=this.START_SCALE+(this.END_SCALE-this.START_SCALE)*((percentage-.3)/.4);this.mesh.scale.set(scale,scale,scale)}else if(percentage>.7&&percentage<=1){var height=this.START_HEIGHT+(this.END_HEIGHT-this.START_HEIGHT)*((percentage-.7)/.3);this.mesh.position.y=height}}},{key:"update",value:function update(dt,et){this.timer+=dt;if(this.timer>=this.UPDATE_INTERVAL){this.timer=0;var percent=Math.min(et/(this.config.endTime-120),1);this.updateFlood(percent)}for(var i=0;i<this.mesh.geometry.vertices.length;i++){var dist=this.mesh.geometry.vertices[i].distanceTo(this.waveSource);dist=dist%this.waveLength/this.waveLength;this.mesh.geometry.vertices[i].z=this.waveHeight*Math.sin(et*Math.PI*2*this.waveFrequencey+Math.PI*2*dist)}this.mesh.geometry.verticesNeedUpdate=true}}]);return Flood}(THREE.Object3D);exports.default=Flood},{"./util/debug":58}],29:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")
}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Fountain=function(_THREE$Object3D){_inherits(Fountain,_THREE$Object3D);function Fountain(square){_classCallCheck(this,Fountain);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Fountain).call(this));_this.BASE_PATH="assets/fountain/";console.log("Fountain constructed!");_this.debug=false;_this.downVelocity=new THREE.Vector3(1,7.8,0);_this.upVelocity=new THREE.Vector3(1.5,11,0);_this.centerVelocity=new THREE.Vector3(0,15,0);_this.outerUp=true;_this.centerRingOriParameter=[new THREE.Vector3(0,9,0),new THREE.Vector3(0,.5,0),new THREE.Vector3(0,-14,0),new THREE.Vector3(1,0,1)];_this.firstRingOriParameter=[new THREE.Vector3(1.5,6,0),new THREE.Vector3,new THREE.Vector3(0,-12,0),new THREE.Vector3];_this.secondRingOriParameter=[new THREE.Vector3(1.5,8,0),new THREE.Vector3,new THREE.Vector3(0,-12,0),new THREE.Vector3];_this.fireOriParameter=[new THREE.Vector3(0,5,0),new THREE.Vector3(0,1,0),new THREE.Vector3(.3,0,.2),new THREE.Vector3];_this.square=square;_this.showTime=false;_this.trickleSize=[.15,.3,0];_this.soundEvents={9:[{time:1,action:function action(){_this.zeroAni()}},{time:6,action:function action(){_this.firstAni()}},{time:14.5,action:function action(){_this.secAni()}},{time:27,action:function action(){_this.thirdAni()}},{time:37,action:function action(){_this.fourthAni()}},{time:54,action:function action(){_this.fifthAni()}},{time:62,action:function action(){_this.sixthAni()}},{time:78,action:function action(){_this.seventhAni()}},{time:97,action:function action(){_this.eighthAni()}},{time:107,action:function action(){_this.ninethAni()}},{time:117,action:function action(){_this.tenthAni()}}],19:[{time:1,action:function action(){_this.zeroAni()}},{time:6,action:function action(){_this.firstAni()}},{time:14.5,action:function action(){_this.secAni()}},{time:27,action:function action(){_this.thirdAni()}},{time:37,action:function action(){_this.fourthAni()}},{time:54,action:function action(){_this.fifthAni()}},{time:62,action:function action(){_this.sixthAni()}},{time:78,action:function action(){_this.seventhAni()}},{time:97,action:function action(){_this.eighthAni()}},{time:107,action:function action(){_this.tenthAni()}}]};return _this}_createClass(Fountain,[{key:"init",value:function init(loadingManager){var _this2=this;this.particleGroup=new SPE.Group({texture:{value:new THREE.TextureLoader(loadingManager).load(this.BASE_PATH+"water_splash.png")},maxParticleCount:1e4});this.fireParticleGroup=new SPE.Group({texture:{value:new THREE.TextureLoader(loadingManager).load(this.BASE_PATH+"fire.jpg"),frames:new THREE.Vector2(4,1),loop:4},maxParticleCount:6e3});var emitter=void 0;var position=new THREE.Vector3(0,1,0);emitter=this.createFire(position,16777215);emitter.disable();this.add(this.fireParticleGroup.mesh);this.fireEmitters=[emitter];var angle=30;var radius=3.5;var rotation=0;this.centerRingEmitters=[];this.firstRingEmitters=[];this.secondRingEmitters=[];emitter=this.createTrickleCenter(position,this.centerVelocity,65535);emitter.disable();this.centerRingEmitters=[emitter];position.y=0;for(var i=0;i<=360;i+=angle){rotation=i*Math.PI/180;position.x=Math.cos(rotation)*radius;position.z=Math.sin(rotation)*radius;emitter=this.createTrickle(position,rotation,this.downVelocity,12043721);this.firstRingEmitters.push(emitter)}this.add(this.particleGroup.mesh);position.y=-.5;radius=5;this.colorWhite=new THREE.Color(16777215);this.colorRed=new THREE.Color(16711680);for(var _i=0;_i<=360;_i+=angle){rotation=_i*Math.PI/180;position.x=Math.cos(rotation)*radius;position.z=Math.sin(rotation)*radius;var backFace=(_i+180)*Math.PI/180;emitter=this.createTrickle(position,backFace,this.upVelocity,16777215);this.secondRingEmitters.push(emitter)}var geo=new THREE.SphereGeometry(.3);var mat=new THREE.MeshBasicMaterial({color:65280});this.center=new THREE.Mesh(geo,mat);this.spotLights=[];this.spotLights[0]=this.createSpotLight(new THREE.Vector3(6.8,-3.2,.96),new THREE.Vector3(.3,1,-.3),1,.8,20,1.5,.3,16771397);this.spotLights[1]=this.createSpotLight(new THREE.Vector3(-7.8,-3.2,1.2),new THREE.Vector3(-.3,1,.3),1,.8,20,1.5,.3,16735938);this.spotLights[2]=this.createSpotLight(new THREE.Vector3(-.78,-3.2,-7.9),new THREE.Vector3(-.3,1,-.3),1,.8,20,1.5,.3,2949111);this.spotLightCenters=new THREE.Object3D;this.spotLightCenters.add(this.spotLights[0].target);this.spotLightCenters.add(this.spotLights[1].target);this.spotLightCenters.add(this.spotLights[2].target);this.add(this.spotLightCenters);this.switchLight(false);this.lightsAreOn=false;if(this.debug){events.emit("add_gui",{folder:"Fountain water up``",listen:true,step:.01},this.upVelocity,"x");events.emit("add_gui",{folder:"Fountain water up``",listen:true,step:.01},this.upVelocity,"y");events.emit("add_gui",{folder:"Fountain water down``",listen:true,step:.01},this.downVelocity,"x");events.emit("add_gui",{folder:"Fountain water down``",listen:true,step:.01},this.downVelocity,"y")}events.on("control_threshold",function(passed){if(passed){for(var _i2=0;_i2<_this2.particleGroup.emitters.length;_i2++){_this2.particleGroup.emitters[_i2].size.value=_this2.trickleSize}}})}},{key:"assignCylinders",value:function assignCylinders(cylinders){this.cylinders=cylinders}},{key:"createSpotLight",value:function createSpotLight(pos,pos2,_intensity,_angle,_distance,_decay,_penumbra,_color){var geometry=new THREE.ConeGeometry(.1,.2,8);var material=new THREE.MeshBasicMaterial({color:16711680});var cone=new THREE.Mesh(geometry,material);cone.visible=false;var s_l=new THREE.SpotLight(_color,_intensity,_distance,_angle,_penumbra,_decay);s_l.target.position.copy(pos2);s_l.position.copy(pos);s_l.add(cone);this.add(s_l);return s_l}},{key:"update",value:function update(dt){this.particleGroup.tick(dt*.4);if(this.showTime){this.fireParticleGroup.tick(dt*.4)}}},{key:"updateVideoTime",value:function updateVideoTime(time){var _this3=this;if(this.nextAnim&&time>=this.nextAnim.time){console.log("Show Fountain - do anim sequence ",this.nextAnim);this.nextAnim.action();if(this.currentSequence.length>0){this.nextAnim=this.currentSequence.shift()}else{this.nextAnim=null;console.log("Show - count down 10 sec to reset ani");setTimeout(function(){_this3.resetAni();_this3.startCycle()},1e4)}}}},{key:"startShow",value:function startShow(hour){console.log("Fountain starting show!");this.showTime=true;clearInterval(this.cycleIntervalID);this.fireEmitters[0].enable();this.centerRingEmitters[0].enable();this.changeWaterColor(true);this.switchLight(true);this.currentSequence=this.soundEvents[hour].slice(0);this.nextAnim=this.currentSequence.shift();events.emit("show_start")}},{key:"resetShow",value:function resetShow(){this.skyLightBack();this.resetAni()}},{key:"changeWaterColor",value:function changeWaterColor(showTime){for(var i=0;i<this.secondRingEmitters.length;i++){this.secondRingEmitters[i].color.value=showTime?this.colorRed:this.colorWhite}}},{key:"switchLight",value:function switchLight(on){if(this.spotLights){for(var i=0;i<this.spotLights.length;i++){this.spotLights[i].intensity=on}}}},{key:"resetAni",value:function resetAni(){var _this4=this;console.log("SHOW END");for(var i=0;i<this.centerRingOriParameter.length;i++){this.setGroupEmittersValue(this.centerRingEmitters,i,this.centerRingOriParameter[i].clone());this.setGroupEmittersValue(this.firstRingEmitters,i,this.firstRingOriParameter[i].clone());this.setGroupEmittersValue(this.secondRingEmitters,i,this.secondRingOriParameter[i].clone());this.setGroupEmittersValue(this.fireEmitters,i,this.fireOriParameter[i].clone())}if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,3,{y:0,onComplete:function onComplete(){_this4.showTime=false}})}this.fireEmitters[0].disable();this.centerRingEmitters[0].disable();this.changeWaterColor(false);this.switchLight(false);this.stopCylinderAni();events.emit("show_end")}},{key:"startCycle",value:function startCycle(){var _this5=this;this.cycleIntervalID=setInterval(function(){_this5.outerUp=!_this5.outerUp;for(var i=0;i<_this5.firstRingEmitters.length;i++){_this5.firstRingEmitters[i].velocity.value=_this5.outerUp?_this5.downVelocity:_this5.upVelocity}for(var _i3=0;_i3<_this5.firstRingEmitters.length;_i3++){_this5.secondRingEmitters[_i3].velocity.value=_this5.outerUp?_this5.upVelocity:_this5.downVelocity}},1e4)}},{key:"createTrickle",value:function createTrickle(position,rotation,velocity,colorCode){var emitter=new SPE.Emitter({maxAge:4,type:SPE.distributions.BOX,position:{value:position,spread:new THREE.Vector3(.2,0,.2)},rotation:{axis:new THREE.Vector3(0,1,0),angle:rotation,"static":true},acceleration:{value:new THREE.Vector3(0,-12,0)},velocity:{value:velocity.clone()},color:{value:new THREE.Color(colorCode)},size:{value:[.0025,.003,0]},particleCount:200,opacity:{value:[1,.8,.5]},transparent:true,wiggle:{value:2,spread:1}});this.particleGroup.addEmitter(emitter);return emitter}},{key:"createTrickleCenter",value:function createTrickleCenter(position,velocity,colorCode){var emitter=new SPE.Emitter({maxAge:{value:2,spread:0},type:SPE.distributions.BOX,position:{value:position,spread:new THREE.Vector3(.4,0,.4)},acceleration:{value:new THREE.Vector3(0,-14,0),spread:new THREE.Vector3(1,0,1)},velocity:{value:velocity,spread:new THREE.Vector3(0,.5,0)},color:{value:new THREE.Color(colorCode)},size:{value:[.3,.4,.2,0]},particleCount:800,opacity:{value:[.5,.8,.4,.2]},transparent:true});this.particleGroup.addEmitter(emitter);return emitter}},{key:"createFire",value:function createFire(position,colorCode){var emitter=new SPE.Emitter({maxAge:{value:.5,spread:0},type:SPE.distributions.BOX,position:{value:position,spread:new THREE.Vector3(.3,0,.3)},velocity:{value:new THREE.Vector3(0,6,0),spread:new THREE.Vector3(0,1,0)},acceleration:{value:new THREE.Vector3(.3,0,.2),spread:new THREE.Vector3},color:{value:new THREE.Color(colorCode)},size:{value:[4,3,2,0]},particleCount:200,opacity:{value:[1,.8,.6,0]},transparent:true,drag:{value:.5,spread:0}});this.fireParticleGroup.addEmitter(emitter);return emitter}},{key:"updateEmittersValue",value:function updateEmittersValue(emitters,arrayOfIndex,arrayOfValue,time,_yoyo,_repeatTime,_delay,_repeatDelay){var _this6=this;var dummyVectors=[];for(var j=0;j<arrayOfIndex.length;j++){dummyVectors.push(this.selectToChangeValue(emitters[0],arrayOfIndex[j]))}TweenMax.to(dummyVectors[0],time,{x:arrayOfValue[0].x,y:arrayOfValue[0].y,z:arrayOfValue[0].z,yoyo:_yoyo,repeat:_repeatTime,delay:_delay,repeatDelay:_repeatDelay,onStart:function onStart(){if(dummyVectors.length>1){for(var k=1;k<dummyVectors.length;k++){TweenMax.to(dummyVectors[k],time,{x:arrayOfValue[k].x,y:arrayOfValue[k].y,z:arrayOfValue[k].z,yoyo:_yoyo,repeat:_repeatTime,delay:_delay,repeatDelay:_repeatDelay})}}},onUpdate:function onUpdate(){for(var i=0;i<emitters.length;i++){for(var k=0;k<dummyVectors.length;k++){_this6.setEmitterValue(emitters[i],arrayOfIndex[k],dummyVectors[k])}}}})}},{key:"setEmitterValue",value:function setEmitterValue(emitter,valueIndex,value){switch(valueIndex){case 0:emitter.velocity.value=value;break;case 1:emitter.velocity.spread=value;break;case 2:emitter.acceleration.value=value;break;case 3:emitter.acceleration.spread=value;break}}},{key:"setGroupEmittersValue",value:function setGroupEmittersValue(emitters,valueIndex,value){switch(valueIndex){case 0:for(var i=0;i<emitters.length;i++){emitters[i].velocity.value=value}break;case 1:for(var _i4=0;_i4<emitters.length;_i4++){emitters[_i4].velocity.spread=value}break;case 2:for(var _i5=0;_i5<emitters.length;_i5++){emitters[_i5].acceleration.value=value}break;case 3:for(var _i6=0;_i6<emitters.length;_i6++){emitters[_i6].acceleration.spread=value}break}}},{key:"selectToChangeValue",value:function selectToChangeValue(emitter,valueIndex){switch(valueIndex){case 0:return emitter.velocity.value.clone();break;case 1:return emitter.velocity.spread.clone();break;case 2:return emitter.acceleration.value.clone();break;case 3:return emitter.acceleration.spread.clone();break}}},{key:"startCylinderAni",value:function startCylinderAni(){this.cylinders[0].tweenAni=TweenMax.to(this.cylinders[0].rotation,60,{y:Math.PI*2,ease:Power0.easeNone,yoyo:true,repeat:1});this.cylinders[1].tweenAni=TweenMax.to(this.cylinders[1].rotation,60,{y:-Math.PI*4,ease:Power0.easeNone,yoyo:true,repeat:1})}},{key:"stopCylinderAni",value:function stopCylinderAni(){if(this.cylinders[0].tweenAni!=null)this.cylinders[0].tweenAni.kill();if(this.cylinders[1].tweenAni!=null)this.cylinders[1].tweenAni.kill()}},{key:"skyLightDarken",value:function skyLightDarken(){this.oriHemi=this.square.sky.getHemiLghtOriStatus();this.oriDir=this.square.sky.getDirLghtOriStatus();this.square.sky.pauseUpdateHemiLight();this.oriFLightIntensity=this.square.fountainLight.intensity;this.oriFLightDistance=this.square.fountainLight.distance;TweenMax.to(this.square.sky.dirLight,3,{intensity:.15});TweenMax.to(this.square.sky.hemiLight,3,{intensity:.01});TweenMax.to(this.square.fountainLight,1,{intensity:2});TweenMax.to(this.square.fountainLight,1,{distance:20})}},{key:"skyLightBack",value:function skyLightBack(){var _this7=this;var hemiTargetIntensity=this.square.sky.getHemiLghtCorrectIntensity();TweenMax.to(this.square.sky.hemiLight,3,{intensity:hemiTargetIntensity});TweenMax.to(this.square.sky.dirLight,3,{intensity:this.oriDir.intensity,onComplete:function onComplete(){_this7.square.sky.resumeUpdateHemiLight()}});TweenMax.to(this.square.fountainLight,1,{intensity:this.oriFLightIntensity});TweenMax.to(this.square.fountainLight,1,{distance:this.oriFLightDistance})}},{key:"zeroAni",value:function zeroAni(){this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1.5,y:8,z:0}],.1,true,7,0,2);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:6,z:0}],.1,true,7,0,2);this.startCylinderAni();this.skyLightDarken()}},{key:"firstAni",value:function firstAni(){this.updateEmittersValue(this.centerRingEmitters,[0,1,2],[{x:0,y:16,z:0},{x:3,y:0,z:3},{x:0,y:-30,z:0}],3,true,1,0,1);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:11,z:0}],3,true,1,0,1);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,3,{y:1.4,yoyo:true,repeat:1,delay:0,repeatDelay:1})}}},{key:"secAni",value:function secAni(){this.updateEmittersValue(this.centerRingEmitters,[0,3,2],[{x:0,y:14,z:0},{x:3,y:0,z:3},{x:0,y:-25,z:0}],0,false,3,0,5);this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:8,z:0}],4,false,3,1,1);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:2,y:12,z:0}],0,false,3,0,5);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1.5,y:5,z:0}],4,false,2,1,1);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:6,z:0}],0,false,3,0,5);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:2,y:12,z:0}],4,false,2,1,1);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:12,z:0}],0,false,3,0,5);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:6,z:0}],4,false,3,1,1);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,2,{y:1.4,yoyo:false,repeat:3,delay:1.5,repeatDelay:2});TweenMax.to(this.spotLightCenters.position,4,{y:-1,yoyo:false,repeat:2,delay:1.5,repeatDelay:1})}}},{key:"thirdAni",value:function thirdAni(){this.updateEmittersValue(this.centerRingEmitters,[0,3],[{x:0,y:14,z:0},{x:3,y:0,z:3}],.5,true,3,1,2);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1.5,y:7,z:0}],.5,true,3,1,2);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:2,y:6,z:0}],.5,true,3,1,2);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:7,z:0}],.5,true,3,1,2);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,2,{y:1.4});TweenMax.to(this.spotLightCenters.rotation,2,{y:4,yoyo:true,repeat:5,delay:0,repeatDelay:0})}}},{key:"fourthAni",value:function fourthAni(){this.updateEmittersValue(this.centerRingEmitters,[0,2,3],[{x:0,y:18,z:0},{x:0,y:-30,z:0},{x:1,y:0,z:1}],0,false,0,0,0);this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:15,z:0}],0,false,0,1,0);this.updateEmittersValue(this.centerRingEmitters,[1],[{x:4,y:.5,z:4}],1,true,3,1,2);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:2.5,y:10,z:0}],1,true,3,1,2);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:14,z:0}],1,true,3,1,2);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:8.5,z:0}],1,true,3,1,2);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.rotation,3,{y:-4,yoyo:true,repeat:3,delay:1,repeatDelay:0});TweenMax.to(this.spotLightCenters.position,2,{x:"+=1",z:"+=1",yoyo:true,repeat:3,delay:1,repeatDelay:1})}}},{key:"fifthAni",value:function fifthAni(){this.updateEmittersValue(this.centerRingEmitters,[0,2],[{x:0,y:9,z:0},{x:0,y:-20,z:0}],8,false,0,0,0);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1.5,y:6,z:0}],8,false,0,0,0);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:2,y:7,z:0}],8,false,0,0,0);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:5,z:0}],8,false,0,0,0);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,8,{y:-2.5})}}},{key:"sixthAni",value:function sixthAni(){this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:14,z:0}],1,true,7,0,1);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1.5,y:9,z:0}],1,true,7,1,1);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:3,y:9,z:0}],1,true,7,0,1);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:8,z:0}],1,true,7,0,1);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,2,{y:1.4,yoyo:true,repeat:7,delay:0,repeatDelay:0})}}},{key:"seventhAni",value:function seventhAni(){this.updateEmittersValue(this.centerRingEmitters,[1],[{x:2,y:.5,z:2}],0,false,0,0,0);this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:13,z:0}],1,true,7,0,1);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:3,y:9,z:0}],1,true,7,0,1);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:13,z:0}],1,true,7,0,1);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:6.5,z:0}],1,true,7,0,1);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,2,{y:1.5,yoyo:true,repeat:6,delay:0,repeatDelay:0})}}},{key:"eighthAni",value:function eighthAni(){this.updateEmittersValue(this.centerRingEmitters,[0,1,2,3],[{x:0,y:16,z:0},{x:1,y:.5,z:1},{x:0,y:-30,z:0},{x:3,y:0,z:3}],8,false,0,0,0);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:3,y:9,z:0}],8,false,0,0,0);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:12,z:0}],8,false,0,0,0);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:9.5,z:0}],6,false,0,2,0);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.rotation,12,{y:Math.PI*8,delay:2});TweenMax.to(this.spotLightCenters.position,3,{x:"-=1",z:"-=1",yoyo:true,repeat:5})}}},{key:"ninethAni",value:function ninethAni(){this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:12,z:0}],.1,true,7,0,1);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1,y:6,z:0}],.1,true,7,0,1);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1.5,y:9,z:0}],.1,true,7,0,1);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:6,z:0}],.1,true,7,0,1)}},{key:"tenthAni",value:function tenthAni(){this.updateEmittersValue(this.centerRingEmitters,[0,3],[{x:0,y:18,z:0},{x:1,y:0,z:1}],0,false,0,0,0);this.updateEmittersValue(this.centerRingEmitters,[0],[{x:0,y:9,z:0}],8,false,0,2,0);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:1,y:12,z:0}],0,false,0,0,0);this.updateEmittersValue(this.firstRingEmitters,[0],[{x:2,y:6,z:0}],8,false,0,2,0);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:1,y:16,z:0}],0,false,0,0,0);this.updateEmittersValue(this.secondRingEmitters,[0],[{x:2,y:7,z:0}],8,false,0,2,0);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:13,z:0}],0,false,0,0,0);this.updateEmittersValue(this.fireEmitters,[0],[{x:0,y:4,z:0}],5,false,0,2,0);if(this.spotLightCenters){TweenMax.to(this.spotLightCenters.position,2,{y:1.8});TweenMax.to(this.spotLightCenters.position,5,{y:-1.7,delay:2})}this.skyLightBack()}}]);return Fountain}(THREE.Object3D);exports.default=Fountain},{"./util/debug":58}],30:[function(require,module,exports){(function(global){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _events=require("events");var _events2=_interopRequireDefault(_events);var _gui_manager=require("./gui_manager");var _gui_manager2=_interopRequireDefault(_gui_manager);var _sky=require("./sky");var _sky2=_interopRequireDefault(_sky);var _square=require("./square");var _square2=_interopRequireDefault(_square);var _collision_manager=require("./collision_manager");var _collision_manager2=_interopRequireDefault(_collision_manager);var _character=require("./character");var _character2=_interopRequireDefault(_character);var _keyboard_controller=require("./keyboard_controller");var _keyboard_controller2=_interopRequireDefault(_keyboard_controller);var _post_shader=require("./post_shader");var _post_shader2=_interopRequireDefault(_post_shader);var _flood=require("./flood");var _flood2=_interopRequireDefault(_flood);var _zoom_controller=require("./zoom_controller");var _zoom_controller2=_interopRequireDefault(_zoom_controller);var _tzina_vr_controls=require("./tzina_vr_controls");var _tzina_vr_controls2=_interopRequireDefault(_tzina_vr_controls);var _intro=require("./intro");var _intro2=_interopRequireDefault(_intro);var _sound_manager=require("./sound_manager");var _sound_manager2=_interopRequireDefault(_sound_manager);var _time_controller=require("./time_controller");var _time_controller2=_interopRequireDefault(_time_controller);var _character_controller=require("./character_controller");var _character_controller2=_interopRequireDefault(_character_controller);var _show=require("./show");var _show2=_interopRequireDefault(_show);var _extras=require("./extras");var _extras2=_interopRequireDefault(_extras);var _sun_gazer=require("./sun_gazer");var _sun_gazer2=_interopRequireDefault(_sun_gazer);var _instructions=require("./instructions");var _instructions2=_interopRequireDefault(_instructions);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _hannah=require("./animations/hannah");var _hannah2=_interopRequireDefault(_hannah);var _lupo12pm=require("./animations/lupo12pm");var _lupo12pm2=_interopRequireDefault(_lupo12pm);var _miriam=require("./animations/miriam");var _miriam2=_interopRequireDefault(_miriam);var _haim=require("./animations/haim");var _haim2=_interopRequireDefault(_haim);var _itzik=require("./animations/itzik");var _itzik2=_interopRequireDefault(_itzik);var _meir=require("./animations/meir");var _meir2=_interopRequireDefault(_meir);var _mark=require("./animations/mark");var _mark2=_interopRequireDefault(_mark);var _agam12pm=require("./animations/agam12pm");var _agam12pm2=_interopRequireDefault(_agam12pm);var _itzhak=require("./animations/itzhak");var _itzhak2=_interopRequireDefault(_itzhak);var _shirin=require("./animations/shirin");var _shirin2=_interopRequireDefault(_shirin);var _rami=require("./animations/rami");var _rami2=_interopRequireDefault(_rami);var _introAni=require("./animations/introAni");var _introAni2=_interopRequireDefault(_introAni);var _index=require("./lib/text2d/index");var _water_drops=require("./water_drops");var _water_drops2=_interopRequireDefault(_water_drops);var _fpscount=require("./util/fpscount");var _fpscount2=_interopRequireDefault(_fpscount);var _video_rgbd=require("./util/video_rgbd");var _video_rgbd2=_interopRequireDefault(_video_rgbd);var _ending=require("./ending");var _ending2=_interopRequireDefault(_ending);var _coin=require("./coin");var _coin2=_interopRequireDefault(_coin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Game=function(){function Game(config){_classCallCheck(this,Game);console.log("Game constructed!");this.config=config;this.started=false;this.controlPassed=false;this.shownWASD=false;this.shownZoom=false;this.ended=false;this.config.endTime=0}_createClass(Game,[{key:"init",value:function init(){console.log("Game init!");var TzinaEmitter=function(_EventEmitter){_inherits(TzinaEmitter,_EventEmitter);function TzinaEmitter(){_classCallCheck(this,TzinaEmitter);return _possibleConstructorReturn(this,Object.getPrototypeOf(TzinaEmitter).apply(this,arguments))}return TzinaEmitter}(_events2.default);this.emitter=new TzinaEmitter;this.emitter.setMaxListeners(40);global.events=this.emitter;global.inVR=false;this.gui=new _gui_manager2.default(this.emitter);if(!this.config.production){this.gui.init()}this.renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});this.renderer.setClearColor(0,1);this.renderer.setPixelRatio(window.devicePixelRatio);this.container=document.getElementById("game");this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,2e6);this.soundManager=new _sound_manager2.default(this.config,this.camera,this.scene);this.scene.add(this.camera);this.clock=new THREE.Clock;this.hemiLight=new THREE.HemisphereLight(16777215,16777215,0);this.hemiLight.color.setHSL(1,1,1);this.hemiLight.position.set(0,500,0);this.scene.add(this.hemiLight);this.dirLight=new THREE.DirectionalLight(16777215,.7);this.dirLight.position.set(0,120,-200);this.dirLight.color.setHSL(1,1,1);this.dirLight=new THREE.DirectionalLight(16777215,.7);this.dirLight.color.setHSL(.1,.42,.9);this.scene.add(this.dirLight);this.loadingManager=new THREE.LoadingManager;this.collisionManager=new _collision_manager2.default(this.camera,this.scene);this.extras=new _extras2.default(this.config,this.camera,this.renderer);this.sky=new _sky2.default(this.loadingManager,this.scene,this.dirLight,this.hemiLight);this.square=new _square2.default(this.collisionManager,this.renderer,this.camera,this.config,this.soundManager,this.scene,this.extras,this.sky);this.sunGazer=new _sun_gazer2.default(this.square,this.soundManager,this.collisionManager);this.sunGazer.init();this.flood=new _flood2.default(this.config);this.vrControls=new _tzina_vr_controls2.default(this.emitter,this.camera,null,this.square);this.zoomController=new _zoom_controller2.default(this.config,this.emitter,this.camera,this.square,this.scene,this.vrControls);this.zoomController.init();if(!this.config.noAnimations){this.animations={Hannah:new _hannah2.default(this.config),Miriam:new _miriam2.default(this.renderer,this.config),Haim:new _haim2.default(this.renderer,this.sky,this.square,this.config),Itzik:new _itzik2.default(this.config),Meir:new _meir2.default(this.config),Mark:new _mark2.default(this.sky,this.square,this.config),Agam12PM:new _agam12pm2.default(this.config,this.square),Lupo12PM:new _lupo12pm2.default(this.config),Itzhak:new _itzhak2.default(this.config),Rami:new _rami2.default(this.renderer,this.config),Shirin:new _shirin2.default(this.config)}}else{this.animations={}}this.characterController=new _character_controller2.default(this.config,this.animations,this.square,this.collisionManager,this.soundManager,this.scene);this.timeController=new _time_controller2.default(this.config,this.container,this.square,this.sky,this.scene,this.camera,this.soundManager,this.sunGazer);this.introAni=new _introAni2.default(this.scene,this.renderer,this.square,this.timeController,this.config);this.intro=new _intro2.default(this.camera,this.square,this.timeController,this.soundManager,this.scene,this.vrControls,this.zoomController,this.config,this.introAni);this.instructions=new _instructions2.default(this.config,this.camera,this.square,this.soundManager);if(!this.config.noAnimations){this.animations["Lupo12PM"].assignChController(this.characterController)}var TEXT_DEFINITION={align:_index.textAlign.center,font:"20px Arial",fillStyle:"#FFFFFF",antialias:true};this.zoomGuidance=new _index.MeshText2D("SCROLL TO ENTER",TEXT_DEFINITION);this.zoomGuidance.position.set(0,-180,0);this.zoomGuidance.material.opacity=0;this.scene.add(this.zoomGuidance);this.ZOOM_OUT_SOUND="assets/sound/zoom_out.ogg";this.SUN_GAZE_SOUND="assets/sound/ui/Hour_Replace_1.ogg";this.waterDrops=new _water_drops2.default(this.config);this.camera.add(this.waterDrops);this.show=new _show2.default(this.config,this.square,this.characterController,this.timeController,this.soundManager);this.ending=new _ending2.default(this.config,this.camera,this.timeController,this.characterController,this.scene,this.vrControls,this.square,this.introAni,this.soundManager);this.coin=new _coin2.default(this.characterController)}},{key:"load",value:function load(onLoad,onProgress){var _this2=this;console.log("Game load!");this.loadingManager.onLoad=function(){console.log("Done loading everything!");if(!_this2.config.noSquare){_this2.scene.add(_this2.square);_this2.sky.applyToMesh(_this2.square.getSphereMesh());_this2.introAni.createSnowParticle();_this2.scene.add(_this2.introAni)}onLoad()};this.loadingManager.onError=function(err){console.log("Error during load",err)};this.loadingManager.onStart=function(url,itemsLoaded,itemsTotal){console.log("Loading ",url,"("+itemsLoaded+"/"+itemsLoaded+")")};this.loadingManager.onProgress=function(url,itemsLoaded,itemsTotal){if(onProgress){onProgress(url,itemsLoaded,itemsTotal)}};if(!this.config.noSquare){this.square.init(this.loadingManager);this.introAni.init(this.loadingManager);this.sky.init(this.loadingManager);console.log("Initializing characters");this.characterController.init(this.loadingManager);this.coin.init(this.loadingManager)}this.intro.init(this.loadingManager);this.soundManager.init(this.loadingManager);this.timeController.init(this.loadingManager);this.waterDrops.init(this.loadingManager);this.flood.init(this.loadingManager);this.show.init();this.instructions.init();this.ending.init(this.loadingManager);if(this.config.platform=="desktop"){this.config.endTime=60*15}else{this.config.endTime=60*15
}console.log("Experence end time: ",this.config.endTime);_video_rgbd2.default.initPool();this.vrEffect=new THREE.VREffect(this.renderer);this.vrEffect.setSize(window.innerWidth,window.innerHeight);var params={hideButton:false,isUndistorted:false};this.vrManager=new WebVRManager(this.renderer,this.vrEffect,params);console.log("VR Manager: ",this.vrManager);var element=this.renderer.domElement;this.container.appendChild(element);this.resize()}},{key:"showZoomGuidance",value:function showZoomGuidance(){var targetOpacity=1;TweenMax.to(this.zoomGuidance.material,1,{opacity:targetOpacity})}},{key:"hideZoomGuidance",value:function hideZoomGuidance(){var targetOpacity=0;TweenMax.to(this.zoomGuidance.material,1,{opacity:targetOpacity})}},{key:"start",value:function start(){var _this3=this;this.counter=0;events.on("zoom_used",function(){console.log("Zoom controller used!");_this3.shownZoom=true;_this3.hideZoomGuidance();_this3.scene.remove(_this3.zoomGuidance)});events.on("time_rotated",function(){});events.on("base_position",function(){});events.on("chapter_threshold",function(passed){});events.on("gaze_started",function(){});events.on("control_threshold",function(passed){if(passed){_this3.controlPassed=true;_this3.soundManager.play("ambience");_this3.introAni.disposeAni();_this3.square.add(_this3.flood);setTimeout(function(){_this3.instructions.start()},2e3)}});this.started=true;if(this.config.controls=="locked"&&!window.WebVRConfig.FORCE_ENABLE_VR){if(this.config.platform=="desktop"){this.keyboardController=new _keyboard_controller2.default(this.config,this.camera,this.square,this.collisionManager);this.keyboardController.init()}else{this.vrControls.standing=true}}else{this.vrControls=null;console.log("Orbit controls");this.keyboardController=new _keyboard_controller2.default(this.config,this.camera,this.square,this.collisionManager);this.keyboardController.init();this.controls=new THREE.OrbitControls(this.camera)}if(!this.config.noSquare){this.square.fountain.startCycle()}if(this.config.skipIntro){if(!this.config.noSquare){this.timeController.transitionTo(this.config.startTime,1)}this.zoomController.start();this.soundManager.play("ambience");setTimeout(function(){events.emit("intro_end");_this3.intro.playCredits()},3e3)}else{console.log("VR Compatible?",this.vrManager.isVRCompatible);if(!this.vrManager.isVRCompatible&&!window.WebVRConfig.FORCE_ENABLE_VR){this.intro.position();this.intro.start();this.introAni.start()}}}},{key:"animate",value:function animate(t){this.update(this.clock.getDelta(),this.clock.getElapsedTime());this.render()}},{key:"update",value:function update(dt,et){if(!this.config.noSquare){this.sky.update(dt);this.square.update(dt,et);this.timeController.update(dt,et);this.characterController.update(dt,et);this.waterDrops.update(dt);if(!this.controlPassed){this.intro.update(dt,et)}if(this.coin.toCheck){this.coin.update(this.camera,dt,et)}}if(this.keyboardController){this.keyboardController.update(dt)}this.introAni.update(dt,et);if(this.vrControls){this.vrControls.update()}else{this.controls.update()}this.collisionManager.update(dt);this.flood.update(dt,et);if(this.ended){this.ending.update(dt)}this.endCheck(et)}},{key:"endCheck",value:function endCheck(time){if(!this.ended&&time>=this.config.endTime){this.ended=true;this.ending.start()}}},{key:"render",value:function render(){this.vrManager.render(this.scene,this.camera)}},{key:"resize",value:function resize(){var width=this.container.offsetWidth;var height=this.container.offsetHeight;console.log("Tzina set size ",width,height);this.camera.aspect=width/height;this.camera.updateProjectionMatrix();this.renderer.setSize(width,height);this.vrEffect.setSize(width,height)}},{key:"vrChange",value:function vrChange(){if(this.vrManager.hmd.isPresenting){var newCameras=this.vrEffect.getCameras();events.emit("vr_start",newCameras);inVR=true;if(!this.config.skipIntro&&!this.controlPassed){this.intro.position();this.intro.start();this.introAni.start()}}else{events.emit("vr_stop");inVR=false}}},{key:"resetPose",value:function resetPose(){console.log("Reset pose!");this.vrControls.resetPose()}},{key:"setPlatform",value:function setPlatform(platform){console.log("Selected platform",platform);this.config.platform=platform}}]);return Game}();exports.default=Game}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./animations/agam12pm":1,"./animations/haim":2,"./animations/hannah":3,"./animations/introAni":4,"./animations/itzhak":5,"./animations/itzik":6,"./animations/lupo12pm":7,"./animations/mark":8,"./animations/meir":9,"./animations/miriam":10,"./animations/rami":11,"./animations/shirin":12,"./character":15,"./character_controller":16,"./coin":19,"./collision_manager":20,"./ending":25,"./extras":26,"./flood":28,"./gui_manager":31,"./instructions":32,"./intro":33,"./keyboard_controller":34,"./lib/text2d/index":40,"./post_shader":43,"./show":44,"./sky":45,"./sound_manager":46,"./square":47,"./sun_gazer":48,"./time_controller":50,"./tzina_vr_controls":54,"./util/debug":58,"./util/fpscount":60,"./util/video_rgbd":67,"./water_drops":68,"./zoom_controller":71,events:89}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var GuiManager=function(){function GuiManager(emitter){_classCallCheck(this,GuiManager);this.emitter=emitter;this.folders={}}_createClass(GuiManager,[{key:"init",value:function init(){var _this=this;this.gui=new dat.GUI;this.emitter.on("add_gui",function(opts){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var control=void 0;var addFunction="add";if(opts.color){addFunction="addColor"}if(opts.folder){if(!_this.folders[opts.folder]){_this.folders[opts.folder]=_this.gui.addFolder(opts.folder);_this.folders[opts.folder].open()}control=_this.folders[opts.folder][addFunction].apply(_this.folders[opts.folder],args)}else{control=_this.gui[addFunction].apply(_this.gui,args)}if(opts.step){control.step(opts.step)}if(opts.onChange){control.onChange(opts.onChange)}if(opts.listen){control.listen()}});this.emitter.on("remove_gui_folder",function(name){console.log("GUI - remove folder ",name);if(_this.folders[name]){_this.folders[name].domElement.parentNode.removeChild(_this.folders[name].domElement)}})}}]);return GuiManager}();exports.default=GuiManager},{}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _index=require("./lib/text2d/index");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Instructions=function(){function Instructions(config,camera,square,soundManager){_classCallCheck(this,Instructions);this.config=config;this.camera=camera;this.square=square;this.soundManager=soundManager;this.lines_eng=[["You are in one of the most","iconic landmarks of Tel Aviv."],["This place no longer exists."],["On January 2017","it was demolished."],["It was a space that","attracted outsiders"],["united only by their solitude."],["The time is now"],["but you can change it if","you focus on one of the","suns above you."]];this.lines_heb=[["הגעת אל אחד מסמליה",".החשובים של העיר תל אביב"],[".מקום זה אינו קיים עוד"],[",בינואר 2017",".הוצאה לפועל הריסתו"],["מרחב זה קיבץ",".את אנשי השוליים של החברה"],[".שותפים לבדידות היומיומית"],[".השעה: עכשיו"],["התמקדות באחת השמשות שמעליך",".תאפשר שינוי של הזמן"]];this.currentLine=0}_createClass(Instructions,[{key:"init",value:function init(loadingManager){var _this=this;var TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#33e5ab",antialias:true,shadow:true};this.instructionText=new _index.MeshText2D("",TEXT_DEFINITION);if(this.config.platform=="desktop"){this.instructionText.scale.multiplyScalar(5e-5);this.instructionText.position.set(0,0,-.1001)}else{this.instructionText.scale.multiplyScalar(.0022);this.instructionText.position.set(0,0,-2.6)}this.instructionText.material.opacity=0;this.instructionLineTwo=new _index.MeshText2D("",TEXT_DEFINITION);this.instructionLineTwo.material.opacity=0;this.instructionLineTwo.position.set(0,-100,0);this.instructionText.add(this.instructionLineTwo);this.instructionLineThree=new _index.MeshText2D("",TEXT_DEFINITION);this.instructionLineThree.material.opacity=0;this.instructionLineThree.position.set(0,-200,0);this.instructionText.add(this.instructionLineThree);this.loadInstructionSound(this.config.assetsHost+"assets/sound/instruction.ogg").then(function(result){_this.instructionSound=result});console.log("Instructions initialized")}},{key:"start",value:function start(){var _this2=this;this.lines=this.config.language=="heb"?this.lines_heb:this.lines_eng;if(this.config.skipInstructions){setTimeout(function(){console.log("Instructions skipping");if(_this2.config.platform=="vive"){events.emit("delayed_rotation",true)}events.emit("instructions_end");_this2.square.extras.showExtras()},1e3)}else{console.log("Instructions starting");this.camera.add(this.instructionText);this.playLines()}}},{key:"update",value:function update(dt){}},{key:"playLines",value:function playLines(){this.currentLine=0;this.showNextLine()}},{key:"showNextLine",value:function showNextLine(){var _this3=this;var texts=this.lines[this.currentLine];this.instructionText.text=texts[0];this.instructionSound.play();if(texts.length>1){this.instructionLineTwo.text=texts[1];this.instructionSound.play()}else{this.instructionLineTwo.text=""}if(texts.length>2){this.instructionLineThree.text=texts[2];this.instructionSound.play()}else{this.instructionLineThree.text=""}var delay=Math.max(5e3,2500*texts.length);TweenMax.to(this.instructionLineTwo.material,1,{opacity:1});TweenMax.to(this.instructionLineThree.material,1,{opacity:1});TweenMax.to(this.instructionText.material,1,{opacity:1,onComplete:function onComplete(){setTimeout(function(){_this3.instructionSound.stop();_this3.hideLine()},delay)}})}},{key:"hideLine",value:function hideLine(){var _this4=this;TweenMax.to(this.instructionLineTwo.material,1,{opacity:0});TweenMax.to(this.instructionLineThree.material,1,{opacity:0});TweenMax.to(this.instructionText.material,1,{opacity:0,onComplete:function onComplete(){setTimeout(function(){_this4.currentLine++;if(_this4.currentLine==3&&_this4.config.platform=="vive"){setTimeout(function(){events.emit("delayed_rotation",false)},4e3)}if(_this4.currentLine<_this4.lines.length){_this4.showNextLine()}else{_this4.camera.remove(_this4.instructionText);_this4.square.extras.showExtras();events.emit("instructions_end")}},2e3)}})}},{key:"dispose",value:function dispose(){this.instructionText.material.dispose();this.instructionLineTwo.material.dispose();this.instructionLineThree.material.dispose();this.instructionSound.unload()}},{key:"loadInstructionSound",value:function loadInstructionSound(path){var _this5=this;return new Promise(function(resolve,reject){console.log("Loading Instruction sound",path);_this5.soundManager.createStaticSoundSampler(path,function(sampler){console.log("Loaded Instruction sound",sampler);_this5.soundManager.panorama.append(sampler);resolve(sampler)})})}}]);return Instructions}();exports.default=Instructions},{"./lib/text2d/index":40,"./util/debug":58}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);var _credits=require("./credits");var _credits2=_interopRequireDefault(_credits);var _credits_heb=require("./credits_heb");var _credits_heb2=_interopRequireDefault(_credits_heb);var _index=require("./lib/text2d/index");var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _video=require("./util/video360");var _video2=_interopRequireDefault(_video);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Intro=function(){function Intro(camera,square,timeConroller,soundManager,scene,vrControls,zoomController,config,introAni){var _this=this;_classCallCheck(this,Intro);this.camera=camera;this.square=square;this.soundManager=soundManager;this.timeConroller=timeConroller;this.scene=scene;this.vrControls=vrControls;this.zoomController=zoomController;this.config=config;this.introAni=introAni;this.soundEvents=[{time:9.33,action:function action(){_this.showTitle()}},{time:23,action:function action(){_this.bringUpSun()}},{time:50,action:function action(){_this.playCredits()}}];this.LOGO_PATH="assets/intro/logo/logo.json";this.STARTING_POSITION=new THREE.Vector3(0,-.65,.11)}_createClass(Intro,[{key:"init",value:function init(loadingManager){var _this2=this;this.INTRO_SOUND=this.config.assetsHost+(this.config.language=="eng"?"assets/sound/INTRO_Shirin.ogg":"assets/sound/INTRO_Shirin_heb.ogg");this.credits=this.config.language=="eng"?_credits2.default:_credits_heb2.default;var CREDIT_TEXT_TITLE={align:_index.textAlign.center,font:"20px Miriam Libre",fillStyle:"#FFFFFF",antialias:true};var CREDIT_TEXT_NAME={align:_index.textAlign.center,font:"bold 26px Miriam Libre",fillStyle:"#FFFFFF",antialias:true};var CREDIT_TEXT_SCALE=.039;this.creditTextTitle=new _index.SpriteText2D("",CREDIT_TEXT_TITLE);this.creditTextTitle.scale.multiplyScalar(CREDIT_TEXT_SCALE);this.creditTextTitle.position.set(.4,7.27,-17);this.creditTextTitle.material.opacity=0;if(this.config.platform=="desktop"){this.creditTextTitle.position.set(-.2,6,-17);this.creditTextTitle.scale.set(.02,.02,.02)}this.scene.add(this.creditTextTitle);this.creditTextName=new _index.SpriteText2D("",CREDIT_TEXT_NAME);this.creditTextName.position.y=-30;this.creditTextName.material.opacity=0;this.creditTextTitle.add(this.creditTextName);var loader=new THREE.ObjectLoader(loadingManager);loader.load(this.LOGO_PATH,function(obj){_this2.logo=obj;_this2.square.add(_this2.logo);_this2.logo.scale.set(.626,.626,.626);_this2.logo.rotation.y=213*Math.PI/180;_this2.logoHebrew=_this2.logo.getObjectByName("heb").children[0];_this2.logoEnglish=_this2.logo.getObjectByName("logoEng").children[0];console.log("Loaded Intro logo ",obj,_this2.logoHebrew,_this2.logoEnglish);_this2.logoHebrew.material.emissiveIntensity=0;_this2.logoEnglish.material.emissiveIntensity=0;_this2.logoHebrew.material.color=new THREE.Color(13421772);_this2.logoEnglish.material.color=new THREE.Color(13421772);_this2.logoEnglish.updateMatrixWorld();_this2.logoHebrew.updateMatrixWorld();_this2.lightEng=new THREE.PointLight(_this2.logoEnglish.material.emissive,0,.03);_this2.lightEng.position.copy((new THREE.Vector3).setFromMatrixPosition(_this2.logoEnglish.matrixWorld));_this2.scene.add(_this2.lightEng);_this2.lightHeb=new THREE.PointLight(_this2.logoHebrew.material.emissive,0,.03);_this2.lightHeb.position.copy((new THREE.Vector3).setFromMatrixPosition(_this2.logoHebrew.matrixWorld));_this2.scene.add(_this2.lightHeb)});var fadePlaneGeo=new THREE.PlaneGeometry(20,20);var fadePlaneMaterial=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,transparent:true,opacity:1});this.fadePlane=new THREE.Mesh(fadePlaneGeo,fadePlaneMaterial);this.fadePlane.position.set(0,0,-.1001);events.on("vr_start",function(){console.log("Into VR Start!");_this2.fadePlane.position.set(0,0,-.050001);console.log("CALIBRATE - Base position INTRO",_this2.vrControls.basePosition)})}},{key:"position",value:function position(){this.square.scale.set(.013,.013,.013);if(inVR){var squarePosition=(new THREE.Vector3).copy(this.STARTING_POSITION).multiplyScalar(-1);this.square.position.copy(squarePosition)}else{this.STARTING_POSITION.set(0,.5,2);this.camera.position.copy(this.STARTING_POSITION)}}},{key:"start",value:function start(){if(this.config.speedIntro){this.localHour=this.config.startTime;this.timeConroller.preloadTime(this.localHour)}else{this.localHour=this.timeConroller.preloadLocalTime()}this.playIntro();events.emit("intro_start")}},{key:"playIntro",value:function playIntro(){var _this3=this;this.soundManager.loadSound(this.INTRO_SOUND).then(function(sound){console.log("Intro Sound ",sound);_this3.sound=sound;setTimeout(function(){if(!_this3.config.speedIntro){_this3.playSound()}else{_this3.bringUpSun()}},2e3)})}},{key:"fadeIn",value:function fadeIn(){var _this4=this;return new Promise(function(resolve,reject){TweenMax.to(_this4.fadePlane.material,2,{opacity:0,onComplete:function onComplete(){_this4.camera.remove(_this4.fadePlane);resolve()}})})}},{key:"fadeOut",value:function fadeOut(){var _this5=this;return new Promise(function(resolve,reject){_this5.camera.add(_this5.fadePlane);TweenMax.to(_this5.fadePlane.material,3,{opacity:1,onComplete:function onComplete(){resolve()}})})}},{key:"bringUpSun",value:function bringUpSun(){var _this6=this;var speed1=this.config.speedIntro?3:37;var speed2=this.config.speedIntro?3:14;var speed3=this.config.speedIntro?1e3:1e4;this.timeConroller.transitionTo(0,speed1,false).then(function(){if(!_this6.config.speedIntro){return _this6.timeConroller.transitionTo(_this6.localHour,speed2,false)}else{return _this6.timeConroller.transitionTo(_this6.config.startTime,speed2,false)}}).then(function(){setTimeout(function(){return _this6.fadeOut().then(function(){_this6.enterSquare();_this6.square.extras.hideExtras()})},speed3)})}},{key:"enterSquare",value:function enterSquare(){var _this7=this;console.log("Intro - enter square");this.square.scale.set(1,1,1);this.zoomController.start();this.zoomController.jumpIn();this.fadeIn().then(function(){_this7.endIntro()})}},{key:"playSound",value:function playSound(){this.sound.playIn(1);this.currentEvent=this.soundEvents.shift()}},{key:"showTitle",value:function showTitle(){this.logoHebrew.material.color.copy(this.logoHebrew.material.emissive);this.logoEnglish.material.color.copy(this.logoEnglish.material.emissive);this.flickerLight(this.logoHebrew.material,this.lightHeb,.05,3);this.flickerLight(this.logoEnglish.material,this.lightEng,.05,3)}},{key:"hideTitle",value:function hideTitle(){}},{key:"turnOnWindows",value:function turnOnWindows(){var shuffledWindows=_lodash2.default.shuffle(this.square.windows.children);console.log("INTRO: TURN ON  WINDOWS");var index={value:0};var lastIndex=0;TweenMax.to(index,50,{value:Math.floor((shuffledWindows.length-1)/3),ease:Circ.easeIn,onUpdate:function onUpdate(val){var currentIndex=Math.ceil(index.value);for(var i=lastIndex+1;i<=currentIndex;i++){shuffledWindows[i].visible=true}lastIndex=currentIndex}})}},{key:"turnOffWindows",value:function turnOffWindows(){var litWindows=_lodash2.default.filter(this.square.windows.children,_lodash2.default.matchesProperty("visible",true));console.log("INTRO: TURN OFF "+litWindows.length+"  WINDOWS");var index={value:0};var lastIndex=0;TweenMax.to(index,6,{value:litWindows.length-1,ease:Circ.easeIn,onUpdate:function onUpdate(val){var currentIndex=Math.ceil(index.value);for(var i=lastIndex+1;i<=currentIndex;i++){litWindows[i].visible=false}lastIndex=currentIndex}})}},{key:"endIntro",value:function endIntro(){console.log("END INTRO");this.fadePlane.geometry.dispose();this.fadePlane.material.dispose();this.creditTextTitle.material.dispose();this.creditTextName.material.dispose();this.square.remove(this.logo);this.logoHebrew.material.dispose();this.logoHebrew.geometry.dispose();this.logoEnglish.material.dispose();this.logoEnglish.geometry.dispose();this.scene.remove(this.lightEng);this.scene.remove(this.lightHeb);events.emit("intro_end")}},{key:"update",value:function update(dt,et){if(this.sound&&this.sound.isPlaying&&this.currentEvent){if(this.sound.getCurrentTime()>=this.currentEvent.time){this.currentEvent.action();if(this.soundEvents.length>0){this.currentEvent=this.soundEvents.shift()}else{this.currentEvent=null}}}}},{key:"playCredits",value:function playCredits(){this.currentCredit=0;this.showNextCredit()}},{key:"showNextCredit",value:function showNextCredit(){var _this8=this;var name=this.credits.credits[this.currentCredit].Name;var title=this.credits.credits[this.currentCredit].Role;this.creditTextTitle.text=title;this.creditTextName.text=name;TweenMax.to(this.creditTextName.material,1,{opacity:1});TweenMax.to(this.creditTextTitle.material,1,{opacity:1,onComplete:function onComplete(){setTimeout(function(){_this8.hideCredit()},2200)}})}},{key:"flickerLight",value:function flickerLight(material,light,_speed,_times){var repeatTimes=1+(_times-1)*2;TweenMax.fromTo(material,_speed,{emissiveIntensity:1},{emissiveIntensity:0,ease:Power0.easeNone,repeat:repeatTimes,yoyo:true,onUpdate:function onUpdate(){light.intensity=material.emissiveIntensity}})}},{key:"hideCredit",value:function hideCredit(){var _this9=this;TweenMax.to(this.creditTextName.material,1,{opacity:0});TweenMax.to(this.creditTextTitle.material,1,{opacity:0,onComplete:function onComplete(){_this9.currentCredit++;if(_this9.currentCredit<_this9.credits.credits.length){_this9.showNextCredit()}else{_this9.camera.remove(_this9.creditTextTitle);_this9.camera.remove(_this9.creditTextName)}}})}}]);return Intro}();exports.default=Intro},{"./credits":22,"./credits_heb":23,"./lib/text2d/index":40,"./util/debug":58,"./util/video360":66,lodash:96}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _pointerLockChromeTolerant=require("pointer-lock-chrome-tolerant");var _pointerLockChromeTolerant2=_interopRequireDefault(_pointerLockChromeTolerant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var KeyboardController=function(){function KeyboardController(config,camera,square,collisionManager){_classCallCheck(this,KeyboardController);this.config=config;this.moveForward=false;this.moveLeft=false;this.moveRight=false;this.moveBackward=false;this.crouch=false;this.isOnObject=false;this.velocity=new THREE.Vector3;this.camera=camera;this.square=square;this.collisionManager=collisionManager;this.playerToCenter=new THREE.Vector3;this.walkingDirection=new THREE.Vector3;this.active=true;this.zAxis=new THREE.Vector3(0,0,1);this.xAxis=new THREE.Vector3(1,0,0);this.CROUCH_HEIGHT=.3;this.STAND_HEIGHT=.5}_createClass(KeyboardController,[{key:"init",value:function init(){var _this=this;console.log("Keyboard controller init");this.pointer=(0,_pointerLockChromeTolerant2.default)(document.getElementById("game"));events.on("start_zoom",function(){});events.on("intro_end",function(){_this.CROUCH_HEIGHT=.55;_this.STAND_HEIGHT=1.1});events.on("experience_end",function(){_this.CROUCH_HEIGHT=1;_this.STAND_HEIGHT=1.6});document.addEventListener("keydown",function(event){switch(event.keyCode){case 16:event.preventDefault();_this.crouch=true;break;case 38:case 87:event.preventDefault();_this.moveForward=true;break;case 37:case 65:event.preventDefault();_this.moveLeft=true;break;case 40:case 83:event.preventDefault();_this.moveBackward=true;break;case 39:case 68:event.preventDefault();_this.moveRight=true;break;case 32:event.preventDefault();if(_this.canJump===true)_this.velocity.y+=350;_this.canJump=false;break}return false},false);document.addEventListener("keyup",function(event){switch(event.keyCode){case 16:event.preventDefault();_this.crouch=false;break;case 38:case 87:event.preventDefault();_this.moveForward=false;break;case 37:case 65:event.preventDefault();_this.moveLeft=false;break;case 40:case 83:event.preventDefault();_this.moveBackward=false;break;case 39:case 68:event.preventDefault();_this.moveRight=false;break}return false},false)}},{key:"update",value:function update(delta){var _this2=this;if(this.active&&delta<.1){if(this.velocity.x>0){this.velocity.x=Math.max(this.velocity.x-this.velocity.x*10*delta,0)}else if(this.velocity.x<0){this.velocity.x=Math.min(this.velocity.x-this.velocity.x*10*delta,0)}if(this.velocity.z>0){this.velocity.z=Math.max(this.velocity.z-this.velocity.z*10*delta,0)}else if(this.velocity.z<0){this.velocity.z=Math.min(this.velocity.z-this.velocity.z*10*delta,0)}if(this.velocity.y>0){this.velocity.y=Math.max(this.velocity.y-this.velocity.y*delta,0)}else if(this.velocity.y<0){this.velocity.y=Math.min(this.velocity.y-this.velocity.y*delta,0)}if(this.moveForward)this.velocity.z-=100*delta*this.config.movementSpeed;if(this.moveBackward)this.velocity.z+=100*delta*this.config.movementSpeed;if(this.moveLeft)this.velocity.x-=100*delta*this.config.movementSpeed;if(this.moveRight)this.velocity.x+=100*delta*this.config.movementSpeed;if(this.crouch){this.velocity.y-=delta*.8;this.camera.position.y=Math.max(this.camera.position.y+this.velocity.y,this.CROUCH_HEIGHT)}else if(this.camera.position.y<this.STAND_HEIGHT){this.velocity.y=Math.max(0,this.velocity.y+delta*.8);this.camera.position.y=Math.min(this.camera.position.y+this.velocity.y,this.STAND_HEIGHT)}else{this.velocity.y=0}if(this.velocity.z!=0||this.velocity.x!=0){(function(){var xVector=(new THREE.Vector3).copy(_this2.xAxis).applyQuaternion(_this2.camera.quaternion);var zVector=(new THREE.Vector3).copy(_this2.zAxis).applyQuaternion(_this2.camera.quaternion);if(!_this2.config.enableFlying){zVector.y=0;xVector.y=0}var target=(new THREE.Vector3).copy(_this2.camera.position);target.add(zVector.multiplyScalar(_this2.velocity.z*delta));target.add(xVector.multiplyScalar(_this2.velocity.x*delta));if(_this2.collisionManager){_this2.collisionManager.testMovement(_this2.camera.position,target).then(function(result){if(result){_this2.camera.position.copy(target)}})}else{_this2.camera.position.copy(target)}})()}}}}]);return KeyboardController}();exports.default=KeyboardController},{"pointer-lock-chrome-tolerant":98}],35:[function(require,module,exports){"use strict";var _keyboard_controller=require("./keyboard_controller");var _keyboard_controller2=_interopRequireDefault(_keyboard_controller);var _tzina_vr_controls=require("./tzina_vr_controls");var _tzina_vr_controls2=_interopRequireDefault(_tzina_vr_controls);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _trees=require("./trees");var _trees2=_interopRequireDefault(_trees);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var Game=require("./game").default;var config=require("./config").default;var Stats=require("stats.js");if(config.production){window["console"]["log"]=function(){}}var game=new Game(config);var stats=new Stats;stats.showPanel(0);var fullscreen=require("fullscreen");var lock=require("pointer-lock-chrome-tolerant");console.log("Touch? ",Modernizr.touchevents);var FPS=config.fps;var FPS_INTERVAL=1e3/FPS;var elapsed=0;var lastTimestamp=0;var clickShaderEffect=0;$("body").click(function(){clickShaderEffect=1;setTimeout(function(){clickShaderEffect=0},100)});var SOUND_PATH="assets/ui_sounds/";var TREES_PATH="assets/trees/";var camera,renderer,trees,clock,landingControls,scene,trees,landingKeyControl;var mouseX=0;var mouseY=0;var followX=0;var followY=0;var windowHalfX=window.innerWidth>>1;var windowHalfY=window.innerHeight>>1;var landingScreen=true;try{var loadingManager;var videoLogo;var videoBirds;var currentLanguage;var introSound;var buttonSound;var buttonClick;var el;var et;(function(){var killLanding=function killLanding(){console.log("Kill landing");landingScreen=false;scene.remove(camera);scene.remove(trees);landingKeyControl=null;landingControls=null;renderer=null;scene=null};var init=function init(){game.init();if(!config.skipLanding){scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3);renderer=new THREE.WebGLRenderer({alpha:true});renderer.setSize(window.innerWidth,window.innerHeight);document.getElementById("tree_scene").appendChild(renderer.domElement);camera.position.set(50,30.08,-7.64);camera.rotation.set(0,117*Math.PI/180,0);_debug2.default.positionObject(camera,"Landing cam");trees=new _trees2.default(config,camera,renderer);trees.init(loadingManager,"landing").then(function(){scene.add(trees);clock=new THREE.Clock;clock.start();render();console.log(scene)})}else{game.load(function(){console.log("Game Finished Loading");$("#loading-container").hide();$("#instruction_screen").fadeOut(250,function(){$("#start_head").fadeIn(250,function(){$("#start_experience").delay(100).fadeIn(250)})})})}window.addEventListener("resize",onWindowResize,false);window.addEventListener("mousemove",onMouseMove,false)};var onMouseMove=function onMouseMove(e){mouseX=event.clientX-windowHalfX;mouseY=event.clientY-windowHalfY};var onWindowResize=function onWindowResize(){if(renderer){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight)}};var render=function render(){if(landingScreen){requestAnimationFrame(render);var moveX=(mouseX-followX)/150;var moveY=(mouseY-followY)/150;followX+=moveX;followY+=moveY;camera.position.y=30+followY/70*-1;camera.position.x=30+followX/70*-1;var delta=clock.getDelta();et+=delta;trees.update(delta,et);trees.clickEffect(clickShaderEffect);renderer.render(scene,camera)}else{cancelAnimationFrame(render)}};var animate=function animate(t){if(game.vrManager.hmd.isPresenting){game.vrManager.hmd.requestAnimationFrame(animate)}else{requestAnimationFrame(animate)}game.animate(t);stats.end();stats.begin()};var resize=function resize(){game.resize()};var vrchange=function vrchange(){game.resize();game.vrChange()};window.mobilecheck=function(){var check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true
})(navigator.userAgent||navigator.vendor||window.opera);return check};loadingManager=new THREE.LoadingManager;loadingManager.onProgress=function(item,loaded,total){console.log(loaded/total*100+"%");$("#progress").css({width:loaded/total*100+"%"});$("#progress_text").html("Loading Tzina..."+loaded/total*100+"%")};videoLogo=$("#logo").get(0);videoBirds=$("#birds").get(0);init();currentLanguage="en";introSound=new Audio(SOUND_PATH+"intro.ogg");introSound.loop=true;introSound.volume=.5;buttonSound=new Audio(SOUND_PATH+"Button_C_1b.ogg");buttonClick=new Audio(SOUND_PATH+"Button_Click_b.ogg");$(".button").mouseenter(function(){buttonSound.play()});$(".button").mouseleave(function(){buttonSound.pause();buttonSound.currentTime=0});$(".button").click(function(){buttonClick.play();setTimeout(function(){buttonClick.pause();buttonClick.currentTime=0},1e3)});$("#about_readmore").click(function(){$(".about_moretext").fadeToggle(250);$("#about_readmore :nth-child(2)").fadeToggle(100);$("#about_readmore :nth-child(1)").fadeToggle(100)});$("#about_readmore_heb").click(function(){$(".about_moretext_heb").fadeToggle(250);$("#about_readmore_heb :nth-child(2)").fadeToggle(100);$("#about_readmore_heb :nth-child(1)").fadeToggle(100)});if(!config.skipLanding){$("#loading-container").hide();if(!!window.chrome){if(!mobilecheck()){$("#loading-container").hide();$("#landing_screen").delay(50).fadeIn(500,function(){console.log("Landing screen faded in");$("#tree_scene").css({"pointer-events":"none"});introSound.play();$("#progress_text").fadeOut(50);$("#headphones-solo").delay(250).fadeIn(250).delay(5e3).fadeOut(50,function(){$("#firstscreen").fadeIn(250);$("#tree_scene").delay(250).fadeIn(500,function(){$("#about").fadeIn(250);$("#language").fadeIn(250)})})})}else{$("#tree_scene").delay(250).fadeIn(500,function(){console.log("its a mobile");$(".mobile_splash_screen").fadeIn(250)})}}else{$("#tree_scene").delay(250).fadeIn(500,function(){$(".not_chrome").fadeIn(250)})}}$("#about").click(function(){$("#language").fadeToggle(250);buttonClick.play();$("#landing_screen").fadeToggle(250);setTimeout(function(){buttonClick.pause();buttonClick.currentTime=0},1e3);$("#about").toggleClass("open");$("#about_container").fadeToggle(500)});$("#enter_button").mouseenter(function(){$("#logo").removeClass("grayscale");videoLogo.play()});$("#enter_button").mouseleave(function(){$("#logo").addClass("grayscale");videoLogo.pause();videoLogo.currentTime=0});$("#enter_button").click(function(){$("#enter_button").fadeOut(250,function(){console.log("platform specific buttons");$("#vive_button").delay(250).fadeIn(250).css("display","inline-block");$("#desktop_button").delay(250).fadeIn(250,function(){$("#logo").removeClass("grayscale")}).css("display","inline-block")})});$("#language").click(function(){$("#about_grid_he").toggle();$("#about_grid_en").toggle();$("#landing_screen").fadeOut(500,function(){if(currentLanguage=="en"){console.log("language changed to Hebrew");currentLanguage="he";config.language="heb";$("#language").html('<img src="assets/ui/language_Eng.png">');$("#desc_sub").html("מאת שירין אנלן webVR דוקומנטרי");$("#enter_button").html("כניסה");$("#start_head").html("?אנחנו מוכנים, מה איתך?");$("#start_experience").html("התחל");$("#lower_tag").html("מסע דרך שטפון של בדידות ואהבה");$("#vive_instruc").html("הסתכל סביב, ולך במרחב של שלושה מטר רבוע<br>הסתכל על השמשות בכדי לשלוט בשעה");$("#desktop_instruc").html("השתמש בחצים בשביל לזוז<br>השתמש במקש SHIFT על מנת להתכופך<br>כהשתמש בעכבר בשביל להסתכל סביב<br> הסתכל על השמשות בכדי לשלוט בשעה");$("#landing_screen").fadeIn(250)}else if(currentLanguage=="he"){console.log("language changed to English");currentLanguage="en";config.language="eng";$("#language").html('<img src="assets/ui/language-Heb.png">');$("#desc_sub").html("A webVR Documentary by Shirin Anlen");$("#enter_button").html("ENTER");$("#vive_instruc").html("LOOK AROUND AND WALK WITHIN A 3X3 METER RANGE <br> GAZE AT THE SUN TO CHANGE THE TIME");$("#desktop_instruc").html("Use arrow/WASD keys to move around<br> Use mouse/trackpad to look around<br> Gaze at the suns to change the time");$("#lower_tag").html("journey through a flood of love and loneliness");$("#landing_screen").fadeIn(250)}})});$("#vive_button").click(function(){$("#vive_button").fadeOut(250);$("#desktop_button").fadeOut(250);$("#about").animate({top:"-100px"},100);$("#language").animate({top:"-100px"},100);$("#instruction_screen").fadeIn(250,function(){$("#vive_instruc").fadeIn(250);$("#progress_text").fadeIn(250).delay(2e3,function(){game.setPlatform("vive");try{game.load(function(){console.log("Game Finished Loading");$("#instruction_screen").fadeOut(250,function(){$("#landing_screen").hide();$("#tree_scene").hide();$("#progress").hide();$("#progress_text").hide();killLanding();$("#start_head").fadeIn(250,function(){$("#start_experience").delay(100).fadeIn(250);$("#vive_message").delay(100).fadeIn(250);buttonClick.play();introSound.pause()})})},function(url,itemsLoaded,itemsTotal){console.log("Landing loaded",itemsLoaded,itemsTotal);$("#progress").css({width:itemsLoaded/itemsTotal*100+"%"});if(currentLanguage=="en"){$("#progress_text").html("Loading Tzina..."+Math.round(itemsLoaded/itemsTotal*100)+"%")}else{$("#progress_text").html(Math.round(itemsLoaded/itemsTotal*100)+"%"+"...טוען")}})}catch(e){console.error("Exception during game load ",e)}})})});$("#desktop_button").click(function(){$("#vive_button").fadeOut(250);$("#desktop_button").fadeOut(250);$("#about").animate({top:"-100px"},100);$("#language").animate({top:"-100px"},100);$("#instruction_screen").fadeIn(250,function(){$("#desktop_instruc").fadeIn(250);$("#progress_text").fadeIn(250).delay(2e3,function(){game.setPlatform("desktop");try{game.load(function(){console.log("Game Finished Loading");$("#instruction_screen").fadeOut(250,function(){$("#landing_screen").hide();$("#tree_scene").hide();$("#progress").hide();$("#progress_text").hide();killLanding();$("#start_head").fadeIn(250,function(){$("#start_experience").delay(100).fadeIn(250);buttonClick.play();introSound.pause()})})},function(url,itemsLoaded,itemsTotal){$("#progress").css({width:itemsLoaded/itemsTotal*100+"%"});if(currentLanguage=="en"){$("#progress_text").html("Loading Tzina..."+Math.round(itemsLoaded/itemsTotal*100)+"%")}else{$("#progress_text").html(Math.round(itemsLoaded/itemsTotal*100)+"%"+"...טוען")}})}catch(e){console.error("Exception during game load ",e)}$("#tree_scene").css({"pointer-events":"auto"})})})});el=document.getElementById("game");$("#start_experience").click(function(){function startExperience(){if(!game.started){window.addEventListener("resize",resize,false);window.addEventListener("vrdisplaypresentchange",vrchange,true);game.start();console.log("Landing Show the game");$("#game").show();if(!config.production){document.getElementById("game").appendChild(stats.dom)}game.resize();animate();$("#start_head").fadeOut(250,function(){$("#start_experience").fadeOut(250);$("#vive_message").fadeOut(250)})}}if(!Modernizr.touchevents&&lock.available()){console.log("Landing requesting pointer lock");var pointer=lock(document.getElementById("game"));pointer.on("attain",function(){console.log("Pointer attained!");startExperience()});if(config.platform=="desktop"){var fs=fullscreen(el);fs.on("attain",function(){console.log("Full screen attained!");if(typeof pointer!="undefined"&&!game.started){pointer.request()}});fs.request()}else{startExperience()}}});et=0})()}catch(e){console.error("Exception",e)}},{"./config":21,"./game":30,"./keyboard_controller":34,"./trees":51,"./tzina_vr_controls":54,"./util/debug":58,fullscreen:90,"pointer-lock-chrome-tolerant":98,"stats.js":101}],36:[function(require,module,exports){(function(global){"use strict";var THREE=typeof window!=="undefined"?window["THREE"]:typeof global!=="undefined"?global["THREE"]:null;var utils_1=require("./utils");var CanvasText=function(){function CanvasText(){this.textWidth=null;this.textHeight=null;this.canvas=document.createElement("canvas");this.ctx=this.canvas.getContext("2d")}Object.defineProperty(CanvasText.prototype,"width",{get:function get(){return this.canvas.width},enumerable:true,configurable:true});Object.defineProperty(CanvasText.prototype,"height",{get:function get(){return this.canvas.height},enumerable:true,configurable:true});CanvasText.prototype.drawText=function(text,ctxOptions){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.font=ctxOptions.font;this.textWidth=Math.ceil(this.ctx.measureText(text).width);this.textHeight=utils_1.getFontHeight(this.ctx.font);this.canvas.width=THREE.Math.nextPowerOfTwo(this.textWidth);this.canvas.height=THREE.Math.nextPowerOfTwo(this.textHeight);this.ctx.font=ctxOptions.font;this.ctx.fillStyle=ctxOptions.fillStyle;if(ctxOptions.shadow){this.ctx.shadowColor="black";this.ctx.shadowOffsetX=ctxOptions.shadowSize*-1;this.ctx.shadowOffsetY=ctxOptions.shaodwSize}this.ctx.textAlign="left";this.ctx.textBaseline="top";this.ctx.fillText(text,0,0);return this.canvas};return CanvasText}();exports.CanvasText=CanvasText}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./utils":41}],37:[function(require,module,exports){(function(global){"use strict";var __extends=undefined&&undefined.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p]}function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=typeof window!=="undefined"?window["THREE"]:typeof global!=="undefined"?global["THREE"]:null;var Text2D_1=require("./Text2D");var MeshText2D=function(_super){__extends(MeshText2D,_super);function MeshText2D(text,options){if(text===void 0){text=""}if(options===void 0){options={}}_super.call(this,text,options)}MeshText2D.prototype.raycast=function(){this.mesh.raycast.apply(this.mesh,arguments)};MeshText2D.prototype.updateText=function(){this.cleanUp();this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle,shadow:this._shadow,shadowSize:this._shadowSize});this.texture=new THREE.Texture(this.canvas.canvas);this.texture.needsUpdate=true;this.applyAntiAlias();if(!this.material){this.material=new THREE.MeshBasicMaterial({map:this.texture,side:this.side});this.material.transparent=true}else{this.material.map=this.texture}if(!this.mesh){this.geometry=new THREE.PlaneGeometry(this.canvas.width,this.canvas.height);this.mesh=new THREE.Mesh(this.geometry,this.material);this.add(this.mesh)}this.mesh.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x;this.mesh.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y;this.geometry.vertices[0].x=this.geometry.vertices[2].x=-this.canvas.width/2;this.geometry.vertices[1].x=this.geometry.vertices[3].x=this.canvas.width/2;this.geometry.vertices[0].y=this.geometry.vertices[1].y=this.canvas.height/2;this.geometry.vertices[2].y=this.geometry.vertices[3].y=-this.canvas.height/2;this.geometry.verticesNeedUpdate=true};return MeshText2D}(Text2D_1.Text2D);exports.MeshText2D=MeshText2D}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Text2D":39}],38:[function(require,module,exports){(function(global){"use strict";var __extends=undefined&&undefined.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p]}function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=typeof window!=="undefined"?window["THREE"]:typeof global!=="undefined"?global["THREE"]:null;var Text2D_1=require("./Text2D");var SpriteText2D=function(_super){__extends(SpriteText2D,_super);function SpriteText2D(){_super.apply(this,arguments)}SpriteText2D.prototype.raycast=function(){return this.sprite.raycast.apply(this.sprite,arguments)};SpriteText2D.prototype.updateText=function(){this.canvas.drawText(this._text,{font:this._font,fillStyle:this._fillStyle});this.cleanUp();this.texture=new THREE.Texture(this.canvas.canvas);this.texture.needsUpdate=true;this.applyAntiAlias();if(!this.material){this.material=new THREE.SpriteMaterial({map:this.texture})}else{this.material.map=this.texture}if(!this.sprite){this.sprite=new THREE.Sprite(this.material);this.geometry=this.sprite.geometry;this.add(this.sprite)}this.sprite.scale.set(this.canvas.width,this.canvas.height,1);this.sprite.position.x=this.canvas.width/2-this.canvas.textWidth/2+this.canvas.textWidth/2*this.align.x;this.sprite.position.y=-this.canvas.height/2+this.canvas.textHeight/2*this.align.y};return SpriteText2D}(Text2D_1.Text2D);exports.SpriteText2D=SpriteText2D}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Text2D":39}],39:[function(require,module,exports){(function(global){"use strict";var __extends=undefined&&undefined.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p))d[p]=b[p]}function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var THREE=typeof window!=="undefined"?window["THREE"]:typeof global!=="undefined"?global["THREE"]:null;var utils_1=require("./utils");var CanvasText_1=require("./CanvasText");var Text2D=function(_super){__extends(Text2D,_super);function Text2D(text,options){if(text===void 0){text=""}if(options===void 0){options={}}_super.call(this);this._font=options.font||"30px Arial";this._fillStyle=options.fillStyle||"#FFFFFF";this._shadow=options.shadow||false;this._shadowSize=options.shadowSize||4;this.canvas=new CanvasText_1.CanvasText;this.align=options.align||utils_1.textAlign.center;this.side=options.side||THREE.DoubleSide;this.antialias=typeof options.antialias==="undefined"?true:options.antialias;this.text=text}Object.defineProperty(Text2D.prototype,"width",{get:function get(){return this.canvas.textWidth},enumerable:true,configurable:true});Object.defineProperty(Text2D.prototype,"height",{get:function get(){return this.canvas.textHeight},enumerable:true,configurable:true});Object.defineProperty(Text2D.prototype,"text",{get:function get(){return this._text},set:function set(value){if(this._text!==value){this._text=value;this.updateText()}},enumerable:true,configurable:true});Object.defineProperty(Text2D.prototype,"font",{get:function get(){return this._font},set:function set(value){if(this._font!==value){this._font=value;this.updateText()}},enumerable:true,configurable:true});Object.defineProperty(Text2D.prototype,"fillStyle",{get:function get(){return this._fillStyle},set:function set(value){if(this._fillStyle!==value){this._fillStyle=value;this.updateText()}},enumerable:true,configurable:true});Text2D.prototype.cleanUp=function(){if(this.texture){this.texture.dispose()}};Text2D.prototype.applyAntiAlias=function(){if(this.antialias===false){this.texture.magFilter=THREE.NearestFilter;this.texture.minFilter=THREE.LinearMipMapLinearFilter}};return Text2D}(THREE.Object3D);exports.Text2D=Text2D}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./CanvasText":36,"./utils":41}],40:[function(require,module,exports){"use strict";var SpriteText2D_1=require("./SpriteText2D");exports.SpriteText2D=SpriteText2D_1.SpriteText2D;var MeshText2D_1=require("./MeshText2D");exports.MeshText2D=MeshText2D_1.MeshText2D;var utils_1=require("./utils");exports.textAlign=utils_1.textAlign},{"./MeshText2D":37,"./SpriteText2D":38,"./utils":41}],41:[function(require,module,exports){(function(global){"use strict";var three_1=typeof window!=="undefined"?window["THREE"]:typeof global!=="undefined"?global["THREE"]:null;exports.textAlign={center:new three_1.Vector2(0,0),left:new three_1.Vector2(1,0),topLeft:new three_1.Vector2(1,-1),topRight:new three_1.Vector2(-1,-1),right:new three_1.Vector2(-1,0),bottomLeft:new three_1.Vector2(1,1),bottomRight:new three_1.Vector2(-1,1)};var fontHeightCache={};function getFontHeight(fontStyle){var result=fontHeightCache[fontStyle];if(!result){var body=document.getElementsByTagName("body")[0];var dummy=document.createElement("div");var dummyText=document.createTextNode("MÉq");dummy.appendChild(dummyText);dummy.setAttribute("style","font:"+fontStyle+";position:absolute;top:0;left:0");body.appendChild(dummy);result=dummy.offsetHeight;fontHeightCache[fontStyle]=result;body.removeChild(dummy)}return result}exports.getFontHeight=getFontHeight}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],42:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _GeometryUtils=require("./util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("./util/fbo");var _fbo2=_interopRequireDefault(_fbo);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Pool=function(_THREE$Object3D){_inherits(Pool,_THREE$Object3D);function Pool(renderer){_classCallCheck(this,Pool);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Pool).call(this));_this.renderer=renderer;_this.render_fs="#define GLSLIFY 1\n varying vec3 vColor;\n\nvoid main() {\n    gl_FragColor = vec4(.8, .8, .95, 0.8); // water drops color & opacity\n }\n";_this.render_vs="#define GLSLIFY 1\nuniform sampler2D positions;\nuniform sampler2D origin;\n\nattribute vec2 reference;\nvarying vec3 vColor;\n\nuniform float pointSize;\n\nvoid main() {\n\n      vec3 pos = texture2D(positions, reference).xyz;\n\n      vColor = vec3(1.0, reference);\n\n      gl_Position = projectionMatrix *  modelViewMatrix * vec4( pos, 1.0 );\n      if(pos.z < 0.0) {\n        gl_PointSize = 0.0;\n      }\n      else {\n        gl_PointSize = pointSize;\n      }\n}\n";_this.simulation_fs="#define GLSLIFY 1\nuniform sampler2D positions;\nuniform sampler2D origin;\nuniform float timer;\nuniform float timeFactor;\n\nvarying vec2 vUv;\n\nuniform float orderTimer;\nuniform float splashTimer;\nuniform float forceFactor;\n\nconst float PI = 3.1415926535897932384626433832795;\n\n//this is exactly the same as in glsl-random\n//not using node here so this CAN be fixed with glslify\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\n      vec3 pos;\n      vec3 originPos;\n          \n      pos = texture2D( positions, vUv ).rgb;\n      originPos = texture2D( origin, vUv ).rgb;\n      if(originPos.z < 0.0) originPos.z = -originPos.z;\n\n      float t = (10.0 - (splashTimer)) * timeFactor;\n      vec3 ground = vec3(originPos.x, originPos.y, 0.0);\n      float theta = acos(dot(normalize(originPos), normalize(ground)));\n      float v0 = 1.5 * length(originPos);\n      float g = 1.0;\n\n      pos.x = v0 * t * forceFactor * cos(theta) * originPos.x;\n      pos.y = v0 * t * forceFactor * cos(theta) * originPos.y;\n      pos.z = v0 * t * forceFactor * sin(theta) - 0.5 * g * t * t;\n      \n      gl_FragColor = vec4( pos, 1.0 );\n}\n";_this.simulation_vs="#define GLSLIFY 1\n  varying vec2 vUv;\n  void main() {\n      vUv = vec2(uv.x, 1.0 - uv.y);\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  }\n";_this.pool_fs="#define GLSLIFY 1\n//only reacts to point lights currently\nvarying vec3 vColor;\nvarying vec3 vViewPosition;\nvarying vec3 worldNormal;\nvarying vec3 eyeDirection;\nvarying vec3 vWorldPos;\nuniform float minAlpha;\nuniform float maxAlpha;\nuniform float minLightAmt;\n\n// it should be possible to extend support to spotlights, etc in a similar manner\n/*\nstruct PointLight {\n    vec3 position;\n    vec3 color;\n};\nuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n*/\nvoid main() {\n    /*\n    vec4 addedLights = vec4(0.0, 0.0, 0.0, 1.0);\n    for(int l = 0; l < NUM_POINT_LIGHTS; l++) {\n      vec3 adjustedLight = pointLights[l].position + cameraPosition;\n      vec3 lightDirection = normalize(vWorldPos - adjustedLight);\n      addedLights.rgb += clamp(dot(lightDirection, worldNormal), minLightAmt, 1.0) * pointLights[l].color;\n    }*/\n\n    vec3 r = vec3(0.6, 0.7, 0.95); // water base color\n    float alpha = clamp(dot(-eyeDirection, worldNormal), minAlpha, maxAlpha);\n    vec4 c = vec4(r, alpha); // water's almost transparent when viewing perpendicularly, gets more opaque when angle changes\n    gl_FragColor = c; //* addedLights;\n}\n";_this.pool_vs="#define GLSLIFY 1\n  uniform float time;\n  uniform float scale;\n  uniform float timeFactor;\n  uniform float amplitudeFactor;\n  uniform float amplitudeDisplacementFactor;\n  uniform float amplitudeNormalFactor;\n  uniform float circularAmplitudeFactor;\n  uniform float circularAmplitudeDisplacementFactor;\n  uniform float circularAmplitudeNormalFactor;\n  \n  uniform float wavelengths[6]; // hardcoded\n  uniform float amplitudes[6];\n  uniform float speeds[6];\n  uniform vec2 directions[6];\n\n  uniform float circularWavelength;\n  uniform float circularSpeed;\n  uniform float circularWaveStrengths[8];\n  uniform vec2 circularWaveCenterPoints[8];\n  uniform float circularMaxDist;\n  \n  varying vec3 vColor;\n  varying vec3 worldNormal;\n  varying vec3 vViewPosition;\n  varying vec3 eyeDirection;\n  varying vec3 vWorldPos;\n\n\n  const float pi = 3.14159;\n\n  // sine function is a bit too smooth to look realistic\n  // --> move to nonnegative and raise to kth exponent\n  float modSin(float x) {\n    float k = 1.6;\n    return 2.0 * pow(((sin(x)+1.0)/2.0), k);\n  }\n  \n  float wave(int i, float x, float y) {\n    float frequency = 2.0 * pi / wavelengths[i];\n    float phase = speeds[i] * frequency;\n    float theta = dot(directions[i], vec2(x, y));\n    return scale * amplitudes[i] * amplitudeFactor * amplitudeDisplacementFactor * modSin(theta * frequency + time * timeFactor * phase);\n  }\n\n  float waveHeight(float x, float y) {\n    float height = 0.0;\n    // 6 is the number of directional waves\n    for(int i = 0; i < 6; i++) {\n      height += wave(i, x, y);\n    }\n    return height;\n  }\n\n  float dWavedx(int i, float x, float y) {\n    float frequency = 2.0*pi/wavelengths[i];\n    float phase = speeds[i] * frequency;\n    float theta = dot(directions[i], vec2(x, y));\n    float A = amplitudes[i] * amplitudeFactor * amplitudeNormalFactor * directions[i].x * frequency;\n    return A * cos(theta * frequency + time * timeFactor * phase);\n  }\n\n  float dWavedy(int i, float x, float y) {\n    float frequency = 2.0*pi/wavelengths[i];\n    float phase = speeds[i] * frequency;\n    float theta = dot(directions[i], vec2(x, y));\n    float A = amplitudes[i] * amplitudeFactor * amplitudeNormalFactor * directions[i].y * frequency;\n    return A * cos(theta * frequency + time * timeFactor * phase);\n  }\n\n  float circularDistanceFactor(vec2 v, vec2 u) {\n    vec2 dv = v - u;\n    float dist = distance(u, v);\n    dist = sqrt(dot(dv, dv));\n    float df = clamp(1.0 / (dist*dist + 0.1), 0.0, 1.0);\n    if(dist > circularMaxDist) {\n      df = 0.0;\n    }\n    return df;\n  }\n\n  float circularWave(int i, float x, float y) {\n    vec2 vertex = vec2(x, y);\n    vec2 center = circularWaveCenterPoints[i];\n    float frequency = 2.0 * pi / circularWavelength;\n    float phaseSpeed = circularSpeed * frequency;\n    vec2 waveDir = normalize(2.0*vertex - center); // i don't even know anymore why multiplication by 2 is required, but wave directions break down otherwise\n    float distanceFactor = circularDistanceFactor(vertex, center);\n    float theta = dot(waveDir, vertex);\n\n    float A = circularWaveStrengths[i] * scale * distanceFactor * circularAmplitudeFactor * circularAmplitudeDisplacementFactor;\n    return A * cos(theta * sqrt(pow((vertex.x - center.x), 2.0) + pow((vertex.y - center.y), 2.0)) + (time * -timeFactor * phaseSpeed)\n      );\n  }\n\n  float circularWaveHeight(float x, float y) {\n    float height = 0.0;\n    // 8 is the number of circular waves\n    for(int i = 0; i < 8; i++) {\n      height += circularWave(i, x, y);\n    }\n    return height;\n  }\n\n  float dCircularWavedx(int i, float x, float y) {\n    vec2 vertex = vec2(x, y);\n    vec2 center = circularWaveCenterPoints[i];\n    float frequency = 2.0 * pi / circularWavelength;\n    float phaseSpeed = circularSpeed * frequency;\n    vec2 waveDir = normalize(2.0*vertex - center);\n    float distanceFactor = circularDistanceFactor(vertex, center);\n    float theta = dot(waveDir, vertex);\n\n    float A = circularWaveStrengths[i] * scale * distanceFactor * circularAmplitudeFactor * circularAmplitudeNormalFactor * waveDir.x * frequency;\n    return A * cos(theta * sqrt(pow((vertex.x - center.x), 2.0) + pow((vertex.y - center.y), 2.0)) + (time * -timeFactor * phaseSpeed)\n      );\n  }\n\n  float dCircularWavedy(int i, float x, float y) {\n    vec2 vertex = vec2(x, y);\n    vec2 center = circularWaveCenterPoints[i];\n    float frequency = 2.0 * pi / circularWavelength;\n    float phaseSpeed = circularSpeed * frequency;\n    vec2 waveDir = normalize(2.0*vertex - center);\n    float distanceFactor = circularDistanceFactor(vertex, center);\n    float theta = dot(waveDir, vertex);\n\n    float A = circularWaveStrengths[i] * scale * distanceFactor * circularAmplitudeFactor * circularAmplitudeNormalFactor * waveDir.y * frequency;\n    return A * cos(theta * sqrt(pow((vertex.x - center.x), 2.0) + pow((vertex.y - center.y), 2.0)) + (time * -timeFactor * phaseSpeed)\n      );\n  }\n\n  // Returns non-normalized normal vector, see comment in function body\nvec3 waveNormal(float x, float y) {\n    float dx = 0.0;\n    float dy = 0.0;\n    for (int i = 0; i < 6; i++) {\n        dx += dWavedx(i, x, y);\n        dy += dWavedy(i, x, y);\n    }\n    vec3 n = vec3(-dx, -dy, 1.0);\n    return n;\n    //we return non-normalized normal vectors, because\n    //we're calculating directional waves and circular waves separately\n    //in effect, the normal's length corresponds to relative weights of\n    //directional / circular components\n    //normalization is the caller's responsibility\n    //return normalize(n);\n}\n\n  // Returns non-normalized normal vector, see comment in function body\nvec3 circularWaveNormal(float x, float y) {\n    float dx = 0.0;\n    float dy = 0.0;\n    for (int i = 0; i < 8; i++) {\n      dx += dCircularWavedx(i, x, y);\n      dy += dCircularWavedy(i, x, y);\n    }\n    vec3 n = vec3(-dx, -dy, 1.0);\n    return n;\n    //we return non-normalized normal vectors, because\n    //we're calculating directional waves and circular waves separately\n    //in effect, the normal's length corresponds to relative weights of\n    //directional / circular components\n    //normalization is the caller's responsibility\n    //return normalize(n);\n}\n\nvoid main(void) {\n    vec4 viewModelPosition = modelViewMatrix * vec4( position, 1 );\n    vViewPosition = viewModelPosition.xyz;\n    eyeDirection = normalize(vViewPosition - position);\n\n    vec3 posNew = position;\n    vWorldPos = position;\n    /*\n    if(amplitudeDisplacementFactor != 0.0) {\n      posNew.z += waveHeight(position.x, position.y);\n    }*/\n    if(circularAmplitudeDisplacementFactor != 0.0) {\n      posNew.z += circularWaveHeight(position.x, position.y);\n    }\n    //vec3 wn = waveNormal(position.x, position.y); \n    vec3 cwn = circularWaveNormal(position.x, position.y);\n    worldNormal = normalize(cwn);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( posNew, 1.0 );\n}\n";_this.enableWaves=true;return _this}_createClass(Pool,[{key:"init",value:function init(loadingManager){this.size=10;this.circle=new THREE.CircleGeometry(this.size,64);this.initLights();this.initWaves();this.initUniforms();this.positions=this.initParticles();this.initParticleParents();this.initCircularWaves();this.initMaterials()}},{key:"initLights",value:function initLights(){}},{key:"initWaves",value:function initWaves(){this.circularWaveStrength1=Math.random();this.circularWaveStrength2=Math.random();this.circularWaveStrength3=Math.random();this.circularWaveStrength4=Math.random();this.circularWaveStrength5=Math.random();this.circularWaveStrength6=Math.random();this.circularWaveStrength7=Math.random();this.circularWaveStrength8=Math.random()}},{key:"initUniforms",value:function initUniforms(){this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib["lights"],{time:{type:"f",value:0},timeFactor:{type:"f",value:1.5},amplitudeFactor:{type:"f",value:.3},amplitudeDisplacementFactor:{type:"f",value:0},amplitudeNormalFactor:{type:"f",value:1},scale:{type:"f",value:.5},wavelengths:{type:"f[]",value:[8,5,3.2,2.2,1.7,1.3]},speeds:{type:"f[]",value:[.4,.43,.47,.5,.8,.9]},amplitudes:{type:"f[]",value:[.5,.45,.3,.17,.13,.05]},directions:{type:"v2[]",value:[new THREE.Vector2(1,0).normalize(),new THREE.Vector2(.5,.5).normalize(),new THREE.Vector2(.4,.7).normalize(),new THREE.Vector2(.8,.2).normalize(),new THREE.Vector2(1,.3).normalize(),new THREE.Vector2(0,.4).normalize()]},circularWavelength:{type:"f",value:.6},circularSpeed:{type:"f",value:.6},circularWaveStrengths:{type:"f[]",value:[this.circularWaveStrength1,this.circularWaveStrength2,this.circularWaveStrength3,this.circularWaveStrength4,this.circularWaveStrength5,this.circularWaveStrength6,this.circularWaveStrength7,this.circularWaveStrength8]},circularWaveCenterPoints:{type:"v2[]",value:[this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint(),this.getRandomPoint()]},circularAmplitudeFactor:{type:"f",value:.08},circularAmplitudeDisplacementFactor:{type:"f",value:0},circularAmplitudeNormalFactor:{type:"f",value:1},circularMaxDist:{type:"f",value:10},minAlpha:{type:"f",value:.5},maxAlpha:{type:"f",value:.9},minLightAmt:{type:"f",value:.05}}])}},{key:"initParticles",value:function initParticles(){var fboGeo=new THREE.SphereGeometry(1);var noOfParticles=1e4;var data=new Float32Array(noOfParticles);var points=THREE.GeometryUtils.randomPointsInGeometry(fboGeo,noOfParticles);for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,32,32,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"initParticleParents",value:function initParticleParents(){this.particleParents=[];this.fbos=[]}},{key:"initCircularWaves",value:function initCircularWaves(){this.noOfCircularWaves=8;
this.particleSimulationShaders=[];var particleRenderShaders=[];for(var i=0;i<this.noOfCircularWaves;i++){var s=new THREE.Object3D;s.position.set(0,0,0);this.add(s);this.particleParents[i]=s;this.positions=this.initParticles();this.particleSimulationShaders[i]=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:this.positions},origin:{type:"t",value:this.positions},timer:{type:"f",value:0},timeFactor:{type:"f",value:3},orderTimer:{type:"f",value:0},splashTimer:{type:"f",value:0},forceFactor:{type:"f",value:1}},vertexShader:this.simulation_vs,fragmentShader:this.simulation_fs});particleRenderShaders[i]=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:null},pointSize:{type:"f",value:1}},vertexShader:this.render_vs,fragmentShader:this.render_fs,transparent:true})}for(var i=0;i<this.noOfCircularWaves;i++){var particleGeometry=new THREE.Geometry;particleGeometry.vertices.push(new THREE.Vector3);this.fbos[i]=new _fbo2.default;this.fbos[i].init(32,32,this.renderer,this.particleSimulationShaders[i],particleRenderShaders[i],particleGeometry);this.fbos[i].particles.renderOrder=1;this.particleParents[i].add(this.fbos[i].particles);this.fbos[i].update()}}},{key:"updateParticleSystems",value:function updateParticleSystems(dt,et){for(var i=0;i<this.noOfCircularWaves;i++){this.particleSimulationShaders[i].uniforms.timer.value=et;this.fbos[i].update();this.particleSimulationShaders[i].uniforms.splashTimer.value-=dt}}},{key:"initMaterials",value:function initMaterials(){this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.pool_vs,fragmentShader:this.pool_fs,transparent:true,lights:true});console.log("Pool material",this.material);this.waterSurface=new THREE.Mesh(this.circle,this.material);this.add(this.waterSurface);var tessellateModifier=new THREE.TessellateModifier(.01);var tessellationDepth=11;for(var i=0;i<tessellationDepth;i++){tessellateModifier.modify(this.circle)}}},{key:"getRandomPoint",value:function getRandomPoint(){var dSquared=Math.random()*this.size*this.size;var theta=Math.random()*Math.PI*2;var x=Math.sqrt(dSquared)*Math.cos(theta);var y=Math.sqrt(dSquared)*Math.sin(theta);return new THREE.Vector2(x,y)}},{key:"update",value:function update(dt,et){if(this.enableWaves){this.uniforms.time.value=et;for(var i=0;i<this.noOfCircularWaves;i++){if(this.uniforms.circularWaveStrengths.value[i]>0){this.uniforms.circularWaveStrengths.value[i]-=dt/1}else{var center=this.getRandomPoint();this.particleParents[i].position.x=center.x;this.particleParents[i].position.y=center.y;this.uniforms.circularWaveCenterPoints.value[i]=center;this.particleSimulationShaders[i].uniforms.splashTimer.value=10;this.uniforms.circularWaveStrengths.value[i]=Math.random()/2+.5}}}this.updateParticleSystems(dt,et)}}]);return Pool}(THREE.Object3D);exports.default=Pool},{"./util/GeometryUtils":56,"./util/fbo":59}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0  );\n}\n",fragmentShader:"#define GLSLIFY 1\nuniform sampler2D tDiffuse;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n        vec4 color = texture2D( tDiffuse, vUv );\n\n        gl_FragColor = color;\n}\n"}},{}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Show=function(){function Show(config,square,characterController,timeController,soundManager){_classCallCheck(this,Show);console.log("Show constructed!");this.config=config;this.square=square;this.characterController=characterController;this.timeController=timeController;this.soundManager=soundManager;this.in12pmShow=false;this.in7pmShow=false;this.in9amshow=false;this.ended12pmShow=false;this.ended7pmShow=false;this.ended9amShow=false;this.inControl=false}_createClass(Show,[{key:"init",value:function init(loadingManager){var _this=this;Promise.all([this.loadAudio(this.config.assetsHost+"assets/sound/event9am.ogg"),this.loadAudio(this.config.assetsHost+"assets/sound/event7pm.ogg")]).then(function(results){_this.music9am=results[0];_this.music7pm=results[1];_this.music9am.controlVolume(.4);_this.music7pm.controlVolume(.4)});events.on("hour_updated",function(hour){if(_this.inControl){_this.checkShow(hour)}});events.on("character_ended",function(name){var hour=_this.timeController.currentChapter.hour;if(hour==19&&!_this.ended7pmShow&&name!="Waterman"&&!_this.in7pmShow){console.log("7PM Show starting",name);_this.square.fountain.startShow(hour);_this.music7pm.play();_this.characterController.addCharacter("Agam7PM");_this.in7pmShow=true}else if(hour==9&&!_this.ended9amShow&&!_this.in9amshow){console.log("9AM Show starting",name);_this.square.fountain.startShow(hour);_this.music9am.play();_this.characterController.addCharacter("Agam12PM");_this.in9amshow=true}});events.on("instructions_end",function(){_this.inControl=true;_this.checkShow(_this.timeController.currentChapter.hour)});events.on("show_end",function(){if(_this.in7pmShow||_this.timeController.currentChapter.hour==19){console.log("7PM Show ended");_this.ended7pmShow=true;_this.music7pm.stop();_this.music7pm.unload();_this.soundManager.panorama.detach(_this.music7pm)}else if(_this.in9amshow||_this.timeController.currentChapter.hour==9){console.log("9AM Show ended");_this.ended9amShow=true;_this.music9am.stop();_this.music9am.unload();_this.soundManager.panorama.detach(_this.music9am)}})}},{key:"checkShow",value:function checkShow(hour){var _this2=this;console.log("Check show ",hour,this.in9amshow,this.in7pmShow);if(hour==19&&!this.in7pmShow&&!this.ended7pmShow){this.square.fountain.startShow(hour);this.music7pm.play();this.in7pmShow=true;setTimeout(function(){_this2.characterController.addCharacter("Agam7PM")},500)}if(hour!=19&&this.in7pmShow){this.square.fountain.resetShow();this.in7pmShow=false}if(hour!=9&&this.in9amshow){this.square.fountain.resetShow();this.in9amshow=false}}},{key:"loadAudio",value:function loadAudio(path){var _this3=this;return new Promise(function(resolve,reject){console.log("Loading show audio ",path);_this3.soundManager.createStaticSoundSampler(path,function(sampler){console.log("Loaded show audio ",sampler);_this3.soundManager.panorama.append(sampler);resolve(sampler)})})}}]);return Show}();exports.default=Show},{"./util/debug":58}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _clouds=require("./clouds");var _clouds2=_interopRequireDefault(_clouds);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var States={STATIC:"static",TRANSITON:"transition"};var Sky=function(){function Sky(loadingManager,scene,dirLight,hemiLight){_classCallCheck(this,Sky);console.log("Sky constructed!");this.SUN_DISTANCE=51;this.sky_fs='#define GLSLIFY 1\n/**\n * @author zz85 / https://github.com/zz85\n *\n * Based on "A Practical Analytic Model for Daylight"\n * aka The Preetham Model, the de facto standard analytic skydome model\n * http://www.cs.utah.edu/~shirley/papers/sunsky/sunsky.pdf\n *\n * First implemented by Simon Wallner\n * http://www.simonwallner.at/projects/atmospheric-scattering\n *\n * Improved by Martin Upitis\n * http://blenderartists.org/forum/showthread.php?245954-preethams-sky-impementation-HDR\n *\n * Three.js integration by zz85 http://twitter.com/blurspline\n*/\n\nuniform sampler2D cloudsMap;\n\nuniform sampler2D skySampler;\nuniform vec3 sunPosition;\nvarying vec3 vWorldPosition;\n\nvarying vec2 vUv;\n\nvec3 cameraPos = vec3(0., 0., 0.);\n\nuniform float luminance;\nuniform float turbidity;\nuniform float reileigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\n\n// constants for atmospheric scattering\nconst float e = 2.71828182845904523536028747135266249775724709369995957;\nconst float pi = 3.141592653589793238462643383279502884197169;\n\nconst float n = 1.0003; // refractive index of air\nconst float N = 2.545E25; // number of molecules per unit volume for air at\n                        // 288.15K and 1013mb (sea level -45 celsius)\nconst float pn = 0.035;	// depolatization factor for standard air\n\n// wavelength of used primaries, according to preetham\nconst vec3 lambda = vec3(680E-9, 550E-9, 450E-9);\n\n// mie stuff\n// K coefficient for the primaries\nconst vec3 K = vec3(0.686, 0.678, 0.666);\nconst float v = 4.0;\n\n// optical length at zenith for molecules\nconst float rayleighZenithLength = 8.4E3;\nconst float mieZenithLength = 1.25E3;\nconst vec3 up = vec3(0.0, 1.0, 0.0);\n\nconst float EE = 1000.0;\n// AVNER REMOVE SUN CIRCLE const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\nconst float sunAngularDiameterCos = 2.0;\n// 66 arc seconds -> degrees, and the cosine of that\n\n// earth shadow hack\nconst float cutoffAngle = pi/1.95;\nconst float steepness = 1.5;\n\n\nvec3 totalRayleigh(vec3 lambda)\n{\n    return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));\n}\n\n// see http://blenderartists.org/forum/showthread.php?321110-Shaders-and-Skybox-madness\n// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE\nvec3 simplifiedRayleigh()\n{\n    return 0.0005 / vec3(94, 40, 18);\n    // return 0.00054532832366 / (3.0 * 2.545E25 * pow(vec3(680E-9, 550E-9, 450E-9), vec3(4.0)) * 6.245);\n}\n\nfloat rayleighPhase(float cosTheta)\n{	 \n    return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n//	return (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));\n//	return (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));\n}\n\nvec3 totalMie(vec3 lambda, vec3 K, float T)\n{\n    float c = (0.2 * T ) * 10E-18;\n    return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;\n}\n\nfloat hgPhase(float cosTheta, float g)\n{\n    return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));\n}\n\nfloat sunIntensity(float zenithAngleCos)\n{\n    return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));\n}\n\n// float logLuminance(vec3 c)\n// {\n// 	return log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);\n// }\n\n// Filmic ToneMapping http://filmicgames.com/archives/75\nfloat A = 0.15;\nfloat B = 0.50;\nfloat C = 0.10;\nfloat D = 0.20;\nfloat E = 0.02;\nfloat F = 0.30;\nfloat W = 1000.0;\n\nvec3 Uncharted2Tonemap(vec3 x)\n{\n   return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\n\n\nvoid main() \n{\n    float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\n\n    // luminance =  1.0 ;// vWorldPosition.y / 450000. + 0.5; //sunPosition.y / 450000. * 1. + 0.5;\n\n     // gl_FragColor = vec4(sunfade, sunfade, sunfade, 1.0);\n\n    float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));\n\n    vec3 sunDirection = normalize(sunPosition);\n\n    float sunE = sunIntensity(dot(sunDirection, up));\n\n    // extinction (absorbtion + out scattering) \n    // rayleigh coefficients\n\n    // vec3 betaR = totalRayleigh(lambda) * reileighCoefficient;\n    vec3 betaR = simplifiedRayleigh() * reileighCoefficient;\n\n    // mie coefficients\n    vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;\n\n    // optical length\n    // cutoff angle at 90 to avoid singularity in next formula.\n    float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));\n    float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\n    float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));\n\n\n\n    // combined extinction factor	\n    vec3 Fex = exp(-(betaR * sR + betaM * sM));\n\n    // in scattering\n    float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);\n\n    float rPhase = rayleighPhase(cosTheta*0.5+0.5);\n    vec3 betaRTheta = betaR * rPhase;\n\n    float mPhase = hgPhase(cosTheta, mieDirectionalG);\n    vec3 betaMTheta = betaM * mPhase;\n\n\n    vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));\n    Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));\n\n    //nightsky\n    vec3 direction = normalize(vWorldPosition - cameraPos);\n    float theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]\n    float phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]\n    vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);\n    // vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;\n    vec3 L0 = vec3(0.1) * Fex;\n\n    // composition + solar disc\n    //if (cosTheta > sunAngularDiameterCos)\n    float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\n    // if (normalize(vWorldPosition - cameraPos).y>0.0)\n    L0 += (sunE * 19000.0 * Fex)*sundisk;\n\n\n    vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));\n\n    vec3 texColor = (Lin+L0);   \n    texColor *= 0.04 ;\n    texColor += vec3(0.0,0.001,0.0025)*0.3;\n\n    float g_fMaxLuminance = 1.0;\n    float fLumScaled = 0.1 / luminance;     \n    float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); \n\n    float ExposureBias = fLumCompressed;\n\n    vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n    vec3 color = curr*whiteScale;\n\n    vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));\n\n    vec3 tColor = texture2D( cloudsMap, vUv ).rgb;\n\n    gl_FragColor.rgb = tColor * retColor;\n\n    gl_FragColor.a = 1.0;\n}\n\n';this.sky_vs="#define GLSLIFY 1\nvarying vec3 vWorldPosition;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n";this.scene=scene;this.sunPosition=new THREE.Vector3(0,0,0);this.dirLight=dirLight;this.hemiLight=hemiLight;this.lensFlareActive=false;this.HOURS_DEFINITION=[{time:0,inclination:.6,azimuth:.02},{time:7,inclination:.1,azimuth:.07},{time:9,inclination:.1,azimuth:.13},{time:12,inclination:.1,azimuth:.255},{time:17,inclination:.1,azimuth:.43},{time:23,inclination:.6,azimuth:.5}];this.yesUpdateHemiLght=true}_createClass(Sky,[{key:"init",value:function init(loadingManager){var _this=this;this.currentTime=0;this.baseTimeIndex=0;this.nextTimeIndex=1;this.inclination=this.HOURS_DEFINITION[this.currentTime].inclination;this.azimuth=this.HOURS_DEFINITION[this.currentTime].azimuth;this.shader=new THREE.ShaderMaterial({uniforms:{luminance:{type:"f",value:1.16},turbidity:{type:"f",value:-84},reileigh:{type:"f",value:14},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:1},sunPosition:{type:"v3",value:new THREE.Vector3},cloudsMap:{type:"t"}},vertexShader:this.sky_vs,fragmentShader:this.sky_fs});this.clouds=new _clouds2.default(loadingManager);this.clouds.init(this.shader);this.setState(States.STATIC);this.loadLensFlare(loadingManager);this.updateSunPosition();events.on("gaze_started",function(){});events.on("gaze_stopped",function(){_this.clouds.stopTransition()});events.on("show_start",function(){setTimeout(function(){_this.hemiLight.intensity=.14},100)})}},{key:"loadLensFlare",value:function loadLensFlare(loadingManager){console.log("Loading lens flares");var textureLoader=new THREE.TextureLoader(loadingManager);var textureFlare0=textureLoader.load("assets/lensflare/lensflare0.png");var textureFlare2=textureLoader.load("assets/lensflare/lensflare2.png");var textureFlare3=textureLoader.load("assets/lensflare/lensflare3.png");var lightHSL=this.dirLight.color.getHSL();var flareColor=new THREE.Color(16777215);flareColor.setHSL(lightHSL.h,lightHSL.s,lightHSL.l+.5);this.lensFlare=new THREE.LensFlare(textureFlare0,100,0,THREE.AdditiveBlending,flareColor);this.lensFlare.add(textureFlare2,512,0,THREE.AdditiveBlending);this.lensFlare.add(textureFlare2,512,0,THREE.AdditiveBlending);this.lensFlare.add(textureFlare2,512,0,THREE.AdditiveBlending);this.lensFlare.add(textureFlare3,60,.6,THREE.AdditiveBlending);this.lensFlare.add(textureFlare3,70,.7,THREE.AdditiveBlending);this.lensFlare.add(textureFlare3,120,.9,THREE.AdditiveBlending);this.lensFlare.add(textureFlare3,70,1,THREE.AdditiveBlending);this.lensFlare.customUpdateCallback=this.lensFlareUpdateCallback}},{key:"lensFlareUpdateCallback",value:function lensFlareUpdateCallback(object){var f=void 0,fl=object.lensFlares.length;var flare=void 0;var vecX=-object.positionScreen.x*2;var vecY=-object.positionScreen.y*2;for(f=0;f<fl;f++){flare=object.lensFlares[f];flare.x=object.positionScreen.x+vecX*flare.distance;flare.y=object.positionScreen.y+vecY*flare.distance;flare.rotation=0}object.lensFlares[2].y+=.025;object.lensFlares[3].rotation=object.positionScreen.x*.5+THREE.Math.degToRad(45)}},{key:"setTime",value:function setTime(time){var baseTime=this.HOURS_DEFINITION[this.baseTimeIndex].time;var nextTime=this.HOURS_DEFINITION[this.nextTimeIndex].time;if(time>nextTime&&nextTime>baseTime||time<baseTime){var temp=this.nextTimeIndex;this.nextTimeIndex=this.nextTimeIndex+1>this.HOURS_DEFINITION.length-1?0:this.nextTimeIndex+1;this.baseTimeIndex=temp;this.setTime(time)}else{this.currentTime=time;var baseInclination=this.HOURS_DEFINITION[this.baseTimeIndex].inclination;var baseAzimuth=this.HOURS_DEFINITION[this.baseTimeIndex].azimuth;var nextInclination=this.HOURS_DEFINITION[this.nextTimeIndex].inclination;var nextAzimuth=this.HOURS_DEFINITION[this.nextTimeIndex].azimuth;if(nextTime==0){nextTime=24}this.inclination=baseInclination+(time-baseTime)/(nextTime-baseTime)*(nextInclination-baseInclination);this.azimuth=baseAzimuth+(time-baseTime)/(nextTime-baseTime)*(nextAzimuth-baseAzimuth);this.updateSunPosition();if(this.yesUpdateHemiLght)this.updateHemiLght()}if(time>=11&&time<=16){if(!this.lensFlareActive){console.log("Sky - adding lens flare");this.lensFlareActive=true;this.scene.add(this.lensFlare)}}else{if(this.lensFlareActive){this.lensFlareActive=false;this.scene.remove(this.lensFlare)}}}},{key:"fadeSpin",value:function fadeSpin(){TweenMax.to(this,15,{spinFactor:.01})}},{key:"setState",value:function setState(state){this.state=state;if(state==States.STATIC){this.spinFactor=.01}else{this.spinFactor=.5}}},{key:"transitionTo",value:function transitionTo(time,inSeconds){var _this2=this;console.log("SKY: Transition to "+time+" in "+inSeconds+" seconds");this.setState(States.TRANSITON);var tl=new TimelineMax({onUpdate:function onUpdate(){_this2.updateSunPosition();_this2.updateHemiLght()},onComplete:function onComplete(){_this2.fadeSpin();_this2.setState(States.STATIC)}});tl.to(this,inSeconds/2,Object.assign(this.HOURS_DEFINITION[10],{ease:Linear.easeNone})).to(this,inSeconds/2,Object.assign(this.HOURS_DEFINITION[time],{ease:Linear.easeNone}));TweenMax.to(this,inSeconds,{currentTime:time,onUpdate:function onUpdate(){_this2.updateHemiLght()}})}},{key:"update",value:function update(dt){this.geo.rotateZ(this.spinFactor*Math.PI/180);this.clouds.update(dt)}},{key:"applyToMesh",value:function applyToMesh(mesh){console.log("Apply sky to",mesh);if(mesh){mesh.material=this.shader;this.geo=mesh.geometry}}},{key:"updateSunPosition",value:function updateSunPosition(){var theta=Math.PI*(this.inclination-.5);var phi=2*Math.PI*(this.azimuth-.5);this.sunPosition.set(this.SUN_DISTANCE*Math.cos(phi),this.SUN_DISTANCE*Math.sin(phi)*Math.sin(theta),this.SUN_DISTANCE*Math.sin(phi)*Math.cos(theta));this.shader.uniforms.sunPosition.value.copy(this.sunPosition);this.dirLight.position.copy(this.sunPosition);if(this.lensFlare){this.lensFlare.position.copy(this.sunPosition)}}},{key:"updateHemiLght",value:function updateHemiLght(){if(this.currentTime>0&&this.currentTime<=14){this.hemiLight.intensity=.6*(this.currentTime/14)*(this.currentTime/14)}else if(this.currentTime>14&&this.currentTime<=23){this.hemiLight.intensity=.6*((23-this.currentTime)/9)*((23-this.currentTime)/9)}else{this.hemiLight.intensity=0}}},{key:"pauseUpdateHemiLight",value:function pauseUpdateHemiLight(){this.yesUpdateHemiLght=false}},{key:"resumeUpdateHemiLight",value:function resumeUpdateHemiLight(){this.yesUpdateHemiLght=true}},{key:"getSunPosition",value:function getSunPosition(){return this.sunPosition}},{key:"getDirLghtOriStatus",value:function getDirLghtOriStatus(){return this.dirLight.clone()}},{key:"getHemiLghtOriStatus",value:function getHemiLghtOriStatus(){return this.hemiLight.clone()}},{key:"getHemiLghtCorrectIntensity",value:function getHemiLghtCorrectIntensity(){if(this.currentTime>0&&this.currentTime<=14){return.6*(this.currentTime/14)*(this.currentTime/14)}else if(this.currentTime>14&&this.currentTime<=23){return.6*((23-this.currentTime)/9)*((23-this.currentTime)/9)}else{return 0}}}]);return Sky}();exports.default=Sky},{"./clouds":18}],46:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});exports.PositionalSoundSampler=exports.StaticSoundSampler=undefined;var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _SoundBlur=require("./util/SoundBlur");var _SoundBlur2=_interopRequireDefault(_SoundBlur);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ambientSamples=[{name:"fountain",path:"Kikar_Inner.ogg",color:65535,position:[0,20,0]},{name:"highway_1",path:"Kikar_Ambiance_1_Loud.ogg",color:15793920,position:[-25,15,0]},{name:"highway_2",path:"Kikar_Ambiance_2_Loud.ogg",color:1048320,position:[25,15,0]},{name:"innerKikar",path:"Pigeons_Center_Kikar.ogg",color:65295,position:[0,20,0]},{name:"wind",path:"WindinTrees.ogg",color:65520,position:[0,30,20]},{name:"birds",path:"Birds.ogg",color:16711680,position:[0,30,-25]},{name:"wind_2",path:"Trees_1.ogg",color:16711680,position:[20,30,-20]}];var SoundManager=function(){function SoundManager(config,camera,scene){_classCallCheck(this,SoundManager);this.camera=camera;this.scene=scene;this.config=config;this.SOUND_PATH=this.config.assetsHost+"assets/sound/";this.panorama={samplers:[],append:function append(who){if(typeof who.controlBlur==="function"){this.samplers.push(who)}else{console.warn("you tried to append a sound to soundManager's panorama, but the sound doesn't have a controlBlur function.")}},detach:function detach(who){try{if(this.samplers.indexOf(who)!=-1){this.samplers.splice(this.samplers.indexOf(who),1)}}catch(error){console.error("soundmanager.panorama could not detach the sampler: ");console.warn(error)}},eachSampler:function eachSampler(what,except){for(var a in this.samplers){if(!except||except===undefined||except!=this.samplers[a]){what(this.samplers[a],a)}}},setFocus:function setFocus(on,time){this.eachSampler(function(thisSampler,n){thisSampler.controlBlur(1,time)},on);if(on&&on!==undefined)if(typeof on.controlBlur==="function"){on.controlBlur(0,time)}else{console.warn("you tried to set sound focus, but the provided object didn't have a controlBlur function.")}},setFocusWithLevel:function setFocusWithLevel(on,level){this.eachSampler(function(thisSampler,n){thisSampler.controlBlur(level,0)},on);if(on&&on!==undefined)if(typeof on.controlBlur==="function"){on.controlBlur(0,0)}else{console.warn("you tried to set sound focus, but the provided object didn't have a controlBlur function.")}},unsetFocus:function unsetFocus(time){console.log("here 2");this.eachSampler(function(thisSampler,n){console.log("refocus"+n);thisSampler.controlBlur(0,time)})}};this.createStaticSoundSampler=function(url,onLoad){var sss=new StaticSoundSampler(this.listener.context);sss.init(url,this.loadingManager,onLoad);return sss};this.createPositionalSoundSampler=function(url,onLoad){var pss=new PositionalSoundSampler(this.listener,this.scene);pss.init(url,this.loadingManager,onLoad);return pss}}_createClass(SoundManager,[{key:"init",value:function init(loadingManager){var thisSoundManager=this;console.log("initializing a SoundManager");THREE.Audio.prototype.playIn=function(seconds){if(this.isPlaying===true){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===false){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playStartTime=this.context.currentTime+seconds;var source=this.context.createBufferSource();source.buffer=this.source.buffer;source.loop=this.source.loop;source.onended=this.source.onended;source.start(this.playStartTime,this.startTime);source.playbackRate.value=this.playbackRate;this.isPlaying=true;this.source=source;return this.connect()};THREE.Audio.prototype.getCurrentTime=function(){return this.context.currentTime-this.playStartTime};THREE.PositionalAudio.prototype.createDebugCube=function(scene,material){this.testCube=new THREE.Mesh(new THREE.BoxGeometry(1,20,1),new THREE.MeshBasicMaterial(material||{color:65280}));this.testCube.position.set(this.position.x,this.position.y,this.position.z);scene.add(this.testCube)};this.listener=new THREE.AudioListener;this.camera.add(this.listener);this.loader=new THREE.AudioLoader(new THREE.LoadingManager);for(var a in ambientSamples){var thisSample=ambientSamples[a];if(!thisSample.disable){var pSampler=new PositionalSoundSampler(this.listener,this.scene);pSampler.blurModule.controlVolume(1.5);pSampler.position.set(thisSample.position[0],thisSample.position[1],thisSample.position[2]);pSampler.init(thisSoundManager.SOUND_PATH+thisSample.path,loadingManager,function(thisSampler){thisSoundManager.panorama.append(thisSampler);thisSampler.setToLoop();var thisSamplerGuiControl={focus:function focus(){thisSoundManager.panorama.setFocus(thisSampler,3)}};console.log(thisSampler.name+" sample loaded")});thisSample.sampler=pSampler}}this.sounds={};this.activateEventListeners()}},{key:"activateEventListeners",value:function activateEventListeners(){}},{key:"play",value:function play(setName){if(setName=="sunGazedSound"){}else if(setName=="flyingSound"){}else if(setName=="ambience"){for(var a in ambientSamples){var thisSample=ambientSamples[a];console.log(thisSample);if(!thisSample.disable&&thisSample.sampler){thisSample.sampler.play()}}}else{console.warn("SoundManager was called to play but the parameter setName didn't match any statement "+setName)}}},{key:"loadSound",value:function loadSound(fileName){var _this=this;return new Promise(function(resolve,reject){var sound=new THREE.Audio(_this.listener);_this.loader.load(fileName,function(audioBuffer){sound.setBuffer(audioBuffer);resolve(sound)})})}},{key:"loadPositionalSound",value:function loadPositionalSound(fileName){var _this2=this;console.log("Loading positional audio sound ",fileName);return new Promise(function(resolve,reject){var sound=new THREE.PositionalAudio(_this2.listener);_this2.loader.load(fileName,function(audioBuffer){sound.setBuffer(audioBuffer);resolve(sound)})})}},{key:"pause",value:function pause(){if(setName=="sunGazedSound"){}else if(setName=="flyingSound"){}else if(!setName){console.warn("SoundManager was called to play without providing a setName");for(var a in ambientSamples){var thisSample=ambientSamples[a];console.log(thisSample);if(!thisSample.disable&&thisSample.sampler){thisSample.sampler.pause();thisSample.sampler.currentTime=0}}}else{console.warn("SoundManager was called to play but the parameter setName didn't match any statement "+setName)}}}]);return SoundManager}();exports.default=SoundManager;var StaticSoundSampler=exports.StaticSoundSampler=function(){function StaticSoundSampler(audioContext){_classCallCheck(this,StaticSoundSampler);this.blurModule=new _SoundBlur2.default(audioContext);this.audioContext=audioContext;this.staticSoundOutputDestination=audioContext.destination;this.paused=false;this.playStartTime=0;this.offset=0;this.loop=false;this.controlVolume=function(){for(var _len=arguments.length,a=Array(_len),_key=0;_key<_len;_key++){a[_key]=arguments[_key]}this.blurModule.controlVolume.apply(this.blurModule,a)};this.controlBlur=function(){for(var _len2=arguments.length,a=Array(_len2),_key2=0;_key2<_len2;_key2++){a[_key2]=arguments[_key2]}this.blurModule.controlBlur.apply(this.blurModule,a)}}_createClass(StaticSoundSampler,[{key:"setToLoop",value:function setToLoop(loopValue){if(loopValue!==undefined){this.loop=loopValue}else{this.loop=true}}},{key:"init",value:function init(sampleUrl,loadingManager,loadReadyCallback){this.sampleUrl=sampleUrl;
var audioContext=this.audioContext;var thisStaticSoundSampler=this;this.blurModule.init(loadingManager);this.source=false;var request=new XMLHttpRequest;request.open("GET",this.sampleUrl,true);request.responseType="arraybuffer";request.onload=function(){var audioData=request.response;audioContext.decodeAudioData(audioData,function(buffer){thisStaticSoundSampler.buffer=buffer;if(loadReadyCallback){loadReadyCallback(thisStaticSoundSampler)}},function(e){"Error with decoding audio data"+e.err})};request.send()}},{key:"play",value:function play(){this.source=this.audioContext.createBufferSource();this.source.buffer=this.buffer;this.source.loop=this.loop;try{this.source.connect(this.blurModule.inputNode);this.blurModule.connect(this.staticSoundOutputDestination)}catch(e){console.log(this.blurModule,this.blurModule.inputNode,audioContext.destination);console.error(e)}if(this.source){this.playStartTime=this.audioContext.currentTime;this.source.start(this.audioContext.currentTime,this.offset);console.log("Audio started at time",this.playStartTime)}else{console.warn("thisStaticSoundSampler mistake: you requested to play, but the source has not been loaded yet")}}},{key:"pause",value:function pause(){var pauseTime=this.audioContext.currentTime;this.offset+=pauseTime-this.playStartTime;console.log("Audio paused at time",pauseTime,"offset is ",this.offset);if(this.source){this.source.stop();this.source.disconnect()}this.source=null}},{key:"stop",value:function stop(){if(this.source){this.source.stop();this.source.disconnect()}this.playStartTime=0;this.offset=0;this.source=null}},{key:"unload",value:function unload(){this.buffer=null}}]);return StaticSoundSampler}();var PositionalSoundSampler=exports.PositionalSoundSampler=function(_StaticSoundSampler){_inherits(PositionalSoundSampler,_StaticSoundSampler);function PositionalSoundSampler(listener,scene){_classCallCheck(this,PositionalSoundSampler);var audioContext=listener.context;var _this3=_possibleConstructorReturn(this,Object.getPrototypeOf(PositionalSoundSampler).call(this,audioContext));_this3.listener=listener;_this3.scene=scene;var connectorNode=audioContext.createGain();_this3.staticSoundOutputDestination=connectorNode;var pa=new THREE.PositionalAudio(listener);_this3.positionalAudio=pa;_this3.positionalAudio.setNodeSource(connectorNode);_this3.scene.add(_this3.positionalAudio);_this3.position={set:function set(a,b,c){return pa.position.set(a,b,c)},get:function get(){return pa.position.get()}};_this3.control=function(){for(var _len3=arguments.length,a=Array(_len3),_key3=0;_key3<_len3;_key3++){a[_key3]=arguments[_key3]}this.blurModule.control.apply(this.blurModule,a)};_this3.controlBlur=function(){for(var _len4=arguments.length,a=Array(_len4),_key4=0;_key4<_len4;_key4++){a[_key4]=arguments[_key4]}this.blurModule.controlBlur.apply(this.blurModule,a)};_this3.controlVolume=function(){for(var _len5=arguments.length,a=Array(_len5),_key5=0;_key5<_len5;_key5++){a[_key5]=arguments[_key5]}this.blurModule.controlVolume.apply(this.blurModule,a)};return _this3}_createClass(PositionalSoundSampler,[{key:"init",value:function init(sampleUrl,loadingManager,loadReadyCallback){_get(Object.getPrototypeOf(PositionalSoundSampler.prototype),"init",this).call(this,sampleUrl,loadingManager,loadReadyCallback);this.positionalAudio.setRefDistance(1);this.positionalAudio.autoplay=false}},{key:"createDebugCube",value:function createDebugCube(incolor){this.testCube=new THREE.Mesh(new THREE.BoxGeometry(2,15,2),new THREE.MeshBasicMaterial({color:incolor||255}));this.testCube.position.set(0,0,0);this.positionalAudio.add(this.testCube)}}]);return PositionalSoundSampler}(StaticSoundSampler)},{"./util/SoundBlur":57}],47:[function(require,module,exports){"use strict";var _typeof2=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":_typeof2(obj)}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj==="undefined"?"undefined":_typeof2(obj)};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _trees=require("./trees");var _trees2=_interopRequireDefault(_trees);var _fountain=require("./fountain");var _fountain2=_interopRequireDefault(_fountain);var _sun_loader=require("./sun_loader");var _sun_loader2=_interopRequireDefault(_sun_loader);var _chapters=require("./chapters");var _chapters2=_interopRequireDefault(_chapters);var _pool=require("./pool");var _pool2=_interopRequireDefault(_pool);var _index=require("./lib/text2d/index");var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof2(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof2(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SUN_LOADER_TIME=3;var Square=function(_THREE$Object3D){_inherits(Square,_THREE$Object3D);function Square(collisionManager,renderer,camera,config,soundManager,scene,extras,sky){_classCallCheck(this,Square);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Square).call(this));console.log("Square constructed!");_this.collisionManager=collisionManager;_this.renderer=renderer;_this.config=config;_this.camera=camera;_this.scene=scene;_this.extras=extras;_this.sky=sky;_this.debug=false;_this.ending=false;_this.MODEL_PATH=_this.config.assetsHost+"assets/square/scene/scene.json";_this.BUILDINGS_PATH=_this.config.assetsHost+"assets/square/buildings/buildings_new.json";_this.END_BUILDING_PATH=_this.config.assetsHost+"assets/square/buildings/endBuilding.json";_this.SUNS_PATH=_this.config.assetsHost+"assets/square/suns.json";_this.COLLIDERS_PATH=_this.config.assetsHost+"assets/square/colliders.json";_this.END_COLLIDERS_PATH=_this.config.assetsHost+"assets/square/buildings/colliderBalcony.json";_this.BENCHES_PREFIX=_this.config.assetsHost+"assets/square/benches/";_this.FOUNTAIN_PATH=_this.config.assetsHost+"assets/square/fountain/fountain.json";_this.GROUND_PATH=_this.config.assetsHost+"assets/square/squareRamp_22.json";_this.sunTextureOffsets={19:0,17:0,12:0,9:0,7:0};_this.ENTRY_POINTS=[{hour:19,worldPosition:[-12,13,40],startPosition:[-25,20,-8],endPosition:[-18,22.1,-7]},{hour:17,worldPosition:[50,13,26],startPosition:[-3,20,43],endPosition:[-3.5,22.1,18]},{hour:12,worldPosition:[-14,12,41],startPosition:[22,20.5,38.5],endPosition:[14,22.1,8.5]},{hour:9,worldPosition:[-7.5,12,51],startPosition:[40,20.5,17.6],endPosition:[15,22.1,-1]},{hour:7,worldPosition:[63,12,5],startPosition:[-26,24,-62],endPosition:[-14,23.7,-12]},{hour:0,startPosition:[-60,20.5,-30],endPosition:[-20,22.1,-8]}];_this.currentSun=null;_this.activatedSun=null;_this.controlPassed=false;_this.soundManager=soundManager;return _this}_createClass(Square,[{key:"init",value:function init(loadingManager){var _this2=this;loadingManager.itemStart("Square");this.trees=new _trees2.default(this.config,this.camera,this.renderer);this.fountain=new _fountain2.default(this);var loaders=[this.loadSquare(loadingManager),this.fountain.init(loadingManager),this.loadBuildings(loadingManager),this.loadSuns(loadingManager),this.loadColliders(loadingManager),this.loadBenches(loadingManager),this.loadFountain(loadingManager),this.loadGround(loadingManager)];if(!this.config.noExtras){loaders.push(this.extras.init(loadingManager))}if(!this.config.noTrees){loaders.push(this.trees.init(loadingManager))}Promise.all(loaders).then(function(results){console.log("Load results",results);var obj=results[0];_this2.suns=results[3];_this2.suns.rotation.y=Math.PI*-70/180;_this2.mesh=obj;_this2.mesh.rotation.order="YXZ";_this2.colliders=results[4];if(_this2.config.platform=="desktop"){_this2.mesh.add(_this2.colliders)}_this2.benches=results[5];_this2.benches.rotation.order="YXZ";_this2.fountainMesh=results[6];var ground=results[7];_this2.mesh.add(ground);_this2.mesh.add(_this2.fountainMesh);_this2.clockwork=new THREE.Object3D;_this2.cylinders=[];_this2.cylinders.push(_this2.fountainMesh.getObjectByName("f_15_SubMesh 0").parent);_this2.cylinders.push(_this2.fountainMesh.getObjectByName("f_14_SubMesh 0").parent);_this2.cylinders.push(_this2.fountainMesh.getObjectByName("f_13_SubMesh 0").parent);for(var i=0;i<_this2.cylinders.length;i++){_this2.cylinders[i].rotation.order="YXZ";_this2.cylinders[i].rotation.z=Math.PI/2}_this2.fountain.assignCylinders(_this2.cylinders);_this2.activeClockwork=_this2.mesh;_debug2.default.positionObject(_this2,"Square",true);_this2.clockwork.add(_this2.benches);_this2.clockwork.add(_this2.buildings);_this2.clockwork.rotation.order="YXZ";_this2.clockworkOffset=new THREE.Object3D;_this2.clockworkOffset.rotation.order="YXZ";_this2.clockworkOffset.add(_this2.clockwork);_this2.mesh.add(_this2.clockworkOffset);_this2.mesh.add(_this2.trees);_this2.mesh.add(_this2.fountain);_this2.mesh.add(_this2.extras);_this2.mesh.add(_this2.suns);_this2.loadLights();_this2.pool=new _pool2.default(_this2.renderer);_this2.pool.init();_this2.pool.renderOrder=1;_this2.pool.position.set(.66,21.52,-.95);_this2.pool.rotation.x=270*Math.PI/180;_this2.pool.scale.set(.822,.822,.822);console.log("Adding square fountain pool",_this2.pool);_this2.mesh.add(_this2.pool);if(_this2.debug){events.emit("add_gui",{folder:"Pool"},_this2.pool,"visible");events.emit("add_gui",{folder:"Trees"},_this2.trees,"visible");events.emit("add_gui",{folder:"Fountain water"},_this2.fountain,"visible");events.emit("add_gui",{folder:"Extras"},_this2.extras,"visible");events.emit("add_gui",{folder:"Buildings"},_this2.buildings,"visible");events.emit("add_gui",{folder:"Suns"},_this2.suns,"visible");events.emit("add_gui",{folder:"Benches"},_this2.benches,"visible");events.emit("add_gui",{folder:"Fountain"},_this2.fountainMesh,"visible");events.emit("add_gui",{folder:"Fountain"},_this2.pool,"visible");_debug2.default.positionObject(_this2.fountain,"Fountain water");_debug2.default.positionObject(_this2.mesh,"Square");_debug2.default.positionObject(_this2.benches,"Benches");events.emit("add_gui",{folder:"Clock rotation",listen:true},_this2,"clockRotation",0,6.28);_debug2.default.positionObject(_this2.cylinders[0],"Cylinder");_debug2.default.positionObject(_this2.clockwork,"Clockwork");_debug2.default.positionObject(ground,"Ground")}_this2.addColliders();_this2.setSquareMiddle();_this2.mesh.scale.set(.6,.6,.6);_this2.fountain.position.set(.69,24.93,-.73);_this2.buildings.rotation.y=4*Math.PI/180;console.log("Finished loading square");loadingManager.itemEnd("Square");_this2.turnOffSuns()});events.on("gaze_started",function(name){_this2.turnOnSun(name,false);_this2.activateSun(name)});events.on("gaze_stopped",function(name){_this2.turnOffSun(name);_this2.deactivateSun(name)});events.on("angle_updated",function(hour){console.log("Square angle updated. Adding colliders");_this2.updateMatrixWorld(true);_this2.addColliders();_this2.setSquareMiddle()});events.on("show_start",function(){_this2.fountainLight.position.set(0,25.11,6.836)});events.on("show_end",function(){_this2.fountainLight.position.set(0,0,0)});events.on("control_threshold",function(passed){_this2.controlPassed=passed;if(passed){if(_this2.config.platform!="desktop"){_this2.clockworkShift()}var sun=_this2.suns.getObjectByName(_this2.currentSun);if(sun){sun.getObjectByName(_this2.currentSun+"_L").visible=true}setTimeout(function(){events.emit("angle_updated")},0)}});events.on("delayed_rotation",function(){var skip=arguments.length<=0||arguments[0]===undefined?false:arguments[0];_this2.delayedRotation(skip)});events.on("experience_end",function(){_this2.ending=true;_this2.setEndBuilding();_this2.pool.enableWaves=false;_this2.disposeSuns()})}},{key:"delayedRotation",value:function delayedRotation(skip){var _this3=this;console.log("Instructions delayed rotation");TweenMax.to(this,skip?0:32,{ease:Power1.easeInOut,clockRotation:this.delayedRotationY,onComplete:function onComplete(){_this3.updateMatrixWorld(true);events.emit("angle_updated",_this3.delayedRotationY/15)},onUpdate:function onUpdate(){}})}},{key:"clockworkShift",value:function clockworkShift(){console.log("Performing clockwork shift");this.activeClockwork=this.clockwork;this.clockworkOffset.rotation.y=-105*Math.PI/180;this.clockwork.rotation.y=this.mesh.rotation.y-135*Math.PI/180;this.delayedRotationY=this.mesh.rotation.y;this.mesh.rotation.set(0,0,0)}},{key:"update",value:function update(dt,et){this.fountain.update(dt);if(this.controlPassed){this.pool.update(dt,et)}if(!this.config.noTrees){this.trees.update(dt,et)}if(!this.config.noExtras){this.extras.update(dt)}for(var i=0;i<this.suns.children.length;i++){this.suns.children[i].children[2].update(dt,et)}}},{key:"getFountainMesh",value:function getFountainMesh(){return this.fountainMesh}},{key:"getCylinders",value:function getCylinders(){return this.cylinders}},{key:"updateSunProgress",value:function updateSunProgress(name,progress){this.sunTextureOffsets[name]=.5*progress;if(name==this.currentSun){this.sunTexture.offset.y=this.sunTextureOffsets[name]}}},{key:"turnOffSuns",value:function turnOffSuns(){var _this4=this;this.suns.children.forEach(function(obj){if(obj.children.length>0){_this4.turnOffSun(obj.name)}})}},{key:"disposeSuns",value:function disposeSuns(){console.log("Disposing suns");this.suns.children.forEach(function(obj){var fill=obj.getObjectByName(obj.name+"_F").children[0];fill.material.dispose();fill.geometry.dispose();var stroke=obj.getObjectByName(obj.name+"_S").children[0];stroke.material.dispose();stroke.geometry.dispose();var loader=obj.getObjectByName(obj.name+"_L");loader.dispose()});this.sunTexture.dispose();for(var i=this.suns.children.length-1;i>=0;i--){this.suns.remove(this.suns.children[i])}}},{key:"turnOffSun",value:function turnOffSun(name){console.log("Turn off sun ",name);var sun=this.suns.getObjectByName(name);if(sun){var strokeMesh=sun.getObjectByName(name+"_S").children[0];strokeMesh.material.color.set(7446);strokeMesh.material.needsUpdate=true;var sunMesh=sun.getObjectByName(name+"_F").children[0];sunMesh.material.color=new THREE.Color(7446);sunMesh.material.emissive=new THREE.Color(5714956);sunMesh.material.specular=new THREE.Color(11777536);sunMesh.material.transparent=true;sunMesh.material.opacity=.8;sunMesh.material.shininess=.2;sunMesh.material.bumpScale=4;sunMesh.material.map=null;sunMesh.material.needsUpdate=true;sun.getObjectByName(name+"_L").visible=false}if(this.currentSun){this.sunTexture.offset.y=this.sunTextureOffsets[this.currentSun]}}},{key:"turnOnSun",value:function turnOnSun(name,setCurrent){if(this.suns){var sun=this.suns.getObjectByName(name);if(sun){console.log("Turning on sun ",name);var strokeMesh=sun.getObjectByName(name+"_S").children[0];strokeMesh.material.color.set(16704552);strokeMesh.material.needsUpdate=true;var sunMesh=sun.getObjectByName(name+"_F").children[0];sunMesh.material.color=new THREE.Color(16777e3);sunMesh.material.bumpScale=4;sunMesh.material.specular=new THREE.Color(16776960);sunMesh.material.shininess=.2;sunMesh.material.transparent=false;sunMesh.material.map=this.sunTexture;this.sunTexture.offset.y=this.sunTextureOffsets[name];sunMesh.material.needsUpdate=true;sun.getObjectByName(name+"_L").visible=true;sun.getObjectByName(name+"_L").disorganize();if(setCurrent){this.currentSun=name}}}}},{key:"activateSun",value:function activateSun(name){var sun=this.suns.getObjectByName(name);if(sun){var sunLoader=sun.getObjectByName(name+"_L");sunLoader.organize(SUN_LOADER_TIME)}}},{key:"deactivateSun",value:function deactivateSun(name){var sun=this.suns.getObjectByName(name);if(sun){var sunLoader=sun.getObjectByName(name+"_L");sunLoader.disorganize()}}},{key:"explodeSun",value:function explodeSun(name){var sun=this.suns.getObjectByName(name);if(sun){var sunLoader=sun.getObjectByName(name+"_L");sunLoader.explode()}}},{key:"loadBuildings",value:function loadBuildings(loadingManager){var _this5=this;return new Promise(function(resolve,reject){var loaders=[];loaders.push(_this5.loadFile(loadingManager,_this5.BUILDINGS_PATH));loaders.push(_this5.loadFile(loadingManager,_this5.END_BUILDING_PATH));Promise.all(loaders).then(function(results){console.log("Loaded Buildings ",results);_this5.buildings=results[0];_this5.endBuilding=results[1];resolve(results[0])})})}},{key:"setEndBuilding",value:function setEndBuilding(){var _this6=this;var originalEndBuilding=this.buildings.getObjectByName("5thBuilding");var blockingWindow=this.buildings.getObjectByName("TheWindow");originalEndBuilding.visible=false;blockingWindow.visible=false;this.buildings.remove(originalEndBuilding);this.buildings.remove(blockingWindow);this.buildings.add(this.endBuilding);this.endNeonThing=this.buildings.getObjectByName("Neon");this.endNeonThing.geometry.computeFaceNormals();this.endNeonThing.geometry.computeVertexNormals();this.endNeonThing.geometry.normalsNeedUpdate=true;this.endNeonThing.material=new THREE.MeshPhongMaterial({color:15069169,emissive:15465727,emissiveIntensity:.2});this.endNeonThingLight=new THREE.PointLight(15400959,1,5);this.endNeonThing.add(this.endNeonThingLight);var tweenM=TweenMax.to(this.endNeonThing.material,2,{emissiveIntensity:.7,delay:2,repeat:-1,yoyo:true,repeatDelay:7,ease:RoughEase.ease.config({template:Power0.easeNone,strength:2,points:10,taper:"none",randomize:true,clamp:false}),onUpdate:function onUpdate(){_this6.endNeonThingLight.intensity=_this6.endNeonThing.material.emissiveIntensity}});this.endNeonThing.tween=tweenM;if(this.config.platform=="desktop"){this.mesh.remove(this.colliders);this.colliders=null}}},{key:"setEndingColliders",value:function setEndingColliders(){this.updateMatrixWorld(true);var colliderParent=this.endBuilding.getObjectByName("ColliderParent");this.collisionManager.refreshSquareColliders(colliderParent.children)}},{key:"loadSuns",value:function loadSuns(loadingManager){var _this7=this;console.log("Loading suns");return new Promise(function(resolve,reject){var textureLoader=new THREE.TextureLoader(loadingManager);_this7.sunTexture=textureLoader.load("assets/square/sunActive_gradientSun2.png");_this7.sunTexture.repeat.set(1,.5);console.log("Sun textures ",_this7.sunTexture);var loader=new THREE.ObjectLoader(loadingManager);loader.load(_this7.SUNS_PATH,function(obj){console.log("Loaded suns",obj);var reorderedSuns=new THREE.Object3D;_chapters2.default.forEach(function(chapter){var parent=obj.getObjectByName(chapter.hour.toString());if(parent){var fill=obj.getObjectByName(chapter.hour.toString()+"_F");fill.position.set(0,0,0);fill.children[0].geometry.dispose();fill.children[0].geometry=new THREE.SphereBufferGeometry(2,32,32);fill.scale.set(1,1,1);parent.add(fill);var stroke=obj.getObjectByName(chapter.hour.toString()+"_S");stroke.children[0].material.side=THREE.BackSide;stroke.children[0].material.color.set(6710835);stroke.children[0].material.opacity=.32;stroke.position.set(0,0,0);stroke.scale.set(1,1,1);stroke.children[0].geometry.dispose();stroke.children[0].geometry=new THREE.SphereBufferGeometry(2.1,32,32);parent.add(stroke);reorderedSuns.add(parent);var sunLoader=new _sun_loader2.default(_this7.renderer);sunLoader.init();sunLoader.name=chapter.hour.toString()+"_L";parent.add(sunLoader);sunLoader.scale.set(.83,.83,.83);sunLoader.rotation.set(chapter.sunLoaderRotation[0]*Math.PI/180,chapter.sunLoaderRotation[1]*Math.PI/180,chapter.sunLoaderRotation[2]*Math.PI/180,"XYZ");if(_this7.debug){}}});var sun19=reorderedSuns.getObjectByName("19");sun19.position.set(-47.29,45.4,38.41);var sun7=reorderedSuns.getObjectByName("7");sun7.position.y=45.57;console.log("Reordered suns",reorderedSuns);resolve(reorderedSuns)})})}},{key:"loadFile",value:function loadFile(loadingManager,path){return new Promise(function(resolve,reject){var loader=new THREE.ObjectLoader(loadingManager);loader.load(path,function(obj){resolve(obj)})})}},{key:"loadColliders",value:function loadColliders(loadingManager){return this.loadFile(loadingManager,this.COLLIDERS_PATH).then(function(obj){var colliders=void 0;obj.children=_lodash2.default.filter(obj.children,function(o){return o.name!="BenchColliders2"&&o.name!="BenchColliders"&&o.children.length>1});obj.children.forEach(function(o){o.children.splice(0,1)});console.log("Loaded square colliders ",obj);return obj})}},{key:"loadBenches",value:function loadBenches(loadingManager){var _this8=this;if(this.config.platform=="desktop"){return this.loadBenchesDesktop(loadingManager)}else{var _ret=function(){var benches=["bottomleft","topleft","group2","bottomright","topright","group1"];var benchPositions=[[9.68,-8.48,30.72],[-36.44,-8.48,-4.6],[-.79,2.36,1.9],[-14.86,-8.48,1.79],[-33.54,-8.48,-15.01],[-.84,1.97,1.76]];var benchRotations=[[0,243,0],[0,172,0],[0,0,0],[0,0,0],[0,297,0],[0,20,0]];var benchScales=[1.4,1.4,.9,1.4,1.4,.9];var loaders=[];benches.forEach(function(benchGroup){loaders.push(_this8.loadFile(loadingManager,_this8.BENCHES_PREFIX+benchGroup+".json"))});return{v:new Promise(function(resolve,reject){Promise.all(loaders).then(function(results){console.log("Benches Load results",results);var allBenches=new THREE.Object3D;for(var i=0;i<results.length;i++){results[i].position.fromArray(benchPositions[i]);results[i].rotation.set(benchRotations[i][0]*Math.PI/180,benchRotations[i][1]*Math.PI/180,benchRotations[i][2]*Math.PI/180,"YXZ");var benchScale=benchScales[i];results[i].scale.set(benchScale,benchScale,benchScale);allBenches.add(results[i]);if(_this8.debug){}}resolve(allBenches)})})}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}}},{key:"loadBenchesDesktop",value:function loadBenchesDesktop(loadingManager){var _this9=this;return new Promise(function(resolve,reject){var loader=new THREE.ObjectLoader(loadingManager);loader.load(_this9.BENCHES_PREFIX+"BenchAll.json",function(obj){console.log("Loaded Desktop benches ",obj);obj.scale.set(.95,.95,.95);obj.position.set(.86,.82,-1.38);resolve(obj)})})}},{key:"disableDepthWrite",value:function disableDepthWrite(objectArray){for(var i=0;i<objectArray.children.length;i++){if(objectArray.children[i].children[0]){objectArray.children[i].children[0].material.depthWrite=false}}}},{key:"loadFountain",value:function loadFountain(loadingManager){var _this10=this;return new Promise(function(resolve,reject){var loader=new THREE.ObjectLoader(loadingManager);loader.load(_this10.FOUNTAIN_PATH,function(obj){console.log("Loaded square fountain ",obj);resolve(obj)})})}},{key:"loadGround",value:function loadGround(loadingManager){var _this11=this;return new Promise(function(resolve,reject){var loader=new THREE.ObjectLoader(loadingManager);loader.load(_this11.GROUND_PATH,function(obj){console.log("Loaded ground ",obj);resolve(obj)})})}},{key:"loadSquare",value:function loadSquare(loadingManager){var _this12=this;return new Promise(function(resolve,reject){var loader=new THREE.ObjectLoader(loadingManager);loader.load(_this12.MODEL_PATH,function(obj){console.log("Loaded square ",obj);_this12.rotation.y=Math.PI*150/180;_this12.updateMatrixWorld();_this12.add(obj);_this12.sphereMesh=obj.getObjectByName("SkySphere").children[0];console.log("Sky sphere",_this12.sphereMesh);resolve(obj)})})}},{key:"setSquareMiddle",value:function setSquareMiddle(){this.squareMiddle=this.mesh.getObjectByName("f_06");if(this.squareMiddle){this.squareCenter=new THREE.Vector3;this.squareCenter.setFromMatrixPosition(this.squareMiddle.matrixWorld);console.log("Square center",this.squareCenter)}else{this.squareCenter=new THREE.Vector3(0,0,0)}}},{key:"addColliders",value:function addColliders(){var aroundFountain=this.fountainMesh.getObjectByName("f_11_SubMesh 0");aroundFountain.onCollision=function(distance){events.emit("fountain_collision",distance)};if(this.config.platform=="desktop"){this.collisionManager.refreshSquareColliders([].concat(_toConsumableArray(this.colliders.children),[aroundFountain]))}else{this.collisionManager.refreshSquareColliders([aroundFountain])}}},{key:"getSphereMesh",value:function getSphereMesh(){return this.sphereMesh}},{key:"getCenterPosition",value:function getCenterPosition(){return this.squareCenter}},{key:"getSun",value:function getSun(name){return this.suns.getObjectByName(name)}},{key:"getSunPosition",value:function getSunPosition(name){var sun=this.suns.getObjectByName(name);if(sun){var sunMesh=sun.children[0];return(new THREE.Vector3).setFromMatrixPosition(sunMesh.matrixWorld)}else{return null}}},{key:"getClockwork",value:function getClockwork(){return this.activeClockwork}},{key:"loadLights",value:function loadLights(){this.fountainLight=new THREE.PointLight(16777215,.5,100);this.fountainLight.position.set(0,0,0);this.fountainLight.intensity=.9;this.mesh.add(this.fountainLight)}},{key:"clockRotation",get:function get(){return this.activeClockwork.rotation.y},set:function set(rotation){this.activeClockwork.rotation.y=rotation;if(this.activeClockwork==this.clockwork){this.cylinders[0].rotation.y=rotation}}}]);return Square}(THREE.Object3D);exports.default=Square},{"./chapters":13,"./fountain":29,"./lib/text2d/index":40,"./pool":42,"./sun_loader":49,"./trees":51,"./util/debug":58,lodash:96}],48:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SunGazer=function(_THREE$Object3D){_inherits(SunGazer,_THREE$Object3D);function SunGazer(square,soundManager,collisionManager){_classCallCheck(this,SunGazer);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(SunGazer).call(this));_this.camPosition=new THREE.Vector3;_this.camQuaternion=new THREE.Quaternion;_this.camScale=new THREE.Vector3;_this.square=square;_this.soundManager=soundManager;_this.active=false;_this.GAZE_THRESHOLD=.977;_this.BLUR_THRESHOLD=.965;_this.gazingSun=null;_this.lastBlur=0;_this.ended=false;_this.currentCollider=null;_this.collisionManager=collisionManager;_this.raycaster=new THREE.Raycaster;return _this}_createClass(SunGazer,[{key:"init",value:function init(){var _this2=this;events.on("instructions_end",function(passed){_this2.active=true;setTimeout(function(){_this2.addSunColliders()},0)});events.on("character_playing",function(){});events.on("character_idle",function(){if(!_this2.ended){_this2.active=true}});events.on("character_ended",function(){if(!_this2.ended){_this2.active=true}});events.on("experience_end",function(){_this2.active=false;_this2.ended=true})}},{key:"addSunColliders",value:function addSunColliders(){var _this3=this;this.square.suns.children.forEach(function(sun){sun.updateMatrixWorld();var bbox=new THREE.BoundingBoxHelper(sun,16711680);bbox.update();bbox.scale.multiplyScalar(4.5);bbox.onGaze=function(camPosition,camVector,colliderPosition){_this3.onGaze(camPosition,camVector,colliderPosition,sun)};bbox.onGazeStop=function(){_this3.stop()};_this3.collisionManager.addGazeCollider(bbox)})}},{key:"onGaze",value:function onGaze(camPosition,camVector,colliderPosition,sun){if(this.active&&!this.ended){var gazeAngle=this.getDotProduct(camPosition,camVector,colliderPosition);if(this.gazingSun){if(gazeAngle<=this.GAZE_THRESHOLD){this.stop()}}else if(sun.name==this.square.currentSun){if(gazeAngle>this.GAZE_THRESHOLD){this.gazingSun=sun;events.emit("gaze_current_started",sun.name)}}else{if(this.blurringSun){this.setBlur(gazeAngle);if(gazeAngle>this.GAZE_THRESHOLD){this.gazingSun=this.blurringSun;events.emit("gaze_started",this.gazingSun.name)}}else{this.blurringSun=sun;this.setBlur(gazeAngle)}}}}},{key:"setBlur",value:function setBlur(res){var value=void 0;if(res==0){value=0}else{value=Math.min(1,(res-this.BLUR_THRESHOLD)/(this.GAZE_THRESHOLD-this.BLUR_THRESHOLD))}if(value!=this.lastBlur){this.soundManager.panorama.setFocusWithLevel(null,value);this.lastBlur=value}}},{key:"stop",value:function stop(){if(this.blurringSun){this.setBlur(0)}if(this.gazingSun){if(this.gazingSun.name==this.square.currentSun){events.emit("gaze_current_stopped")}else{events.emit("gaze_stopped",this.gazingSun.name)}}this.gazingSun=null;this.blurringSun=null}},{key:"getDotProduct",value:function getDotProduct(camPosition,camVector,colliderPosition){var camToSun=(new THREE.Vector3).copy(colliderPosition).sub(camPosition).normalize();return camToSun.dot(camVector)}}]);return SunGazer}(THREE.Object3D);exports.default=SunGazer},{}],49:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;
if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _GeometryUtils=require("./util/GeometryUtils");var _GeometryUtils2=_interopRequireDefault(_GeometryUtils);var _fbo=require("./util/fbo");var _fbo2=_interopRequireDefault(_fbo);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SunLoader=function(_THREE$Object3D){_inherits(SunLoader,_THREE$Object3D);function SunLoader(renderer){_classCallCheck(this,SunLoader);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(SunLoader).call(this));_this.render_fs="#define GLSLIFY 1\nvarying vec3 vColor;\nuniform float orderTimer;\nvarying float progressInCircle;\nuniform int organizing;\n\nvoid main() {\n  //gl_FragColor = vec4( vec3( 1., .5, .5 ), .85 );\n\n    if (organizing == 1 && orderTimer <  progressInCircle) {\n        discard;\n    }\n    \n  gl_FragColor = vec4(vColor, 1.);\n}\n";_this.render_vs="#define GLSLIFY 1\n//float texture containing the positions of each particle\nuniform sampler2D positions;\nuniform sampler2D origin;\n\nattribute vec2 reference;\nvarying vec3 vColor;\n\nuniform float radius;\nuniform float tube;\n\nuniform int boom;\nvarying float progressInCircle;\n\nvoid main() {\n\n    //the mesh is a nomrliazed square so the uvs = the xy positions of the vertices\n    vec3 pos = texture2D( positions, reference).xyz;\n\n    // Distance from center?\n    /*\n    vColor = vec3(distToCenter, 0.5, 0.5);\n    */\n    progressInCircle = (1.0 - reference.x) * (1.1 - reference.y) / 0.84;\n    if (progressInCircle > 1.0) {\n        progressInCircle -= 0.3;\n    }\n\n    vColor = vec3(1.0, mix(0.6,1.0,reference.x), mix(0.2,0.8,reference.y));\n\n    if (boom == 1) {\n        float distToCenter = distance(pos, vec3(0, 0, 0)) / (radius + tube);\n        vColor.g += (25.0 - distToCenter) / 65.0;\n        vColor.b += (25.0 - distToCenter) / 65.0;\n    }\n\n    gl_Position = projectionMatrix *  modelViewMatrix * vec4( pos, 1.0 );\n\n    gl_PointSize = 2.0;\n\n}\n";_this.simulation_fs="#define GLSLIFY 1\nhighp float random_1_0(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n\n\nuniform sampler2D positions;\nuniform sampler2D origin;\nuniform float timer;\nuniform float radius;\nuniform float tube;\n\nvarying vec2 vUv;\n\nuniform float orderTimer;\nuniform float explodeTimer;\n\nconst float PI = 3.1415926535897932384626433832795;\n\nvoid main() {\n    vec3 pos;\n    vec3 originPos;\n        \n    pos = texture2D( positions, vUv ).rgb;\n    originPos = texture2D( origin, vUv ).rgb;\n\n    if (explodeTimer == 1.0) {\n        pos = originPos;\n    } \n\n    if (orderTimer == 0.0) {\n        if ( random_1_0(vUv + timer ) > 0.99 ) {\n            pos = texture2D( origin, vUv ).xyz;\n        } else {\n            pos = texture2D( positions, vUv ).rgb;\n\n            float x = pos.x;\n            float y = pos.y;\n            float z = pos.z;\n\n\n            pos.x += sin( y * 13.0 ) * cos( z * 13.0 ) * 0.02 * (1.0 - (orderTimer / 0.3));\n            pos.y += sin( x * 13.0 ) * cos( z * 13.0 ) * 0.01 * (1.0 - (orderTimer / 0.3));\n            pos.z += sin( x * 14.0 ) * cos( y * 14.0 ) * 0.01 * (1.0 - (orderTimer / 0.3));\n        } \n    } else {\n        // Try to organize the circle by color\n        float particleRadius = distance(originPos, vec3(0, 0, 0));\n\n        if (explodeTimer > 0.0 && explodeTimer < 1.0) {\n            float variation = 0.2 + random_1_0(vUv + explodeTimer) * 0.8;\n            particleRadius += (50.0 * explodeTimer * explodeTimer * variation);\n        }\n\n        float progressInCircle = (1.0 - vUv.x) * (1.1 - vUv.y) / 0.84;\n        if (progressInCircle > 1.0) {\n            progressInCircle -= 0.3;\n        }\n        pos.x = cos(progressInCircle * 2.0 * PI) * particleRadius;\n        pos.y = sin(progressInCircle * 2.0 * PI) * particleRadius;\n    }\n\n\n    gl_FragColor = vec4( pos, 1.0 );\n}\n\n";_this.simulation_vs="#define GLSLIFY 1\nvarying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, 1.0 - uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";_this.width=32;_this.height=32;_this.orderTimer=0;_this.renderer=renderer;_this.radius=3;_this.tube=.2;_this.organizeTween=null;return _this}_createClass(SunLoader,[{key:"organize",value:function organize(time){var _this2=this;console.log("Sun loader - organize!");this.renderShader.uniforms.organizing.value=1;this.organizeTween=TweenMax.to(this,time,{ease:Linear.easeNone,orderTimer:1,onUpdate:function onUpdate(){_this2.simulationShader.uniforms.orderTimer.value=_this2.renderShader.uniforms.orderTimer.value=_this2.orderTimer},onComplete:function onComplete(){_this2.organizeTween=null;_this2.renderShader.uniforms.organizing.value=0;console.log("Sun loader - organize done")}})}},{key:"disorganize",value:function disorganize(){console.log("Sun loader - disorganize!");if(this.organizeTween){this.organizeTween.kill();this.organizeTween=null}this.orderTimer=0;this.simulationShader.uniforms.orderTimer.value=this.renderShader.uniforms.orderTimer.value=this.orderTimer;this.renderShader.uniforms.organizing.value=0}},{key:"explode",value:function explode(){var _this3=this;console.log("Sun loader - explode!");this.renderShader.uniforms.boom.value=1;TweenMax.to(this.simulationShader.uniforms.explodeTimer,1,{ease:Linear.None,onComplete:function onComplete(){_this3.simulationShader.uniforms.explodeTimer.value=0;_this3.simulationShader.uniforms.orderTimer.value=0;_this3.renderShader.uniforms.orderTimer.value=0;_this3.renderShader.uniforms.boom.value=0},value:1})}},{key:"initParticles",value:function initParticles(){var fboGeo=new THREE.TorusGeometry(this.radius,this.tube,20,100);var data=new Float32Array(this.width*this.height*3);var points=THREE.GeometryUtils.randomPointsInGeometry(fboGeo,this.width*this.height);for(var i=0,j=0,l=data.length;i<l;i+=3,j+=1){data[i]=points[j].x;data[i+1]=points[j].y;data[i+2]=points[j].z}var positions=new THREE.DataTexture(data,this.width,this.height,THREE.RGBFormat,THREE.FloatType);positions.needsUpdate=true;return positions}},{key:"init",value:function init(){var positions=this.initParticles();this.simulationShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:positions},origin:{type:"t",value:positions},timer:{type:"f",value:0},radius:{type:"f",value:this.radius},tube:{type:"f",value:this.tube},orderTimer:{type:"f",value:0},explodeTimer:{type:"f",value:0}},vertexShader:this.simulation_vs,fragmentShader:this.simulation_fs});this.renderShader=new THREE.ShaderMaterial({uniforms:{positions:{type:"t",value:null},pointSize:{type:"f",value:2},radius:{type:"f",value:this.radius},tube:{type:"f",value:this.tube},boom:{type:"1",value:0},organizing:{type:"1",value:0},orderTimer:{type:"f",value:0}},vertexShader:this.render_vs,fragmentShader:this.render_fs,transparent:false});var particleGeometry=new THREE.Geometry;particleGeometry.vertices.push(new THREE.Vector3);this.fbo=new _fbo2.default;this.fbo.init(this.width,this.height,this.renderer,this.simulationShader,this.renderShader,particleGeometry);this.add(this.fbo.particles);this.fbo.update()}},{key:"dispose",value:function dispose(){console.log("Disposing sun loader");this.fbo.particles.geometry.dispose();this.simulationShader.dispose();this.renderShader.dispose()}},{key:"update",value:function update(dt,et){this.simulationShader.uniforms.timer.value=et;this.fbo.update()}}]);return SunLoader}(THREE.Object3D);exports.default=SunLoader},{"./util/GeometryUtils":56,"./util/debug":58,"./util/fbo":59}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _chapters=require("./chapters");var _chapters2=_interopRequireDefault(_chapters);var _chapters_heb=require("./chapters_heb");var _chapters_heb2=_interopRequireDefault(_chapters_heb);var _math=require("./util/math");var _math2=_interopRequireDefault(_math);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _misc=require("./util/misc");var _misc2=_interopRequireDefault(_misc);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);var _index=require("./lib/text2d/index");var _moment=require("moment");var _moment2=_interopRequireDefault(_moment);var _multiline_text=require("./util/multiline_text");var _multiline_text2=_interopRequireDefault(_multiline_text);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var TimeController=function(){function TimeController(config,element,square,sky,scene,camera,soundManager,sunGazer){var _this=this;_classCallCheck(this,TimeController);this.square=square;this.config=config;this.element=element;this.sky=sky;this.scene=scene;this.rotateVelocity=0;this.currentRotation=0;this.camera=camera;this.soundManager=soundManager;this.sunGazer=sunGazer;this.gazeCounter=0;this.gazeHour=-1;this.active=false;this.clockRunning=false;this.daySpeed=config.daySpeed;this.wasUsed=false;this.done=false;this.currentChapter;this.chapterProgress={};this.totalExperienceTime=0;this.idleTimer=0;this.helpTimer=0;this.inShow=false;this.usedSun=false;this.nowCount=0;this.IDLE_TIMEOUT=90;this.HELP_TIMEOUT=30;this.NOW_HELP_TRIGGER=3;this.characterPlaying=false;events.on("experience_end",function(){_this.done=true});events.on("character_playing",function(){_this.characterPlaying=true});events.on("character_idle",function(){_this.characterPlaying=false})}_createClass(TimeController,[{key:"init",value:function init(loadingManager){var _this2=this;console.log("Initializing Time Controller",this.element);this.times=_chapters2.default.map(function(chapter){return chapter.hour}).sort(function(a,b){return a-b});this.angles=this.times.map(function(time){return time*15});this.angles.push(360);console.log("Chapter times",this.times,this.angles);this.currentHour=0;this.nextHour=this.times[1];_chapters2.default.forEach(function(chapter){_this2.chapterProgress[chapter.hour]={};_this2.totalExperienceTime+=chapter.totalTime;chapter.characters.forEach(function(character){_this2.chapterProgress[chapter.hour][character]=0})});this.isFirstChapter=true;this.chapterSounds={};Promise.all([this.loadChapterSounds("VO",7),this.loadChapterSounds("VO",9),this.loadChapterSounds("VO",12),this.loadChapterSounds("VO",17),this.loadChapterSounds("VO",19),this.loadChapterSounds("ambience",7),this.loadChapterSounds("ambience",9),this.loadChapterSounds("ambience",12),this.loadChapterSounds("ambience",17),this.loadChapterSounds("ambience",19)]).then(function(sounds){sounds.forEach(function(sound){if(!_this2.chapterSounds[sound.hour]){_this2.chapterSounds[sound.hour]={}}_this2.chapterSounds[sound.hour][sound.type]=sound;console.log(sound)})}).catch(function(err){console.warn("An error with loading chapter sounds "+err)});console.log("Total experience time:",this.totalExperienceTime);events.on("chapter_threshold",function(passed){_this2.active=!passed});events.on("control_threshold",function(passed){if(passed){_this2.scene.remove(_this2.chapterTitle);console.log("Time contol thresholdPassed. Turn off ",_this2.square.currentSun," Turn on ",_this2.currentHour.toString());if(_this2.square.currentSun){_this2.square.turnOffSun(_this2.square.currentSun)}_this2.square.currentSun=_this2.currentHour.toString();_this2.square.turnOnSun(_this2.currentHour.toString(),true);_this2.updateSunProgress()}});events.on("instructions_end",function(){_this2.clockRunning=true;_this2.isFirstChapter=false});events.on("base_position",function(){if(!_this2.done){console.log("Return to base, hour is ",_this2.currentHour);var closestAngle=_math2.default.closestValue(_this2.angles,_this2.currentHour*15);var closestHour=_this2.getHour(closestAngle);_this2.stickToAngle(closestAngle);_this2.currentHour=closestHour;_this2.setCurrentChapter();_this2.showChapterTitle()}});events.on("intro_end",function(){_this2.active=true});events.on("character_progress",function(data){_this2.idleTimer=0;_this2.helpTimer=0;if(_this2.chapterProgress[_this2.currentChapter.hour]&&typeof _this2.chapterProgress[_this2.currentChapter.hour][data.name]!="undefined"){_this2.chapterProgress[_this2.currentChapter.hour][data.name]=data.time;_this2.updateSunProgress();_this2.updateTotalTime()}});events.on("show_start",function(){_this2.clockRunning=false;_this2.inShow=true;console.log("Time controller - Show start. Stopping clock")});events.on("show_end",function(){_this2.clockRunning=true;_this2.inShow=false;console.log("Time controller - Show end. Resuming clock")});var TEXT_DEFINITION={align:_index.textAlign.center,font:"22px Miriam Libre",fillStyle:"#FFFFFF",antialias:true};var INSIDE_TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#cccccc",antialias:true};var INSIDE_SUN_TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#cccccc",antialias:true,shadow:true};var NOWHELP_TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#bfbfbf",antialias:true,shadow:true};var SUN_TEXT_SCALE=this.config.platform=="desktop"?.009:.013;this.chapterTitle=new _index.SpriteText2D("SPRITE",TEXT_DEFINITION);this.chapterTitle.scale.set(.002,.002,.002);this.chapterTitle.visible=false;this.chapterTitleLineTwo=new _index.SpriteText2D("SPRITE",TEXT_DEFINITION);this.chapterTitleLineTwo.visible=false;this.insideChapterTitle=new _index.MeshText2D("",INSIDE_SUN_TEXT_DEFINITION);this.insideChapterTitle.scale.multiplyScalar(.01);this.insideChapterTitleLineTwo=new _index.MeshText2D("",INSIDE_TEXT_DEFINITION);this.insideChapterTitleLineTwo.scale.multiplyScalar(SUN_TEXT_SCALE);var nowText=this.config.language=="eng"?"Now:":":כעת";this.insideChapterTitleLineNow=new _index.MeshText2D(nowText,INSIDE_TEXT_DEFINITION);this.insideChapterTitleLineNow.scale.multiplyScalar(SUN_TEXT_SCALE);var nowHelpText=this.config.language=="eng"?"Try a different sun":"נסו שמש אחרת";this.insideChapterTitleLineNowHelp=new _index.MeshText2D(nowHelpText,NOWHELP_TEXT_DEFINITION);this.insideChapterTitleLineNowHelp.scale.multiplyScalar(SUN_TEXT_SCALE);this.insideChapterTitle.visible=false;this.insideChapterTitleLineTwo.visible=false;this.insideChapterTitleLineNow.visible=false;this.insideChapterTitleLineNowHelp.visible=false;this.scene.add(this.insideChapterTitle);this.scene.add(this.insideChapterTitleLineTwo);this.scene.add(this.insideChapterTitleLineNow);this.scene.add(this.insideChapterTitleLineNowHelp);this.chapterTitle.add(this.chapterTitleLineTwo);this.chapterTitleLineTwo.position.y=-30;this.scene.add(this.chapterTitle);this.helpText=this.generateHelpText();events.on("gaze_started",function(hour){_this2.idleTimer=0;_this2.helpTimer=0;_this2.gazeHour=parseInt(hour);_this2.gazeCounter=0;_this2.insideChapterTitle.visible=true;_this2.insideChapterTitleLineTwo.visible=true;_this2.showInsideChapterTitle(hour);console.log("Time controller - Starting gaze counter for target hour "+_this2.gazeHour)});events.on("gaze_current_started",function(hour){_this2.insideChapterTitle.visible=true;_this2.insideChapterTitleLineTwo.visible=true;_this2.insideChapterTitleLineNow.visible=true;_this2.showInsideChapterTitle(hour);if(!_this2.usedSun){_this2.nowCount++;if(_this2.nowCount>=_this2.NOW_HELP_TRIGGER){_this2.insideChapterTitleLineNowHelp.visible=true}}console.log("Time controller - Starting gaze counter for current hour "+_this2.gazeHour,"now count",_this2.nowCount)});events.on("gaze_stopped",function(hour){_this2.insideChapterTitle.visible=false;_this2.insideChapterTitleLineTwo.visible=false;_this2.sunWorld=null;_this2.gazeHour=-1});events.on("gaze_current_stopped",function(hour){_this2.insideChapterTitle.visible=false;_this2.insideChapterTitleLineTwo.visible=false;_this2.insideChapterTitleLineNow.visible=false;_this2.insideChapterTitleLineNowHelp.visible=false;_this2.sunWorld=null});events.on("experience_end",function(){_this2.clockRunning=false})}},{key:"generateHelpText",value:function generateHelpText(){var TEXT_DEFINITION={align:_index.textAlign.center,font:"70px Miriam Libre",fillStyle:"#bfbfbf",antialias:true,shadow:true};var text=new _multiline_text2.default(2,TEXT_DEFINITION,100);text.init();if(this.config.platform=="desktop"){text.scale.multiplyScalar(5e-5);text.position.set(0,0,-.1001)}else{text.scale.multiplyScalar(.001);text.position.set(0,0,-1.56)}if(this.config.language=="heb"){text.setText([",אם ברצונך לשנות את השעה",".עליך להתמקד על אחת השמשות שמעליך"])}else{text.setText(["When you wish to change the time,","focus your gaze on one of the suns above."])}text.hide(0);return text}},{key:"updateSunProgress",value:function updateSunProgress(){var sum=0;_lodash2.default.forEach(this.chapterProgress[this.currentChapter.hour],function(value,key){if(key!="total"){sum+=value}});this.chapterProgress[this.currentChapter.hour]["total"]=sum;this.square.updateSunProgress(this.currentChapter.hour.toString(),sum/this.currentChapter.totalTime)}},{key:"updateTotalTime",value:function updateTotalTime(){var sum=0;_lodash2.default.forEach(this.chapterProgress,function(value,key){if(value["total"]){sum+=value["total"]}});this.experienceProgress=sum/this.totalExperienceTime;events.emit("experience_progress",this.experienceProgress)}},{key:"update",value:function update(dt,et){if(this.active&&this.rotateVelocity!=0){if(!this.wasUsed){this.wasUsed=true;events.emit("time_rotated")}this.square.getClockwork().rotateY(this.rotateVelocity*Math.PI/180*dt*20);this.updateRotation()}if(this.clockRunning&&!this.done){this.idleTimer+=dt;this.helpTimer+=dt;if(this.idleTimer>this.IDLE_TIMEOUT){console.log("Idle timer reached!",this.idleTimer);if(!this.characterPlaying){this.setDaySpeed(.5)}this.idleTimer=0;this.helpTimer=0}if(!this.usedSun&&this.helpTimer>this.HELP_TIMEOUT){this.helpTimer=0;if(!this.characterPlaying){this.showHelp();this.HELP_TIMEOUT=60}}this.currentHour+=dt*this.daySpeed;if(this.currentHour>=24){this.currentHour=0}if(this.currentHour>=this.nextHour&&this.nextHour!=0||this.nextHour==0&&this.currentHour>0&&this.currentHour<this.times[1]){this.currentHour=this.nextHour;var roundHour=this.nextHour;if(roundHour!=0){this.setCurrentChapter();console.log("Time - Updating next hour due to clock");events.emit("hour_updated",roundHour);if(this.square.currentSun){this.square.turnOffSun(this.square.currentSun)}this.square.currentSun=this.currentHour.toString();this.square.turnOnSun(this.currentHour.toString(),true);console.log("Time controller - next chapter");if(!this.done){this.setDaySpeed(this.config.daySpeed)}if(this.config.platform=="vive"){var previousHour=this.square.clockRotation*180/(Math.PI*15);this.rotateClockwork(previousHour,roundHour)}else{events.emit("angle_updated",roundHour)}}this.updateNextHour()}this.sky.setTime(this.currentHour)}if(this.gazeHour!=-1&&this.gazeHour!=this.currentChapter.hour){this.gazeCounter+=dt;if(this.gazeCounter>.5&&this.sky.clouds.currentState!="transition"){this.sky.clouds.startTransition()}if(this.gazeCounter>=3.2){if(!this.usedSun){this.usedSun=true;this.insideChapterTitleLineNowHelp.visible=false;this.scene.remove(this.insideChapterTitleLineNowHelp);if(this.helpText.parent==this.camera){this.camera.remove(this.helpText)}}var targetHour=this.gazeHour;this.gazeHour=-1;this.clockworkTransitionTo(targetHour,2,true)}}if(this.sunWorld){this.updateSunTitle()}}},{key:"showHelp",value:function showHelp(){var _this3=this;this.camera.add(this.helpText);this.helpText.show(1).then(function(){setTimeout(function(){_this3.helpText.hide(1).then(function(){_this3.camera.remove(_this3.helpText)});_this3.helpTimer=0},5e3)})}},{key:"clockworkTransitionTo",value:function clockworkTransitionTo(targetHour,time,usingGaze){var _this4=this;return new Promise(function(resolve,reject){if(targetHour==0){targetHour=24}var baseHour=_this4.currentHour;console.log("Time controller - Performing transition to "+targetHour+"! Stopping clock");_this4.clockRunning=false;if(usingGaze){_this4.square.explodeSun(targetHour.toString())}TweenMax.to(_this4,time,{ease:Power2.easeInOut,currentHour:targetHour,onComplete:function onComplete(){if(targetHour==24){_this4.currentHour=0}if(usingGaze){_this4.sunGazer.stop();_this4.sunGazer.active=false;if(_this4.square.currentSun){_this4.square.turnOffSun(_this4.square.currentSun)}_this4.square.currentSun=_this4.currentHour.toString();_this4.square.turnOnSun(_this4.currentHour.toString(),true)}_this4.setCurrentChapter();events.emit("hour_updated",_this4.currentHour);if(_this4.config.platform!="desktop"){setTimeout(function(){_this4.rotateClockwork(baseHour,targetHour)},1e3)}else{events.emit("angle_updated",_this4.currentHour);_this4.updateNextHour();if(_this4.currentHour!=0&&!_this4.done){_this4.sunGazer.active=true;console.log("Time controller Finished transition -Resuming clock");_this4.clockRunning=true}}},onUpdate:function onUpdate(){_this4.sky.setTime(_this4.currentHour)}})})}},{key:"rotateClockwork",value:function rotateClockwork(baseHour,targetHour){var _this5=this;console.log("Time controller rotating clockwork from "+baseHour+" to "+targetHour);var targetRotationY=targetHour*15;targetRotationY*=Math.PI/180;console.log("Time controller - rotating square from ",this.square.clockRotation," to ",targetRotationY," Stopping clock");this.sunGazer.active=false;this.clockRunning=false;TweenMax.to(this.square,7*(Math.abs(targetHour-baseHour)*.5),{ease:Power2.easeInOut,delay:1,clockRotation:targetRotationY,onComplete:function onComplete(){events.emit("angle_updated",_this5.currentHour);_this5.updateNextHour();if(_this5.currentHour==0){_this5.square.clockRotation=0}else if(!_this5.done){_this5.sunGazer.active=true;if(!_this5.inShow){_this5.clockRunning=true}}},onUpdate:function onUpdate(){events.emit("square_rotating")}})}},{key:"setDaySpeed",value:function setDaySpeed(speed){console.log("Time controller - setting day speed to "+speed);this.daySpeed=speed}},{key:"updateRotation",value:function updateRotation(){var rotationY=this.square.clockRotation;if(rotationY<0){rotationY=2*Math.PI+rotationY}this.currentRotation=rotationY*180/Math.PI;this.sky.setTime(this.currentRotation/15);var closestAngle=_math2.default.closestValue(this.angles,this.currentRotation);var closestHour=this.getHour(closestAngle);if(closestHour!=this.currentHour){this.currentHour=closestHour;this.updateNextHour();this.setCurrentChapter();this.showChapterTitle();events.emit("hour_updated",this.currentHour)}}},{key:"updateNextHour",value:function updateNextHour(){var currentIndex=this.times.indexOf(this.currentHour);if(currentIndex==this.times.length-1){this.nextHour=this.times[0]}else{this.nextHour=this.times[currentIndex+1]}console.log("Next hour: ",this.nextHour)}},{key:"updateSquare",value:function updateSquare(){if(this.square.mesh){var rotationY=this.currentRotation;this.square.clockRotation=rotationY*Math.PI/180;this.sky.setTime(this.currentRotation/15)}}},{key:"getHour",value:function getHour(angle){var hour=void 0;if(angle==360){hour=0}else{hour=angle/15}return hour}},{key:"handleMouseMove",value:function handleMouseMove(e){if(!this.active||this.done){return}if(e.pageX>this.element.offsetWidth*2/3){this.rotateVelocity=(e.pageX-this.element.offsetWidth*2/3)/(this.element.offsetWidth/3)}else if(e.pageX<this.element.offsetWidth/3){this.rotateVelocity=(this.element.offsetWidth/3-e.pageX)/(this.element.offsetWidth/3)*-1}else{if(this.rotateVelocity!=0){this.stoppedTurning()}this.rotateVelocity=0}}},{key:"stoppedTurning",value:function stoppedTurning(){var closestAngle=_math2.default.closestValue(this.angles,this.currentRotation);var closestHour=this.getHour(closestAngle);this.stickToAngle(closestAngle);this.currentHour=closestHour}},{key:"stickToAngle",value:function stickToAngle(closestAngle){var _this6=this;var targetRotationY=closestAngle;console.log("Target rotationY ",targetRotationY," from ",this.currentRotation);var roundHour=targetRotationY/15;TweenMax.to(this,1,{currentRotation:targetRotationY,onComplete:function onComplete(){events.emit("angle_updated",roundHour)},onUpdate:function onUpdate(){_this6.updateSquare()}})}},{key:"preloadLocalTime",value:function preloadLocalTime(){var now=new Date;var localTime=now.getHours()+now.getMinutes()/60;var availableTimes=this.times.slice(1);var closestHour=_math2.default.closestValue(availableTimes,localTime);console.log("Current local time ",localTime,"Available times",availableTimes,"Closest time",closestHour);events.emit("hour_updated",closestHour);return closestHour}},{key:"preloadTime",value:function preloadTime(hour){events.emit("hour_updated",hour)}},{key:"transitionTo",value:function transitionTo(hour,time,setChapter){var _this7=this;return new Promise(function(resolve,reject){var targetRotationY=void 0;if(hour==0){targetRotationY=360}else{targetRotationY=hour*15}console.log("Time transition - Square rotating to ",targetRotationY);TweenMax.to(_this7,time,{ease:Linear.easeNone,currentRotation:targetRotationY,onComplete:function onComplete(){_this7.currentHour=hour;if(_this7.currentHour==0){_this7.currentRotation=0;_this7.updateSquare()}_this7.updateNextHour();_this7.setCurrentChapter();_this7.showChapterTitle();if(setChapter){events.emit("hour_updated",_this7.currentHour)}events.emit("angle_updated",_this7.currentHour);resolve()},onUpdate:function onUpdate(){_this7.updateSquare()}})})}},{key:"rotate",value:function rotate(angle,time){var _this8=this;return new Promise(function(resolve,reject){TweenMax.to(_this8,time,_defineProperty({ease:Linear.easeNone,currentRotation:angle,onComplete:function onComplete(){},onUpdate:function onUpdate(){_this8.updateSquare()}},"onComplete",function onComplete(){resolve()}))})}},{key:"setCurrentChapter",value:function setCurrentChapter(){var _this9=this;this.currentChapter=_lodash2.default.find(_chapters2.default,{hour:this.currentHour});if(this.config.language=="heb"){var hebChapter=_lodash2.default.find(_chapters_heb2.default,{hour:this.currentHour});_misc2.default.overwriteProps(this.currentChapter,hebChapter)}this.characterPlaying=false;this.clearVoiceovers();console.log("Chapter sound check ",this.currentHour,this.isFirstChapter,this.chapterSounds);if(this.currentHour!=19&&!this.isFirstChapter){(function(){var hour=_this9.currentHour;setTimeout(function(){_this9.playChapterSounds(hour)},1e3)})()}}},{key:"showChapterTitle",value:function showChapterTitle(){if(this.currentChapter.hour==0){return}var now=(0,_moment2.default)();var targetOpacity=1;if(this.config.language=="eng"){this.chapterTitle.text="Your Local Time "+now.format("HH:mm")}else{this.chapterTitle.text="השעה כעת "+now.format("HH:mm")}this.chapterTitle.visible=true;this.chapterTitle.position.fromArray(this.currentChapter.titlePosition).add(this.square.position);this.chapterTitle.material.opacity=0;this.chapterTitleLineTwo.text=this.currentChapter.name;this.chapterTitleLineTwo.visible=true;this.chapterTitleLineTwo.material.opacity=0;TweenMax.to(this.chapterTitle.material,1,{opacity:targetOpacity});TweenMax.to(this.chapterTitleLineTwo.material,1,{opacity:targetOpacity});if(this.square.currentSun){this.square.turnOffSun(this.square.currentSun)}this.square.currentSun=this.currentHour.toString();this.turnOnChapterSun(this.currentHour,true)}},{key:"getHourText",value:function getHourText(hour){var hourText="";if(hour==12){hourText="12PM"}else if(hour>12){hourText=hour-12+"PM"}else{hourText=hour+"AM"}return hourText}},{key:"showInsideChapterTitle",value:function showInsideChapterTitle(hour){var sun=this.square.getSun(hour);if(!sun){throw new Error("Invalid chapter sun "+hour)}var chapter=this.config.language=="eng"?_lodash2.default.find(_chapters2.default,{hour:parseInt(hour)}):_lodash2.default.find(_chapters_heb2.default,{hour:parseInt(hour)});if(!chapter){throw new Error("Invalid chapter hour "+hour)}var hourText=this.getHourText(chapter.hour);this.insideChapterTitle.text=hourText;this.insideChapterTitleLineTwo.text=chapter.name;sun.updateMatrixWorld();this.sunWorld=(new THREE.Vector3).setFromMatrixPosition(sun.matrixWorld)}},{key:"updateSunTitle",value:function updateSunTitle(){if(this.sunWorld){this.insideChapterTitle.position.copy(this.sunWorld);this.insideChapterTitle.lookAt(this.camera.position);this.insideChapterTitle.translateZ(5);this.insideChapterTitle.quaternion.copy(this.camera.quaternion);this.insideChapterTitle.translateY(.5);this.insideChapterTitleLineTwo.position.copy(this.sunWorld);this.insideChapterTitleLineTwo.lookAt(this.camera.position);this.insideChapterTitleLineTwo.translateZ(5);this.insideChapterTitleLineTwo.quaternion.copy(this.camera.quaternion);this.insideChapterTitleLineTwo.translateY(-1.5);if(this.insideChapterTitleLineNow.visible){this.insideChapterTitleLineNow.position.copy(this.sunWorld);this.insideChapterTitleLineNow.lookAt(this.camera.position);this.insideChapterTitleLineNow.translateZ(5);this.insideChapterTitleLineNow.quaternion.copy(this.camera.quaternion);this.insideChapterTitleLineNow.translateY(2.5);if(this.insideChapterTitleLineNowHelp.visible){this.insideChapterTitleLineNowHelp.position.copy(this.sunWorld);this.insideChapterTitleLineNowHelp.lookAt(this.camera.position);this.insideChapterTitleLineNowHelp.translateZ(5);this.insideChapterTitleLineNowHelp.quaternion.copy(this.camera.quaternion);this.insideChapterTitleLineNowHelp.translateY(-2.5)}}}}},{key:"turnOnChapterSun",value:function turnOnChapterSun(){if(this.currentHour==17||this.currentHour==9){this.square.turnOnSun("9",true)}else if(this.currentHour==19||this.currentHour==7){this.square.turnOnSun("7",true)}else if(this.currentHour==12){this.square.turnOnSun("12",true)}else{if(this.square.currentSun){this.square.turnOffSun(this.square.currentSun)}}}},{key:"setTime",value:function setTime(hour){this.currentHour=hour;this.currentRotation=hour*15;this.setCurrentChapter();this.updateSquare();this.setCurrentChapter();this.showChapterTitle();events.emit("hour_updated",this.currentHour);events.emit("angle_updated",this.currentHour);
this.updateNextHour()}},{key:"jumpToTime",value:function jumpToTime(hour){this.currentHour=hour;this.sky.setTime(this.currentHour);this.setCurrentChapter();events.emit("hour_updated",this.currentHour);this.setCurrentChapter();this.showChapterTitle();this.updateNextHour()}},{key:"clearVoiceovers",value:function clearVoiceovers(){var _this10=this;_lodash2.default.forIn(this.chapterSounds,function(chapterSound,hour){if(chapterSound.VO&&chapterSound.VO.playedOnce){console.log("Clear chapter sound",hour,chapterSound.VO);_this10.unloadChapterSound(chapterSound.VO);delete _this10.chapterSounds[hour].VO}})}},{key:"unloadChapterSound",value:function unloadChapterSound(chapterSound){chapterSound.sampler.stop();chapterSound.sampler.unload()}},{key:"loadChapterSounds",value:function loadChapterSounds(type,hour){var _this11=this;return new Promise(function(resolve,reject){if(type=="ambience"){_this11.soundManager.createStaticSoundSampler(_this11.config.assetsHost+"assets/sound/chapter_vo/ambience/"+hour+"_"+type+".ogg",function(sampler){resolve({sampler:sampler,type:type,hour:hour})})}else if(type=="VO"){_this11.soundManager.createStaticSoundSampler(_this11.config.assetsHost+"assets/sound/chapter_vo/"+hour+"_"+_this11.config.language+".ogg",function(sampler){resolve({sampler:sampler,type:type,hour:hour,playedOnce:false})})}})}},{key:"playChapterSounds",value:function playChapterSounds(hour){var _this12=this;if(this.chapterSounds[hour]){if(!this.chapterSounds[hour].VO){this.chapterSounds[hour].ambience.sampler.play()}else{this.chapterSounds[hour].VO.sampler.play();events.emit("chapter_sound_playing",true);this.chapterSounds[hour].VO.playedOnce=true;this.chapterSounds[hour].VO.sampler.source.onended=function(){events.emit("chapter_sound_playing",false);_this12.clearVoiceovers()}}}}}]);return TimeController}();exports.default=TimeController},{"./chapters":13,"./chapters_heb":14,"./lib/text2d/index":40,"./util/debug":58,"./util/math":62,"./util/misc":63,"./util/multiline_text":64,lodash:96,moment:97}],51:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _trees_def=require("./trees/trees_def");var _trees_def2=_interopRequireDefault(_trees_def);var _trees_def_landing=require("./trees/trees_def_landing");var _trees_def_landing2=_interopRequireDefault(_trees_def_landing);var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TREES_PATH="assets/trees";var Trees=function(_THREE$Object3D){_inherits(Trees,_THREE$Object3D);function Trees(config,camera,renderer){_classCallCheck(this,Trees);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Trees).call(this));_this.debug=false;_this.cameras=[camera];_this.renderer=renderer;_this.config=config;_this.windVertexShader="#define GLSLIFY 1\n// frequencies for rustling animation\n// can be tweaked to taste\n#define SIDE_TO_SIDE_FREQ1 1.975\n#define SIDE_TO_SIDE_FREQ2 0.793\n#define UP_AND_DOWN_FREQ1 0.375\n#define UP_AND_DOWN_FREQ2 0.193\n\n\n// uniforms\n// common uniforms\nuniform float time; // increase by delta time in render loop\nuniform float speedFactor; // larger value -> faster bending and rustling\nuniform float pointSize; // rendering point size\n\n// bending uniforms\nuniform float bendFactor; // amount of bending\nuniform float bendHeightLimit; // the height above which the bending starts\nuniform vec2 wind; // direction & speed of the wind on the xz plane - note: only affects bending\n\n#define max_clip_boxes 30\n\nattribute float intensity;\nattribute float classification;\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float pointSourceID;\nattribute vec4 indices;\n\nuniform float screenWidth;\nuniform float screenHeight;\nuniform float fov;\nuniform float spacing;\nuniform float near;\nuniform float far;\n\n#if defined use_clip_box\nuniform mat4 clipBoxes[max_clip_boxes];\n#endif\n\n\nuniform float heightMin;\nuniform float heightMax;\nuniform float intensityMin;\nuniform float intensityMax;\nuniform float size; // pixel size factor\nuniform float minSize; // minimum pixel size\nuniform float maxSize; // maximum pixel size\nuniform float octreeSize;\nuniform vec3 bbSize;\nuniform vec3 uColor;\nuniform float opacity;\nuniform float clipBoxCount;\n\n\nuniform sampler2D visibleNodes;\nuniform sampler2D gradient;\nuniform sampler2D classificationLUT;\nuniform sampler2D depthMap;\n\nvarying float vOpacity;\nvarying vec3 vColor;\nvarying float vLinearDepth;\nvarying float vLogDepth;\nvarying vec3 vViewPosition;\nvarying float vRadius;\nvarying vec3 vWorldPosition;\nvarying vec3 vNormal;\n\n\nuniform float rustleHeightLimit; // the height above which the rustling starts\nuniform bool rustleColorCheck; // use color checking for limiting rustling; currently not usable; see rustle()\nuniform float rustleFactor; // amount of rustling\nuniform float rustleFrequency; // frequency of rustles\n\n\n// ---------------------\n// OCTREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_tree_depth)) && defined(tree_type_octree)\n/**\n* number of 1-bits up to inclusive index position\n* number is treated as if it were an integer in the range 0-255\n*\n*/\nfloat numberOfOnes(float number, float index){\n    float tmp = mod(number, pow(2.0, index + 1.0));\n    float numOnes = 0.0;\n    for(float i = 0.0; i < 8.0; i++){\n    if(mod(tmp, 2.0) != 0.0){\n    numOnes++;\n    }\n    tmp = floor(tmp / 2.0);\n    }\n    return numOnes;\n}\n\n\n/**\n* checks whether the bit at index is 1\n* number is treated as if it were an integer in the range 0-255\n*\n*/\nbool isBitSet(float number, float index){\n    return mod(floor(number / pow(2.0, index)), 2.0) != 0.0;\n}\n\n\n/**\n* find the tree depth at the point position\n*/\nfloat getLocalTreeDepth(){\n    vec3 offset = vec3(0.0, 0.0, 0.0);\n    float iOffset = 0.0;\n    float depth = 0.0;\n    for(float i = 0.0; i <= 1000.0; i++){\n        float nodeSizeAtLevel = octreeSize / pow(2.0, i);\n        vec3 index3d = (position - offset) / nodeSizeAtLevel;\n        index3d = floor(index3d + 0.5);\n        float index = 4.0*index3d.x + 2.0*index3d.y + index3d.z;\n\n        vec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n        float mask = value.r * 255.0;\n        if(isBitSet(mask, index)){\n        // there are more visible child nodes at this position\n        iOffset = iOffset + value.g * 255.0 + numberOfOnes(mask, index - 1.0);\n        depth++;\n        }else{\n        // no more visible child nodes at this position\n        return depth;\n        }\n        offset = offset + (vec3(1.0, 1.0, 1.0) * nodeSizeAtLevel * 0.5) * index3d;\n    }\n    return depth;\n}\n\nfloat getPointSizeAttenuation(){\n    return pow(1.9, getLocalTreeDepth());\n}\n\n\n#endif\n\n\n// ---------------------\n// KD-TREE\n// ---------------------\n\n#if (defined(adaptive_point_size) || defined(color_type_tree_depth)) && defined(tree_type_kdtree)\n\nfloat getLocalTreeDepth(){\n    vec3 offset = vec3(0.0, 0.0, 0.0);\n    float iOffset = 0.0;\n    float depth = 0.0;\n\n\n    vec3 size = bbSize;\n    vec3 pos = position;\n\n    for(float i = 0.0; i <= 1000.0; i++){\n\n        vec4 value = texture2D(visibleNodes, vec2(iOffset / 2048.0, 0.0));\n\n        int children = int(value.r * 255.0);\n        float next = value.g * 255.0;\n        int split = int(value.b * 255.0);\n\n        if(next == 0.0){\n        return depth;\n        }\n\n        vec3 splitv = vec3(0.0, 0.0, 0.0);\n        if(split == 1){\n        splitv.x = 1.0;\n        }else if(split == 2){\n        splitv.y = 1.0;\n        }else if(split == 4){\n        splitv.z = 1.0;\n        }\n\n        iOffset = iOffset + next;\n\n        float factor = length(pos * splitv / size);\n        if(factor < 0.5){\n        // left\n        if(children == 0 || children == 2){\n        return depth;\n        }\n        }else{\n        // right\n        pos = pos - size * splitv * 0.5;\n        if(children == 0 || children == 1){\n        return depth;\n        }\n        if(children == 3){\n        iOffset = iOffset + 1.0;\n        }\n        }\n        size = size * ((1.0 - (splitv + 1.0) / 2.0) + 0.5);\n\n        depth++;\n    }\n\n\n    return depth;\n}\n\nfloat getPointSizeAttenuation(){\n    return pow(1.3, getLocalTreeDepth());\n}\n\n#endif\n\n\n// WIND-SHADER\n\n// run-of-the-mill rgb-hsv-conversions\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n// general math\nfloat smoothCurve(float x) {\n    return x * x * (3.0 - 2.0 * x);\n}\nfloat triangleWave(float x) {\n    return abs(fract(x + 0.5) * 2.0 - 1.0);\n}\nfloat smoothTriangleWave(float x) {\n    return smoothCurve(triangleWave(x));\n}\nvec4 smoothTriangleWave(vec4 v) {\n    float x = smoothTriangleWave(v.x);\n    float y = smoothTriangleWave(v.y);\n    float z = smoothTriangleWave(v.z);\n    float w = smoothTriangleWave(v.w);\n    return vec4(x, y, z, w);\n}\n\nvoid bend(inout vec3 pos) {\n    if(pos.x > bendHeightLimit) {\n    float bend = (sin(time * speedFactor) + 1.0) * bendFactor;\n    float clampedX = max(pos.x, bendHeightLimit); // coordinate system is rotated -> x is up\n    float bf = (clampedX - bendHeightLimit) * bend;\n        vec3 newPos = pos;\n        newPos.yz += wind.xy * bf; // trees' supposed xz plane is yz b/c rotation; if the wind direction is off, flip the coordinates\n        pos = newPos;\n    }\n}\n\nvoid rustle(inout vec3 pos) {\n    vec3 hsv = rgb2hsv(color);\n    // values by trial and error, mostly\n    if(pos.x > rustleHeightLimit) {\n        if(!rustleColorCheck || (hsv.x > 0.16 && hsv.x < 0.5 && hsv.y > 0.18 && hsv.z > 0.08)) {\n            // vColor.r = 1.0; // uncomment to debug height limit and HVS comparisons\n            // vColor.g = 0.0;\n            // vColor.b = 0.0;\n            vec3 newPos = pos;\n            float objPhase = length(modelMatrix[3].xyz); // assign unique phase to each object\n            float vtxYPhase = pos.y + objPhase; // vary vertex phases according to location\n            float vtxZPhase = pos.z + objPhase; // on the yz plane (ground plane b/c rotated models)\n            vec2 wavesIn = vec2(vtxYPhase + time, vtxZPhase + time);\n            vec4 waves = (fract(wavesIn.xxyy *\n               vec4(SIDE_TO_SIDE_FREQ1, SIDE_TO_SIDE_FREQ2, UP_AND_DOWN_FREQ1, UP_AND_DOWN_FREQ2)) *\n               2.0 - 1.0 ) * speedFactor * rustleFrequency; // lifted from crytek paper: http://http.developer.nvidia.com/GPUGems3/gpugems3_ch16.html\n            waves = smoothTriangleWave(waves);\n            vec2 wavesSum = waves.xz + waves.yw;\n            newPos.y += wavesSum.y * (pos.x - rustleHeightLimit) * rustleFactor / 100.0;\n            newPos.z += wavesSum.x * (pos.x - rustleHeightLimit) * rustleFactor / 100.0;\n            pos = newPos;\n        }\n    }\n}\n\nvoid main() {\n    // WIND SHADER\n    vec3 pos = position.xyz;\n    bend(pos);\n    rustle(pos);\n\n    vec4 worldPosition = modelMatrix * vec4( pos, 1.0 );\n    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );\n    vViewPosition = -mvPosition.xyz;\n    vWorldPosition = worldPosition.xyz;\n    gl_Position = projectionMatrix * mvPosition;\n    vOpacity = opacity;\n    vLinearDepth = -mvPosition.z;\n    vNormal = normalize(normalMatrix * normal);\n\n#if defined(use_edl)\n    vLogDepth = log2(gl_Position.w + 1.0) / log2(far + 1.0);\n#endif\n\n    //#if defined(use_logarithmic_depth_buffer)\n    // float logarithmicZ = (2.0 * log2(gl_Position.w + 1.0) / log2(far + 1.0) - 1.0) * gl_Position.w;\n    // gl_Position.z = logarithmicZ;\n    //#endif\n\n// ---------------------\n// POINT COLOR\n// ---------------------\n\n#ifdef color_type_rgb\n    vColor = color;\n#elif defined color_type_height\n    vec4 world = modelMatrix * vec4( position, 1.0 );\n    float w = (world.y - heightMin) / (heightMax-heightMin);\n    vColor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n#elif defined color_type_depth\n    float linearDepth = -mvPosition.z ;\n    float expDepth = (gl_Position.z / gl_Position.w) * 0.5 + 0.5;\n    vColor = vec3(linearDepth, expDepth, 0.0);\n#elif defined color_type_intensity\n    float w = (intensity - intensityMin) / (intensityMax - intensityMin);\n    vColor = vec3(w, w, w);\n#elif defined color_type_intensity_gradient\n    float w = (intensity - intensityMin) / intensityMax;\n    vColor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n#elif defined color_type_color\n    vColor = uColor;\n#elif defined color_type_tree_depth\n    float depth = getLocalTreeDepth();\n    float w = depth / 30.0;\n    vColor = texture2D(gradient, vec2(w,1.0-w)).rgb;\n#elif defined color_type_point_index\n    vColor = indices.rgb;\n#elif defined color_type_classification\n    float c = mod(classification, 16.0);\n    vec2 uv = vec2(c / 255.0, 0.5);\n    vColor = texture2D(classificationLUT, uv).rgb;\n\n    // TODO only for testing - removing points with class 7\n    if(classification == 7.0){\n    gl_Position = vec4(100.0, 100.0, 100.0, 0.0);\n    }\n#elif defined color_type_return_number\n    //float w = (returnNumber - 1.0) / 4.0 + 0.1;\n    //vColor = texture2D(gradient, vec2(w, 1.0 - w)).rgb;\n\n    if(numberOfReturns == 1.0){\n    vColor = vec3(1.0, 1.0, 0.0);\n    }else{\n    if(returnNumber == 1.0){\n    vColor = vec3(1.0, 0.0, 0.0);\n    }else if(returnNumber == numberOfReturns){\n    vColor = vec3(0.0, 0.0, 1.0);\n    }else{\n    vColor = vec3(0.0, 1.0, 0.0);\n    }\n    }\n\n#elif defined color_type_source\n    float w = mod(pointSourceID, 10.0) / 10.0;\n    vColor = texture2D(gradient, vec2(w,1.0 - w)).rgb;\n#elif defined color_type_normal\n    vColor = (modelMatrix * vec4(normal, 0.0)).xyz;\n#elif defined color_type_phong\n    vColor = color;\n#endif\n\n    //if(vNormal.z < 0.0){\n    // gl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n    //}\n\n    // ---------------------\n    // POINT SIZE\n    // ---------------------\n    float pointSize = 1.0;\n\n    float projFactor = 1.0 / tan(fov / 2.0);\n    projFactor /= vViewPosition.z;\n    projFactor *= screenHeight / 2.0;\n    float r = spacing * 1.5;\n    vRadius = r;\n#if defined fixed_point_size\n    pointSize = size;\n#elif defined attenuated_point_size\n    pointSize = size * projFactor;\n#elif defined adaptive_point_size\n    float worldSpaceSize = size * r / getPointSizeAttenuation();\n    pointSize = worldSpaceSize * projFactor;\n#endif\n\n    pointSize = max(minSize, pointSize);\n    pointSize = min(maxSize, pointSize);\n\n    vRadius = pointSize / projFactor;\n\n    gl_PointSize = pointSize;\n\n\n    // ---------------------\n    // CLIPPING\n    // ---------------------\n\n#if defined use_clip_box\n    bool insideAny = false;\n    for(int i = 0; i < max_clip_boxes; i++){\n    if(i == int(clipBoxCount)){\n    break;\n    }\n\n    vec4 clipPosition = clipBoxes[i] * modelMatrix * vec4( position, 1.0 );\n    bool inside = -0.5 <= clipPosition.x && clipPosition.x <= 0.5;\n    inside = inside && -0.5 <= clipPosition.y && clipPosition.y <= 0.5;\n    inside = inside && -0.5 <= clipPosition.z && clipPosition.z <= 0.5;\n    insideAny = insideAny || inside;\n    }\n    if(!insideAny){\n\n#if defined clip_outside\n    gl_Position = vec4(1000.0, 1000.0, 1000.0, 1.0);\n#elif defined clip_highlight_inside && !defined(color_type_depth)\n    float c = (vColor.r + vColor.g + vColor.b) / 6.0;\n#endif\n    }else{\n#if defined clip_highlight_inside\n    vColor.r += 0.5;\n#endif\n    }\n\n#endif\n\n}\n\n\n\n\n// ------------------------------\n\n\n/*\nvoid main(void) {\n	vColor = color;\n	float length = length(position.xyz);\n	vec3 pos = position;\n	bend(pos);\n	rustle(pos);\n	gl_PointSize = pointSize;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4(normalize(pos.xyz) * length, 1.0);\n}*/\n\n";return _this}_createClass(Trees,[{key:"init",value:function init(loadingManager,which){var _this2=this;var treeTypes={};var treeSelector=void 0;if(which=="landing"){treeSelector=_trees_def_landing2.default}else{treeSelector=_trees_def2.default}return new Promise(function(resolve,reject){console.log("Loading trees",treeSelector);var typePromises=treeSelector.types.map(function(type){return _this2.loadType(type,treeTypes)});Promise.all(typePromises).then(function(results){_this2.potreeWindMaterial=new Potree.PointCloudMaterial;_this2.potreeMaterial=new Potree.PointCloudMaterial;var windUniforms={time:{type:"f",value:0},speedFactor:{type:"f",value:1},pointSize:{type:"f",value:.03},bendFactor:{type:"f",value:.01},bendHeightLimit:{type:"f",value:0},wind:{type:"v2",value:new THREE.Vector2(1,.5)},rustleHeightLimit:{type:"f",value:5},rustleColorCheck:{type:"b",value:false},rustleFactor:{type:"f",value:1},rustleFrequency:{type:"f",value:.2}};Object.assign(windUniforms,_this2.potreeWindMaterial.uniforms);var windShader=_this2.potreeWindMaterial.getDefines()+_this2.windVertexShader;_this2.potreeWindMaterial.setValues({uniforms:windUniforms,vertexShader:windShader});var counter=0;treeSelector.instances.forEach(function(instance){if(treeTypes[instance.type]){var mesh=void 0;if(instance.scale>.5){mesh=new Potree.PointCloudOctree(treeTypes[instance.type],_this2.potreeWindMaterial)}else{mesh=new Potree.PointCloudOctree(treeTypes[instance.type],_this2.potreeMaterial)}mesh.material.size=.003;mesh.material.lights=false;mesh.position.fromArray(instance.position);if(instance.scale){mesh.scale.multiplyScalar(instance.scale)}mesh.rotation.order="ZXY";mesh.rotation.set(instance.rotation[0]*Math.PI/180,instance.rotation[1]*Math.PI/180,instance.rotation[2]*Math.PI/180);_this2.add(mesh);if(_this2.debug){_debug2.default.positionObject(mesh,instance.type+" "+counter,false,-40,40,instance.rotation)}counter++}});if(typeof events!="undefined"){events.on("control_threshold",function(passed){_this2.controlPassed=passed;if(passed){var size=_this2.config.platform=="desktop"?.07:.03;_this2.potreeWindMaterial.size=size;_this2.potreeMaterial.size=size;if(inVR){var hide1=_this2.children[8];var hide2=_this2.children[13];console.log("Hiding 2 trees",hide1,hide2);_this2.remove(hide1);_this2.remove(hide2)}}});events.on("vr_start",function(cameras){_this2.cameras=cameras})}resolve()})})}},{key:"loadType",value:function loadType(props,store){return new Promise(function(resolve,reject){console.log("Loading tree type ",props);Potree.POCLoader.load(TREES_PATH+"/"+props.fileName,function(geometry){store[props.name]=geometry;resolve()})})}},{key:"update",value:function update(dt,et){this.potreeWindMaterial.uniforms.time.value=et;for(var i=0;i<this.children.length;i++){for(var j=0;j<this.cameras.length;j++){this.children[i].update(this.cameras[j],this.renderer)}}}},{key:"clickEffect",value:function clickEffect(input){if(input==1){this.potreeWindMaterial.uniforms.rustleFrequency.value=30;this.potreeWindMaterial.uniforms.rustleFactor.value=5}else{this.potreeWindMaterial.uniforms.rustleFrequency.value=.2;this.potreeWindMaterial.uniforms.rustleFactor.value=1}}}]);return Trees}(THREE.Object3D);exports.default=Trees},{"./trees/trees_def":52,"./trees/trees_def_landing":53,"./util/debug":58}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={types:[{name:"ThreeTrees",fileName:"3tress_2/cloud.js"},{name:"palm",fileName:"palm/cloud.js"}],instances:[{type:"ThreeTrees",position:[-27.91,14.67,.96],rotation:[360,14,87],scale:.92},{type:"ThreeTrees",position:[-30.61,13.32,9.8],rotation:[339,0,71],scale:1},{type:"ThreeTrees",position:[10.88,20.08,25.31],rotation:[119,192,233],scale:.44},{type:"ThreeTrees",position:[31.63,9.5,-19.79],rotation:[83,38,90],scale:.87},{type:"ThreeTrees",position:[-1.75,17.38,23.51],rotation:[343,18,99],scale:.65},{type:"ThreeTrees",position:[40,16,13],rotation:[14,6,91],scale:.6},{type:"ThreeTrees",position:[-14.38,16.03,-26],rotation:[225,13.8,115],scale:.469},{type:"ThreeTrees",position:[-29.71,17.38,-26.1],rotation:[201,2,103],scale:.65},{type:"ThreeTrees",position:[40,17.38,.06],rotation:[257,46,132],scale:.65},{type:"ThreeTrees",position:[-20,10.61,-20],rotation:[330,0,90],scale:1},{type:"palm",position:[-18,16,10],rotation:[260,0,90],scale:.75},{type:"palm",position:[26.62,16.03,15],rotation:[60,0,90],scale:.69},{type:"palm",position:[-33.32,18.73,-40],rotation:[42,0,83],scale:.65},{type:"ThreeTrees",position:[11.78,17.38,-35.12],rotation:[152,360,99],scale:.424}]}},{}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={types:[{name:"ThreeTrees",fileName:"3tress_2/cloud.js"},{name:"palm",fileName:"palm/cloud.js"}],instances:[{type:"ThreeTrees",position:[40,-8.33,30.73],rotation:[0,5.7,91],scale:2.228},{type:"ThreeTrees",position:[13.59,20.08,-1.75],rotation:[253,123,233],scale:.469},{type:"ThreeTrees",position:[8.17,20.08,-1.75],rotation:[237,132,245],scale:.46},{type:"ThreeTrees",position:[40,16,13],rotation:[14,6,91],scale:.6},{type:"ThreeTrees",position:[27.12,18.73,-4.45],rotation:[253,42,140],scale:.559},{type:"ThreeTrees",position:[27.12,18.73,-4.45],rotation:[253,42,140],scale:.559},{type:"ThreeTrees",position:[40,17.38,.06],rotation:[257,46,132],scale:.65},{type:"ThreeTrees",position:[40,17.38,.06],rotation:[257,46,132],scale:.65},{type:"ThreeTrees",position:[-20,10.61,-20],rotation:[330,0,90],scale:1},{type:"palm",position:[-40,21.44,-10.77],rotation:[95,0,95],scale:.334},{type:"palm",position:[21.71,10.61,40],rotation:[360,0,91],scale:.965},{type:"palm",position:[-33.32,18.73,-40],rotation:[42,0,83],scale:.65},{type:"ThreeTrees",position:[11.78,17.38,-35.12],rotation:[152,360,99],scale:.424}]}},{}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(emitter,object,onError,square){var _this=this;var scope=this;this.square=square;var vrInput;var standingMatrix=new THREE.Matrix4;function gotVRDevices(devices){for(var i=0;i<devices.length;i++){if("VRDisplay"in window&&devices[i]instanceof VRDisplay||"PositionSensorVRDevice"in window&&devices[i]instanceof PositionSensorVRDevice){vrInput=devices[i];break}}if(!vrInput){if(onError)onError("VR input not available.")}}if(navigator.getVRDisplays){navigator.getVRDisplays().then(gotVRDevices)}else if(navigator.getVRDevices){navigator.getVRDevices().then(gotVRDevices)}this.scale=1;this.standing=true;this.userHeight=22.1;this.active=true;this.offset=new THREE.Vector3(0,0,0);this.BASE_VIVE=new THREE.Vector3(.030513843521475792,0,1.2663648128509521);this.SQUARE_POSITION=new THREE.Vector3;events.on("control_threshold",function(passed){if(passed){console.log("VR Control threshold: ",object.position);_this.active=true}else{_this.active=false}});this.calibrate=function(){console.log("CALIBRATE with square")};this.getCurrentPosition=function(){if(vrInput){var pose=vrInput.getPose().position;if(pose){var position=(new THREE.Vector3).fromArray(pose);if(this.standing){standingMatrix.fromArray(vrInput.stageParameters.sittingToStandingTransform);position.applyMatrix4(standingMatrix);return position}}else{return null}}else{return null}};this.update=function(){if(vrInput){if(vrInput.getPose){var pose=vrInput.getPose();if(pose.orientation!==null){object.quaternion.fromArray(pose.orientation)}if(this.active&&pose.position!==null){object.position.fromArray(pose.position).multiplyScalar(this.scale);if(this.standing){if(vrInput.stageParameters){object.updateMatrix();standingMatrix.fromArray(vrInput.stageParameters.sittingToStandingTransform);object.applyMatrix(standingMatrix)}else{object.position.setY(object.position.y+this.userHeight)}}}}else{var state=vrInput.getState();if(state.orientation!==null){object.quaternion.copy(state.orientation)}if(state.position!==null){object.position.copy(state.position)}}}};this.resetPose=function(){if(vrInput){if(vrInput.resetPose!==undefined){console.log("CALIBRATE resetPose");vrInput.resetPose()}else if(vrInput.resetSensor!==undefined){vrInput.resetSensor()}else if(vrInput.zeroSensor!==undefined){vrInput.zeroSensor()}}};this.resetSensor=function(){console.warn("THREE.VRControls: .resetSensor() is now .resetPose().");this.resetPose()};this.zeroSensor=function(){console.warn("THREE.VRControls: .zeroSensor() is now .resetPose().");this.resetPose()};this.dispose=function(){vrInput=null}}},{}],55:[function(require,module,exports){(function(global){"use strict";var _gsScope=typeof module!=="undefined"&&module.exports&&typeof global!=="undefined"?global:undefined||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine.plugin({propName:"endArray",API:2,version:"0.1.3",init:function init(target,value,tween){var i=value.length,a=this.a=[],start,end;this.target=target;this._mod=0;if(!i){return false}while(--i>-1){start=target[i];end=value[i];if(start!==end){a.push({i:i,s:start,c:end-start})}}return true},mod:function mod(lookup){if(typeof lookup.endArray==="function"){this._mod=lookup.endArray}},set:function set(ratio){var target=this.target,a=this.a,i=a.length,mod=this._mod,e,val;if(mod){while(--i>-1){e=a[i];target[e.i]=mod(e.s+e.c*ratio,target)}}else{while(--i>-1){e=a[i];val=e.s+e.c*ratio;target[e.i]=val<1e-6&&val>-1e-6?0:val}}}})});if(_gsScope._gsDefine){_gsScope._gsQueue.pop()()}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],56:[function(require,module,exports){"use strict";THREE.GeometryUtils={merge:function merge(geometry1,geometry2,materialIndexOffset){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2 instanceof THREE.Mesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},randomPointInTriangle:function(){var vector=new THREE.Vector3;return function(vectorA,vectorB,vectorC){var point=new THREE.Vector3;var a=Math.random();var b=Math.random();if(a+b>1){a=1-a;b=1-b}var c=1-a-b;point.copy(vectorA);point.multiplyScalar(a);vector.copy(vectorB);vector.multiplyScalar(b);point.add(vector);vector.copy(vectorC);vector.multiplyScalar(c);point.add(vector);return point}}(),randomPointInFace:function randomPointInFace(face,geometry){var vA,vB,vC;vA=geometry.vertices[face.a];vB=geometry.vertices[face.b];vC=geometry.vertices[face.c];return THREE.GeometryUtils.randomPointInTriangle(vA,vB,vC)},randomPointsInGeometry:function randomPointsInGeometry(geometry,n){var face,i,faces=geometry.faces,vertices=geometry.vertices,il=faces.length,totalArea=0,cumulativeAreas=[],vA,vB,vC;for(i=0;i<il;i++){face=faces[i];vA=vertices[face.a];vB=vertices[face.b];vC=vertices[face.c];face._area=THREE.GeometryUtils.triangleArea(vA,vB,vC);totalArea+=face._area;cumulativeAreas[i]=totalArea}function binarySearchIndices(value){function binarySearch(start,end){if(end<start)return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1)}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end)}else{return mid}}var result=binarySearch(0,cumulativeAreas.length-1);return result}var r,index,result=[];var stats={};for(i=0;i<n;i++){r=Math.random()*totalArea;index=binarySearchIndices(r);result[i]=THREE.GeometryUtils.randomPointInFace(faces[index],geometry);if(!stats[index]){stats[index]=1}else{stats[index]+=1}}return result},randomPointsAndIndexInGeometry:function randomPointsAndIndexInGeometry(geometry,n){var face,i,faces=geometry.faces,vertices=geometry.vertices,il=faces.length,totalArea=0,cumulativeAreas=[],vA,vB,vC,indexArray=[];for(i=0;i<il;i++){face=faces[i];vA=vertices[face.a];vB=vertices[face.b];vC=vertices[face.c];face._area=THREE.GeometryUtils.triangleArea(vA,vB,vC);totalArea+=face._area;cumulativeAreas[i]=totalArea}function binarySearchIndices(value){function binarySearch(start,end){if(end<start)return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1)}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end)}else{return mid}}var result=binarySearch(0,cumulativeAreas.length-1);return result}var r,index,result=[];var stats={};for(i=0;i<n;i++){r=Math.random()*totalArea;index=binarySearchIndices(r);indexArray.push(index);result[i]=THREE.GeometryUtils.randomPointInFace(faces[index],geometry);if(!stats[index]){stats[index]=1}else{stats[index]+=1}}return[result,indexArray]},indexedPointsInGeometry:function indexedPointsInGeometry(geometry,n,indexArray){var face,i,faces=geometry.faces,vertices=geometry.vertices,il=faces.length,totalArea=0,cumulativeAreas=[],vA,vB,vC;for(i=0;i<il;i++){face=faces[i];vA=vertices[face.a];vB=vertices[face.b];vC=vertices[face.c];face._area=THREE.GeometryUtils.triangleArea(vA,vB,vC);totalArea+=face._area;cumulativeAreas[i]=totalArea}function binarySearchIndices(value){function binarySearch(start,end){if(end<start)return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1)}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end)}else{return mid}}var result=binarySearch(0,cumulativeAreas.length-1);return result}var r,index,result=[];var stats={};for(i=0;i<n;i++){index=indexArray[i];result[i]=THREE.GeometryUtils.randomPointInFace(faces[index],geometry);if(!stats[index]){stats[index]=1}else{stats[index]+=1}}return result},randomPointsInBufferGeometry:function randomPointsInBufferGeometry(geometry,n){var i,vertices=geometry.attributes.position.array,totalArea=0,cumulativeAreas=[],vA,vB,vC;vA=new THREE.Vector3;vB=new THREE.Vector3;vC=new THREE.Vector3;var il=vertices.length/9;for(i=0;i<il;i++){vA.set(vertices[i*9+0],vertices[i*9+1],vertices[i*9+2]);vB.set(vertices[i*9+3],vertices[i*9+4],vertices[i*9+5]);vC.set(vertices[i*9+6],vertices[i*9+7],vertices[i*9+8]);
area=THREE.GeometryUtils.triangleArea(vA,vB,vC);totalArea+=area;cumulativeAreas.push(totalArea)}function binarySearchIndices(value){function binarySearch(start,end){if(end<start)return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1)}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end)}else{return mid}}var result=binarySearch(0,cumulativeAreas.length-1);return result}var r,index,result=[];for(i=0;i<n;i++){r=Math.random()*totalArea;index=binarySearchIndices(r);vA.set(vertices[index*9+0],vertices[index*9+1],vertices[index*9+2]);vB.set(vertices[index*9+3],vertices[index*9+4],vertices[index*9+5]);vC.set(vertices[index*9+6],vertices[index*9+7],vertices[index*9+8]);result[i]=THREE.GeometryUtils.randomPointInTriangle(vA,vB,vC)}return result},randomPointsInNoFaceGeometry:function randomPointsInNoFaceGeometry(geometry,n){var i,vertices=geometry.vertices,totalArea=0,cumulativeAreas=[],vA,vB,vC;vA=new THREE.Vector3;vB=new THREE.Vector3;vC=new THREE.Vector3;var il=vertices.length;for(i=0;i<il-3;i++){vA.copy(vertices[i+0]);vB.copy(vertices[i+1]);vC.copy(vertices[i+2]);var area=THREE.GeometryUtils.triangleArea(vA,vB,vC);totalArea+=area;cumulativeAreas.push(totalArea)}function binarySearchIndices(value){function binarySearch(start,end){if(end<start)return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1)}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end)}else{return mid}}var result=binarySearch(0,cumulativeAreas.length-1);return result}var r,index,result=[];for(i=0;i<n;i++){r=Math.random()*totalArea;index=binarySearchIndices(r);vA.copy(vertices[index+0]);vB.copy(vertices[index+1]);vC.copy(vertices[index+2]);result[i]=THREE.GeometryUtils.randomPointInTriangle(vA,vB,vC)}return result},triangleArea:function(){var vector1=new THREE.Vector3;var vector2=new THREE.Vector3;return function(vectorA,vectorB,vectorC){vector1.subVectors(vectorB,vectorA);vector2.subVectors(vectorC,vectorA);vector1.cross(vector2);return.5*vector1.length()}}(),center:function center(geometry){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()},enlargeBox:function enlargeBox(box,space,offset){var scale=new THREE.Vector3;if(typeof space=="number"){scale.set(space,space,space)}else{scale.copy(space)}var newBox=new THREE.Box3;newBox.copy(box);newBox.min.x=box.min.x-scale.x+offset.x;newBox.min.y=box.min.y-scale.y+offset.y;newBox.min.z=box.min.z-scale.z+offset.z;newBox.max.x=box.max.x+scale.x+offset.x;newBox.max.y=box.max.y+scale.y+offset.y;newBox.max.z=box.max.z+scale.z+offset.z;return newBox}}},{}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SOUND_PATH="assets/sound/";var BlurModule=function(){function BlurModule(audioContext){_classCallCheck(this,BlurModule);this.filterLowestCut=380;this.filterHighestCut=2e4;this.volumeWhenBLurred=.7;this.defaultBlurValue=0;this.audioContext=audioContext;this.inputNode=audioContext.createGain();this.outputNode=audioContext.createGain()}_createClass(BlurModule,[{key:"init",value:function init(loadingManager){console.log("blurmodule init");var thisBlurModule=this;var audioContext=this.audioContext;this.biquadFilter=audioContext.createBiquadFilter();this.biquadFilter.Q.value=.01;this.convolver=audioContext.createConvolver();var inputNode=this.inputNode;var outputNode=this.outputNode;this.dryLevel=audioContext.createGain();this.wetLevel=audioContext.createGain();inputNode.connect(this.biquadFilter);this.biquadFilter.connect(this.dryLevel);this.biquadFilter.connect(this.wetLevel);this.dryLevel.connect(outputNode);this.wetLevel.connect(this.convolver);this.convolver.connect(outputNode);this.biquadFilter.type="lowpass";this.biquadFilter.frequency.value=300;function getImpulse(impulseUrl){var ajaxRequest=new XMLHttpRequest;ajaxRequest.open("GET",impulseUrl,true);ajaxRequest.responseType="arraybuffer";ajaxRequest.onload=function(){var impulseData=ajaxRequest.response;audioContext.decodeAudioData(impulseData,function(buffer){var myImpulseBuffer=buffer;thisBlurModule.convolver.buffer=myImpulseBuffer;thisBlurModule.convolver.loop=true;thisBlurModule.convolver.normalize=true},function(e){"Error with decoding audio data"+e.err})};ajaxRequest.send()}getImpulse(SOUND_PATH+"ui/Tunnel_impulse_response.wav");this.controlBlur(this.defaultBlurValue)}},{key:"setRange",value:function setRange(min,max){this.filterLowestCut=min;this.filterHighestCut=max}},{key:"connect",value:function connect(audioInputNode){this.outputNode.connect(audioInputNode)}},{key:"control",value:function control(values){if(values.volume){this.controlVolume(values.volume)}if(values.Blur){this.controlVolume(values.Blur)}if(values.interpolateBlur){this.interpolateBlur(values.Blur)}}},{key:"controlVolume",value:function controlVolume(value){this.inputNode.gain.value=value}},{key:"controlBlur",value:function controlBlur(value,changeRate){var wet=value;var filterCut=(1-value)*this.filterHighestCut+this.filterLowestCut;if(changeRate){var interpolationStart=this.audioContext.currentTime+.01;this.biquadFilter.frequency.setTargetAtTime(filterCut,interpolationStart,changeRate);this.dryLevel.gain.setTargetAtTime(1-wet,interpolationStart,changeRate);this.wetLevel.gain.setTargetAtTime(wet*this.volumeWhenBLurred,interpolationStart,changeRate)}else{this.biquadFilter.frequency.value=filterCut;this.dryLevel.gain.value=1-wet;this.wetLevel.gain.value=wet*this.volumeWhenBLurred}}}]);return BlurModule}();exports.default=BlurModule},{}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={drawCurve:function drawCurve(curve,color){var geo=new THREE.Geometry;for(var i=0;i<=1;i+=.01){geo.vertices.push(curve.getPoint(i))}var mat=new THREE.LineBasicMaterial({color:color});return new THREE.Line(geo,mat)},adjustableCube:function adjustableCube(position,name,size,color){var geometry=new THREE.BoxGeometry(size,size,size);var material=new THREE.MeshBasicMaterial({color:color});var cube=new THREE.Mesh(geometry,material);cube.position.copy(position);events.emit("add_gui",{folder:name,step:.01},cube.position,"x");events.emit("add_gui",{folder:name,step:.01},cube.position,"y");events.emit("add_gui",{folder:name,step:.01},cube.position,"z");return cube},positionObject:function positionObject(object,name){var listen=arguments.length<=2||arguments[2]===undefined?false:arguments[2];var min=arguments.length<=3||arguments[3]===undefined?-50:arguments[3];var max=arguments.length<=4||arguments[4]===undefined?50:arguments[4];var angles=arguments[5];console.log("Debug - position object ",name);events.emit("add_gui",{folder:name+" - Position",listen:listen,step:.01},object.position,"x",min,max);events.emit("add_gui",{folder:name+" - Position",listen:listen,step:.01},object.position,"y",min,max*2);events.emit("add_gui",{folder:name+" - Position",listen:listen,step:.01},object.position,"z",min,max);if(angles){object.angleRotation={x:angles[0],y:angles[1],z:angles[2]}}else{object.angleRotation={x:0,y:0,z:0}}events.emit("add_gui",{folder:name+" - Rotation",onChange:function onChange(){object.rotation.x=object.angleRotation.x*Math.PI/180}},object.angleRotation,"x",0,360);events.emit("add_gui",{folder:name+" - Rotation",onChange:function onChange(){object.rotation.y=object.angleRotation.y*Math.PI/180}},object.angleRotation,"y",0,360);events.emit("add_gui",{folder:name+" - Rotation",onChange:function onChange(){object.rotation.z=object.angleRotation.z*Math.PI/180}},object.angleRotation,"z",0,360);object.global=object.scale.x;events.emit("add_gui",{folder:name+" - Scale",listen:listen,step:1e-5,onChange:function onChange(){object.scale.set(object.global,object.global,object.global)}},object,"global",0,4);events.emit("add_gui",{folder:name},object,"visible")},fastForward:function fastForward(video){video.currentTime=video.duration-10},colorPicker:function colorPicker(name,object,prop){var lightPicker={color:[object[prop].r*255,object[prop].g*255,object[prop].b*255]};events.emit("add_gui",{folder:name,color:true,listen:true,onChange:function onChange(){object[prop].setRGB(lightPicker.color[0]/255,lightPicker.color[1]/255,lightPicker.color[2]/255)}},lightPicker,"color")},positionEntry:function positionEntry(entry,square,scene){var cube=this.adjustableCube((new THREE.Vector3).fromArray(entry.startPosition),"Ramp start",1,16711680);square.add(cube);var cube2=this.adjustableCube((new THREE.Vector3).fromArray(entry.endPosition),"Ramp end",1,65535);square.add(cube2);if(entry.worldPosition){var cube3=this.adjustableCube((new THREE.Vector3).fromArray(entry.worldPosition),"World Point",1,65280);scene.add(cube3)}},donePositioning:function donePositioning(name){events.emit("remove_gui_folder",name+" - Position");events.emit("remove_gui_folder",name+" - Rotation");events.emit("remove_gui_folder",name+" - Scale")},adjustBBox:function adjustBBox(bboxMesh,prefix,space,offset){var scale={space:space};var newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position);events.emit("add_gui",{folder:prefix+" Offset",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},offset,"x",-5,5);events.emit("add_gui",{folder:prefix+" Offset",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},offset,"y",-5,5);events.emit("add_gui",{folder:prefix+" Offset",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},offset,"z",-5,5);if(typeof space=="number"){events.emit("add_gui",{folder:prefix+" Space",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},scale,"space",-3,3)}else{events.emit("add_gui",{folder:prefix+" Space",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},scale.space,"x",-5,5);events.emit("add_gui",{folder:prefix+" Space",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},scale.space,"y",-5,5);events.emit("add_gui",{folder:prefix+" Space",listen:true,step:.01,onChange:function onChange(){newBox=THREE.GeometryUtils.enlargeBox(bboxMesh.box,scale.space,offset);newBox.getSize(bboxMesh.scale);newBox.getCenter(bboxMesh.position)}},scale.space,"z",-5,5)}}}},{}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FBO=function(){function FBO(){_classCallCheck(this,FBO);console.log("FBO Constructed")}_createClass(FBO,[{key:"init",value:function init(width,height,renderer,simulationMaterial,renderMaterial,particleGeometry){var gl=renderer.getContext();if(!gl.getExtension("OES_texture_float")){throw new Error("float textures not supported")}if(gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)==0){throw new Error("vertex shader cannot read textures")}this.scene=new THREE.Scene;this.simulationMaterial=simulationMaterial;this.orthoCamera=new THREE.OrthographicCamera(-1,1,1,-1,1/Math.pow(2,53),1);var options={minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,type:THREE.FloatType};this.rttOut=new THREE.WebGLRenderTarget(width,height,options);this.rttIn=this.rttOut.clone();var geom=new THREE.BufferGeometry;geom.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),3));geom.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0]),2));this.scene.add(new THREE.Mesh(geom,simulationMaterial));var particleVertices=particleGeometry.vertices;var l=width*height;var points=l*particleVertices.length;var vertices=new Float32Array(points*3);var v=0;for(var i=0;i<l;i++){for(var j=0;j<particleVertices.length;j++){vertices[v++]=particleVertices[j].x;vertices[v++]=particleVertices[j].y;vertices[v++]=particleVertices[j].z}}var references=new Float32Array(points*2);var bigX=0;var bigY=0;for(var vert=0;vert<points;vert++){var i=~~(vert/3);var x=i%width/width;var y=~~(i/width)/height;references[vert*2]=x;references[vert*2+1]=y;if(x>bigX){bigX=x}if(y>bigY){bigY=y}}console.log("BIG X ",bigX," BIG Y ",bigY);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("reference",new THREE.BufferAttribute(references,2));if(particleVertices.length>1){this.particles=new THREE.Mesh(geometry,renderMaterial);this.particles.matrixAutoUpdate=false;this.particles.rotation.z=Math.PI/2;this.particles.rotation.x=Math.PI/2;this.particles.updateMatrix()}else{this.particles=new THREE.Points(geometry,renderMaterial)}this.renderer=renderer;this.renderer.render(this.scene,this.orthoCamera,this.rttOut,false);this.update()}},{key:"update",value:function update(){var tmp=this.rttIn;this.rttIn=this.rttOut;this.rttOut=tmp;this.simulationMaterial.uniforms.positions.value=this.rttIn.texture;this.renderer.render(this.scene,this.orthoCamera,this.rttOut,true);this.particles.material.uniforms.positions.value=this.rttOut.texture}}]);return FBO}();exports.default=FBO},{}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _index=require("../lib/text2d/index");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var FPSCount=function(){function FPSCount(camera){_classCallCheck(this,FPSCount);this.camera=camera;this.beginTime=performance.now();this.prevTime=this.beginTime;this.frames=0}_createClass(FPSCount,[{key:"init",value:function init(loadingManager){var FPS_TEXT={align:_index.textAlign.center,font:"20px Miriam Libre",fillStyle:"#FFFFFF",antialias:true};var FPS_TEXT_SCALE=5e-4;this.fpsText=new _index.SpriteText2D("FPS",FPS_TEXT);this.fpsText.scale.multiplyScalar(FPS_TEXT_SCALE);this.fpsText.position.set(-.02,.2,-.5);this.camera.add(this.fpsText)}},{key:"begin",value:function begin(){this.beginTime=performance.now()}},{key:"end",value:function end(){this.frames++;var time=performance.now();if(time>this.prevTime+1e3){var fps=Math.round(this.frames*1e3/(time-this.prevTime));this.fpsText.text=fps+"FPS";this.prevTime=time;this.frames=0}}}]);return FPSCount}();exports.default=FPSCount},{"../lib/text2d/index":40}],61:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=ImprovedNoise;function ImprovedNoise(){var p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(var i=0;i<256;i++){p[256+i]=p[i]}function fade(t){return t*t*t*(t*(t*6-15)+10)}function lerp(t,a,b){return a+t*(b-a)}function grad(hash,x,y,z){var h=hash&15;var u=h<8?x:y,v=h<4?y:h==12||h==14?x:z;return((h&1)==0?u:-u)+((h&2)==0?v:-v)}return{noise:function noise(x,y,z){var floorX=~~x,floorY=~~y,floorZ=~~z;var X=floorX&255,Y=floorY&255,Z=floorZ&255;x-=floorX;y-=floorY;z-=floorZ;var xMinus1=x-1,yMinus1=y-1,zMinus1=z-1;var u=fade(x),v=fade(y),w=fade(z);var A=p[X]+Y,AA=p[A]+Z,AB=p[A+1]+Z,B=p[X+1]+Y,BA=p[B]+Z,BB=p[B+1]+Z;return lerp(w,lerp(v,lerp(u,grad(p[AA],x,y,z),grad(p[BA],xMinus1,y,z)),lerp(u,grad(p[AB],x,yMinus1,z),grad(p[BB],xMinus1,yMinus1,z))),lerp(v,lerp(u,grad(p[AA+1],x,y,zMinus1),grad(p[BA+1],xMinus1,y,z-1)),lerp(u,grad(p[AB+1],x,yMinus1,zMinus1),grad(p[BB+1],xMinus1,yMinus1,zMinus1))))}}}},{}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={closestValue:function closestValue(arr,goal){var closest=arr.reduce(function(prev,curr){return Math.abs(curr-goal)<Math.abs(prev-goal)?curr:prev});return closest}}},{}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={overwriteProps:function overwriteProps(original,update){var keys=Object.keys(update);keys.forEach(function(key){original[key]=update[key]})}}},{}],64:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _index=require("../lib/text2d/index");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MultilineText=function(_THREE$Object3D){_inherits(MultilineText,_THREE$Object3D);function MultilineText(numLines,textDefinition,lineOffset){_classCallCheck(this,MultilineText);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(MultilineText).call(this));console.log("Multiline text constructed!");_this.numLines=numLines;_this.textDefinition=textDefinition;_this.lineOffset=lineOffset;return _this}_createClass(MultilineText,[{key:"init",value:function init(loadingManager){var offset=0;for(var i=0;i<this.numLines;i++){var line=new _index.MeshText2D("",this.textDefinition);line.position.set(0,offset,0);this.add(line);offset-=this.lineOffset}console.log("Multinline text initialized with "+this.numLines+" lines")}},{key:"show",value:function show(time){var _this2=this;if(this.children.length>0){return new Promise(function(resolve,reject){TweenMax.to(_this2.children[0].material,time,{opacity:1,onComplete:function onComplete(){resolve()}});for(var i=1;i<_this2.children.length;i++){TweenMax.to(_this2.children[i].material,time,{opacity:1})}})}}},{key:"hide",value:function hide(time){var _this3=this;if(this.children.length>0){return new Promise(function(resolve,reject){TweenMax.to(_this3.children[0].material,time,{opacity:0,onComplete:function onComplete(){resolve()}});for(var i=1;i<_this3.children.length;i++){TweenMax.to(_this3.children[i].material,time,{opacity:0})}})}}},{key:"setText",value:function setText(lines){for(var i=0;i<this.children.length;i++){if(i<lines.length){this.children[i].text=lines[i]}else{this.children[i].text=""}}}}]);return MultilineText}(THREE.Object3D);exports.default=MultilineText},{"../lib/text2d/index":40}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=TextureAnimator;function TextureAnimator(texture,tilesHoriz,tilesVert,numTiles,tileDispDuration,order){this.tilesHorizontal=tilesHoriz;this.tilesVertical=tilesVert;this.numberOfTiles=numTiles;texture.wrapS=texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical);this.tileDisplayDuration=tileDispDuration;this.currentDisplayTime=0;this.currentTile=0;this.displayOrder=order;this.updateWithOrder=function(milliSec){this.currentDisplayTime+=milliSec;while(this.currentDisplayTime>this.tileDisplayDuration){var currentColumn=this.displayOrder[this.currentTile]%this.tilesHorizontal;texture.offset.x=currentColumn/this.tilesHorizontal;var currentRow=Math.floor(this.displayOrder[this.currentTile]/this.tilesHorizontal);texture.offset.y=currentRow/this.tilesVertical;this.currentDisplayTime-=this.tileDisplayDuration;this.currentTile++;if(this.currentTile==this.numberOfTiles)this.currentTile=0}};this.update=function(milliSec){this.currentDisplayTime+=milliSec;while(this.currentDisplayTime>this.tileDisplayDuration){this.currentDisplayTime-=this.tileDisplayDuration;this.currentTile++;if(this.currentTile==this.numberOfTiles)this.currentTile=0;var currentColumn=this.currentTile%this.tilesHorizontal;texture.offset.x=currentColumn/this.tilesHorizontal;var currentRow=Math.floor(this.currentTile/this.tilesHorizontal);texture.offset.y=currentRow/this.tilesVertical;console.log("currentTile: "+this.currentTile+", offset.x: "+texture.offset.x)}}}},{}],66:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SEC_PER_360_FRAME=1/25;var Video360=function(){function Video360(path,targetTexture){_classCallCheck(this,Video360);this.path=path;console.log("Video360 constructed: "+this.path);this.targetTexture=targetTexture}_createClass(Video360,[{key:"init",value:function init(){this.video=document.createElement("video");this.video.loop=true;this.video.src=this.path;this.video.load();this.video.isPlaying=false;this.timer=0;this.texture=new THREE.Texture(this.video);this.texture.minFilter=THREE.LinearFilter;this.texture.magFilter=THREE.LinearFilter}},{key:"isReady",value:function isReady(){return this.video.readyState===this.video.HAVE_ENOUGH_DATA}},{key:"update",value:function update(dt){this.timer+=dt;if(this.timer>=SEC_PER_360_FRAME){this.timer=0;if(this.isPlaying&&this.video.readyState===this.video.HAVE_ENOUGH_DATA){if(this.targetTexture){this.targetTexture.value=this.texture}this.texture.needsUpdate=true}}}},{key:"play",value:function play(){if(this.isPlaying===true)return;console.log("Video360 - play",this.path);this.video.play();this.isPlaying=true}},{key:"pause",value:function pause(){if(this.isPlaying===false)return;console.log("Video360 - pause");this.video.pause();this.isPlaying=false}},{key:"setRate",value:function setRate(rate){this.video.playbackRate=rate;console.log("Video360 playback rate = ",rate,this.video)}},{key:"unload",value:function unload(){console.log("Video unload",this.path);this.pause();this.video.src="";if(this.texture){this.texture.dispose()}}}]);return Video360}();exports.default=Video360},{}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var VERTS_WIDE=256;var VERTS_TALL=256;var precision=3;var VideoRGBD=function(){function VideoRGBD(properties){_classCallCheck(this,VideoRGBD);this.properties=properties;this.timer=0;this.SEC_PER_RGBD_FRAME=1/this.properties.fps;this.video=document.createElement("video");this.video.crossOrigin="anonymous";this.video.setAttribute("crossorigin","anonymous");this.isPlaying=false}_createClass(VideoRGBD,[{key:"init",value:function init(){var withWire=arguments.length<=0||arguments[0]===undefined?true:arguments[0];console.log("Video rgbd loading ",this.properties.fileName);this.videoTexture=new THREE.Texture(this.video);this.videoTexture.minFilter=THREE.LinearFilter;this.videoTexture.magFilter=THREE.LinearFilter;this.videoTexture.format=THREE.RGBFormat;this.videoTexture.generateMipmaps=false;this.mesh=VideoRGBD.meshPool.pop();if(withWire){this.wire=VideoRGBD.wirePool.pop()}if(this.mesh){this.mesh.material.uniforms.mindepth.value=this.properties.mindepth;this.mesh.material.uniforms.maxdepth.value=this.properties.maxdepth;this.mesh.material.uniforms.uvdy.value=this.properties.uvdy;this.mesh.material.uniforms.uvdx.value=this.properties.uvdx;this.mesh.material.uniforms.width.value=this.properties.width;this.mesh.material.uniforms.height.value=this.properties.height;this.mesh.scale.set(this.properties.scale,this.properties.scale,this.properties.scale);if(withWire){this.wire.material.uniforms.mindepth.value=this.properties.mindepth;this.wire.material.uniforms.maxdepth.value=this.properties.maxdepth;this.wire.material.uniforms.uvdy.value=this.properties.uvdy;this.wire.material.uniforms.uvdx.value=this.properties.uvdx;this.wire.material.uniforms.width.value=this.properties.width;this.wire.material.uniforms.height.value=this.properties.height;this.wire.scale.set(this.properties.scale,this.properties.scale,this.properties.scale);this.wire.position.z+=.01}this.setOpacity(1)}else{console.error("Video RGBD Failed to load mesh from pool",this.properties.fileName)}}},{key:"load",value:function load(){this.video.src=this.properties.fileName;if(typeof this.properties.volume!="undefined"){console.log("Video volume ",this.properties.volume);this.video.volume=this.properties.volume}this.video.load()}},{key:"unload",value:function unload(){console.log("Video unload",this.properties.fileName);this.pause();this.video.src="";if(this.videoTexture){this.videoTexture.dispose()}if(this.mesh){VideoRGBD.meshPool.push(this.mesh)}if(this.wire){VideoRGBD.wirePool.push(this.wire)}this.mesh=null;this.wire=null}},{key:"setPosition",value:function setPosition(newPosition){if(this.mesh){this.mesh.position.copy(newPosition)}if(this.wire){this.wire.position.copy(newPosition);this.wire.position.z+=.01}}},{key:"buildWireGeometry",value:function buildWireGeometry(){var wireGeometry=new THREE.Geometry;for(var y=0;y<VERTS_TALL;y++){for(var x=0,x2=precision;x<VERTS_WIDE;x+=precision,x2+=precision){wireGeometry.vertices.push(new THREE.Vector3(x,y,0));wireGeometry.vertices.push(new THREE.Vector3(x2,y,0))}}return wireGeometry}},{key:"play",value:function play(){if(this.isPlaying===true)return;console.log("RGBD Play ",this.properties.fileName);this.video.play();this.isPlaying=true}},{key:"update",value:function update(dt){this.timer+=dt;if(this.timer>=this.SEC_PER_RGBD_FRAME){this.timer=0;if(this.isPlaying&&this.video.readyState===this.video.HAVE_ENOUGH_DATA){this.mesh.material.uniforms.map.value=this.videoTexture;if(this.wire){this.wire.material.uniforms.map.value=this.videoTexture}this.videoTexture.needsUpdate=true}}}},{key:"pause",value:function pause(){if(this.isPlaying===false)return;this.video.pause();this.isPlaying=false}},{key:"isPlaying",value:function isPlaying(){return this.isPlaying}},{key:"setOpacity",value:function setOpacity(opacity){if(this.mesh){this.mesh.material.uniforms.opacity.value=opacity}if(this.wire){this.wire.material.uniforms.opacity.value=Math.min(opacity,.1)}}},{key:"setDepth",value:function setDepth(min,max){console.log("Video "+this.properties.fileName+"Changing depth ",min,max);this.mesh.material.uniforms.mindepth.value=min;this.mesh.material.uniforms.maxdepth.value=max;if(this.wire){this.wire.material.uniforms.mindepth.value=min;this.wire.material.uniforms.maxdepth.value=max}}},{key:"setScale",value:function setScale(scale){this.mesh.scale.set(scale,scale,scale);if(this.wire){this.wire.scale.set(scale,scale,scale)}}},{key:"multiplyScale",value:function multiplyScale(scalar){this.mesh.scale.multiplyScalar(scalar);
if(this.wire){this.wire.scale.multiplyScalar(scalar)}}},{key:"setVisible",value:function setVisible(visible){if(this.mesh){this.mesh.visible=visible}if(this.wire){this.wire.visible=visible}}}],[{key:"initPool",value:function initPool(){var rgbd_fs="#define GLSLIFY 1\nuniform sampler2D map;\nuniform float opacity;\n\nuniform float uvdy;\nuniform float uvdx;\n\nvarying float visibility;\nvarying vec2 vUv;\n\nvoid main() {\n\n    if ( visibility < 0.75 ) discard;\n\n    vec4 color = texture2D( map, vUv + vec2(uvdx, uvdy));\n    color.w = opacity;\n\n    gl_FragColor = color;\n}\n";var rgbd_vs="#define GLSLIFY 1\nuniform float mindepth;\nuniform float maxdepth;\n\nuniform float width;\nuniform float height;\n\n//TODO: make uniforms\nconst float fx = 1.11087;\nconst float fy = 0.832305;\n\nuniform sampler2D map;\n\n//Making z global\nfloat z;\n\nvarying float visibility;\nvarying vec2 vUv;\n\nvec3 rgb2hsl( vec3 color ) {\n    float h = 0.0;\n    float s = 0.0;\n    float l = 0.0;\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n    float cMin = min( r, min( g, b ) );\n    float cMax = max( r, max( g, b ) );\n    l =  ( cMax + cMin ) / 2.0;\n    if ( cMax > cMin ) {\n        float cDelta = cMax - cMin;\n        // saturation\n        if ( l < 0.5 ) {\n            s = cDelta / ( cMax + cMin );\n        } else {\n            s = cDelta / ( 2.0 - ( cMax + cMin ) );\n        }\n\n        // hue\n        if ( r == cMax ) {\n            h = ( g - b ) / cDelta;\n        } else if ( g == cMax ) {\n            h = 2.0 + ( b - r ) / cDelta;\n        } else {\n            h = 4.0 + ( r - g ) / cDelta;\n        }\n\n        if ( h < 0.0) {\n            h += 6.0;\n        }\n        h = h / 6.0;\n\n    }\n    return vec3( h, s, l );\n}\n\nvec3 xyz( float x, float y, float depth ) {\n\n    //Adding an if statment to determine where the face is and where the body\n    //to get rid of this just --  z = depth * (maxdepth - mindepth) + mindepth;\n\n    /*\n    if (position.y <= 250.0) {\n        z = depth * ( maxdepth - mindepth ) + mindepth - 0.2;\n    } \n    else if (position.y >= 250.0) {\n        z = depth * ( maxdepth - mindepth ) + mindepth;\n    }*/\n    z = depth * ( maxdepth - mindepth ) + mindepth;\n    return vec3( ( x / height  ) * z * fx, ( y / (width * 2.0)  ) * z * fy, - z );\n}\n\nvoid main() {\n\n    vUv = vec2( ( position.x + 512.0 ) / 1024.0 , ( position.y + 512.0  ) / 1024.0 );\n\n    vUv.y = vUv.y * 0.5;// + 0.5;\n\n    vec3 hsl = rgb2hsl( texture2D( map, vUv ).xyz );\n    vec4 pos = vec4( xyz( position.x, position.y, hsl.x ), 1.0 );\n    pos.z += 2600.0;\n\n    visibility = hsl.z * 2.1;\n\n    gl_Position = projectionMatrix * modelViewMatrix * pos;\n}\n";var wire_rgbd_fs="#define GLSLIFY 1\nuniform sampler2D map;\nuniform float opacity;\n\nuniform float brightness;\n\nuniform float contrast;\n\nuniform float uvdy;\nuniform float uvdx;\n\nvarying float visibility;\nvarying vec2 vUv;\n\nvoid main() {\n\n    if ( visibility < 0.75 ) discard;\n\n    vec3 bright = vec3(brightness,brightness,brightness);\n\n    vec4 color = texture2D( map, vUv + vec2(uvdx, uvdy));\n    color.rgb = color.rgb - brightness;\n\n    // /*\n\n    // if( faceY < 230.0 ){\n\n	   // 	color.rgb += brightness;\n\n	   //  color.w = opacity + 0.1; \n\n    // } else if ( faceY > 230.0 && faceY < 240.0 ){\n\n	   //  color.rgb += brightness -0.1;\n\n	   //  color.w = opacity + 0.05; \n\n    // }\n    // */\n\n    color.w = opacity;  \n\n    gl_FragColor = color;\n}\n";var wire_rgbd_vs="#define GLSLIFY 1\nuniform float mindepth;\nuniform float maxdepth;\n\nuniform float width;\nuniform float height;\n\n//TODO: make uniforms\nconst float fx = 1.11087;\nconst float fy = 0.832305;\n\nuniform sampler2D map;\n\nvarying float visibility;\nvarying vec2 vUv;\n\nvec3 rgb2hsl( vec3 color ) {\n    float h = 0.0;\n    float s = 0.0;\n    float l = 0.0;\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n    float cMin = min( r, min( g, b ) );\n    float cMax = max( r, max( g, b ) );\n    l =  ( cMax + cMin ) / 2.0;\n    if ( cMax > cMin ) {\n        float cDelta = cMax - cMin;\n        // saturation\n        if ( l < 0.5 ) {\n            s = cDelta / ( cMax + cMin );\n        } else {\n            s = cDelta / ( 2.0 - ( cMax + cMin ) );\n        }\n\n        // hue\n        if ( r == cMax ) {\n            h = ( g - b ) / cDelta;\n        } else if ( g == cMax ) {\n            h = 2.0 + ( b - r ) / cDelta;\n        } else {\n            h = 4.0 + ( r - g ) / cDelta;\n        }\n\n        if ( h < 0.0) {\n            h += 6.0;\n        }\n        h = h / 6.0;\n\n    }\n    return vec3( h, s, l );\n}\n\nvec3 xyz( float x, float y, float depth ) {\n\n    float z = depth * ( maxdepth - mindepth ) + mindepth;\n\n    return vec3( ( x / height  ) * z * fx, ( y / (width * 2.0)  ) * z * fy, - z );\n\n    // float z = depth * ( maxdepth - mindepth ) + mindepth;\n    // return vec3( ( x / height  ) * z * fx, ( y / (width * 2.0)  ) * z * fy, - z );\n}\n\nvoid main() {\n\n    vUv = vec2( ( position.x + 512.0 ) / 1024.0 , ( position.y + 512.0  ) / 1024.0 );\n\n    vUv.y = vUv.y * 0.5;// + 0.5;\n\n    vec3 hsl = rgb2hsl( texture2D( map, vUv ).xyz );\n\n    vec4 pos = vec4( xyz( position.x, position.y, hsl.x ), 1.0 );\n\n\n    pos.z += 2600.0;\n\n    visibility = hsl.z * 2.1;\n\n    // faceY = position.y;\n\n    gl_Position = projectionMatrix * modelViewMatrix * pos;\n}\n";console.log("VideoRGBD init pool");this.meshPool=[];this.wirePool=[];var baseGeometry=this.buildMeshGeometry();for(var i=0;i<10;i++){var meshMaterial=new THREE.ShaderMaterial({uniforms:{map:{type:"t"},mindepth:{type:"f",value:0},maxdepth:{type:"f",value:0},uvdy:{type:"f",value:.5},uvdx:{type:"f",value:0},width:{type:"f",value:0},height:{type:"f",value:0},opacity:{type:"f",value:1}},vertexShader:rgbd_vs,fragmentShader:rgbd_fs,transparent:true,wireframe:false});this.meshPool.push(new THREE.Mesh(baseGeometry,meshMaterial))}for(var _i=0;_i<10;_i++){var linesMaterial=new THREE.ShaderMaterial({uniforms:{map:{type:"t"},mindepth:{type:"f",value:0},maxdepth:{type:"f",value:0},uvdy:{type:"f",value:.5},uvdx:{type:"f",value:0},opacity:{type:"f",value:.1},width:{type:"f",value:0},height:{type:"f",value:0},brightness:{type:"f",value:.3},wire_strech:{type:"f",value:1},contrast:{type:"f",value:.001}},vertexShader:wire_rgbd_vs,fragmentShader:wire_rgbd_fs,blending:THREE.AdditiveBlending,wireframe:true,transparent:true});this.wirePool.push(new THREE.Mesh(baseGeometry,linesMaterial))}}},{key:"buildMeshGeometry",value:function buildMeshGeometry(){var meshGeometry=new THREE.Geometry;for(var y=0;y<VERTS_TALL;y++){for(var x=0;x<VERTS_WIDE;x++){meshGeometry.vertices.push(new THREE.Vector3(-640+x*5,480-y*5,0))}}for(var _y=0;_y<VERTS_TALL-1;_y++){for(var _x2=0;_x2<VERTS_WIDE-1;_x2++){meshGeometry.faces.push(new THREE.Face3(_x2+_y*VERTS_WIDE,_x2+(_y+1)*VERTS_WIDE,_x2+1+_y*VERTS_WIDE));meshGeometry.faces.push(new THREE.Face3(_x2+1+_y*VERTS_WIDE,_x2+(_y+1)*VERTS_WIDE,_x2+1+(_y+1)*VERTS_WIDE))}}return meshGeometry}}]);return VideoRGBD}();exports.default=VideoRGBD},{"./debug":58}],68:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var WaterDrops=function(_THREE$Object3D){_inherits(WaterDrops,_THREE$Object3D);function WaterDrops(config){_classCallCheck(this,WaterDrops);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(WaterDrops).call(this));_this.active=false;_this.fading=false;_this.inControl=false;_this.config=config;_this.drops=[];_this.timeSinceCollision=0;_this.timeSinceChange=0;return _this}_createClass(WaterDrops,[{key:"init",value:function init(loadingManager){var _this2=this;var map=new THREE.TextureLoader(loadingManager).load("assets/drops/water_drop.png");this.material=new THREE.SpriteMaterial({map:map});this.position.z=-.5;this.FOUNTAIN_DISTANCE=this.config.platform=="vive"?15:15.3;events.on("control_threshold",function(passed){_this2.inControl=passed});events.on("fountain_collision",function(distance){if(distance<_this2.FOUNTAIN_DISTANCE){_this2.timeSinceCollision=0;if(_this2.inControl&&!_this2.active){_this2.timeSinceChange=0;_this2.active=true}}})}},{key:"update",value:function update(dt){var _this3=this;this.timeSinceCollision+=dt;this.timeSinceChange+=dt;if(this.active&&this.timeSinceCollision>2){this.active=false;this.fading=true;TweenMax.to(this.material,3,{opacity:0,onComplete:function onComplete(){_this3.drops.forEach(function(drop){_this3.remove(drop)});_this3.drops.splice(0);_this3.material.opacity=1;_this3.fading=false}})}if(this.active&&!this.fading&&this.timeSinceChange>.2&&this.drops.length<100){if(Math.random()<this.timeSinceChange){this.timeSinceChange=0;var sprite=new THREE.Sprite(this.material);sprite.position.x=Math.random()*.8-.4;sprite.position.y=Math.random()*.4-.2;var scale=Math.random()*.03;sprite.scale.set(scale,scale,scale);this.add(sprite);this.drops.push(sprite)}}}}]);return WaterDrops}(THREE.Object3D);exports.default=WaterDrops},{"./util/debug":58}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{hour:7,extraAssets:[{name:"junkie",position:[-9.67,23.9,2.89],rotation:[182,229,0],scale:.365},{name:"pocketCam",position:[-4.8,21.34,11.95],rotation:[0,81,0],scale:.29},{name:"cart",position:[-9.67,23.5,-12.37],rotation:[181,246,0],scale:.411},{name:"dadOnBike",position:[14.56,21.2,6.48],rotation:[0,347,0],scale:.45}]},{hour:9,extraAssets:[{name:"oldmansit",position:[9.5,23.2,-18.65],rotation:[178,266,0],scale:.371},{name:"sweetLady",position:[7.6,21.5,-6.98],rotation:[0,189,0],scale:.31},{name:"grandpa",position:[14.56,21.2,2.89],rotation:[360,93,0],scale:.54},{name:"grandma",position:[13.66,21.2,.2],rotation:[0,360,0],scale:.233},{name:"firstcouple",position:[-16.86,21.2,-7.88],rotation:[0,254,0],scale:.35},{name:"AnlenGrandma",position:[-1.35,21.2,17],rotation:[0,77,0],scale:.19}]},{hour:12,extraAssets:[{name:"100_",position:[16.36,21.2,.2],rotation:[0,258,0],scale:.233},{name:"dude",position:[-9.67,21.3,2.86],rotation:[0,102,0],scale:.323},{name:"twoNiceJewishMen",position:[10.97,23.65,14.56],rotation:[184,47,342],scale:.43},{name:"kadafi",position:[-9.67,24.25,-14.16],rotation:[177,193,0],scale:.372},{name:"BlackGuy",position:[14.56,21.37,-2.49],rotation:[0,225,0],scale:.43}]},{hour:17,extraAssets:[{name:"bridegroom",position:[-1.6,21.15,-10.5],rotation:[0,84,0],scale:.348},{name:"yukalele",position:[-14.16,21.2,-11.47],rotation:[0,306,0],scale:.322},{name:"bikeHottie",position:[14.56,21.2,14.56],rotation:[0,52,0],scale:.44},{name:"mom",position:[6.17,21.2,7.81],rotation:[0,80,0],scale:.542},{name:"coolPair",position:[-14.16,21.4,3.79],rotation:[0,0,0],scale:.404}]},{hour:19,extraAssets:[{name:"manOnBench",position:[11.87,21.3,-6],rotation:[0,186,0],scale:.3},{name:"blueLady",position:[-16.95,21.41,4.21],rotation:[0,161,0],scale:.304},{name:"Gyno",position:[-9.67,24.07,-13.27],rotation:[186,138,18],scale:.374},{name:"cat",position:[7.38,22.15,4.69],rotation:[7,270,355],scale:.439},{name:"DAN",position:[13.1,23.8,9.51],rotation:[174,25,0],scale:.33}]},{name:"ep.6: night",hour:0,extraAssets:[{fileName:"lightstreets",position:[0,0,0]}]}]},{}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"Hannah",position:[11.4,22.04,-10.1],rotation:[355,302,3],space:1.3,spaceOffset:[-.17,0,-.39],endingPosition:[10.49,22.4,-10.14],endingRotation:[360,210,3]},{name:"Miriam",position:[-17.1,22.1,3.38],rotation:[0,78,0],scale:.003*.661*1.071*.9,space:1.2,spaceOffset:[.59,0,.47],endingPosition:[11.77,22.04,-18.52],adjustments:[{sec:0,mindepth:2200,maxdepth:3119.456298828,position:[-17.6,22.1,3.38],scale:.003*.5748*1.106}]},{name:"Itzik",position:[-6.58,22.06,11.01],rotation:[9,208,3.6],space:1.5,spaceOffset:[.62,.59,-.17],endingPosition:[7.29,21.8,-12.91],gazeOffset:[.14,.25,.47],adjustments:[{sec:0,mindepth:0,maxdepth:3494.158935547,position:[-6.61,22.09,10.93],rotation:[9,208,3.6],scale:.0027*.4686}]},{name:"Haim",position:[21.74,21.8,12.77],rotation:[0,225,0],space:.8,spaceOffset:[-.11,0,.43],gazeOffset:[-4.46,.9,.02],endingPosition:[-12.33,19.7,-6.69]},{name:"Rami",position:[-9.19,22.2,14.6],rotation:[0,151,0],space:1.2,spaceOffset:[-.06,.2,.25],gazeSpace:[-.55,0,0],gazeOffset:[.14,-.05,-.31]},{name:"Meir",position:[-.43,22.39,7.43],rotation:[7,0,0],space:.8,endingPosition:[-3.93,22.04,-8.42],spaceOffset:[-.17,0,.62]},{name:"Sasha",position:[-37.78,19.74,13.54],rotation:[8,131,343]},{name:"Agam12PM",position:[-2.11,22.08,7.338],rotation:[0,325,5.8]},{name:"LupoDogs12PM",position:[-19.85,22,5.34],rotation:[0,86,0]},{name:"LupoDogs5PM",position:[21,21.8,0],rotation:[3,213,0],endingPosition:[-22.99,22.04,-3.93]},{name:"Mark",mindepth:1499.999877929688,maxdepth:4564.32861328125,space:1.4,spaceOffset:[-.56,0,-1.4],endingPosition:[-17.4,22.04,-.57],position:[8.28,21.8,-16.86],rotation:[0,286,350],adjustments:[{sec:0,mindepth:1499.999877929688,maxdepth:4564.32861328125,position:[6,21.9,-15.96],scale:.003*.458437*1.34174*.865*1.246*.85},{sec:92,mindepth:2689.701416015625,maxdepth:4381.86181640625},{sec:117,mindepth:1499.999877929688,maxdepth:4564.32861328125}]},{name:"FatmanSleep",position:[-3.5,22.25,-6.98],rotation:[0,197,0]},{name:"Lupo9AM",position:[-27,21.16,-37.04],rotation:[350,300,7.3]},{name:"Lupo12PM",position:[-17.83,22.1,2.69],rotation:[0,132,0],space:1.2,spaceOffset:[.5,0,.28],animationPosition:[.18,-.47,-1.01],animationRotation:[0,-39,0]},{name:"Lupo5PM",position:[18.25,22,-3.1],endingPosition:[22.99,22.04,-3.93],rotation:[7,225,0],adjustments:[{sec:100,mindepth:1770.462036132813,maxdepth:3428.071533203125,position:[18.2,22.05,-3.3],scale:.003*.75*1.028*1.09*.85},{sec:120,mindepth:1523.277099609375,maxdepth:3428.071533203125,position:[18.9,21.9,-2.1],scale:.003*.75*1.028*1.132*.75}],scale:.003*.75*1.028*.9,space:1,spaceOffset:[.28,0,-.62]},{name:"Itzhak",position:[-8.2,21.87,18.15],rotation:[360,84,0],space:1.2,spaceOffset:[.62,0,-.17],gazeOffset:[0,.47,-.31],endingPosition:[-8.2,22.04,.55]},{name:"Shirin7PM",position:[16.7,27.3,-46.57],rotation:[0,275,0],space:100,spaceOffset:[0,0,0]},{name:"Waterman",position:[7.87,22.36,-3.26],rotation:[0,220,0],space:20},{name:"FatmanShower",position:[-3.39,22.8,-6.98],rotation:[197,322,185]},{name:"Agam7PM",position:[4.69,22.2,6],rotation:[0,48,2.3]}]},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _jqueryBrowserify=require("jquery-browserify");var _jqueryBrowserify2=_interopRequireDefault(_jqueryBrowserify);var _jqueryMousewheel=require("jquery-mousewheel");var _jqueryMousewheel2=_interopRequireDefault(_jqueryMousewheel);var _easingUtils=require("easing-utils");var _debug=require("./util/debug");var _debug2=_interopRequireDefault(_debug);var _lodash=require("lodash");var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ZoomController=function(){function ZoomController(config,emitter,camera,square,scene,vrControls){_classCallCheck(this,ZoomController);this.camera=camera;this.square=square;this.recalculateZoom=true;this.velocityZ=0;this.emitter=emitter;this.zoomVector=new THREE.Vector3;this.lastCameraOrientation=new THREE.Quaternion;this.lastCameraOrientation.y=1;this.config=config;this.scene=scene;this.wasUsed=false;this.done=false;this.vrControls=vrControls;this.distanceOnCurve=0;this.friction=.01;this.STARTING_ROTATION=new THREE.Euler(-.03997799566520428,-.001781628129114201,-7126384840989064e-20,"XYZ");this.STARTING_POSITION=new THREE.Vector3(0,15,150);this.MID_ZOOM=new THREE.Vector3(0,10,50);this.BASE_WORLD_POSITION=new THREE.Vector3(-6.75,12.67,.47);this.VR_SQUARE_POSITION=new THREE.Vector3(-3.01,-12.8,5.85);this.CHAPTER_THRESHOLD=.45;this.CONTROL_THRESHOLD=1;this.passedChapterThreshold=false;this.passedControlThreshold=false;this.basePosition=true}_createClass(ZoomController,[{key:"init",value:function init(){var _this=this;(0,_jqueryMousewheel2.default)(_jqueryBrowserify2.default);console.log("Zoom controller init");(0,_jqueryBrowserify2.default)(document.documentElement).on("mousewheel",function(event){_this.velocityZ=event.deltaY*10;if(_this.velocityZ>0){_this.velocityZ=Math.max(_this.velocityZ,60)}else if(_this.velocityZ<0){_this.velocityZ=Math.min(_this.velocityZ,-100)}});document.addEventListener("keydown",function(event){if(!_this.passedControlThreshold){switch(event.keyCode){case 69:event.preventDefault();_this.velocityZ+=5;break;case 84:event.preventDefault();_this.velocityZ-=5;break;case 85:event.preventDefault();_this.calculateZoomCurve(_this.lastEntryPoint);break}}return false},false);events.emit("add_gui",{folder:"Camera",listen:true,step:.1},this.camera.position,"x");events.emit("add_gui",{folder:"Camera",listen:true,step:.1},this.camera.position,"y");events.emit("add_gui",{folder:"Camera",listen:true,step:.1},this.camera.position,"z");events.on("angle_updated",function(hour){if(!_this.done&&typeof hour!="undefined"){if(hour==24){hour=0}console.log("Zoom Controller: Hour angle updated to ",hour);var entryPoint=_lodash2.default.find(_this.square.ENTRY_POINTS,{hour:hour});if(entryPoint){_this.calculateZoomCurve(entryPoint);_this.lastEntryPoint=entryPoint}else{_this.velocityZ=null;_this.zoomCurve=null}}})}},{key:"start",value:function start(){this.camera.position.copy(this.STARTING_POSITION);this.camera.rotation.copy(this.STARTING_ROTATION);this.baseVRPosition=null;this.square.position.copy(this.VR_SQUARE_POSITION);this.baseVRPosition=new THREE.Vector3;this.baseVRPosition.y=1.1}},{key:"jumpIn",value:function jumpIn(){if(!inVR){this.camera.position.copy(this.baseVRPosition)}else{}events.emit("control_threshold",true)}},{key:"getZoomOutPosition",value:function getZoomOutPosition(){var vec=new THREE.Vector3;vec.copy(new THREE.Vector3(0,0,1)).applyQuaternion(this.camera.quaternion).multiplyScalar(500);vec.add(this.camera.position);vec.y+=100;return vec}},{key:"calculateZoomVector",value:function calculateZoomVector(){var quat=(new THREE.Quaternion).copy(this.camera.quaternion);this.zoomVector.copy(new THREE.Vector3(0,0,1)).applyQuaternion(quat);this.zoomVector.y=0}},{key:"calculateEaseQuaternion",value:function calculateEaseQuaternion(){var cameraClone=this.camera.clone();this.easeQuaternionSource=(new THREE.Quaternion).copy(cameraClone.quaternion);cameraClone.position.copy(this.zoomCurve.getPoint(.95));cameraClone.lookAt(this.zoomCurve.getPoint(.951));this.easeQuaternionTarget=(new THREE.Quaternion).copy(cameraClone.quaternion)}},{key:"calculateZoomCurve",value:function calculateZoomCurve(entryPoint){this.calculateZoomVector();if(!entryPoint&&this.passedControlThreshold){this.zoomCurve=null}else{if(this.square.mesh){this.square.mesh.updateMatrixWorld();this.easeQuaternionSource=null;this.easeQuaternionTarget=null;var startPoint=(new THREE.Vector3).fromArray(entryPoint.startPosition).applyMatrix4(this.square.mesh.matrixWorld);var endPoint=(new THREE.Vector3).fromArray(entryPoint.endPosition).applyMatrix4(this.square.mesh.matrixWorld);if(this.camera.position.equals(this.STARTING_POSITION)||this.camera.position.z==0){var points=[(new THREE.Vector3).copy(this.camera.position)];if(entryPoint.worldPosition){points.push((new THREE.Vector3).fromArray(entryPoint.worldPosition))}else{points.push(this.MID_ZOOM)}points.push.apply(points,[startPoint,endPoint]);if(this.baseVRPosition){points.push(this.baseVRPosition)}console.log("Curve points",points);this.zoomCurve=new THREE.CatmullRomCurve3(points)}else{this.zoomCurve=null}}}console.log(this.zoomCurve)}},{key:"update",value:function update(dt){if(this.velocityZ!=0&&this.zoomCurve&&!this.passedControlThreshold){if(this.passedControlThreshold){if(this.velocityZ<0){this.calculateZoomCurve()}else{this.velocityZ=0;return}}if(!this.wasUsed){this.wasUsed=true;events.emit("zoom_used")}this.distanceOnCurve=Math.max(0,Math.min(1,this.distanceOnCurve+this.velocityZ*dt*.001));this.camera.position.copy(this.zoomCurve.getPoint(this.distanceOnCurve));if(this.easeQuaternionTarget&&this.distanceOnCurve>=.95){var easePercent=(1-this.distanceOnCurve)/.05;THREE.Quaternion.slerp(this.easeQuaternionSource,this.easeQuaternionTarget,this.camera.quaternion,easePercent)}else if(this.distanceOnCurve<=.99){this.camera.lookAt(this.zoomCurve.getPoint(this.distanceOnCurve+.01))}if(!this.passedChapterThreshold&&this.distanceOnCurve>this.CHAPTER_THRESHOLD){this.passedChapterThreshold=true;events.emit("chapter_threshold",this.passedChapterThreshold)}else if(this.passedChapterThreshold&&this.distanceOnCurve<=this.CHAPTER_THRESHOLD){this.passedChapterThreshold=false;events.emit("chapter_threshold",this.passedChapterThreshold)}if(!this.passedControlThreshold&&this.distanceOnCurve>=this.CONTROL_THRESHOLD){this.passedControlThreshold=true;this.velocityZ=0;events.emit("control_threshold",this.passedControlThreshold)}else if(this.passedControlThreshold&&this.distanceOnCurve<=this.CONTROL_THRESHOLD){this.passedControlThreshold=false;events.emit("control_threshold",this.passedControlThreshold)}if(!this.basePosition&&this.distanceOnCurve==0){this.basePosition=true;this.velocityZ=0;this.calculateZoomCurve(this.lastEntryPoint);events.emit("base_position")}else if(this.basePosition&&this.distanceOnCurve>0){this.basePosition=false}if(this.velocityZ>0){this.velocityZ=Math.max(0,this.velocityZ-this.friction*dt)}else{this.velocityZ=Math.min(0,this.velocityZ+this.friction*dt)}}}}]);return ZoomController}();exports.default=ZoomController},{"./util/debug":58,"easing-utils":88,"jquery-browserify":94,"jquery-mousewheel":95,lodash:96}],72:[function(require,module,exports){addEventListener.removeEventListener=removeEventListener;addEventListener.addEventListener=addEventListener;module.exports=addEventListener;var Events=null;function addEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach});return Events.add(el,eventName,listener,useCapture)}function removeEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach});return Events.rm(el,eventName,listener,useCapture)}function stdAttach(el,eventName,listener,useCapture){el.addEventListener(eventName,listener,useCapture)}function stdDetach(el,eventName,listener,useCapture){el.removeEventListener(eventName,listener,useCapture)}function oldIEAttach(el,eventName,listener,useCapture){if(useCapture){throw new Error("cannot useCapture in oldIE")}el.attachEvent("on"+eventName,listener)}function oldIEDetach(el,eventName,listener,useCapture){el.detachEvent("on"+eventName,listener)}},{}],73:[function(require,module,exports){"use strict";exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;function init(){var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63}init();function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}placeHolders=b64[len-2]==="="?2:b64[len-1]==="="?1:0;arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],74:[function(require,module,exports){"use strict";"use restrict";var INT_BITS=32;exports.INT_BITS=INT_BITS;exports.INT_MAX=2147483647;exports.INT_MIN=-1<<INT_BITS-1;exports.sign=function(v){return(v>0)-(v<0)};exports.abs=function(v){var mask=v>>INT_BITS-1;return(v^mask)-mask};exports.min=function(x,y){return y^(x^y)&-(x<y)};exports.max=function(x,y){return x^(x^y)&-(x<y)};exports.isPow2=function(v){return!(v&v-1)&&!!v};exports.log2=function(v){var r,shift;r=(v>65535)<<4;v>>>=r;shift=(v>255)<<3;v>>>=shift;r|=shift;shift=(v>15)<<2;v>>>=shift;r|=shift;shift=(v>3)<<1;v>>>=shift;r|=shift;return r|v>>1};exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0};exports.popCount=function(v){v=v-(v>>>1&1431655765);v=(v&858993459)+(v>>>2&858993459);return(v+(v>>>4)&252645135)*16843009>>>24};function countTrailingZeros(v){var c=32;v&=-v;if(v)c--;if(v&65535)c-=16;if(v&16711935)c-=8;if(v&252645135)c-=4;if(v&858993459)c-=2;if(v&1431655765)c-=1;return c}exports.countTrailingZeros=countTrailingZeros;exports.nextPow2=function(v){v+=v===0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1};exports.prevPow2=function(v){v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v-(v>>>1)};exports.parity=function(v){v^=v>>>16;v^=v>>>8;v^=v>>>4;v&=15;return 27030>>>v&1};var REVERSE_TABLE=new Array(256);(function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1){r<<=1;r|=v&1;--s}tab[i]=r<<s&255}})(REVERSE_TABLE);exports.reverse=function(v){return REVERSE_TABLE[v&255]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]};exports.interleave2=function(x,y){x&=65535;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y&=65535;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1};exports.deinterleave2=function(v,n){v=v>>>n&1431655765;v=(v|v>>>1)&858993459;v=(v|v>>>2)&252645135;v=(v|v>>>4)&16711935;v=(v|v>>>16)&65535;return v<<16>>16};exports.interleave3=function(x,y,z){x&=1023;x=(x|x<<16)&4278190335;x=(x|x<<8)&251719695;x=(x|x<<4)&3272356035;x=(x|x<<2)&1227133513;y&=1023;y=(y|y<<16)&4278190335;y=(y|y<<8)&251719695;y=(y|y<<4)&3272356035;y=(y|y<<2)&1227133513;x|=y<<1;z&=1023;z=(z|z<<16)&4278190335;z=(z|z<<8)&251719695;z=(z|z<<4)&3272356035;z=(z|z<<2)&1227133513;return x|z<<2};exports.deinterleave3=function(v,n){v=v>>>n&1227133513;v=(v|v>>>2)&3272356035;v=(v|v>>>4)&251719695;v=(v|v>>>8)&4278190335;v=(v|v>>>16)&1023;return v<<22>>22};exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],75:[function(require,module,exports){"use strict";module.exports=boxIntersectWrapper;var pool=require("typedarray-pool");var sweep=require("./lib/sweep");var boxIntersectIter=require("./lib/intersect");function boxEmpty(d,box){for(var j=0;j<d;++j){if(!(box[j]<=box[j+d])){return true}}return false}function convertBoxes(boxes,d,data,ids){var ptr=0;var count=0;for(var i=0,n=boxes.length;i<n;++i){var b=boxes[i];if(boxEmpty(d,b)){continue}for(var j=0;j<2*d;++j){data[ptr++]=b[j]}ids[count++]=i}return count}function boxIntersect(red,blue,visit,full){var n=red.length;var m=blue.length;if(n<=0||m<=0){return}var d=red[0].length>>>1;if(d<=0){return}var retval;var redList=pool.mallocDouble(2*d*n);var redIds=pool.mallocInt32(n);n=convertBoxes(red,d,redList,redIds);if(n>0){if(d===1&&full){sweep.init(n);retval=sweep.sweepComplete(d,visit,0,n,redList,redIds,0,n,redList,redIds)}else{var blueList=pool.mallocDouble(2*d*m);var blueIds=pool.mallocInt32(m);m=convertBoxes(blue,d,blueList,blueIds);if(m>0){sweep.init(n+m);if(d===1){retval=sweep.sweepBipartite(d,visit,0,n,redList,redIds,0,m,blueList,blueIds)}else{retval=boxIntersectIter(d,visit,full,n,redList,redIds,m,blueList,blueIds)}pool.free(blueList);pool.free(blueIds)}}pool.free(redList);pool.free(redIds)}return retval}var RESULT;function appendItem(i,j){RESULT.push([i,j])}function intersectFullArray(x){RESULT=[];boxIntersect(x,x,appendItem,true);return RESULT}function intersectBipartiteArray(x,y){RESULT=[];boxIntersect(x,y,appendItem,false);return RESULT}function boxIntersectWrapper(arg0,arg1,arg2){var result;switch(arguments.length){case 1:return intersectFullArray(arg0);case 2:if(typeof arg1==="function"){return boxIntersect(arg0,arg0,arg1,true)}else{return intersectBipartiteArray(arg0,arg1)}case 3:return boxIntersect(arg0,arg1,arg2,false);default:throw new Error("box-intersect: Invalid arguments")}}},{"./lib/intersect":77,"./lib/sweep":81,"typedarray-pool":115}],76:[function(require,module,exports){"use strict";var DIMENSION="d";var AXIS="ax";var VISIT="vv";var FLIP="fp";
var ELEM_SIZE="es";var RED_START="rs";var RED_END="re";var RED_BOXES="rb";var RED_INDEX="ri";var RED_PTR="rp";var BLUE_START="bs";var BLUE_END="be";var BLUE_BOXES="bb";var BLUE_INDEX="bi";var BLUE_PTR="bp";var RETVAL="rv";var INNER_LABEL="Q";var ARGS=[DIMENSION,AXIS,VISIT,RED_START,RED_END,RED_BOXES,RED_INDEX,BLUE_START,BLUE_END,BLUE_BOXES,BLUE_INDEX];function generateBruteForce(redMajor,flip,full){var funcName="bruteForce"+(redMajor?"Red":"Blue")+(flip?"Flip":"")+(full?"Full":"");var code=["function ",funcName,"(",ARGS.join(),"){","var ",ELEM_SIZE,"=2*",DIMENSION,";"];var redLoop="for(var i="+RED_START+","+RED_PTR+"="+ELEM_SIZE+"*"+RED_START+";"+"i<"+RED_END+";"+"++i,"+RED_PTR+"+="+ELEM_SIZE+"){"+"var x0="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"],"+"x1="+RED_BOXES+"["+AXIS+"+"+RED_PTR+"+"+DIMENSION+"],"+"xi="+RED_INDEX+"[i];";var blueLoop="for(var j="+BLUE_START+","+BLUE_PTR+"="+ELEM_SIZE+"*"+BLUE_START+";"+"j<"+BLUE_END+";"+"++j,"+BLUE_PTR+"+="+ELEM_SIZE+"){"+"var y0="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"],"+(full?"y1="+BLUE_BOXES+"["+AXIS+"+"+BLUE_PTR+"+"+DIMENSION+"],":"")+"yi="+BLUE_INDEX+"[j];";if(redMajor){code.push(redLoop,INNER_LABEL,":",blueLoop)}else{code.push(blueLoop,INNER_LABEL,":",redLoop)}if(full){code.push("if(y1<x0||x1<y0)continue;")}else if(flip){code.push("if(y0<=x0||x1<y0)continue;")}else{code.push("if(y0<x0||x1<y0)continue;")}code.push("for(var k="+AXIS+"+1;k<"+DIMENSION+";++k){"+"var r0="+RED_BOXES+"[k+"+RED_PTR+"],"+"r1="+RED_BOXES+"[k+"+DIMENSION+"+"+RED_PTR+"],"+"b0="+BLUE_BOXES+"[k+"+BLUE_PTR+"],"+"b1="+BLUE_BOXES+"[k+"+DIMENSION+"+"+BLUE_PTR+"];"+"if(r1<b0||b1<r0)continue "+INNER_LABEL+";}"+"var "+RETVAL+"="+VISIT+"(");if(flip){code.push("yi,xi")}else{code.push("xi,yi")}code.push(");if("+RETVAL+"!==void 0)return "+RETVAL+";}}}");return{name:funcName,code:code.join("")}}function bruteForcePlanner(full){var funcName="bruteForce"+(full?"Full":"Partial");var prefix=[];var fargs=ARGS.slice();if(!full){fargs.splice(3,0,FLIP)}var code=["function "+funcName+"("+fargs.join()+"){"];function invoke(redMajor,flip){var res=generateBruteForce(redMajor,flip,full);prefix.push(res.code);code.push("return "+res.name+"("+ARGS.join()+");")}code.push("if("+RED_END+"-"+RED_START+">"+BLUE_END+"-"+BLUE_START+"){");if(full){invoke(true,false);code.push("}else{");invoke(false,false)}else{code.push("if("+FLIP+"){");invoke(true,true);code.push("}else{");invoke(true,false);code.push("}}else{if("+FLIP+"){");invoke(false,true);code.push("}else{");invoke(false,false);code.push("}")}code.push("}}return "+funcName);var codeStr=prefix.join("")+code.join("");var proc=new Function(codeStr);return proc()}exports.partial=bruteForcePlanner(false);exports.full=bruteForcePlanner(true)},{}],77:[function(require,module,exports){"use strict";module.exports=boxIntersectIter;var pool=require("typedarray-pool");var bits=require("bit-twiddle");var bruteForce=require("./brute");var bruteForcePartial=bruteForce.partial;var bruteForceFull=bruteForce.full;var sweep=require("./sweep");var findMedian=require("./median");var genPartition=require("./partition");var BRUTE_FORCE_CUTOFF=128;var SCAN_CUTOFF=1<<22;var SCAN_COMPLETE_CUTOFF=1<<22;var partitionInteriorContainsInterval=genPartition("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]);var partitionStartEqual=genPartition("lo===p0",["p0"]);var partitionStartLessThan=genPartition("lo<p0",["p0"]);var partitionEndLessThanEqual=genPartition("hi<=p0",["p0"]);var partitionContainsPoint=genPartition("lo<=p0&&p0<=hi",["p0"]);var partitionContainsPointProper=genPartition("lo<p0&&p0<=hi",["p0"]);var IFRAME_SIZE=6;var DFRAME_SIZE=2;var INIT_CAPACITY=1024;var BOX_ISTACK=pool.mallocInt32(INIT_CAPACITY);var BOX_DSTACK=pool.mallocDouble(INIT_CAPACITY);function iterInit(d,count){var levels=8*bits.log2(count+1)*(d+1)|0;var maxInts=bits.nextPow2(IFRAME_SIZE*levels);if(BOX_ISTACK.length<maxInts){pool.free(BOX_ISTACK);BOX_ISTACK=pool.mallocInt32(maxInts)}var maxDoubles=bits.nextPow2(DFRAME_SIZE*levels);if(BOX_DSTACK<maxDoubles){pool.free(BOX_DSTACK);BOX_DSTACK=pool.mallocDouble(maxDoubles)}}function iterPush(ptr,axis,redStart,redEnd,blueStart,blueEnd,state,lo,hi){var iptr=IFRAME_SIZE*ptr;BOX_ISTACK[iptr]=axis;BOX_ISTACK[iptr+1]=redStart;BOX_ISTACK[iptr+2]=redEnd;BOX_ISTACK[iptr+3]=blueStart;BOX_ISTACK[iptr+4]=blueEnd;BOX_ISTACK[iptr+5]=state;var dptr=DFRAME_SIZE*ptr;BOX_DSTACK[dptr]=lo;BOX_DSTACK[dptr+1]=hi}function onePointPartial(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueOffset,blue,blueId){var elemSize=2*d;var bluePtr=blueOffset*elemSize;var blueX=blue[bluePtr+axis];red_loop:for(var i=redStart,redPtr=redStart*elemSize;i<redEnd;++i,redPtr+=elemSize){var r0=red[redPtr+axis];var r1=red[redPtr+axis+d];if(blueX<r0||r1<blueX){continue}if(flip&&blueX===r0){continue}var redId=redIndex[i];for(var j=axis+1;j<d;++j){var r0=red[redPtr+j];var r1=red[redPtr+j+d];var b0=blue[bluePtr+j];var b1=blue[bluePtr+j+d];if(r1<b0||b1<r0){continue red_loop}}var retval;if(flip){retval=visit(blueId,redId)}else{retval=visit(redId,blueId)}if(retval!==void 0){return retval}}}function onePointFull(d,axis,visit,redStart,redEnd,red,redIndex,blueOffset,blue,blueId){var elemSize=2*d;var bluePtr=blueOffset*elemSize;var blueX=blue[bluePtr+axis];red_loop:for(var i=redStart,redPtr=redStart*elemSize;i<redEnd;++i,redPtr+=elemSize){var redId=redIndex[i];if(redId===blueId){continue}var r0=red[redPtr+axis];var r1=red[redPtr+axis+d];if(blueX<r0||r1<blueX){continue}for(var j=axis+1;j<d;++j){var r0=red[redPtr+j];var r1=red[redPtr+j+d];var b0=blue[bluePtr+j];var b1=blue[bluePtr+j+d];if(r1<b0||b1<r0){continue red_loop}}var retval=visit(redId,blueId);if(retval!==void 0){return retval}}}function boxIntersectIter(d,visit,initFull,xSize,xBoxes,xIndex,ySize,yBoxes,yIndex){iterInit(d,xSize+ySize);var top=0;var elemSize=2*d;var retval;iterPush(top++,0,0,xSize,0,ySize,initFull?16:0,-Infinity,Infinity);if(!initFull){iterPush(top++,0,0,ySize,0,xSize,1,-Infinity,Infinity)}while(top>0){top-=1;var iptr=top*IFRAME_SIZE;var axis=BOX_ISTACK[iptr];var redStart=BOX_ISTACK[iptr+1];var redEnd=BOX_ISTACK[iptr+2];var blueStart=BOX_ISTACK[iptr+3];var blueEnd=BOX_ISTACK[iptr+4];var state=BOX_ISTACK[iptr+5];var dptr=top*DFRAME_SIZE;var lo=BOX_DSTACK[dptr];var hi=BOX_DSTACK[dptr+1];var flip=state&1;var full=!!(state&16);var red=xBoxes;var redIndex=xIndex;var blue=yBoxes;var blueIndex=yIndex;if(flip){red=yBoxes;redIndex=yIndex;blue=xBoxes;blueIndex=xIndex}if(state&2){redEnd=partitionStartLessThan(d,axis,redStart,redEnd,red,redIndex,hi);if(redStart>=redEnd){continue}}if(state&4){redStart=partitionEndLessThanEqual(d,axis,redStart,redEnd,red,redIndex,lo);if(redStart>=redEnd){continue}}var redCount=redEnd-redStart;var blueCount=blueEnd-blueStart;if(full){if(d*redCount*(redCount+blueCount)<SCAN_COMPLETE_CUTOFF){retval=sweep.scanComplete(d,axis,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex);if(retval!==void 0){return retval}continue}}else{if(d*Math.min(redCount,blueCount)<BRUTE_FORCE_CUTOFF){retval=bruteForcePartial(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex);if(retval!==void 0){return retval}continue}else if(d*redCount*blueCount<SCAN_CUTOFF){retval=sweep.scanBipartite(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex);if(retval!==void 0){return retval}continue}}var red0=partitionInteriorContainsInterval(d,axis,redStart,redEnd,red,redIndex,lo,hi);if(redStart<red0){if(d*(red0-redStart)<BRUTE_FORCE_CUTOFF){retval=bruteForceFull(d,axis+1,visit,redStart,red0,red,redIndex,blueStart,blueEnd,blue,blueIndex);if(retval!==void 0){return retval}}else if(axis===d-2){if(flip){retval=sweep.sweepBipartite(d,visit,blueStart,blueEnd,blue,blueIndex,redStart,red0,red,redIndex)}else{retval=sweep.sweepBipartite(d,visit,redStart,red0,red,redIndex,blueStart,blueEnd,blue,blueIndex)}if(retval!==void 0){return retval}}else{iterPush(top++,axis+1,redStart,red0,blueStart,blueEnd,flip,-Infinity,Infinity);iterPush(top++,axis+1,blueStart,blueEnd,redStart,red0,flip^1,-Infinity,Infinity)}}if(red0<redEnd){var blue0=findMedian(d,axis,blueStart,blueEnd,blue,blueIndex);var mid=blue[elemSize*blue0+axis];var blue1=partitionStartEqual(d,axis,blue0,blueEnd,blue,blueIndex,mid);if(blue1<blueEnd){iterPush(top++,axis,red0,redEnd,blue1,blueEnd,(flip|4)+(full?16:0),mid,hi)}if(blueStart<blue0){iterPush(top++,axis,red0,redEnd,blueStart,blue0,(flip|2)+(full?16:0),lo,mid)}if(blue0+1===blue1){if(full){retval=onePointFull(d,axis,visit,red0,redEnd,red,redIndex,blue0,blue,blueIndex[blue0])}else{retval=onePointPartial(d,axis,visit,flip,red0,redEnd,red,redIndex,blue0,blue,blueIndex[blue0])}if(retval!==void 0){return retval}}else if(blue0<blue1){var red1;if(full){red1=partitionContainsPoint(d,axis,red0,redEnd,red,redIndex,mid);if(red0<red1){var redX=partitionStartEqual(d,axis,red0,red1,red,redIndex,mid);if(axis===d-2){if(red0<redX){retval=sweep.sweepComplete(d,visit,red0,redX,red,redIndex,blue0,blue1,blue,blueIndex);if(retval!==void 0){return retval}}if(redX<red1){retval=sweep.sweepBipartite(d,visit,redX,red1,red,redIndex,blue0,blue1,blue,blueIndex);if(retval!==void 0){return retval}}}else{if(red0<redX){iterPush(top++,axis+1,red0,redX,blue0,blue1,16,-Infinity,Infinity)}if(redX<red1){iterPush(top++,axis+1,redX,red1,blue0,blue1,0,-Infinity,Infinity);iterPush(top++,axis+1,blue0,blue1,redX,red1,1,-Infinity,Infinity)}}}}else{if(flip){red1=partitionContainsPointProper(d,axis,red0,redEnd,red,redIndex,mid)}else{red1=partitionContainsPoint(d,axis,red0,redEnd,red,redIndex,mid)}if(red0<red1){if(axis===d-2){if(flip){retval=sweep.sweepBipartite(d,visit,blue0,blue1,blue,blueIndex,red0,red1,red,redIndex)}else{retval=sweep.sweepBipartite(d,visit,red0,red1,red,redIndex,blue0,blue1,blue,blueIndex)}}else{iterPush(top++,axis+1,red0,red1,blue0,blue1,flip,-Infinity,Infinity);iterPush(top++,axis+1,blue0,blue1,red0,red1,flip^1,-Infinity,Infinity)}}}}}}}},{"./brute":76,"./median":78,"./partition":79,"./sweep":81,"bit-twiddle":74,"typedarray-pool":115}],78:[function(require,module,exports){"use strict";module.exports=findMedian;var genPartition=require("./partition");var partitionStartLessThan=genPartition("lo<p0",["p0"]);var PARTITION_THRESHOLD=8;function insertionSort(d,axis,start,end,boxes,ids){var elemSize=2*d;var boxPtr=elemSize*(start+1)+axis;for(var i=start+1;i<end;++i,boxPtr+=elemSize){var x=boxes[boxPtr];for(var j=i,ptr=elemSize*(i-1);j>start&&boxes[ptr+axis]>x;--j,ptr-=elemSize){var aPtr=ptr;var bPtr=ptr+elemSize;for(var k=0;k<elemSize;++k,++aPtr,++bPtr){var y=boxes[aPtr];boxes[aPtr]=boxes[bPtr];boxes[bPtr]=y}var tmp=ids[j];ids[j]=ids[j-1];ids[j-1]=tmp}}}function findMedian(d,axis,start,end,boxes,ids){if(end<=start+1){return start}var lo=start;var hi=end;var mid=end+start>>>1;var elemSize=2*d;var pivot=mid;var value=boxes[elemSize*mid+axis];while(lo<hi){if(hi-lo<PARTITION_THRESHOLD){insertionSort(d,axis,lo,hi,boxes,ids);value=boxes[elemSize*mid+axis];break}var count=hi-lo;var pivot0=Math.random()*count+lo|0;var value0=boxes[elemSize*pivot0+axis];var pivot1=Math.random()*count+lo|0;var value1=boxes[elemSize*pivot1+axis];var pivot2=Math.random()*count+lo|0;var value2=boxes[elemSize*pivot2+axis];if(value0<=value1){if(value2>=value1){pivot=pivot1;value=value1}else if(value0>=value2){pivot=pivot0;value=value0}else{pivot=pivot2;value=value2}}else{if(value1>=value2){pivot=pivot1;value=value1}else if(value2>=value0){pivot=pivot0;value=value0}else{pivot=pivot2;value=value2}}var aPtr=elemSize*(hi-1);var bPtr=elemSize*pivot;for(var i=0;i<elemSize;++i,++aPtr,++bPtr){var x=boxes[aPtr];boxes[aPtr]=boxes[bPtr];boxes[bPtr]=x}var y=ids[hi-1];ids[hi-1]=ids[pivot];ids[pivot]=y;pivot=partitionStartLessThan(d,axis,lo,hi-1,boxes,ids,value);var aPtr=elemSize*(hi-1);var bPtr=elemSize*pivot;for(var i=0;i<elemSize;++i,++aPtr,++bPtr){var x=boxes[aPtr];boxes[aPtr]=boxes[bPtr];boxes[bPtr]=x}var y=ids[hi-1];ids[hi-1]=ids[pivot];ids[pivot]=y;if(mid<pivot){hi=pivot-1;while(lo<hi&&boxes[elemSize*(hi-1)+axis]===value){hi-=1}hi+=1}else if(pivot<mid){lo=pivot+1;while(lo<hi&&boxes[elemSize*lo+axis]===value){lo+=1}}else{break}}return partitionStartLessThan(d,axis,start,mid,boxes,ids,boxes[elemSize*mid+axis])}},{"./partition":79}],79:[function(require,module,exports){"use strict";module.exports=genPartition;var code="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m";function genPartition(predicate,args){var fargs="abcdef".split("").concat(args);var reads=[];if(predicate.indexOf("lo")>=0){reads.push("lo=e[k+n]")}if(predicate.indexOf("hi")>=0){reads.push("hi=e[k+o]")}fargs.push(code.replace("_",reads.join()).replace("$",predicate));return Function.apply(void 0,fargs)}},{}],80:[function(require,module,exports){"use strict";module.exports=wrapper;var INSERT_SORT_CUTOFF=32;function wrapper(data,n0){if(n0<=4*INSERT_SORT_CUTOFF){insertionSort(0,n0-1,data)}else{quickSort(0,n0-1,data)}}function insertionSort(left,right,data){var ptr=2*(left+1);for(var i=left+1;i<=right;++i){var a=data[ptr++];var b=data[ptr++];var j=i;var jptr=ptr-2;while(j-->left){var x=data[jptr-2];var y=data[jptr-1];if(x<a){break}else if(x===a&&y<b){break}data[jptr]=x;data[jptr+1]=y;jptr-=2}data[jptr]=a;data[jptr+1]=b}}function swap(i,j,data){i*=2;j*=2;var x=data[i];var y=data[i+1];data[i]=data[j];data[i+1]=data[j+1];data[j]=x;data[j+1]=y}function move(i,j,data){i*=2;j*=2;data[i]=data[j];data[i+1]=data[j+1]}function rotate(i,j,k,data){i*=2;j*=2;k*=2;var x=data[i];var y=data[i+1];data[i]=data[j];data[i+1]=data[j+1];data[j]=data[k];data[j+1]=data[k+1];data[k]=x;data[k+1]=y}function shufflePivot(i,j,px,py,data){i*=2;j*=2;data[i]=data[j];data[j]=px;data[i+1]=data[j+1];data[j+1]=py}function compare(i,j,data){i*=2;j*=2;var x=data[i],y=data[j];if(x<y){return false}else if(x===y){return data[i+1]>data[j+1]}return true}function comparePivot(i,y,b,data){i*=2;var x=data[i];if(x<y){return true}else if(x===y){return data[i+1]<b}return false}function quickSort(left,right,data){var sixth=(right-left+1)/6|0,index1=left+sixth,index5=right-sixth,index3=left+right>>1,index2=index3-sixth,index4=index3+sixth,el1=index1,el2=index2,el3=index3,el4=index4,el5=index5,less=left+1,great=right-1,tmp=0;if(compare(el1,el2,data)){tmp=el1;el1=el2;el2=tmp}if(compare(el4,el5,data)){tmp=el4;el4=el5;el5=tmp}if(compare(el1,el3,data)){tmp=el1;el1=el3;el3=tmp}if(compare(el2,el3,data)){tmp=el2;el2=el3;el3=tmp}if(compare(el1,el4,data)){tmp=el1;el1=el4;el4=tmp}if(compare(el3,el4,data)){tmp=el3;el3=el4;el4=tmp}if(compare(el2,el5,data)){tmp=el2;el2=el5;el5=tmp}if(compare(el2,el3,data)){tmp=el2;el2=el3;el3=tmp}if(compare(el4,el5,data)){tmp=el4;el4=el5;el5=tmp}var pivot1X=data[2*el2];var pivot1Y=data[2*el2+1];var pivot2X=data[2*el4];var pivot2Y=data[2*el4+1];var ptr0=2*el1;var ptr2=2*el3;var ptr4=2*el5;var ptr5=2*index1;var ptr6=2*index3;var ptr7=2*index5;for(var i1=0;i1<2;++i1){var x=data[ptr0+i1];var y=data[ptr2+i1];var z=data[ptr4+i1];data[ptr5+i1]=x;data[ptr6+i1]=y;data[ptr7+i1]=z}move(index2,left,data);move(index4,right,data);for(var k=less;k<=great;++k){if(comparePivot(k,pivot1X,pivot1Y,data)){if(k!==less){swap(k,less,data)}++less}else{if(!comparePivot(k,pivot2X,pivot2Y,data)){while(true){if(!comparePivot(great,pivot2X,pivot2Y,data)){if(--great<k){break}continue}else{if(comparePivot(great,pivot1X,pivot1Y,data)){rotate(k,less,great,data);++less;--great}else{swap(k,great,data);--great}break}}}}}shufflePivot(left,less-1,pivot1X,pivot1Y,data);shufflePivot(right,great+1,pivot2X,pivot2Y,data);if(less-2-left<=INSERT_SORT_CUTOFF){insertionSort(left,less-2,data)}else{quickSort(left,less-2,data)}if(right-(great+2)<=INSERT_SORT_CUTOFF){insertionSort(great+2,right,data)}else{quickSort(great+2,right,data)}if(great-less<=INSERT_SORT_CUTOFF){insertionSort(less,great,data)}else{quickSort(less,great,data)}}},{}],81:[function(require,module,exports){"use strict";module.exports={init:sqInit,sweepBipartite:sweepBipartite,sweepComplete:sweepComplete,scanBipartite:scanBipartite,scanComplete:scanComplete};var pool=require("typedarray-pool");var bits=require("bit-twiddle");var isort=require("./sort");var BLUE_FLAG=1<<28;var INIT_CAPACITY=1024;var RED_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY);var RED_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY);var BLUE_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY);var BLUE_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY);var COMMON_SWEEP_QUEUE=pool.mallocInt32(INIT_CAPACITY);var COMMON_SWEEP_INDEX=pool.mallocInt32(INIT_CAPACITY);var SWEEP_EVENTS=pool.mallocDouble(INIT_CAPACITY*8);function sqInit(count){var rcount=bits.nextPow2(count);if(RED_SWEEP_QUEUE.length<rcount){pool.free(RED_SWEEP_QUEUE);RED_SWEEP_QUEUE=pool.mallocInt32(rcount)}if(RED_SWEEP_INDEX.length<rcount){pool.free(RED_SWEEP_INDEX);RED_SWEEP_INDEX=pool.mallocInt32(rcount)}if(BLUE_SWEEP_QUEUE.length<rcount){pool.free(BLUE_SWEEP_QUEUE);BLUE_SWEEP_QUEUE=pool.mallocInt32(rcount)}if(BLUE_SWEEP_INDEX.length<rcount){pool.free(BLUE_SWEEP_INDEX);BLUE_SWEEP_INDEX=pool.mallocInt32(rcount)}if(COMMON_SWEEP_QUEUE.length<rcount){pool.free(COMMON_SWEEP_QUEUE);COMMON_SWEEP_QUEUE=pool.mallocInt32(rcount)}if(COMMON_SWEEP_INDEX.length<rcount){pool.free(COMMON_SWEEP_INDEX);COMMON_SWEEP_INDEX=pool.mallocInt32(rcount)}var eventLength=8*rcount;if(SWEEP_EVENTS.length<eventLength){pool.free(SWEEP_EVENTS);SWEEP_EVENTS=pool.mallocDouble(eventLength)}}function sqPop(queue,index,count,item){var idx=index[item];var top=queue[count-1];queue[idx]=top;index[top]=idx}function sqPush(queue,index,count,item){queue[count]=item;index[item]=count}function sweepBipartite(d,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){var ptr=0;var elemSize=2*d;var istart=d-1;var iend=elemSize-1;for(var i=redStart;i<redEnd;++i){var idx=redIndex[i];var redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart];SWEEP_EVENTS[ptr++]=-(idx+1);SWEEP_EVENTS[ptr++]=red[redOffset+iend];SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=blueIndex[i]+BLUE_FLAG;var blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart];SWEEP_EVENTS[ptr++]=-idx;SWEEP_EVENTS[ptr++]=blue[blueOffset+iend];SWEEP_EVENTS[ptr++]=idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);var redActive=0;var blueActive=0;for(var i=0;i<n;++i){var e=SWEEP_EVENTS[2*i+1]|0;if(e>=BLUE_FLAG){e=e-BLUE_FLAG|0;sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive--,e)}else if(e>=0){sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,e)}else if(e<=-BLUE_FLAG){e=-e-BLUE_FLAG|0;for(var j=0;j<redActive;++j){var retval=visit(RED_SWEEP_QUEUE[j],e);if(retval!==void 0){return retval}}sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive++,e)}else{e=-e-1|0;for(var j=0;j<blueActive;++j){var retval=visit(e,BLUE_SWEEP_QUEUE[j]);if(retval!==void 0){return retval}}sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,e)}}}function sweepComplete(d,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){var ptr=0;var elemSize=2*d;var istart=d-1;var iend=elemSize-1;for(var i=redStart;i<redEnd;++i){var idx=redIndex[i]+1<<1;var redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart];SWEEP_EVENTS[ptr++]=-idx;SWEEP_EVENTS[ptr++]=red[redOffset+iend];SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=blueIndex[i]+1<<1;var blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart];SWEEP_EVENTS[ptr++]=-idx|1;SWEEP_EVENTS[ptr++]=blue[blueOffset+iend];SWEEP_EVENTS[ptr++]=idx|1}var n=ptr>>>1;isort(SWEEP_EVENTS,n);var redActive=0;var blueActive=0;var commonActive=0;for(var i=0;i<n;++i){var e=SWEEP_EVENTS[2*i+1]|0;var color=e&1;if(i<n-1&&e>>1===SWEEP_EVENTS[2*i+3]>>1){color=2;i+=1}if(e<0){var id=-(e>>1)-1;for(var j=0;j<commonActive;++j){var retval=visit(COMMON_SWEEP_QUEUE[j],id);if(retval!==void 0){return retval}}if(color!==0){for(var j=0;j<redActive;++j){var retval=visit(RED_SWEEP_QUEUE[j],id);if(retval!==void 0){return retval}}}if(color!==1){for(var j=0;j<blueActive;++j){var retval=visit(BLUE_SWEEP_QUEUE[j],id);if(retval!==void 0){return retval}}}if(color===0){sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,id)}else if(color===1){sqPush(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive++,id)}else if(color===2){sqPush(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,commonActive++,id)}}else{var id=(e>>1)-1;if(color===0){sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,id)}else if(color===1){sqPop(BLUE_SWEEP_QUEUE,BLUE_SWEEP_INDEX,blueActive--,id)}else if(color===2){sqPop(COMMON_SWEEP_QUEUE,COMMON_SWEEP_INDEX,commonActive--,id)}}}}function scanBipartite(d,axis,visit,flip,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){var ptr=0;var elemSize=2*d;var istart=axis;var iend=axis+d;var redShift=1;var blueShift=1;if(flip){blueShift=BLUE_FLAG}else{redShift=BLUE_FLAG}for(var i=redStart;i<redEnd;++i){var idx=i+redShift;var redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart];SWEEP_EVENTS[ptr++]=-idx;SWEEP_EVENTS[ptr++]=red[redOffset+iend];SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=i+blueShift;var blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart];SWEEP_EVENTS[ptr++]=-idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);var redActive=0;for(var i=0;i<n;++i){var e=SWEEP_EVENTS[2*i+1]|0;if(e<0){var idx=-e;var isRed=false;if(idx>=BLUE_FLAG){isRed=!flip;idx-=BLUE_FLAG}else{isRed=!!flip;idx-=1}if(isRed){sqPush(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive++,idx)}else{var blueId=blueIndex[idx];var bluePtr=elemSize*idx;var b0=blue[bluePtr+axis+1];var b1=blue[bluePtr+axis+1+d];red_loop:for(var j=0;j<redActive;++j){var oidx=RED_SWEEP_QUEUE[j];var redPtr=elemSize*oidx;if(b1<red[redPtr+axis+1]||red[redPtr+axis+1+d]<b0){continue}for(var k=axis+2;k<d;++k){if(blue[bluePtr+k+d]<red[redPtr+k]||red[redPtr+k+d]<blue[bluePtr+k]){continue red_loop}}var redId=redIndex[oidx];var retval;if(flip){retval=visit(blueId,redId)}else{retval=visit(redId,blueId)}if(retval!==void 0){return retval}}}}else{sqPop(RED_SWEEP_QUEUE,RED_SWEEP_INDEX,redActive--,e-redShift)}}}function scanComplete(d,axis,visit,redStart,redEnd,red,redIndex,blueStart,blueEnd,blue,blueIndex){var ptr=0;var elemSize=2*d;var istart=axis;var iend=axis+d;for(var i=redStart;i<redEnd;++i){var idx=i+BLUE_FLAG;var redOffset=elemSize*i;SWEEP_EVENTS[ptr++]=red[redOffset+istart];SWEEP_EVENTS[ptr++]=-idx;SWEEP_EVENTS[ptr++]=red[redOffset+iend];SWEEP_EVENTS[ptr++]=idx}for(var i=blueStart;i<blueEnd;++i){var idx=i+1;var blueOffset=elemSize*i;SWEEP_EVENTS[ptr++]=blue[blueOffset+istart];SWEEP_EVENTS[ptr++]=-idx}var n=ptr>>>1;isort(SWEEP_EVENTS,n);var redActive=0;for(var i=0;i<n;++i){var e=SWEEP_EVENTS[2*i+1]|0;if(e<0){var idx=-e;if(idx>=BLUE_FLAG){RED_SWEEP_QUEUE[redActive++]=idx-BLUE_FLAG}else{idx-=1;var blueId=blueIndex[idx];var bluePtr=elemSize*idx;var b0=blue[bluePtr+axis+1];var b1=blue[bluePtr+axis+1+d];red_loop:for(var j=0;j<redActive;++j){var oidx=RED_SWEEP_QUEUE[j];var redId=redIndex[oidx];if(redId===blueId){break}var redPtr=elemSize*oidx;if(b1<red[redPtr+axis+1]||red[redPtr+axis+1+d]<b0){continue}for(var k=axis+2;k<d;++k){if(blue[bluePtr+k+d]<red[redPtr+k]||red[redPtr+k+d]<blue[bluePtr+k]){continue red_loop}}var retval=visit(redId,blueId);if(retval!==void 0){return retval}}}}else{var idx=e-BLUE_FLAG;for(var j=redActive-1;j>=0;--j){if(RED_SWEEP_QUEUE[j]===idx){for(var k=j+1;k<redActive;++k){RED_SWEEP_QUEUE[k-1]=RED_SWEEP_QUEUE[k]}break}}--redActive}}}},{"./sort":80,"bit-twiddle":74,"typedarray-pool":115}],82:[function(require,module,exports){},{}],83:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer");var Buffer=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function alloc(size,fill,encoding){if(typeof Buffer.alloc==="function"){return Buffer.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===undefined){enc=undefined;_fill=0}var buf=new Buffer(size);if(typeof _fill==="string"){var fillBuf=new Buffer(_fill,enc);var flen=fillBuf.length;var i=-1;while(++i<size){buf[i]=fillBuf[i%flen]}}else{buf.fill(_fill)}return buf};exports.allocUnsafe=function allocUnsafe(size){if(typeof Buffer.allocUnsafe==="function"){return Buffer.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer(size)};exports.from=function from(value,encodingOrOffset,length){if(typeof Buffer.from==="function"&&(!global.Uint8Array||Uint8Array.from!==Buffer.from)){return Buffer.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof value==="string"){return new Buffer(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("'offset' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("'length' is out of bounds")}return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer(value.data)}}throw new TypeError("First argument must be a string, Buffer, "+"ArrayBuffer, Array, or array-like object.")};exports.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer.allocUnsafeSlow==="function"){return Buffer.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:84}],84:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);that.write(string,encoding);return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')
}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function arrayIndexOf(arr,val,byteOffset,encoding){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var foundIndex=-1;for(var i=byteOffset;i<arrLength;++i){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}return-1}Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(this,val,byteOffset,encoding)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset,encoding)}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":73,ieee754:91,isarray:85}],85:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],86:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":93}],87:[function(require,module,exports){"use strict";function dupe_array(count,value,i){var c=count[i]|0;if(c<=0){return[]}var result=new Array(c),j;if(i===count.length-1){for(j=0;j<c;++j){result[j]=value}}else{for(j=0;j<c;++j){result[j]=dupe_array(count,value,i+1)}}return result}function dupe_number(count,value){var result,i;result=new Array(count);for(i=0;i<count;++i){result[i]=value}return result}function dupe(count,value){if(typeof value==="undefined"){value=0}switch(typeof count){case"number":if(count>0){return dupe_number(count|0,value)}break;case"object":if(typeof count.length==="number"){return dupe_array(count,value,0)}break}return[]}module.exports=dupe},{}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.linear=linear;exports.easeInSine=easeInSine;exports.easeOutSine=easeOutSine;exports.easeInOutSine=easeInOutSine;exports.easeInQuad=easeInQuad;exports.easeOutQuad=easeOutQuad;exports.easeInOutQuad=easeInOutQuad;exports.easeInCubic=easeInCubic;exports.easeOutCubic=easeOutCubic;exports.easeInOutCubic=easeInOutCubic;exports.easeInQuart=easeInQuart;exports.easeOutQuart=easeOutQuart;exports.easeInOutQuart=easeInOutQuart;exports.easeInQuint=easeInQuint;exports.easeOutQuint=easeOutQuint;exports.easeInOutQuint=easeInOutQuint;exports.easeInExpo=easeInExpo;exports.easeOutExpo=easeOutExpo;exports.easeInOutExpo=easeInOutExpo;exports.easeInCirc=easeInCirc;exports.easeOutCirc=easeOutCirc;exports.easeInOutCirc=easeInOutCirc;exports.easeInBack=easeInBack;exports.easeOutBack=easeOutBack;exports.easeInOutBack=easeInOutBack;exports.easeInElastic=easeInElastic;exports.easeOutElastic=easeOutElastic;exports.easeInOutElastic=easeInOutElastic;exports.easeOutBounce=easeOutBounce;exports.easeInBounce=easeInBounce;exports.easeInOutBounce=easeInOutBounce;function linear(t){return t}function easeInSine(t){return-1*Math.cos(t*(Math.PI/2))+1}function easeOutSine(t){return Math.sin(t*(Math.PI/2))}function easeInOutSine(t){return-.5*(Math.cos(Math.PI*t)-1)}function easeInQuad(t){return t*t}function easeOutQuad(t){return t*(2-t)}function easeInOutQuad(t){return t<.5?2*t*t:-1+(4-2*t)*t}function easeInCubic(t){return t*t*t}function easeOutCubic(t){var t1=t-1;return t1*t1*t1+1}function easeInOutCubic(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}function easeInQuart(t){return t*t*t*t}function easeOutQuart(t){var t1=t-1;return 1-t1*t1*t1*t1}function easeInOutQuart(t){var t1=t-1;return t<.5?8*t*t*t*t:1-8*t1*t1*t1*t1}function easeInQuint(t){return t*t*t*t*t}function easeOutQuint(t){var t1=t-1;return 1+t1*t1*t1*t1*t1}function easeInOutQuint(t){var t1=t-1;return t<.5?16*t*t*t*t*t:1+16*t1*t1*t1*t1*t1}function easeInExpo(t){if(t===0){return 0}return Math.pow(2,10*(t-1))}function easeOutExpo(t){if(t===1){return 1}return-Math.pow(2,-10*t)+1}function easeInOutExpo(t){if(t===0||t===1){return t}var scaledTime=t*2;var scaledTime1=scaledTime-1;if(scaledTime<1){return.5*Math.pow(2,10*scaledTime1)}return.5*(-Math.pow(2,-10*scaledTime1)+2)}function easeInCirc(t){var scaledTime=t/1;return-1*(Math.sqrt(1-scaledTime*t)-1)}function easeOutCirc(t){var t1=t-1;return Math.sqrt(1-t1*t1)}function easeInOutCirc(t){var scaledTime=t*2;var scaledTime1=scaledTime-2;if(scaledTime<1){return-.5*(Math.sqrt(1-scaledTime*scaledTime)-1)}return.5*(Math.sqrt(1-scaledTime1*scaledTime1)+1)}function easeInBack(t){var magnitude=arguments.length<=1||arguments[1]===undefined?1.70158:arguments[1];var scaledTime=t/1;return scaledTime*scaledTime*((magnitude+1)*scaledTime-magnitude)}function easeOutBack(t){var magnitude=arguments.length<=1||arguments[1]===undefined?1.70158:arguments[1];var scaledTime=t/1-1;return scaledTime*scaledTime*((magnitude+1)*scaledTime+magnitude)+1}function easeInOutBack(t){var magnitude=arguments.length<=1||arguments[1]===undefined?1.70158:arguments[1];var scaledTime=t*2;var scaledTime2=scaledTime-2;var s=magnitude*1.525;if(scaledTime<1){return.5*scaledTime*scaledTime*((s+1)*scaledTime-s)}return.5*(scaledTime2*scaledTime2*((s+1)*scaledTime2+s)+2)}function easeInElastic(t){var magnitude=arguments.length<=1||arguments[1]===undefined?.7:arguments[1];if(t===0||t===1){return t}var scaledTime=t/1;var scaledTime1=scaledTime-1;var p=1-magnitude;var s=p/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*scaledTime1)*Math.sin((scaledTime1-s)*(2*Math.PI)/p))}function easeOutElastic(t){var magnitude=arguments.length<=1||arguments[1]===undefined?.7:arguments[1];var p=1-magnitude;var scaledTime=t*2;if(t===0||t===1){return t}var s=p/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*scaledTime)*Math.sin((scaledTime-s)*(2*Math.PI)/p)+1}function easeInOutElastic(t){var magnitude=arguments.length<=1||arguments[1]===undefined?.65:arguments[1];var p=1-magnitude;if(t===0||t===1){return t}var scaledTime=t*2;var scaledTime1=scaledTime-1;var s=p/(2*Math.PI)*Math.asin(1);if(scaledTime<1){return-.5*(Math.pow(2,10*scaledTime1)*Math.sin((scaledTime1-s)*(2*Math.PI)/p))}return Math.pow(2,-10*scaledTime1)*Math.sin((scaledTime1-s)*(2*Math.PI)/p)*.5+1}function easeOutBounce(t){var scaledTime=t/1;
if(scaledTime<1/2.75){return 7.5625*scaledTime*scaledTime}else if(scaledTime<2/2.75){var scaledTime2=scaledTime-1.5/2.75;return 7.5625*scaledTime2*scaledTime2+.75}else if(scaledTime<2.5/2.75){var _scaledTime=scaledTime-2.25/2.75;return 7.5625*_scaledTime*_scaledTime+.9375}else{var _scaledTime2=scaledTime-2.625/2.75;return 7.5625*_scaledTime2*_scaledTime2+.984375}}function easeInBounce(t){return 1-easeOutBounce(1-t)}function easeInOutBounce(t){if(t<.5){return easeInBounce(t*2)*.5}return easeOutBounce(t*2-1)*.5+.5}},{}],89:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],90:[function(require,module,exports){module.exports=fullscreen;fullscreen.available=available;fullscreen.enabled=enabled;var EE=require("events").EventEmitter;var ael=require("add-event-listener");var rel=ael.removeEventListener;function available(){return!!shim(document.body)}function enabled(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullscreenEnabled||document.msFullscreenEnabled)}function fullscreen(el){var doc=el.ownerDocument,body=doc.body,rfs=shim(el),ee=new EE;var vendors=["","webkit","moz"];for(var i=0,len=vendors.length;i<len;++i){ael(doc,vendors[i]+"fullscreenchange",onfullscreenchange);ael(doc,vendors[i]+"fullscreenerror",onfullscreenerror)}ael(doc,"MSFullscreenChange",onfullscreenchange);ael(doc,"MSFullscreenError",onfullscreenerror);ee.release=release;ee.request=request;ee.dispose=dispose;ee.target=fullscreenelement;if(!shim){setTimeout(function(){ee.emit("error",new Error("fullscreen is not supported"))},0)}return ee;function onfullscreenchange(){if(!fullscreenelement()){return ee.emit("release")}ee.emit("attain")}function onfullscreenerror(){ee.emit("error")}function request(){return rfs.apply(el,arguments)}function release(){var element_exit=el.exitFullscreen||el.webkitExitFullscreen||el.mozCancelFullScreen||el.mozExitFullScreen||el.msExitFullscreen;if(element_exit){element_exit.apply(el,arguments);return}var document_exit=doc.exitFullscreen||doc.webkitExitFullscreen||doc.mozCancelFullScreen||doc.mozExitFullScreen||doc.msExitFullscreen;document_exit.apply(doc,arguments)}function fullscreenelement(){return 0||doc.fullscreenElement||doc.webkitFullscreenElement||doc.mozFullScreenElement||doc.msFullscreenElement||null}function dispose(){for(var i=0,len=vendors.length;i<len;++i){rel(doc,vendors[i]+"fullscreenchange",onfullscreenchange);rel(doc,vendors[i]+"fullscreenerror",onfullscreenerror)}rel(doc,"MSFullscreenChange",onfullscreenchange);rel(doc,"MSFullscreenError",onfullscreenerror)}}function shim(el){return el.requestFullscreen||el.webkitRequestFullscreen||el.mozRequestFullScreen||el.msRequestFullscreen}},{"add-event-listener":72,events:89}],91:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],92:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],93:[function(require,module,exports){module.exports=function(obj){return!!(obj!=null&&(obj._isBuffer||obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)))}},{}],94:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else{root.returnExports=factory()}})(this,function(){return function(window,undefined){var rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase()},DOMContentLoaded=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready()}else if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready()}},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this}if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=context&&context.nodeType?context.ownerDocument||context:document;selector=jQuery.parseHTML(match[1],doc,true);if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){this.attr.call(selector,context,true)}return jQuery.merge(this,selector)}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",jquery:"1.8.1",length:0,size:function(){return this.length},toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector}else if(name){ret.selector=this.selector+"."+name+"("+selector+")"}return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}if(!document.body){return setTimeout(jQuery.ready,1)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object"},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var key;for(key in obj){}return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,scripts){var parsed;if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){scripts=context;context=0}context=context||document;if(parsed=rsingleTag.exec(data)){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts?null:[]);return jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes)},parseJSON:function(data){if(!data||typeof data!=="string"){return null}data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{if(window.DOMParser){tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(data){if(data&&core_rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase()},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj){if(callback.apply(obj[name],args)===false){break}}}else{for(;i<length;){if(callback.apply(obj[i++],args)===false){break}}}}else{if(isObj){for(name in obj){if(callback.call(obj[name],name,obj[name])===false){break}}}else{for(;i<length;){if(callback.call(obj[i],i,obj[i++])===false){break}}}}return obj},trim:core_trim&&!core_trim.call("﻿ ")?function(text){return text==null?"":core_trim.call(text)}:function(text){return text==null?"":text.toString().replace(rtrim,"")},makeArray:function(arr,results){var type,ret=results||[];if(arr!=null){type=jQuery.type(arr);if(arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)){core_push.call(ret,arr)}else{jQuery.merge(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&(length>0&&elems[0]&&elems[length-1]||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value}}}return ret.concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key==="object"){for(i in key){jQuery.access(elems,fn,i,key[i],1,emptyGet,value)}chainable=1}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value);if(bulk){if(exec){exec=fn;fn=function(elem,key,value){return exec.call(jQuery(elem),value)}}else{fn.call(elems,value);fn=null}}if(fn){for(;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass)}}chainable=1}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready,1)}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false)}else{document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var top=false;try{top=window.frameElement==null&&document.documentElement}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}jQuery.ready()}})()}}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"&&(!options.unique||!self.has(arg))){list.push(arg)}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return jQuery.inArray(fn,list)>-1},empty:function(){list=[];return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned])}}:newDefer[action])});fns=null}).promise()},promise:function(obj){return typeof obj==="object"?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];a.style.cssText="top:1px;float:left;opacity:.5";if(!all||!all.length||!a){return{}}select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];support={leadingWhitespace:div.firstChild.nodeType===3,tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:a.getAttribute("href")==="/a",opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:input.value==="on",optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:document.compatMode==="CSS1Compat",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=false}if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=false});div.cloneNode(true).fireEvent("onclick");div.detachEvent("onclick",clickFn)}input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);if(div.attachEvent){for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;isSupported=eventName in div;if(!isSupported){div.setAttribute(eventName,"return;");isSupported=typeof div[eventName]==="function"}support[i+"Bubbles"]=isSupported}}jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=tds[0].offsetHeight===0;tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&tds[0].offsetHeight===0;div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";support.boxSizing=div.offsetWidth===4;support.doesNotIncludeMarginInBodyOffset=body.offsetTop!==1;if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=document.createElement("div");marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";div.appendChild(marginDiv);support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}if(typeof div.style.zoom!=="undefined"){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=div.offsetWidth===3;div.style.display="block";div.style.overflow="visible";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=div.offsetWidth!==3;container.style.zoom=1}body.removeChild(container);container=div=tds=marginDiv=null});fragment.removeChild(div);all=a=select=opt=input=fragment=div=null;return support}();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||!pvt&&!cache[id].data)&&getByName&&data===undefined){return}if(!id){if(isNode){elem[internalKey]=id=jQuery.deletedIds.pop()||++jQuery.uuid}else{id=internalKey}}if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]]}if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=null}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true)},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];
return!noData||noData!==true&&elem.getAttribute("classid")===noData}});jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++){name=attr[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name])}}jQuery._data(elem,"parsedAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}parts=key.split(".",2);parts[1]=parts[1]?"."+parts[1]:"";part=parts[1]+"!";return jQuery.access(this,function(value){if(value===undefined){data=this.triggerHandler("getData"+part,[parts[0]]);if(data===undefined&&elem){data=jQuery.data(elem,key);data=dataAttr(elem,key,data)}return data===undefined&&parts[1]?this.data(parts[0]):data}parts[1]=value;this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts);jQuery.data(this,key,value);self.triggerHandler("changeData"+part,parts)})},null,value,arguments.length>1,null,false)},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",true);jQuery.removeData(elem,key,true)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(value&&typeof value==="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(!~setClass.indexOf(" "+classNames[c]+" ")){setClass+=classNames[c]+" "}}elem.className=jQuery.trim(setClass)}}}}return this},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(value&&typeof value==="string"||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++){while(className.indexOf(" "+removes[c]+" ")>-1){className=className.replace(" "+removes[c]+" "," ")}}elem.className=value?jQuery.trim(className):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while(className=classNames[i++]){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className)}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className)}this.className=this.className||value===false?"":jQuery._data(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>-1){return true}}return false},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,self.val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0){return null}i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}if(one&&!values.length&&options.length){return jQuery(options[index]).val()}return values},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0});if(!values.length){elem.selectedIndex=-1}return values}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(pass&&jQuery.isFunction(jQuery.fn[name])){return jQuery(elem)[name](value)}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value)}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,""+value);return value}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=elem.getAttribute(name);return ret===null?undefined:ret}},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;isBool=rboolean.test(name);if(!isBool){jQuery.attr(elem,name,"")}elem.removeAttribute(getSetAttribute?name:propName);if(isBool&&propName in elem){elem[propName]=false}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed")}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name)}return name in elem?elem.value:null},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name)}elem.value=value}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{return elem[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{return elem[name]}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined}}}});boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name)}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true}elem.setAttribute(name,name.toLowerCase())}return name}};if(!getSetAttribute){fixSpecified={name:true,id:true,coords:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret)}return ret.value=value+""}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}})});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false"}nodeHook.set(elem,value,name)}}}if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret}})})}if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined},set:function(elem,value){return elem.style.cssText=""+value}}}if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}})}if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding"}if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}})}jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}})});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1")};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}events=elemData.events;if(!events){elemData.events=events={}}eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery.removeData(elem,"events",true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return}var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return}event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true)}}return}event.result=undefined;if(!event.target){event.target=elem}data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return}eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur}if(old===(elem.ownerDocument||document)){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType])}}for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&(type!=="focus"&&type!=="blur"||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=(jQuery._data(this,"events")||{})[event.type]||[],delegateCount=handlers.delegateCount,args=[].slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}if(delegateCount&&!(event.button&&event.type==="click")){for(cur=event.target;cur!=this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){selMatch={};matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=jQuery(sel,this).index(cur)>=0}if(selMatch[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,matches:matches})}}}}if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)})}for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||!event.namespace&&!handleObj.namespace||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};function returnFalse(){return false}function returnTrue(){return true}jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"_submit_attached")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true});jQuery._data(form,"_submit_attached",true)}})},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true)}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false}jQuery.event.simulate("change",this,event,true)})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true)}});jQuery._data(elem,"_change_attached",true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=="radio"&&elem.type!=="checkbox"){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName)}}}if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length==1?this.off(selector,"**"):this.off(types,selector||"**",fn)},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true)}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false};toggler.guid=guid;while(i<args.length){args[i++].guid=guid}return this.click(toggler)},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null}return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)};if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks}if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks}});(function(window,undefined){var dirruns,cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,baseHasDuplicate=true,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),document=window.document,docElem=document.documentElement,done=0,slice=[].slice,push=[].push,markFunction=function(fn,value){fn[expando]=value||true;return fn},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){if(keys.push(key)>Expr.cacheLength){delete cache[keys.shift()]}return cache[key]=value},cache)},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),NAME:new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),POS:new RegExp(pos,"ig"),needsContext:new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");
try{return fn(div)}catch(e){return false}finally{div=null}},assertTagNameNoComments=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length}),assertHrefNotNormalized=assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#"}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string"}),assertUsableClassName=assert(function(div){div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!div.getElementsByClassName||!div.getElementsByClassName("e").length){return false}div.lastChild.className="e";return div.getElementsByClassName("e").length===2}),assertUsableName=assert(function(div){div.id=expando+0;div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>";docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+document.getElementsByName(expando+0).length;assertGetIdNotName=!document.getElementById(expando);docElem.removeChild(div);return pass});try{slice.call(docElem.childNodes,0)[0].nodeType}catch(e){slice=function(i){var elem,results=[];for(;elem=this[i];i++){results.push(elem)}return results}}function Sizzle(selector,context,results,seed){results=results||[];context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(nodeType!==1&&nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}xml=isXML(context);if(!xml&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,slice.call(context.getElementsByTagName(selector),0));return results}else if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName){push.apply(results,slice.call(context.getElementsByClassName(m),0));return results}}}return select(selector,context,results,seed,xml)}Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}}else{for(;node=elem[i];i++){ret+=getText(node)}}return ret};isXML=Sizzle.isXML=function isXML(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup))}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode){if(b===a){return true}}return false};Sizzle.attr=function(elem,name){var attr,xml=isXML(elem);if(!xml){name=name.toLowerCase()}if(Expr.attrHandle[name]){return Expr.attrHandle[name](elem)}if(assertAttributes||xml){return elem.getAttribute(name)}attr=elem.getAttributeNode(name);return attr?typeof elem[name]==="boolean"?elem[name]?name:null:attr.specified?attr.value:null:null};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,order:new RegExp("ID|TAG"+(assertUsableName?"|NAME":"")+(assertUsableClassName?"|CLASS":"")),attrHandle:assertHrefNotNormalized?{}:{href:function(elem){return elem.getAttribute("href",2)},type:function(elem){return elem.getAttribute("type")}},find:{ID:assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[]}},TAG:assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;elem=results[i];i++){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results},NAME:function(tag,context){if(typeof context.getElementsByName!==strundefined){return context.getElementsByName(name)}},CLASS:function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml){return context.getElementsByClassName(className)}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(rbackslash,"");match[3]=(match[4]||match[5]||"").replace(rbackslash,"");if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0])}match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd"));match[4]=+(match[6]+match[7]||match[2]==="odd")}else if(match[2]){Sizzle.error(match[0])}return match},PSEUDO:function(match,context,xml){var unquoted,excess;if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[3]}else if(unquoted=match[4]){if(rpseudo.test(unquoted)&&(excess=tokenize(unquoted,context,xml,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){unquoted=unquoted.slice(0,excess);match[0]=match[0].slice(0,excess)}match[2]=unquoted}return match.slice(0,3)}},filter:{ID:assertGetIdNotName?function(id){id=id.replace(rbackslash,"");return function(elem){return elem.getAttribute("id")===id}}:function(id){id=id.replace(rbackslash,"");return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id}},TAG:function(nodeName){if(nodeName==="*"){return function(){return true}}nodeName=nodeName.replace(rbackslash,"").toLowerCase();return function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[expando][className];if(!pattern){pattern=classCache(className,new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))}return function(elem){return pattern.test(elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")}},ATTR:function(name,operator,check){if(!operator){return function(elem){return Sizzle.attr(elem,name)!=null}}return function(elem){var result=Sizzle.attr(elem,name),value=result+"";if(result==null){return operator==="!="}switch(operator){case"=":return value===check;case"!=":return value!==check;case"^=":return check&&value.indexOf(check)===0;case"*=":return check&&value.indexOf(check)>-1;case"$=":return check&&value.substr(value.length-check.length)===check;case"~=":return(" "+value+" ").indexOf(check)>-1;case"|=":return value===check||value.substr(0,check.length+1)===check+"-"}}},CHILD:function(type,argument,first,last){if(type==="nth"){var doneName=done++;return function(elem){var parent,diff,count=0,node=elem;if(first===1&&last===0){return true}parent=elem.parentNode;if(parent&&(parent[expando]!==doneName||!elem.sizset)){for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.sizset=++count;if(node===elem){break}}}parent[expando]=doneName}diff=elem.sizset-last;if(first===0){return diff===0}else{return diff%first===0&&diff/first>=0}}}return function(elem){var node=elem;switch(type){case"only":case"first":while(node=node.previousSibling){if(node.nodeType===1){return false}}if(type==="first"){return true}node=elem;case"last":while(node=node.nextSibling){if(node.nodeType===1){return false}}return true}}},PSEUDO:function(pseudo,argument,context,xml){var args,fn=Expr.pseudos[pseudo]||Expr.pseudos[pseudo.toLowerCase()];if(!fn){Sizzle.error("unsupported pseudo: "+pseudo)}if(!fn[expando]){if(fn.length>1){args=[pseudo,pseudo,"",argument];return function(elem){return fn(elem,0,args)}}return fn}return fn(argument,context,xml)}},pseudos:{not:markFunction(function(selector,context,xml){var matcher=compile(selector.replace(rtrim,"$1"),context,xml);return function(elem){return!matcher(elem)}}),enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},parent:function(elem){return!Expr.pseudos["empty"](elem)},empty:function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4){return false}elem=elem.nextSibling}return true},contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),header:function(elem){return rheader.test(elem.nodeName)},text:function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type)},radio:createInputPseudo("radio"),checkbox:createInputPseudo("checkbox"),file:createInputPseudo("file"),password:createInputPseudo("password"),image:createInputPseudo("image"),submit:createButtonPseudo("submit"),reset:createButtonPseudo("reset"),button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},input:function(elem){return rinputs.test(elem.nodeName)},focus:function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&!!(elem.type||elem.href)},active:function(elem){return elem===elem.ownerDocument.activeElement}},setFilters:{first:function(elements,argument,not){return not?elements.slice(1):[elements[0]]},last:function(elements,argument,not){var elem=elements.pop();return not?elements:[elem]},even:function(elements,argument,not){var results=[],i=not?1:0,len=elements.length;for(;i<len;i=i+2){results.push(elements[i])}return results},odd:function(elements,argument,not){var results=[],i=not?0:1,len=elements.length;for(;i<len;i=i+2){results.push(elements[i])}return results},lt:function(elements,argument,not){return not?elements.slice(+argument):elements.slice(0,+argument)},gt:function(elements,argument,not){return not?elements.slice(0,+argument+1):elements.slice(+argument+1)},eq:function(elements,argument,not){var elem=elements.splice(+argument,1);return not?elements:elem}}};function siblingCheck(a,b,ret){if(a===b){return ret}var cur=a.nextSibling;while(cur){if(cur===b){return-1}cur=cur.nextSibling}return 1}sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b)}else if(!aup){return-1}else if(!bup){return 1}while(cur){ap.unshift(cur);cur=cur.parentNode}cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode}al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i])}}return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1)};[0,0].sort(sortOrder);baseHasDuplicate=!hasDuplicate;Sizzle.uniqueSort=function(results){var elem,i=1;hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(;elem=results[i];i++){if(elem===results[i-1]){results.splice(i--,1)}}}return results};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};function tokenize(selector,context,xml,parseOnly){var matched,match,tokens,type,soFar,groups,group,i,preFilters,filters,checkContext=!xml&&context!==document,key=(checkContext?"<s>":"")+selector.replace(rtrim,"$1<s>"),cached=tokenCache[expando][key];if(cached){return parseOnly?0:slice.call(cached,0)}soFar=selector;groups=[];i=0;preFilters=Expr.preFilter;filters=Expr.filter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length);tokens.selector=group}groups.push(tokens=[]);group="";if(checkContext){soFar=" "+soFar}}matched=false;if(match=rcombinators.exec(soFar)){group+=match[0];soFar=soFar.slice(match[0].length);matched=tokens.push({part:match.pop().replace(rtrim," "),string:match[0],captures:match})}for(type in filters){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match,context,xml)))){group+=match[0];soFar=soFar.slice(match[0].length);matched=tokens.push({part:type,string:match.shift(),captures:match})}}if(!matched){break}}if(group){tokens.selector=group}return parseOnly?soFar.length:soFar?Sizzle.error(selector):slice.call(tokenCache(key,groups),0)}function addCombinator(matcher,combinator,context,xml){var dir=combinator.dir,doneName=done++;if(!matcher){matcher=function(elem){return elem===context}}return combinator.first?function(elem){while(elem=elem[dir]){if(elem.nodeType===1){return matcher(elem)&&elem}}}:xml?function(elem){while(elem=elem[dir]){if(elem.nodeType===1){if(matcher(elem)){return elem}}}}:function(elem){var cache,dirkey=doneName+"."+dirruns,cachedkey=dirkey+"."+cachedruns;while(elem=elem[dir]){if(elem.nodeType===1){if((cache=elem[expando])===cachedkey){return elem.sizset}else if(typeof cache==="string"&&cache.indexOf(dirkey)===0){if(elem.sizset){return elem}}else{elem[expando]=cachedkey;if(matcher(elem)){elem.sizset=true;return elem}elem.sizset=false}}}}}function addMatcher(higher,deeper){return higher?function(elem){var result=deeper(elem);return result&&higher(result===true?elem:result)}:deeper}function matcherFromTokens(tokens,context,xml){var token,matcher,i=0;for(;token=tokens[i];i++){if(Expr.relative[token.part]){matcher=addCombinator(matcher,Expr.relative[token.part],context,xml)}else{matcher=addMatcher(matcher,Expr.filter[token.part].apply(null,token.captures.concat(context,xml)))}}return matcher}function matcherFromGroupMatchers(matchers){return function(elem){var matcher,j=0;for(;matcher=matchers[j];j++){if(matcher(elem)){return true}}return false}}compile=Sizzle.compile=function(selector,context,xml){var group,i,len,cached=compilerCache[expando][selector];if(cached&&cached.context===context){return cached}group=tokenize(selector,context,xml);for(i=0,len=group.length;i<len;i++){group[i]=matcherFromTokens(group[i],context,xml)}cached=compilerCache(selector,matcherFromGroupMatchers(group));cached.context=context;cached.runs=cached.dirruns=0;return cached};function multipleContexts(selector,contexts,results,seed){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results,seed)}}function handlePOSGroup(selector,posfilter,argument,contexts,seed,not){var results,fn=Expr.setFilters[posfilter.toLowerCase()];if(!fn){Sizzle.error(posfilter)}if(selector||!(results=seed)){multipleContexts(selector||"*",contexts,results=[],seed)}return results.length>0?fn(results,argument,not):[]}function handlePOS(groups,context,results,seed){var group,part,j,groupLen,token,selector,anchor,elements,match,matched,lastIndex,currentContexts,not,i=0,len=groups.length,rpos=matchExpr["POS"],rposgroups=new RegExp("^"+rpos.source+"(?!"+whitespace+")","i"),setUndefined=function(){var i=1,len=arguments.length-2;for(;i<len;i++){if(arguments[i]===undefined){match[i]=undefined}}};for(;i<len;i++){group=groups[i];part="";elements=seed;for(j=0,groupLen=group.length;j<groupLen;j++){token=group[j];selector=token.string;if(token.part==="PSEUDO"){rpos.exec("");anchor=0;while(match=rpos.exec(selector)){matched=true;lastIndex=rpos.lastIndex=match.index+match[0].length;if(lastIndex>anchor){part+=selector.slice(anchor,match.index);anchor=lastIndex;currentContexts=[context];if(rcombinators.test(part)){if(elements){currentContexts=elements}elements=seed}if(not=rendsWithNot.test(part)){part=part.slice(0,-5).replace(rcombinators,"$&*");anchor++}if(match.length>1){match[0].replace(rposgroups,setUndefined)}elements=handlePOSGroup(part,match[1],match[2],currentContexts,elements,not)}part=""}}if(!matched){part+=selector}matched=false}if(part){if(rcombinators.test(part)){multipleContexts(part,elements||[context],results,seed)}else{Sizzle(part,context,results,seed?seed.concat(elements):elements)}}else{push.apply(results,elements)}}return len===1?results:Sizzle.uniqueSort(results)}function select(selector,context,results,seed,xml){selector=selector.replace(rtrim,"$1");var elements,matcher,cached,elem,i,tokens,token,lastToken,findContext,type,match=tokenize(selector,context,xml),contextNodeType=context.nodeType;if(matchExpr["POS"].test(selector)){return handlePOS(match,context,results,seed)}if(seed){elements=slice.call(seed,0)}else if(match.length===1){if((tokens=slice.call(match[0],0)).length>2&&(token=tokens[0]).part==="ID"&&contextNodeType===9&&!xml&&Expr.relative[tokens[1].part]){context=Expr.find["ID"](token.captures[0].replace(rbackslash,""),context,xml)[0];if(!context){return results}selector=selector.slice(tokens.shift().string.length)}findContext=(match=rsibling.exec(tokens[0].string))&&!match.index&&context.parentNode||context;lastToken="";for(i=tokens.length-1;i>=0;i--){token=tokens[i];type=token.part;lastToken=token.string+lastToken;if(Expr.relative[type]){break}if(Expr.order.test(type)){elements=Expr.find[type](token.captures[0].replace(rbackslash,""),findContext,xml);if(elements==null){continue}else{selector=selector.slice(0,selector.length-lastToken.length)+lastToken.replace(matchExpr[type],"");if(!selector){push.apply(results,slice.call(elements,0))}break}}}}if(selector){matcher=compile(selector,context,xml);dirruns=matcher.dirruns++;if(elements==null){elements=Expr.find["TAG"]("*",rsibling.test(selector)&&context.parentNode||context)}for(i=0;elem=elements[i];i++){cachedruns=matcher.runs++;if(matcher(elem)){results.push(elem)}}}return results}if(document.querySelectorAll){(function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[],rbuggyMatches=[":active"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){div.innerHTML="<p test=''></p>";if(div.querySelectorAll("[test^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')")}div.innerHTML="<input type='hidden'/>";if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}});rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));select=function(selector,context,results,seed,xml){if(!seed&&!xml&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(context.nodeType===9){try{push.apply(results,slice.call(context.querySelectorAll(selector),0));return results}catch(qsaError){}}else if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){var groups,i,len,old=context.getAttribute("id"),nid=old||expando,newContext=rsibling.test(selector)&&context.parentNode||context;if(old){nid=nid.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}groups=tokenize(selector,context,xml);nid="[id='"+nid+"']";for(i=0,len=groups.length;i<len;i++){groups[i]=nid+groups[i].selector}try{push.apply(results,slice.call(newContext.querySelectorAll(groups.join(",")),0));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}return oldSelect(selector,context,results,seed,xml)};if(matches){assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle");rbuggyMatches.push(matchExpr["PSEUDO"].source,matchExpr["POS"].source,"!=")}catch(e){}});rbuggyMatches=new RegExp(rbuggyMatches.join("|"));Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,null,null,[elem]).length>0}}})()}Expr.setFilters["nth"]=Expr.setFilters["eq"];Expr.filters=Expr.pseudos;Sizzle.attr=jQuery.attr;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true}}})}ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break}}}}}return ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector)},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector)},is:function(selector){return!!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0)},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break}cur=cur.parentNode}}ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11}function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if(this.length>1&&rparentsprev.test(name)){ret=ret.reverse()}return this.pushStack(ret,name,core_slice.call(arguments).join(","))}});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")"}return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems)},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep})}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return elem===qualifier===keep})}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep)}else{qualifier=jQuery.filter(qualifier,filtered)}}return jQuery.grep(elements,function(elem,i){return jQuery.inArray(elem,qualifier)>=0===keep})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"X<div>","</div>"]}jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.insertBefore(elem,this.firstChild)}})},before:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this)})}if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector)}},after:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)})}if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector)}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem])}if(elem.parentNode){elem.parentNode.removeChild(elem)}}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"))}while(elem.firstChild){elem.removeChild(elem.firstChild)}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(value){if(!isDisconnected(this[0])){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();
self.replaceWith(value.call(this,i,old))})}if(typeof value!=="string"){value=jQuery(value).detach()}return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value)}else{jQuery(parent).append(value)}})}return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this},detach:function(selector){return this.remove(selector,true)},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback)})}if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback)})}if(this[0]){results=jQuery.buildFragment(args,this,scripts);fragment=results.fragment;first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++){callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,true,true))}}fragment=first=null;if(scripts.length){jQuery.each(scripts,function(i,elem){if(elem.src){if(jQuery.ajax){jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:false,global:false,"throws":true})}else{jQuery.error("no ajax")}}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,""))}if(elem.parentNode){elem.parentNode.removeChild(elem)}})}}return this}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag))}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return}if(dest.clearAttributes){dest.clearAttributes()}if(dest.mergeAttributes){dest.mergeAttributes(src)}nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else if(nodeName==="option"){dest.selected=src.defaultSelected}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}else if(nodeName==="script"&&dest.text!==src.text){dest.text=src.text}dest.removeAttribute(jQuery.expando)}jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];context=context||document;context=!context.nodeType&&context[0]||context;context=context.ownerDocument||context;if(args.length===1&&typeof first==="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;fragment=jQuery.fragments[first];cachehit=fragment!==undefined}if(!fragment){fragment=context.createDocumentFragment();jQuery.clean(args,context,fragment,scripts);if(cacheable){jQuery.fragments[first]=cachehit&&fragment}}return{fragment:fragment,cacheable:cacheable}};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1){insert[original](this[0]);return this}else{for(;i<l;i++){elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems)}return this.pushStack(ret,name,insert.selector)}}});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*")}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*")}else{return[]}}function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i])}}}if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i])}}}srcElements=destElements=null;return clone},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment==="undefined"){context=document}for(i=0;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+=""}if(!elem){continue}if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem)}else{safe=safe||createSafeFragment(context);div=context.createElement("div");safe.appendChild(div);elem=elem.replace(rxhtmlTag,"<$1></$2>");tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;depth=wrap[0];div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild}if(!jQuery.support.tbody){hasBody=rtbody.test(elem);tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])}}}if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild)}elem=div.childNodes;div.parentNode.removeChild(div)}}if(elem.nodeType){ret.push(elem)}else{jQuery.merge(ret,elem)}}if(div){elem=div=safe=null}if(!jQuery.support.appendChecked){for(i=0;(elem=ret[i])!=null;i++){if(jQuery.nodeName(elem,"input")){fixDefaultChecked(elem)}else if(typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked)}}}if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type)){return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem)}};for(i=0;(elem=ret[i])!=null;i++){if(!(jQuery.nodeName(elem,"script")&&handleScript(elem))){fragment.appendChild(elem);if(typeof elem.getElementsByTagName!=="undefined"){jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript);ret.splice.apply(ret,[i+1,0].concat(jsTags));i+=jsTags.length}}}}return ret},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey]}else if(elem.removeAttribute){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}jQuery.deletedIds.push(id)}}}}}});(function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else if(browser.webkit){browser.safari=true}jQuery.browser=browser;jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context)}jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context)}return jQuery.fn.init.call(this,selector,context,rootjQuerySub)};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub}})();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,"olddisplay");if(show){if(!values[index]&&elem.style.display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{display=curCSS(elem,"display");if(!values[index]&&display!=="none"){jQuery._data(elem,"olddisplay",display)}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state,fn2){var bool=typeof state==="boolean";if(jQuery.isFunction(state)&&jQuery.isFunction(fn2)){return eventsToggle.apply(this,arguments)}return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(numeric||extra!==undefined){num=parseFloat(val);return numeric||jQuery.isNumeric(num)?num||0:val}return val},swap:function(elem,options,callback){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.call(elem);for(name in options){elem.style[name]=old[name]}return ret}});if(window.getComputedStyle){curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;if(computed){ret=computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret}}else if(document.documentElement.currentStyle){curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft}}return ret===""?"auto":ret}}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true)}if(isBorderBox){if(extra==="content"){val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0}if(extra!=="margin"){val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0}}else{val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;if(extra!=="padding"){val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0}}}return val}function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=true,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox)+"px"}function css_defaultDisplay(nodeName){if(elemdisplay[nodeName]){return elemdisplay[nodeName]}var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close()}elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName));display=curCSS(elem,"display");document.body.removeChild(iframe)}elemdisplay[nodeName]=display;return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){if(elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))){return jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)})}else{return getWidthOrHeight(elem,name,extra)}}},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0)}}});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{display:"inline-block"},function(){if(computed){return curCSS(elem,"marginRight")}})}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth===0&&elem.offsetHeight===0||!jQuery.support.reliableHiddenOffsets&&(elem.style&&elem.style.display||curCSS(elem,"display"))==="none"};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value==="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}var ajaxLocation,ajaxLocParts,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func)){for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*"}list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func)}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=structure===prefilters;for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected)}}}if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected)}return selection}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}if(!this.length){return this}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){if(callback){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}}}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText)});return this};jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f)}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type})}});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings)}else{settings=target;target=jQuery.ajaxSettings}ajaxExtend(target,settings);return target},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match===undefined?null:match},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},abort:function(statusText){statusText=statusText||strAbort;if(transport){transport.abort(statusText)}done(0,statusText);return this}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}if(status>=200&&status<300||status===304){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[ifModifiedKey]=modified}modified=jqXHR.getResponseHeader("Etag");if(modified){jQuery.etag[ifModifiedKey]=modified}}if(status===304){statusText="notmodified";isSuccess=true}else{isSuccess=ajaxConvert(s,response);statusText=isSuccess.state;success=isSuccess.data;error=isSuccess.error;isSuccess=!error}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=""+(nativeStatusText||statusText);if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]]}}else{tmp=map[jqXHR.status];jqXHR.always(tmp)}}return this};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data}ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+(ret===s.url?(rquery.test(s.url)?"&":"?")+"_="+ts:"")}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey])}if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey])}}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}return jqXHR},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type]}}while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;if(s.dataFilter){response=s.dataFilter(response,s.dataType)}if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}for(;current=dataTypes[++i];){if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.splice(i--,0,current)}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}
}}}}prev=current}}return{state:"success",data:response}}var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==false,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;overwritten=window[callbackName];if(replaceInUrl){s.url=url.replace(rjsonp,"$1"+callbackName)}else if(replaceInData){s.data=data.replace(rjsonp,"$1"+callbackName)}else if(hasCallback){s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script)}script=undefined;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(0,1)}}}}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1)}}:false,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&"withCredentials"in xhr})})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password)}else{xhr.open(s.type,s.url,s.async)}if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i]}}if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType)}if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}try{for(i in headers){xhr.setRequestHeader(i,headers[i])}}catch(_){}xhr.send(s.hasContent&&s.data||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle]}}if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml}try{responses.text=xhr.responseText}catch(_){}try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404}else if(status===1223){status=204}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException)}}if(responses){complete(status,statusText,responses,responseHeaders)}};if(!s.async){callback()}else if(xhr.readyState===4){setTimeout(callback,0)}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort)}xhrCallbacks[handle]=callback}xhr.onreadystatechange=callback}},abort:function(){if(callback){callback(0,1)}}}}})}var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,prevScale,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{prevScale=scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit);scale=tween.cur()/target}while(scale!==1&&scale!==prevScale)}tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined},0);return fxNow=jQuery.now()}function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return}}})}function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block"}else{style.zoom=1}}}if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.done(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];if(value===(hidden?"hide":"show")){continue}handled.push(index)}}length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{});if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",true);for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,false,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"||!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing)?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty){anim.stop(true)}};return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)&&!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.interval=13;jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var box,docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,top,left,elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}if((body=doc.body)===elem){return jQuery.offset.bodyOffset(elem)}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return{top:0,left:0}}box=elem.getBoundingClientRect();win=getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;top=box.top+scrollTop-clientTop;left=box.left+scrollLeft-clientLeft;return{top:top,left:left}};jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0}return{top:top,left:left}},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative"}var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||document.body})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery})}return jQuery}(window)})},{}],95:[function(require,module,exports){(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory}else{factory(jQuery)}})(function($){var toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice,nullLowestDeltaTimeout,lowestDelta;if($.event.fixHooks){for(var i=toFix.length;i;){$.event.fixHooks[toFix[--i]]=$.event.mouseHooks}}var special=$.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener){for(var i=toBind.length;i;){this.addEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=handler}$.data(this,"mousewheel-line-height",special.getLineHeight(this));$.data(this,"mousewheel-page-height",special.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var i=toBind.length;i;){this.removeEventListener(toBind[--i],handler,false)}}else{this.onmousewheel=null}$.removeData(this,"mousewheel-line-height");$.removeData(this,"mousewheel-page-height")},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem["offsetParent"in $.fn?"offsetParent":"parent"]();if(!$parent.length){$parent=$("body")}return parseInt($parent.css("fontSize"),10)||parseInt($elem.css("fontSize"),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if("detail"in orgEvent){deltaY=orgEvent.detail*-1}if("wheelDelta"in orgEvent){deltaY=orgEvent.wheelDelta}if("wheelDeltaY"in orgEvent){deltaY=orgEvent.wheelDeltaY}if("wheelDeltaX"in orgEvent){deltaX=orgEvent.wheelDeltaX*-1}if("axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaX=deltaY*-1;deltaY=0}delta=deltaY===0?deltaX:deltaY;if("deltaY"in orgEvent){deltaY=orgEvent.deltaY*-1;delta=deltaY}if("deltaX"in orgEvent){deltaX=orgEvent.deltaX;if(deltaY===0){delta=deltaX*-1}}if(deltaY===0&&deltaX===0){return}if(orgEvent.deltaMode===1){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight;deltaY*=lineHeight;deltaX*=lineHeight}else if(orgEvent.deltaMode===2){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight;deltaY*=pageHeight;deltaX*=pageHeight}absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX));if(!lowestDelta||absDelta<lowestDelta){lowestDelta=absDelta;if(shouldAdjustOldDeltas(orgEvent,absDelta)){lowestDelta/=40}}if(shouldAdjustOldDeltas(orgEvent,absDelta)){delta/=40;deltaX/=40;deltaY/=40}delta=Math[delta>=1?"floor":"ceil"](delta/lowestDelta);deltaX=Math[deltaX>=1?"floor":"ceil"](deltaX/lowestDelta);deltaY=Math[deltaY>=1?"floor":"ceil"](deltaY/lowestDelta);if(special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left;offsetY=event.clientY-boundingRect.top}event.deltaX=deltaX;event.deltaY=deltaY;event.deltaFactor=lowestDelta;event.offsetX=offsetX;event.offsetY=offsetY;event.deltaMode=0;args.unshift(event,delta,deltaX,deltaY);if(nullLowestDeltaTimeout){clearTimeout(nullLowestDeltaTimeout)}nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200);return($.event.dispatch||$.event.handle).apply(this,args)}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&orgEvent.type==="mousewheel"&&absDelta%120===0}})},{}],96:[function(require,module,exports){(function(global){(function(){var undefined;var VERSION="4.14.0";var LARGE_ARRAY_SIZE=200;var FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var PLACEHOLDER="__lodash_placeholder__";var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,FLIP_FLAG=512;var UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=150,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",ARY_FLAG],["bind",BIND_FLAG],["bindKey",BIND_KEY_FLAG],["curry",CURRY_FLAG],["curryRight",CURRY_RIGHT_FLAG],["flip",FLIP_FLAG],["partial",PARTIAL_FLAG],["partialRight",PARTIAL_RIGHT_FLAG],["rearg",REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",promiseTag="[object Promise]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reBasicWord=/[a-zA-Z0-9]+/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reHasHexPrefix=/^0x/i;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f\\ufe20-\\ufe23",rsComboSymbolsRange="\\u20d0-\\u20f0",rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="['’]",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboMarksRange+rsComboSymbolsRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsLowerMisc="(?:"+rsLower+"|"+rsMisc+")",rsUpperMisc="(?:"+rsUpper+"|"+rsMisc+")",rsOptLowerContr="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptUpperContr="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reComplexSymbol=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reComplexWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptLowerContr+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsUpperMisc+"+"+rsOptUpperContr+"(?="+[rsBreak,rsUpper+rsLowerMisc,"$"].join("|")+")",rsUpper+"?"+rsLowerMisc+"+"+rsOptLowerContr,rsUpper+"+"+rsOptUpperContr,rsDigits,rsEmoji].join("|"),"g");var reHasComplexSymbol=RegExp("["+rsZWJ+rsAstralRange+rsComboMarksRange+rsComboSymbolsRange+rsVarRange+"]");var reHasComplexWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;
var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=freeGlobal&&typeof exports=="object"&&exports;var freeModule=freeExports&&typeof module=="object"&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function addSetEntry(set,value){set.add(value);return set}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array?array.length:0;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array?array.length:0;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array?array.length:0;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array?array.length:0;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array?array.length:0,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array?array.length:0;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array?array.length:0;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array?array.length:0,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array?array.length:0;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array?array.length:0;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){if(value!==value){return baseFindIndex(array,baseIsNaN,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array?array.length:0;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){result++}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function stringSize(string){if(!(string&&reHasComplexSymbol.test(string))){return string.length}var result=reComplexSymbol.lastIndex=0;while(reComplexSymbol.test(string)){result++}return result}function stringToArray(string){return string.match(reComplexSymbol)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function runInContext(context){context=context?_.defaults({},context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Math=context.Math,RegExp=context.RegExp,TypeError=context.TypeError;var arrayProto=context.Array.prototype,objectProto=context.Object.prototype,stringProto=context.String.prototype;var coreJsData=context["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var funcToString=context.Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Reflect=context.Reflect,Symbol=context.Symbol,Uint8Array=context.Uint8Array,enumerate=Reflect?Reflect.enumerate:undefined,iteratorSymbol=Symbol?Symbol.iterator:undefined,objectCreate=context.Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;var clearTimeout=function(id){return context.clearTimeout.call(root,id)},setTimeout=function(func,wait){return context.setTimeout.call(root,func,wait)};var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetPrototype=Object.getPrototypeOf,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=Object.keys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReplace=stringProto.replace,nativeReverse=arrayProto.reverse,nativeSplit=stringProto.split;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(context.Object,"create");var defineProperty=function(){var func=getNative(context.Object,"defineProperty"),name=getNative.name;return name&&name.length>2?func:undefined}();var metaMap=WeakMap&&new WeakMap;var nonEnumShadows=!propertyIsEnumerable.call({valueOf:1},"valueOf");var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}}function hashDelete(key){return this.has(key)&&delete this.__data__[key]}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries?entries.length:0;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){return getMapData(this,key)["delete"](key)}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){getMapData(this,key).set(key,value);return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values?values.length:0;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){this.__data__=new ListCache(entries)}function stackClear(){this.__data__=new ListCache}function stackDelete(key){return this.__data__["delete"](key)}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);return this}cache=this.__data__=new MapCache(pairs)}cache.set(key,value);return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function assignInDefaults(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||typeof key=="number"&&value===undefined&&!(key in object)){object[key]=value}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAt(object,paths){var index=-1,isNil=object==null,length=paths.length,result=Array(length);while(++index<length){result[index]=isNil?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){if(isHostObject(value)){return object?value:{}}result=initCloneObject(isFunc?{}:value);if(!isDeep){return copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(!isArr){var props=isFull?getAllKeys(value):keys(value)}arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))});if(!isFull){stack["delete"](value)}return result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}var index=length;while(index--){var key=props[index],predicate=source[key],value=object[key];if(value===undefined&&!(key in Object(object))||!predicate(value)){return false}}return true}function baseCreate(proto){return isObject(proto)?objectCreate(proto):{}}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=isKey(path,object)?[path]:castPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){return objectToString.call(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&(hasOwnProperty.call(object,key)||typeof object=="object"&&key in object&&getPrototype(object)===null)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){if(!isKey(path,object)){path=castPath(path);object=parent(object,path);path=last(path)}var func=object==null?object:object[toKey(path)];return func==null?undefined:apply(func,object,args)}function baseIsArrayBuffer(value){return isObjectLike(value)&&objectToString.call(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&objectToString.call(value)==dateTag}function baseIsEqual(value,other,customizer,bitmask,stack){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,bitmask,stack)}function baseIsEqualDeep(object,other,equalFunc,customizer,bitmask,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=getTag(object);objTag=objTag==argsTag?objectTag:objTag}if(!othIsArr){othTag=getTag(other);othTag=othTag==argsTag?objectTag:othTag}var objIsObj=objTag==objectTag&&!isHostObject(object),othIsObj=othTag==objectTag&&!isHostObject(other),isSameTag=objTag==othTag;if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,equalFunc,customizer,bitmask,stack):equalByTag(object,other,objTag,equalFunc,customizer,bitmask,stack)}if(!(bitmask&PARTIAL_COMPARE_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,customizer,bitmask,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,equalFunc,customizer,bitmask,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObject(value)&&objectToString.call(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}var baseKeys=overArg(nativeKeys,Object);function baseKeysIn(object){object=object==null?object:Object(object);var result=[];for(var key in object){result.push(key)}return result}if(enumerate&&!propertyIsEnumerable.call({valueOf:1},"valueOf")){baseKeysIn=function(object){return iteratorToArray(enumerate(object))}}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,undefined,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}if(!(isArray(source)||isTypedArray(source))){var props=keysIn(source)}arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key]}if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}})}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){newValue=srcValue;if(isArray(srcValue)||isTypedArray(srcValue)){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else{isCommon=false;newValue=baseClone(srcValue,true)}}else if(isPlainObject(srcValue)||isArguments(srcValue)){if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){isCommon=false;newValue=baseClone(srcValue,true)}else{newValue=objValue}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,props){object=Object(object);return basePickBy(object,props,function(value,key){return key in object})}function basePickBy(object,props,predicate){var index=-1,length=props.length,result={};while(++index<length){var key=props[index],value=object[key];if(predicate(value,key)){result[key]=value}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else if(!isKey(index,array)){var path=castPath(index),object=parent(array,path);if(object!=null){delete object[toKey(last(path))]}}else{delete array[toKey(index)]
}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=array;return apply(func,this,otherArgs)}}function baseSet(object,path,value,customizer){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]);if(isObject(nested)){var newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=objValue==null?isIndex(path[index+1])?[]:{}:objValue}}assignValue(nested,key,newValue)}nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=isKey(path,object)?[path]:castPath(path);object=parent(object,path);var key=toKey(last(path));return!(object!=null&&baseHas(object,key))||delete object[key]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var index=-1,length=arrays.length;while(++index<length){var result=result?arrayPush(baseDifference(result,arrays[index],iteratee,comparator),baseDifference(arrays[index],result,iteratee,comparator)):arrays[index]}return result&&result.length?baseUniq(result,iteratee,comparator):[]}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value){return isArray(value)?value:stringToPath(value)}function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var result=new buffer.constructor(buffer.length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),true):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),true):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue)}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=reHasComplexSymbol.test(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return baseRest(function(funcs){funcs=baseFlatten(funcs,1);var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurried=bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG),isFlip=bitmask&FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return baseRest(function(iteratees){iteratees=iteratees.length==1&&isArray(iteratees[0])?arrayMap(iteratees[0],baseUnary(getIteratee())):arrayMap(baseFlatten(iteratees,1),baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return reHasComplexSymbol.test(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toNumber(start);start=start===start?start:0;if(end===undefined){end=start;start=0}else{end=toNumber(end)||0}step=step===undefined?start<end?1:-1:toNumber(step)||0;return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!(bitmask&CURRY_BOUND_FLAG)){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=nativeMin(toInteger(precision),292);if(precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]==null?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG)){bitmask&=~(CURRY_FLAG|CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==CURRY_FLAG||bitmask==CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function equalArrays(array,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&UNORDERED_COMPARE_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!seen.has(othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack))){return seen.add(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack))){result=false;break}}stack["delete"](array);return result}function equalByTag(object,other,tag,equalFunc,customizer,bitmask,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&PARTIAL_COMPARE_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=UNORDERED_COMPARE_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),equalFunc,customizer,bitmask,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:baseHas(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,customizer,bitmask,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);return result}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}var getLength=baseProperty("length");function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}var getPrototype=overArg(nativeGetPrototype,Object);var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):stubArray;var getSymbolsIn=!nativeGetSymbols?getSymbols:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):undefined;if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=isKey(path,object)?[path]:castPath(path);var result,index=-1,length=path.length;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result){return result}var length=object?object.length:0;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isString(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object,isDeep,cloneFunc);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object,isDeep,cloneFunc);case symbolTag:return cloneSymbol(object)}}function indexKeys(object){var length=object?object.length:undefined;if(isLength(length)&&(isArray(object)||isString(object)||isArguments(object))){return baseTimes(length,String)}return null}function insertWrapDetails(source,details){var length=details.length,lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(BIND_FLAG|BIND_KEY_FLAG|ARY_FLAG);var isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&source[7].length<=source[8]&&bitmask==CURRY_FLAG;if(!(isCommon||isCombo)){return data
}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function mergeDefaults(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,mergeDefaults,stack);stack["delete"](srcValue)}return objValue}function parent(object,path){return path.length==1?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key}}else{count=0}return baseSetData(key,value)}}();var setWrapToString=!defineProperty?identity:function(wrapper,reference,bitmask){var source=reference+"";return defineProperty(wrapper,"toString",{configurable:true,enumerable:false,value:constant(insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))})};var stringToPath=memoize(function(string){var result=[];toString(string).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array?array.length:0;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array?array.length:0,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length,args=Array(length?length-1:0),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return length?arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1)):[]}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array?array.length:0;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array?array.length:0;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs?pairs.length:0,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){return dropRight(array,1)}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(comparator===last(mapped)){comparator=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array?nativeJoin.call(array,separator):""}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=(index<0?nativeMax(length+index,0):nativeMin(index,length-1))+1}if(value!==value){return baseFindIndex(array,baseIsNaN,index-1,true)}while(index--){if(array[index]===value){return index}}return-1}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=baseRest(function(array,indexes){indexes=baseFlatten(indexes,1);var length=array?array.length:0,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array?nativeReverse.call(array):array}function slice(array,start,end){var length=array?array.length:0;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){return drop(array,1)}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=baseRest(function(paths){paths=baseFlatten(paths,1);var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{result[key]=[value]}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){var func=isFunc?path:isProp&&value!=null?value[path]:undefined;result[++index]=func?apply(func,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){result[key]=value});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined}function sampleSize(collection,n,guard){var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=baseClamp(toInteger(n),0,length)}while(++index<n){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index];result[index]=value}result.length=n;return result}function shuffle(collection){return sampleSize(collection,MAX_ARRAY_LENGTH)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){var result=collection.length;return result&&isString(collection)?stringSize(collection):result}if(isObjectLike(collection)){var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}}return keys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});function now(){return Date.now()}function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=baseRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=baseRest(function(func,indexes){return createWrap(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes,1))});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return partial(wrapper,value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,false,true)}function cloneWith(value,customizer){return baseClone(value,false,true,customizer)}function cloneDeep(value){return baseClone(value,true,true)}function cloneDeepWith(value,customizer){return baseClone(value,true,true,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(getLength(value))&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&objectToString.call(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return!!value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value)}function isEmpty(value){if(isArrayLike(value)&&(isArray(value)||isString(value)||isFunction(value.splice)||isArguments(value)||isBuffer(value))){return!value.length}if(isObjectLike(value)){var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return!(nonEnumShadows&&keys(value).length)}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}return objectToString.call(value)==errorTag||typeof value.message=="string"&&typeof value.name=="string"}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error("This method is not supported with core-js. Try https://github.com/es-shims.")}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&objectToString.call(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&objectToString.call(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(iteratorSymbol&&value[iteratorSymbol]){return iteratorToArray(value[iteratorSymbol]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value
}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER)}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keysIn(source),object);return}for(var key in source){assignValue(object,key,source[key])}});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=baseRest(function(object,paths){return baseAt(object,baseFlatten(paths,1))});function create(prototype,properties){var result=baseCreate(prototype);return properties?baseAssign(result,properties):result}var defaults=baseRest(function(args){args.push(undefined,assignInDefaults);return apply(assignInWith,undefined,args)});var defaultsDeep=baseRest(function(args){args.push(undefined,mergeDefaults);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){var isProto=isPrototype(object);if(!(isProto||isArrayLike(object))){return baseKeys(object)}var indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;for(var key in object){if(baseHas(object,key)&&!(skipIndexes&&(key=="length"||isIndex(key,length)))&&!(isProto&&key=="constructor")){result.push(key)}}return result}function keysIn(object){var index=-1,isProto=isPrototype(object),props=baseKeysIn(object),propsLength=props.length,indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;while(++index<propsLength){var key=props[index];if(!(skipIndexes&&(key=="length"||isIndex(key,length)))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[iteratee(value,key,object)]=value});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object)});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=baseRest(function(object,props){if(object==null){return{}}props=arrayMap(baseFlatten(props,1),toKey);return basePick(object,baseDifference(getAllKeysIn(object),props))});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=baseRest(function(object,props){return object==null?{}:basePick(object,arrayMap(baseFlatten(props,1),toKey))});function pickBy(object,predicate){return object==null?{}:basePickBy(object,getAllKeysIn(object),getIteratee(predicate))}function result(object,path,defaultValue){path=isKey(path,object)?[path]:castPath(path);var index=-1,length=path.length;if(!length){object=undefined;length=1}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[]}else{accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}}else{accumulator={}}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object?baseValues(object,keys(object)):[]}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toNumber(start)||0;if(end===undefined){end=start;start=0}else{end=toNumber(end)||0}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toNumber(lower)||0;if(upper===undefined){upper=lower;lower=0}else{upper=toNumber(upper)||0}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}string=toString(string).replace(reTrim,"");return nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:nativeReplace.call(string,args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(separator==""&&reHasComplexSymbol.test(string)){return castSlice(stringToArray(string),0,limit)}}return nativeSplit.call(string,separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,assignInDefaults);var imports=assignInWith({},options.imports,settings.imports,assignInDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(reHasComplexSymbol.test(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){pattern=reHasComplexWord.test(string)?reComplexWord:reBasicWord}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=baseRest(function(object,methodNames){arrayEach(baseFlatten(methodNames,1),function(key){key=toKey(key);object[key]=bind(object[key],object)});return object});function cond(pairs){var length=pairs?pairs.length:0,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,true))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,true))}function matches(source){return baseMatches(baseClone(source,true))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,true))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(value))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index){return new LazyWrapper(this)}n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.clone();if(filtered){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();
return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(iteratorSymbol){lodash.prototype[iteratorSymbol]=wrapperToIterator}return lodash}var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],97:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==="[object Array]"}function isObject(input){return input!=null&&Object.prototype.toString.call(input)==="[object Object]"}function isObjectEmpty(obj){var k;for(k in obj){return false}return true}function isNumber(input){return typeof value==="number"||Object.prototype.toString.call(input)==="[object Number]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}var some;if(Array.prototype.some){some=Array.prototype.some}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true}}return false}}var some$1=some;function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some$1.call(flags.parsedDateParts,function(i){return i!=null});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid}else{return isNowValid}}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}function isUndefined(input){return input===void 0}var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject}if(!isUndefined(from._i)){to._i=from._i}if(!isUndefined(from._f)){to._f=from._f}if(!isUndefined(from._l)){to._l=from._l}if(!isUndefined(from._strict)){to._strict=from._strict}if(!isUndefined(from._tzm)){to._tzm=from._tzm}if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC}if(!isUndefined(from._offset)){to._offset=from._offset}if(!isUndefined(from._pf)){to._pf=getParsingFlags(from)}if(!isUndefined(from._locale)){to._locale=from._locale}if(momentProperties.length>0){for(i in momentProperties){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)||0}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function warn(msg){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg)}if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg="";if(typeof arguments[i]==="object"){arg+="\n["+i+"] ";for(var key in arguments[0]){arg+=key+": "+arguments[0][key]+", "}arg=arg.slice(0,-2)}else{arg=arguments[i]}args.push(arg)}warn(msg+"\nArguments: "+Array.prototype.slice.call(args).join("")+"\n"+(new Error).stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg)}if(!deprecations[name]){warn(msg);deprecations[name]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==="[object Function]"}function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop}else{this["_"+i]=prop}}this._config=config;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop])}else if(childConfig[prop]!=null){res[prop]=childConfig[prop]}else{delete res[prop]}}}for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop])}}return res}function Locale(config){if(config!=null){this.set(config)}}var keys;if(Object.keys){keys=Object.keys}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i)}}return res}}var keys$1=keys;var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar["sameElse"];return isFunction(output)?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return isFunction(format)?format(output):format.replace(/%s/i,output)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]})}units.sort(function(a,b){return a.priority-b.priority});return units}function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this}else{return get(this,unit)}}}function get(mom,unit){return mom.isValid()?mom._d["get"+(mom._isUTC?"UTC":"")+unit]():NaN}function set$1(mom,unit,value){if(mom.isValid()){mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}}function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]()}return this}function stringSet(units,value){if(typeof units==="object"){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit])}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value)}}return this}function zeroFill(number,targetLength,forceSign){var absNumber=""+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?"+":"":"-")+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="",i;for(i=0;i<length;i++){output+=array[i]instanceof Function?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return regexEscape(s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i}}return-1}}var indexOf$1=indexOf;function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",function(isStrict,locale){return locale.monthsShortRegex(isStrict)});addRegexToken("MMMM",function(isStrict,locale){return locale.monthsRegex(isStrict)});addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m,format){if(!m){return this._months}return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?"format":"standalone"][m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m,format){if(!m){return this._monthsShort}return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?"format":"standalone"][m.month()]}function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(mom,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,"").toLocaleLowerCase()}}if(strict){if(format==="MMM"){ii=indexOf$1.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._longMonthsParse,llc);return ii!==-1?ii:null}}else{if(format==="MMM"){ii=indexOf$1.call(this._shortMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._longMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._longMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}}}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom}if(typeof value==="string"){if(/^\d+$/.test(value)){value=toInt(value)}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom}}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=defaultMonthsShortRegex}return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex}}var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(isStrict){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=defaultMonthsRegex}return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2e3,i]);shortPieces.push(this.monthsShort(mom,""));longPieces.push(this.months(mom,""));mixedPieces.push(this.months(mom,""));mixedPieces.push(this.monthsShort(mom,""))}shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i])}for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i])}this._monthsRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i")}addFormatToken("Y",0,0,function(){var y=this.year();return y<=9999?""+y:"+"+y});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYYY","YYYYYY"],YEAR);addParseToken("YYYY",function(input,array){array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input)});addParseToken("YY",function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input)});addParseToken("Y",function(input,array){array[YEAR]=parseInt(input,10)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<100&&y>=0&&isFinite(date.getFullYear())){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<100&&y>=0&&isFinite(date.getUTCFullYear())){date.setUTCFullYear(y)}return date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year)}else{resYear=year;resDayOfYear=dayOfYear}return{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy)}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1}else{resYear=mom.year();resWeek=week}return{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)});addRegexToken("ddd",function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)});addRegexToken("dddd",function(isStrict,locale){return locale.weekdaysRegex(isStrict)});addWeekParseToken(["dd","ddd","dddd"],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=="string"){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==="number"){return input}return null}function parseIsoWeekday(input,locale){if(typeof input==="string"){return locale.weekdaysParse(input)%7||7}return isNaN(input)?null:input}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m,format){if(!m){return this._weekdays}return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?"format":"standalone"][m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return m?this._weekdaysShort[m.day()]:this._weekdaysShort}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return m?this._weekdaysMin[m.day()]:this._weekdaysMin}function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,"").toLocaleLowerCase()}}if(strict){if(format==="dddd"){ii=indexOf$1.call(this._weekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf$1.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}}else{if(format==="dddd"){ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else if(format==="ddd"){ii=indexOf$1.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf$1.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf$1.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}}}function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(mom,"").replace(".",".?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(mom,"").replace(".",".?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(mom,"").replace(".",".?")+"$","i")}if(!this._weekdaysParse[i]){regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="dddd"&&this._fullWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="ddd"&&this._shortWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==="dd"&&this._minWeekdaysParse[i].test(weekdayName)){return i}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}else{return this.day()||7}}var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=defaultWeekdaysRegex}return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex}}var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=defaultWeekdaysShortRegex}return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=defaultWeekdaysMinRegex}return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2e3,1]).day(i);minp=this.weekdaysMin(mom,"");shortp=this.weekdaysShort(mom,"");longp=this.weekdays(mom,"");minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp)}minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i])}this._weekdaysRegex=new RegExp("^("+mixedPieces.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+longPieces.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+shortPieces.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+minPieces.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24
}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addRegexToken("hmm",match3to4);addRegexToken("hmmss",match5to6);addRegexToken("Hmm",match3to4);addRegexToken("Hmmss",match5to6);addParseToken(["H","HH"],HOUR);addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});addParseToken("hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true});addParseToken("hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true});addParseToken("Hmm",function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos))});addParseToken("Hmmss",function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2))});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,ordinalParse:defaultOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;require("./locale/"+name);getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}}return globalLocale._abbr}function defineLocale(name,config){if(config!==null){var parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");parentConfig=locales[name]._config}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[]}localeFamilies[config.parentLocale].push({name:name,config:config});return null}}locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config)})}getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function updateLocale(name,config){if(config!=null){var locale,parentConfig=baseConfig;if(locales[name]!=null){parentConfig=locales[name]._config}config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name)}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale}else if(locales[name]!=null){delete locales[name]}}}return locales[name]}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}function listLocales(){return keys$1(locales)}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK}if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY}getParsingFlags(m).overflow=overflow}return m}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var isoTimes=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break}}if(dateFormat==null){config._isValid=false;return}if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||" ")+isoTimes[i][0];break}}if(timeFormat==null){config._isValid=false;return}}if(!allowTime&&timeFormat!=null){config._isValid=false;return}if(match[4]){if(tzRegex.exec(match[4])){tzFormat="Z"}else{config._isValid=false;return}}config._f=dateFormat+(timeFormat||"")+(tzFormat||"");configFromStringAndFormat(config)}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid;hooks.createFromInputFallback(config)}}hooks.createFromInputFallback=deprecate("value provided is not in a recognized ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]}return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true}}else{weekday=dow}}if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}}hooks.ISO_8601=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)});configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||format===undefined&&input===""){return createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isDate(input)){config._d=input}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else{configFromInput(config)}if(!isValid(config)){config._d=null}return config}function configFromInput(config){var input=config._i;if(input===undefined){config._d=new Date(hooks.now())}else if(isDate(input)){config._d=new Date(input.valueOf())}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(typeof input==="object"){configFromObject(config)}else if(isNumber(input)){config._d=new Date(input)}else{hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined}if(isObject(input)&&isObjectEmpty(input)||isArray(input)&&input.length===0){input=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other}else{return createInvalid()}});var prototypeMax=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other}else{return createInvalid()}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}var now=function(){return Date.now?Date.now():+new Date};function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*1e3*60*60;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){if(number<0){return Math.round(-1*number)*-1}else{return Math.round(number)}}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchShortOffset);addRegexToken("ZZ",matchShortOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||"").match(matcher);if(matches===null){return null}var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res}else{return createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN}if(input!=null){if(typeof input==="string"){input=offsetFromString(matchShortOffset,input);if(input===null){return this}}else if(Math.abs(input)<16){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm)}else if(typeof this._i==="string"){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(input){if(!this.isValid()){return false}input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var aspNetRegex=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(isNumber(input)){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1e3))*sign}}else if(!!(match=isoRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}createDuration.fn=Duration.prototype;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0}}other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return}updateOffset=updateOffset==null?true:updateOffset;if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding)}if(days){set$1(mom,"Date",get(mom,"Date")+days*isAdding)}if(months){setMonth(mom,get(mom,"Month")+months*isAdding)}if(updateOffset){hooks.updateOffset(mom,days||months)}}var add=createAdder(1,"add");var subtract=createAdder(-1,"subtract");function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,"days",true);return diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse"}function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf("day"),format=hooks.calendarFormat(this,sod)||"sameElse";var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()>localInput.valueOf()}else{return localInput.valueOf()<this.clone().startOf(units).valueOf()}}function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:"millisecond");if(units==="millisecond"){return this.valueOf()<localInput.valueOf()}else{return this.clone().endOf(units).valueOf()<localInput.valueOf()}}function isBetween(from,to,units,inclusivity){inclusivity=inclusivity||"()";return(inclusivity[0]==="("?this.isAfter(from,units):!this.isBefore(from,units))&&(inclusivity[1]===")"?this.isBefore(to,units):!this.isAfter(to,units))}function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(units||"millisecond");if(units==="millisecond"){return this.valueOf()===localInput.valueOf()}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()}}function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units)}function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units)}function diff(input,units,asFloat){var that,zoneDelta,delta,output;if(!this.isValid()){return NaN}that=cloneWithOffset(input,this);if(!that.isValid()){return NaN}zoneDelta=(that.utcOffset()-this.utcOffset())*6e4;units=normalizeUnits(units);if(units==="year"||units==="month"||units==="quarter"){output=monthDiff(this,that);if(units==="quarter"){output=output/3}else if(units==="year"){output=output/12}}else{delta=this-that;output=units==="second"?delta/1e3:units==="minute"?delta/6e4:units==="hour"?delta/36e5:units==="day"?(delta-zoneDelta)/864e5:units==="week"?(delta-zoneDelta)/6048e5:delta}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(){var m=this.clone().utc();if(0<m.year()&&m.year()<=9999){if(isFunction(Date.prototype.toISOString)){return this.toDate().toISOString()}else{return formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}else{return formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var func="moment";var zone="";if(!this.isLocal()){func=this.utcOffset()===0?"moment.utc":"moment.parseZone";zone="Z"}var prefix="["+func+'("]';var year=0<this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var datetime="-MM-DD[T]HH:mm:ss.SSS";var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix)}function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var output=formatMoment(this,inputString);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}if(units==="date"){units="day"}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$1(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)
}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget}return setWeekAll.call(this,input,week,weekday,dow,doy)}}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",match1);addParseToken("Q",function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);var token;for(token="SSSS";token.length<=9;token+="S"){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)}for(token="S";token.length<=9;token+="S"){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$1;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);proto.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(string){return string}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined}format=format||"";if(index!=null){return get$1(format,index,field,"month")}var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,"month")}return out}function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==="boolean"){if(isNumber(format)){index=format;format=undefined}format=format||""}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined}format=format||""}var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,"day")}var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,"day")}return out}function listMonths(format,index){return listMonthsImpl(format,index,"months")}function listMonthsShort(format,index){return listMonthsImpl(format,index,"monthsShort")}function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdays")}function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysShort")}function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,"weekdaysMin")}getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function add$1(input,value){return addSubtract$1(this,input,value,1)}function subtract$1(input,value){return addSubtract$1(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0}data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);return units==="month"?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function valueOf$1(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function get$2(units){units=normalizeUnits(units);return this[units+"s"]()}function makeGetter(name){return function(){return this._data[name]}}var milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<thresholds.s&&["s",seconds]||minutes<=1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours<=1&&["h"]||hours<thresholds.h&&["hh",hours]||days<=1&&["d"]||days<thresholds.d&&["dd",days]||months<=1&&["M"]||months<thresholds.M&&["MM",months]||years<=1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round}if(typeof roundingFunction==="function"){round=roundingFunction;return true}return false}function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;return true}function humanize(withSuffix){var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var abs$1=Math.abs;function toISOString$1(){var seconds=abs$1(this._milliseconds)/1e3;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds;var total=this.asSeconds();if(!total){return"P0D"}return(total<0?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":"")}var proto$2=Duration.prototype;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);proto$2.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});hooks.version="2.16.0";setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;return hooks})},{}],98:[function(require,module,exports){module.exports=pointer;pointer.available=available;var EventEmitter=require("events").EventEmitter,Stream=require("stream").Stream;function available(){return!!shim(document.body)}function pointer(el){var addEventListener=el.addEventListener||el.attachEvent,removeEventListener=el.removeEventListener||el.detachEvent,doc=el.ownerDocument,body=doc.body,requestPointerLock=shim(el),out={dx:0,dy:0,dt:0},eventEmitter=new EventEmitter,stream=null,skipPixelTolerance=4,lastPageX=0,lastPageY=0,biggestMovementX=0,biggestMovementY=0,virtualBuggyX=0,virtualBuggyY=0,buggyX=0,buggyY=0,virtualInfiniteX=0,virtualInfiniteY=0,needsFullscreen=false,mouseDownMS;addEventListener.call(el,"mousedown",onmousedown,false);addEventListener.call(el,"mouseup",onmouseup,false);addEventListener.call(body,"mousemove",onmove,false);var vendors=["","webkit","moz","ms","o"];for(var i=0,len=vendors.length;i<len;++i){addEventListener.call(doc,vendors[i]+"pointerlockchange",onpointerlockchange);addEventListener.call(doc,vendors[i]+"pointerlockerror",onpointerlockerror)}eventEmitter.release=release;eventEmitter.target=pointerlockelement;eventEmitter.request=onmousedown;eventEmitter.destroy=function(){removeEventListener.call(el,"mouseup",onmouseup,false);removeEventListener.call(el,"mousedown",onmousedown,false);removeEventListener.call(el,"mousemove",onmove,false)};if(!shim){setTimeout(function(){eventEmitter.emit("error",new Error("pointer lock is not supported"))},0)}return eventEmitter;function onmousedown(ev){if(pointerlockelement()){return}mouseDownMS=+new Date;requestPointerLock.call(el)}function onmouseup(ev){if(!needsFullscreen){return}eventEmitter.emit("needs-fullscreen");needsFullscreen=false}function onpointerlockchange(ev){biggestMovementX=biggestMovementY=0;if(!pointerlockelement()){if(stream)release();return}stream=new Stream;stream.readable=true;stream.initial={x:lastPageX,y:lastPageY,t:Date.now()};eventEmitter.emit("attain",stream)}function onpointerlockerror(ev){var dt=+new Date-mouseDownMS;if(dt<100){needsFullscreen=true;return}eventEmitter.emit("error");if(stream){stream.emit("error",ev)}stream=null}function release(){eventEmitter.emit("release");if(stream){stream.emit("end");stream.readable=false;stream.emit("close");stream=null}var pel=pointerlockelement();if(!pel){return}(doc.exitPointerLock||doc.mozExitPointerLock||doc.webkitExitPointerLock||doc.msExitPointerLock||doc.oExitPointerLock).call(doc)}function onmove(ev){lastPageX=ev.pageX;lastPageY=ev.pageY;if(!stream)return;var dx=ev.movementX||ev.webkitMovementX||ev.mozMovementX||ev.msMovementX||ev.oMovementX||0;var dy=ev.movementY||ev.webkitMovementY||ev.mozMovementY||ev.msMovementY||ev.oMovementY||0;out.dx=dx;out.dy=dy;out.dt=Date.now()-stream.initial.t;virtualBuggyX+=dx;virtualBuggyY+=dy;var mightHaveFoundBuggyOrigin=false;if(dx>0&&dx>biggestMovementX||dx<0&&dx<-biggestMovementX){biggestMovementX=Math.abs(dx);mightHaveFoundBuggyOrigin=true}if(dy>0&&dy>biggestMovementY||dy<0&&dy<-biggestMovementY){biggestMovementY=Math.abs(dy);mightHaveFoundBuggyOrigin=true}if(mightHaveFoundBuggyOrigin){buggyX=virtualBuggyX;buggyY=virtualBuggyY}if(Math.abs(virtualBuggyX-buggyX)<skipPixelTolerance&&Math.abs(virtualBuggyY-buggyY)<skipPixelTolerance){out.dx=0;out.dy=0}eventEmitter.emit("data",out);stream.emit("data",out)}function pointerlockelement(){return 0||doc.pointerLockElement||doc.mozPointerLockElement||doc.webkitPointerLockElement||doc.msPointerLockElement||doc.oPointerLockElement||null}function setBuggyOrigin(x,y){}}function shim(el){return el.requestPointerLock||el.webkitRequestPointerLock||el.mozRequestPointerLock||el.msRequestPointerLock||el.oRequestPointerLock||null}},{events:89,stream:102}],99:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:100}],100:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;(function(){try{cachedSetTimeout=setTimeout}catch(e){cachedSetTimeout=function(){throw new Error("setTimeout is not defined")}}try{cachedClearTimeout=clearTimeout}catch(e){cachedClearTimeout=function(){throw new Error("clearTimeout is not defined")}}})();var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=cachedSetTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;cachedClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){cachedSetTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],101:[function(require,module,exports){var Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?"block":"none";l=a}var l=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel("FPS","#0ff","#002")),f=h(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var t=h(new Stats.Panel("MB","#f08","#201"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1e3&&(r.update(1e3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};Stats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement("canvas");q.width=r;q.height=f;q.style.cssText="width:80px;height:48px";var b=q.getContext("2d");b.font="bold "+9*a+"px Helvetica,Arial,sans-serif";b.textBaseline="top";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,v){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+" "+h+" ("+e(c)+"-"+e(g)+")",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};"object"===typeof module&&(module.exports=Stats)},{}],102:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:89,inherits:92,"readable-stream/duplex.js":104,"readable-stream/passthrough.js":110,"readable-stream/readable.js":111,"readable-stream/transform.js":112,"readable-stream/writable.js":113}],103:[function(require,module,exports){arguments[4][85][0].apply(exports,arguments)},{dup:85}],104:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":105}],105:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":107,"./_stream_writable":109,"core-util-is":86,inherits:92,"process-nextick-args":99}],106:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":108,"core-util-is":86,inherits:92}],107:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var StringDecoder;util.inherits(Readable,Stream);var hasPrependListener=typeof EE.prototype.prependListener==="function";function prependListener(emitter,event,fn){if(hasPrependListener)return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}var Duplex;function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}var Duplex;function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);
skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else{return state.length}}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var _i=0;_i<len;_i++){dests[_i].emit("unpipe",this)}return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&!this._readableState.endEmitted){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else if(list.length===1)ret=list[0];else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=bufferShim.allocUnsafe(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var _buf=list[0];var cpy=Math.min(n-c,_buf.length);if(stringMode)ret+=_buf.slice(0,cpy);else _buf.copy(ret,c,0,cpy);if(cpy<_buf.length)list[0]=_buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":105,_process:100,buffer:84,"buffer-shims":83,"core-util-is":86,events:89,inherits:92,isarray:103,"process-nextick-args":99,"string_decoder/":114,util:82}],108:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("Not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":105,"core-util-is":86,inherits:92}],109:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}var Duplex;function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function writableStateGetBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var Duplex;function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":105,_process:100,buffer:84,"buffer-shims":83,"core-util-is":86,events:89,inherits:92,"process-nextick-args":99,"util-deprecate":116}],110:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":106}],111:[function(require,module,exports){(function(process){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module.exports=Stream}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":105,"./lib/_stream_passthrough.js":106,"./lib/_stream_readable.js":107,"./lib/_stream_transform.js":108,"./lib/_stream_writable.js":109,_process:100}],112:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":108}],113:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":109}],114:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:84}],115:[function(require,module,exports){(function(global,Buffer){"use strict";var bits=require("bit-twiddle");var dup=require("dup");if(!global.__TYPEDARRAY_POOL){global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])}}var hasUint8C=typeof Uint8ClampedArray!=="undefined";var POOL=global.__TYPEDARRAY_POOL;if(!POOL.UINT8C){POOL.UINT8C=dup([32,0])}if(!POOL.BUFFER){POOL.BUFFER=dup([32,0])}var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function free(array){if(Buffer.isBuffer(array)){BUFFER[bits.log2(array.length)].push(array)}else{if(Object.prototype.toString.call(array)!=="[object ArrayBuffer]"){array=array.buffer}if(!array){return}var n=array.length||array.byteLength;var log_n=bits.log2(n)|0;DATA[log_n].push(array)}};function freeArrayBuffer(buffer){if(!buffer){return}var n=buffer.length||buffer.byteLength;var log_n=bits.log2(n);DATA[log_n].push(buffer)}function freeTypedArray(array){freeArrayBuffer(array.buffer)}exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray;exports.freeArrayBuffer=freeArrayBuffer;exports.freeBuffer=function freeBuffer(array){BUFFER[bits.log2(array.length)].push(array)};exports.malloc=function malloc(n,dtype){if(dtype===undefined||dtype==="arraybuffer"){return mallocArrayBuffer(n)}else{switch(dtype){case"uint8":return mallocUint8(n);case"uint16":return mallocUint16(n);case"uint32":return mallocUint32(n);case"int8":return mallocInt8(n);case"int16":return mallocInt16(n);case"int32":return mallocInt32(n);case"float":case"float32":return mallocFloat(n);case"double":case"float64":return mallocDouble(n);case"uint8_clamped":return mallocUint8Clamped(n);case"buffer":return mallocBuffer(n);case"data":case"dataview":return mallocDataView(n);default:return null}}return null};function mallocArrayBuffer(n){var n=bits.nextPow2(n);var log_n=bits.log2(n);var d=DATA[log_n];if(d.length>0){return d.pop()}return new ArrayBuffer(n)}exports.mallocArrayBuffer=mallocArrayBuffer;function mallocUint8(n){return new Uint8Array(mallocArrayBuffer(n),0,n)}exports.mallocUint8=mallocUint8;function mallocUint16(n){return new Uint16Array(mallocArrayBuffer(2*n),0,n)}exports.mallocUint16=mallocUint16;function mallocUint32(n){return new Uint32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocUint32=mallocUint32;function mallocInt8(n){return new Int8Array(mallocArrayBuffer(n),0,n)}exports.mallocInt8=mallocInt8;function mallocInt16(n){return new Int16Array(mallocArrayBuffer(2*n),0,n)}exports.mallocInt16=mallocInt16;function mallocInt32(n){return new Int32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocInt32=mallocInt32;function mallocFloat(n){return new Float32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocFloat32=exports.mallocFloat=mallocFloat;function mallocDouble(n){return new Float64Array(mallocArrayBuffer(8*n),0,n)}exports.mallocFloat64=exports.mallocDouble=mallocDouble;function mallocUint8Clamped(n){if(hasUint8C){return new Uint8ClampedArray(mallocArrayBuffer(n),0,n)}else{return mallocUint8(n)}}exports.mallocUint8Clamped=mallocUint8Clamped;function mallocDataView(n){return new DataView(mallocArrayBuffer(n),0,n)}exports.mallocDataView=mallocDataView;function mallocBuffer(n){n=bits.nextPow2(n);var log_n=bits.log2(n);var cache=BUFFER[log_n];if(cache.length>0){return cache.pop()}return new Buffer(n)}exports.mallocBuffer=mallocBuffer;exports.clearCache=function clearCache(){for(var i=0;i<32;++i){POOL.UINT8[i].length=0;POOL.UINT16[i].length=0;POOL.UINT32[i].length=0;POOL.INT8[i].length=0;POOL.INT16[i].length=0;POOL.INT32[i].length=0;POOL.FLOAT[i].length=0;POOL.DOUBLE[i].length=0;POOL.UINT8C[i].length=0;DATA[i].length=0;BUFFER[i].length=0}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{"bit-twiddle":74,buffer:84,dup:87}],116:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[35]);